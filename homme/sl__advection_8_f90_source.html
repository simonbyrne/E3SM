<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Homme: src/share/sl_advection.F90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Homme
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sl__advection_8_f90_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">sl_advection.F90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sl__advection_8_f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifdef HAVE_CONFIG_H</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span><span class="preprocessor"># include &quot;config.h&quot;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor"></span> </div>
<div class="line"><a name="l00005"></a><span class="lineno"><a class="line" href="namespacesl__advection.html">    5</a></span>&#160;<span class="keyword">module</span> <a class="code" href="namespacesl__advection.html">sl_advection</a></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>, <span class="keywordtype">only</span>              : <a class="code" href="namespacekinds.html#abddc5e60584151b4d48b02e6436330f3">real_kind</a>, <a class="code" href="namespacekinds.html#a3df43a1a47df308ae70f8f8e98d9337c">int_kind</a></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacedimensions__mod.html">dimensions_mod</a>, <span class="keywordtype">only</span>     : <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a311b48352dde44bfd8b73213bfc94689">nlevp</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, <a class="code" href="namespacedimensions__mod.html#a5020e9504c2decc9d182fe296ffc3b42">qsize_d</a></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacephysical__constants.html">physical_constants</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacephysical__constants.html#a69f714bc9b76972dfccc59b88524efd3">rgas</a>, <a class="code" href="namespacephysical__constants.html#a9f7801ffaf5ec43f669eec6a85f3f784">rwater_vapor</a>, <a class="code" href="namespacephysical__constants.html#a7f66175ea1fb6d94513f85a5b57ff6db">kappa</a>, <a class="code" href="namespacephysical__constants.html#adf45737a6626ac54e4f0e4d83a69e839">g</a>, <a class="code" href="namespacephysical__constants.html#ab0f67c26417296baa8f3b876c001ff99">rearth</a>, <a class="code" href="namespacephysical__constants.html#af091abf0ec9f32e0c88a7f14ba3df1d9">rrearth</a>, <a class="code" href="namespacephysical__constants.html#a9e383c954fc7f7ee936c4848b91194a3">cp</a></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacederivative__mod.html">derivative_mod</a>, <span class="keywordtype">only</span>     : derivative_t, gradient_sphere, divergence_sphere</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespaceelement__mod.html">element_mod</a>, <span class="keywordtype">only</span>        : <a class="code" href="structelement__mod_1_1element__t.html">element_t</a></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacehybvcoord__mod.html">hybvcoord_mod</a>, <span class="keywordtype">only</span>      : <a class="code" href="structhybvcoord__mod_1_1hvcoord__t.html">hvcoord_t</a></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacetime__mod.html">time_mod</a>, <span class="keywordtype">only</span>           : <a class="code" href="structtime__mod_1_1timelevel__t.html">timelevel_t</a>, <a class="code" href="namespacetime__mod.html#a5dcb3daf686858cd2a8f3d0b6f5888b4">timelevel_qdp</a></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>, <span class="keywordtype">only</span>        : <a class="code" href="namespacecontrol__mod.html#a9a6f4129394969bdffe333ae2e3b4990">integration</a>, <a class="code" href="namespacecontrol__mod.html#a1c2d69b8f71e9a957a5b180477a751e4">test_case</a>, <a class="code" href="namespacecontrol__mod.html#a7538e7332f24585fe70aea206a84ee5d">hypervis_order</a>, <a class="code" href="namespacecontrol__mod.html#a7843d1e9a4379154a53150027e49f43b">transport_alg</a>, <a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespaceedge__mod.html">edge_mod</a>, <span class="keywordtype">only</span>           : edgevpack_nlyr, edgevunpack_nlyr, edge_g, &amp;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;       initghostbuffer3d, ghostvpack_unoriented, ghostvunpack_unoriented</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespaceedgetype__mod.html">edgetype_mod</a>, <span class="keywordtype">only</span>       : <a class="code" href="structedgetype__mod_1_1edgedescriptor__t.html">edgedescriptor_t</a>, <a class="code" href="structedgetype__mod_1_1edgebuffer__t.html">edgebuffer_t</a>, <a class="code" href="structedgetype__mod_1_1ghostbuffer3d__t.html">ghostbuffer3d_t</a></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacehybrid__mod.html">hybrid_mod</a>, <span class="keywordtype">only</span>         : <a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacebndry__mod.html">bndry_mod</a>, <span class="keywordtype">only</span>          : bndry_exchangev</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <span class="keywordtype">use </span>perf_mod, <span class="keywordtype">only</span>           : t_startf, t_stopf, t_barrierf <span class="comment">! _EXTERNAL</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespaceparallel__mod.html">parallel_mod</a>, <span class="keywordtype">only</span>       : <a class="code" href="namespaceparallel__mod.html#a00f76482d3b7bb15da165475c828f466">abortmp</a>, <a class="code" href="structparallel__mod_1_1parallel__t.html">parallel_t</a></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacecoordinate__systems__mod.html">coordinate_systems_mod</a>, <span class="keywordtype">only</span> : <a class="code" href="structcoordinate__systems__mod_1_1cartesian3d__t.html">cartesian3d_t</a></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  <span class="keywordtype">use </span><a class="code" href="namespacecompose__mod.html">compose_mod</a></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordtype">private</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keywordtype">  real</span>(real_kind), <span class="keywordtype">parameter</span> :: zero = 0.0_real_kind, fourth = 0.25_real_kind, &amp;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;       half = 0.5_real_kind, one = 1.0_real_kind, two = 2.0_real_kind, &amp;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;       eps = epsilon(1.0_real_kind)</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">type</span> (ghostBuffer3D_t)   :: ghostbuf_tr</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  <span class="keywordtype">type</span> (cartesian3D_t), <span class="keywordtype">allocatable</span> :: dep_points_all(:,:,:,:) <span class="comment">! (np,np,nlev,nelemd)</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keywordtype">  real</span>(kind=real_kind), <span class="keywordtype">dimension(:,:,:,:,:)</span>, <span class="keywordtype">allocatable</span> :: minq, maxq <span class="comment">! (np,np,nlev,qsize,nelemd)</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="comment">! For use in make_positive.</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keywordtype">  real</span>(kind=real_kind) :: dp_tol</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="keywordtype">public</span> :: <a class="code" href="namespacesl__advection.html#a81c34130a55d41c0fd8e542c1179a3bd">prim_advec_tracers_remap_ale</a>, <a class="code" href="namespacesl__advection.html#aee757725a5699052cf486db58117ccf5">sl_init1</a>, <a class="code" href="namespacesl__advection.html#a8ba565fd96cb9b82977c6e0b1db77098">sl_vertically_remap_tracers</a>, <a class="code" href="namespacesl__advection.html#ade3fbec219e2361b39f8db6e113d0e38">sl_unittest</a></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: barrier = .false.</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keyword">contains</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="comment">!=================================================================================================!</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keyword">subroutine </span>sl_parse_transport_alg(transport_alg, slmm, cisl, qos, sl_test, independent_time_steps)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacecontrol__mod.html#a242f2b7da6d34c2ed16a4820ee0033f9">dt_remap_factor</a>, <a class="code" href="namespacecontrol__mod.html#a6909204405993d9c799d4f81181bb0c8">dt_tracer_factor</a></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: transport_alg</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(out)</span> :: slmm, cisl, qos, sl_test, independent_time_steps</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="namespaceslmm.html">slmm</a> = transport_alg &gt; 1</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    cisl = transport_alg == 2 .or. transport_alg == 3 .or. transport_alg &gt;= 20</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    qos  = cisl .and. (transport_alg == 3 .or. transport_alg == 39)  </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    sl_test = (transport_alg &gt;= 17 .and. transport_alg &lt;= 19) .or. &amp;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;         transport_alg == 29 .or. transport_alg == 39</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">! Either dt_remap_factor = 0 (vertically Eulerian dynamics) or</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">! dt_remap_factor &lt; dt_tracer_factor (vertically Lagrangian</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">! dynamics&#39; vertical remap time step &lt; tracer time step).</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    independent_time_steps = <a class="code" href="namespacecontrol__mod.html#a242f2b7da6d34c2ed16a4820ee0033f9">dt_remap_factor</a> &lt; <a class="code" href="namespacecontrol__mod.html#a6909204405993d9c799d4f81181bb0c8">dt_tracer_factor</a></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keyword">end subroutine </span>sl_parse_transport_alg</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#aee757725a5699052cf486db58117ccf5">   64</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#aee757725a5699052cf486db58117ccf5">sl_init1</a>(par, elem)</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceinterpolate__mod.html">interpolate_mod</a>,        <span class="keywordtype">only</span> : <a class="code" href="namespaceinterpolate__mod.html#a3a616000a8ae3e578f566bd332d05188">interpolate_tracers_init</a></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>,            <span class="keywordtype">only</span> : <a class="code" href="namespacecontrol__mod.html#a7843d1e9a4379154a53150027e49f43b">transport_alg</a>, <a class="code" href="namespacecontrol__mod.html#ae2d01a75815e71546709ca4a63a3e6ac">semi_lagrange_cdr_alg</a>, <a class="code" href="namespacecontrol__mod.html#aff62de0026bd6ea7c244564a9cbf1c03">cubed_sphere_map</a>, &amp;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;         <a class="code" href="namespacecontrol__mod.html#a0142942a55c16000237db63932980642">nu_q</a>, <a class="code" href="namespacecontrol__mod.html#a3c37a279d8c63ac16bc5210798e1e1e7">semi_lagrange_hv_q</a></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceelement__state.html">element_state</a>,          <span class="keywordtype">only</span> : <a class="code" href="namespaceelement__state.html#ad600dbbab5d81bfc236df4786d322a10">timelevels</a></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecoordinate__systems__mod.html">coordinate_systems_mod</a>, <span class="keywordtype">only</span> : <a class="code" href="structcoordinate__systems__mod_1_1cartesian3d__t.html">cartesian3d_t</a>, change_coordinates</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordtype">use </span>perf_mod, <span class="keywordtype">only</span>: t_startf, t_stopf</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">iulog</a></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structparallel__mod_1_1parallel__t.html">parallel_t</a>) :: par</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structelement__mod_1_1element__t.html">element_t</a>) :: elem(:)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structcoordinate__systems__mod_1_1cartesian3d__t.html">cartesian3d_t</a>) :: pinside</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordtype">integer</span> :: nslots, ie, num_neighbors, need_conservation, i, j</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="keywordtype">logical</span> :: <a class="code" href="namespaceslmm.html">slmm</a>, cisl, qos, sl_test, independent_time_steps</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#ifdef HOMME_ENABLE_COMPOSE</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;sl_init1&#39;</span>)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacecontrol__mod.html#a7843d1e9a4379154a53150027e49f43b">transport_alg</a> &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;       <span class="keyword">call </span>sl_parse_transport_alg(<a class="code" href="namespacecontrol__mod.html#a7843d1e9a4379154a53150027e49f43b">transport_alg</a>, <a class="code" href="namespaceslmm.html">slmm</a>, cisl, qos, sl_test, independent_time_steps)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;       <span class="keywordflow">if</span> (par%masterproc .and. <a class="code" href="namespacecontrol__mod.html#a0142942a55c16000237db63932980642">nu_q</a> &gt; 0 .and. <a class="code" href="namespacecontrol__mod.html#a3c37a279d8c63ac16bc5210798e1e1e7">semi_lagrange_hv_q</a> &gt; 0) &amp;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keyword">write</span>(<a class="code" href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">iulog</a>,*) <span class="stringliteral">&#39;COMPOSE&gt; use HV; nu_q, all:&#39;</span>, <a class="code" href="namespacecontrol__mod.html#a0142942a55c16000237db63932980642">nu_q</a>, <a class="code" href="namespacecontrol__mod.html#a3c37a279d8c63ac16bc5210798e1e1e7">semi_lagrange_hv_q</a></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;       nslots = <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>*<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;       <span class="keyword">call </span><a class="code" href="namespaceinterpolate__mod.html#a3a616000a8ae3e578f566bd332d05188">interpolate_tracers_init</a>()</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;       <span class="comment">! Technically a memory leak, but the array persists for the entire</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;       <span class="comment">! run, so not a big deal for now.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;       <span class="keyword">allocate</span>(dep_points_all(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,<span class="keyword">size</span>(elem)))</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;       <span class="keywordflow">do</span> ie = 1, <span class="keyword">size</span>(elem)</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;          <span class="comment">! Provide a point inside the target element.</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;          pinside = change_coordinates(elem(ie)%spherep(2,2))</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;          num_neighbors = elem(ie)%desc%actual_neigh_edges + 1</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;          <span class="keyword">call </span><a class="code" href="compose__slmm_8cpp.html#a98fd88feb99433d9ee1ba08414134b3e">slmm_init_local_mesh</a>(ie, elem(ie)%desc%neigh_corners, num_neighbors, &amp;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;               pinside, <span class="keyword">size</span>(elem(ie)%desc%neigh_corners,2))</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;          <span class="keywordflow">if</span> (sl_test) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;             <span class="keywordflow">do</span> j = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="keywordflow">do</span> i = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                   pinside = change_coordinates(elem(ie)%spherep(i,j))</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                   <span class="keyword">call </span><a class="code" href="compose__slmm_8cpp.html#a7f1def61c5ac9e4753536215ae1fb3c6">slmm_check_ref2sphere</a>(ie, pinside)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keywordflow">                end do</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="keywordflow">             end do</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;       <span class="keyword">call </span><a class="code" href="compose__slmm_8cpp.html#ad07d1b06cdd32a08841d0ed836bf8ace">slmm_init_finalize</a>()</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;       <span class="keywordflow">if</span> (<a class="code" href="namespacecontrol__mod.html#ae2d01a75815e71546709ca4a63a3e6ac">semi_lagrange_cdr_alg</a> &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;          need_conservation = 1</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;          <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#abc8a42a818fcdafcf2eb3644a461521a">cedr_sl_init</a>(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, <a class="code" href="namespacedimensions__mod.html#a5020e9504c2decc9d182fe296ffc3b42">qsize_d</a>, <a class="code" href="namespaceelement__state.html#ad600dbbab5d81bfc236df4786d322a10">timelevels</a>, need_conservation)</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;       <span class="keyword">allocate</span>(minq(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>,<span class="keyword">size</span>(elem)), maxq(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>,<span class="keyword">size</span>(elem)))</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;       dp_tol = -one</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;sl_init1&#39;</span>)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor"></span>  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#aee757725a5699052cf486db58117ccf5">sl_init1</a></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a81c34130a55d41c0fd8e542c1179a3bd">  117</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#a81c34130a55d41c0fd8e542c1179a3bd">prim_advec_tracers_remap_ale</a>(elem, deriv, hvcoord, hybrid, dt, tl, nets, nete)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecoordinate__systems__mod.html">coordinate_systems_mod</a>, <span class="keywordtype">only</span> : <a class="code" href="structcoordinate__systems__mod_1_1cartesian3d__t.html">cartesian3d_t</a>, <a class="code" href="structcoordinate__systems__mod_1_1cartesian2d__t.html">cartesian2d_t</a></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacedimensions__mod.html">dimensions_mod</a>,         <span class="keywordtype">only</span> : <a class="code" href="namespacedimensions__mod.html#a18c8482a9b97b76f2f0f065ad2329a9d">max_neigh_edges</a></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacebndry__mod.html">bndry_mod</a>,              <span class="keywordtype">only</span> : ghost_exchangevfull</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceinterpolate__mod.html">interpolate_mod</a>,        <span class="keywordtype">only</span> : <a class="code" href="namespaceinterpolate__mod.html#a664716eba599277c527f7ecd0d8036a8">interpolate_tracers</a>, <a class="code" href="namespaceinterpolate__mod.html#a35e943dfe23cd5d993f59610823e3869">minmax_tracers</a></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>,            <span class="keywordtype">only</span> : <a class="code" href="namespacecontrol__mod.html#a6909204405993d9c799d4f81181bb0c8">dt_tracer_factor</a>, <a class="code" href="namespacecontrol__mod.html#a0142942a55c16000237db63932980642">nu_q</a>, <a class="code" href="namespacecontrol__mod.html#a7843d1e9a4379154a53150027e49f43b">transport_alg</a>, <a class="code" href="namespacecontrol__mod.html#a3c37a279d8c63ac16bc5210798e1e1e7">semi_lagrange_hv_q</a>, &amp;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;         <a class="code" href="namespacecontrol__mod.html#ae2d01a75815e71546709ca4a63a3e6ac">semi_lagrange_cdr_alg</a>, <a class="code" href="namespacecontrol__mod.html#ab14b33338b3f65ce4aff1c5db5e299d1">semi_lagrange_cdr_check</a></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="comment">! For DCMIP16 supercell test case.</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>,            <span class="keywordtype">only</span> : <a class="code" href="namespacecontrol__mod.html#aa42fe46bfc88132a53ea639ea5504a24">dcmip16_mu_q</a></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceprim__advection__base.html">prim_advection_base</a>,    <span class="keywordtype">only</span> : <a class="code" href="namespaceprim__advection__base.html#aa1b3ddd0ebdfda6841170f7842eb3dcc">advance_physical_vis</a></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacevertremap__base.html">vertremap_base</a>,         <span class="keywordtype">only</span> : <a class="code" href="namespacevertremap__base.html#af3d970dd3d2368cb76531117cc4aacc4">remap1</a></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structelement__mod_1_1element__t.html">element_t</a>)     , <span class="keywordtype">intent(inout)</span> :: elem(:)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordtype">type</span> (derivative_t)  , <span class="keywordtype">intent(in   )</span> :: deriv</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structhybvcoord__mod_1_1hvcoord__t.html">hvcoord_t</a>)     , <span class="keywordtype">intent(in   )</span> :: hvcoord</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a>)      , <span class="keywordtype">intent(in   )</span> :: hybrid</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind) , <span class="keywordtype">intent(in   )</span> :: dt</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structtime__mod_1_1timelevel__t.html">timelevel_t</a>)   , <span class="keywordtype">intent(in   )</span> :: tl</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span> :: nets</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span> :: nete</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structcoordinate__systems__mod_1_1cartesian3d__t.html">cartesian3d_t</a>)   :: dep_points  (np,np)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordtype">integer</span> :: i,j,k,l,n,q,ie,n0_qdp,np1_qdp</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordtype">integer</span> :: num_neighbors, scalar_q_bounds, info</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordtype">logical</span> :: <a class="code" href="namespaceslmm.html">slmm</a>, cisl, qos, sl_test, independent_time_steps</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind) :: wr(np,np,nlev,2)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">#ifdef HOMME_ENABLE_COMPOSE</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor"></span>    <span class="keyword">call </span>t_barrierf(<span class="stringliteral">&#39;Prim_Advec_Tracers_remap_ALE&#39;</span>, hybrid%par%comm)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;Prim_Advec_Tracers_remap_ALE&#39;</span>)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keyword">call </span>sl_parse_transport_alg(transport_alg, <a class="code" href="namespaceslmm.html">slmm</a>, cisl, qos, sl_test, independent_time_steps)</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacetime__mod.html#a5dcb3daf686858cd2a8f3d0b6f5888b4">timelevel_qdp</a>(tl, dt_tracer_factor, n0_qdp, np1_qdp)</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">do</span> ie = nets,nete</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;       elem(ie)%derived%vn0 = elem(ie)%state%v(:,:,:,:,tl%np1)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">if</span> (independent_time_steps) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;       <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;SLMM_reconstruct&#39;</span>)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;       <span class="keywordflow">if</span> (dp_tol &lt; zero) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;          <span class="comment">! Thread write race condition; benign b/c written value is same in all threads.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;          <span class="keyword">call </span>set_dp_tol(hvcoord, dp_tol)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;       <span class="keywordflow">do</span> ie = nets,nete</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;          <span class="comment">! divdp is dp_star</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ad1e85e15e324c7b4e9796f9ec18376e0">calc_vertically_lagrangian_levels</a>(hybrid, elem(ie), ie, hvcoord, tl, dt, &amp;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;               deriv, dp_tol, elem(ie)%derived%divdp)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;          wr(:,:,:,1) = elem(ie)%derived%vn0(:,:,1,:)*elem(ie)%state%dp3d(:,:,:,tl%np1)</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;          wr(:,:,:,2) = elem(ie)%derived%vn0(:,:,2,:)*elem(ie)%state%dp3d(:,:,:,tl%np1)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacevertremap__base.html#af3d970dd3d2368cb76531117cc4aacc4">remap1</a>(wr, np, 2, elem(ie)%state%dp3d(:,:,:,tl%np1), elem(ie)%derived%divdp)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          elem(ie)%derived%vn0(:,:,1,:) = wr(:,:,:,1)/elem(ie)%derived%divdp</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;          elem(ie)%derived%vn0(:,:,2,:) = wr(:,:,:,2)/elem(ie)%derived%divdp</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;       <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;SLMM_reconstruct&#39;</span>)</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ac7a5c34b24e1562b64a3b8d682f9682d">ale_rkdss</a>(elem, nets, nete, hybrid, deriv, dt, tl, independent_time_steps)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160; </div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span> (barrier) <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">perf_barrier</a>(hybrid)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;SLMM_v2x&#39;</span>)</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordflow">do</span> ie = nets, nete</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;       num_neighbors = elem(ie)%desc%actual_neigh_edges + 1</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="preprocessor">#if (defined COLUMN_OPENMP)</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="preprocessor"></span>       <span class="comment">!$omp parallel do private(k)</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="preprocessor"></span>       <span class="keywordflow">do</span> k = 1, nlev</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#a60c1e2943a45bdad87d374dbfd85b9df">ale_departure_from_gll</a>(dep_points_all(:,:,k,ie), &amp;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;               elem(ie)%derived%vstar(:,:,:,k), elem(ie), dt, normalize=.true.)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;SLMM_v2x&#39;</span>)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;SLMM_csl&#39;</span>)</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">!todo Here and in the set-pointer loop for CEDR, do just in the first call.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">do</span> ie = nets, nete</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;       <span class="keyword">call </span><a class="code" href="compose__slmm_8cpp.html#a3b3cf3d8c264ccb732bc94edd2b2575b">slmm_csl_set_elem_data</a>(ie, elem(ie)%metdet, &amp;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            elem(ie)%state%Qdp(:,:,:,:,n0_qdp), &amp;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            elem(ie)%derived%dp, elem(ie)%state%Q, &amp;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            elem(ie)%desc%actual_neigh_edges + 1)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <span class="comment">! edge_g buffers are shared by SLMM, CEDR, other places in HOMME, and</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">! dp_coupling in EAM. Thus, we must take care to protected threaded</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">! access. In the following, &quot;No barrier needed&quot; comments justify why a</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">! barrier isn&#39;t needed.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">! No barrier needed: ale_rkdss has a horiz thread barrier at the end.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">call </span><a class="code" href="compose__slmm_8cpp.html#aeedef9961e344918a8181917bfdb31ba">slmm_csl</a>(nets, nete, dep_points_all, minq, maxq, info)</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">! No barrier needed: slmm_csl has a horiz thread barrier at the end.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">if</span> (info /= 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#a6e1aeb13721bdac8f49b15a97a3a7a88">write_velocity_data</a>(elem, nets, nete, hybrid, deriv, dt, tl)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;       <span class="keyword">call </span><a class="code" href="namespaceparallel__mod.html#a00f76482d3b7bb15da165475c828f466">abortmp</a>(<span class="stringliteral">&#39;slmm_csl returned -1; see output above for more information.&#39;</span>)</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (barrier) <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">perf_barrier</a>(hybrid)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;SLMM_csl&#39;</span>)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span> (semi_lagrange_hv_q &gt; 0 .and. nu_q &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;       n = semi_lagrange_hv_q</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#a81b334fbea02bd090428fd930848fbce">advance_hypervis_scalar</a>(elem, hvcoord, hybrid, deriv, tl%np1, np1_qdp, nets, nete, dt, n)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;       <span class="comment">! No barrier needed: advance_hypervis_scalar has a horiz thread barrier at the end.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">! CEDR works with either classical SL or IR.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">if</span> (semi_lagrange_cdr_alg &gt; 1) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;       scalar_q_bounds = 0</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;       <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#ae8e9dd870a128686a261eb848c9a18a2">cedr_sl_set_pointers_begin</a>(nets, nete)</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;       <span class="keywordflow">do</span> ie = nets, nete</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;          <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#ae31f3ee7ed0b1796b20d315da6067bd7">cedr_sl_set_spheremp</a>(ie, elem(ie)%spheremp)</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;          <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#adb50e9b1de2f71de7cc4bd92ecd6a495">cedr_sl_set_dp0</a>(hvcoord%dp0)</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;          <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#ae3ec6a834c0bd7647fde8f59d31cb012">cedr_sl_set_qdp</a>(ie, elem(ie)%state%Qdp, n0_qdp, np1_qdp)</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;          <span class="keywordflow">if</span> (independent_time_steps) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;             <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#af90836fbfe6950bf37bc5cfe57ad9ebc">cedr_sl_set_dp</a>(ie, elem(ie)%derived%divdp) <span class="comment">! dp_star</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;             <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#aac63b05d328ad81de6a8b4a6b6390f59">cedr_sl_set_dp3d</a>(ie, elem(ie)%state%dp3d, tl%np1)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;          <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#af5a0276bb2dbefb74e60bc2f48777353">cedr_sl_set_q</a>(ie, elem(ie)%state%Q)</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;       <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#a01a8e64063567601af02f3ee19e4a4c3">cedr_sl_set_pointers_end</a>()</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;       <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;CEDR&#39;</span>)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;       <span class="comment">! No barrier needed: A barrier was already called.</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;       <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#a6733f39eb2f96fb3a1149d1a087aedaa">cedr_sl_run</a>(minq, maxq, nets, nete)</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;       <span class="comment">! No barrier needed: run_cdr has a horiz thread barrier at the end.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;       <span class="keywordflow">if</span> (barrier) <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">perf_barrier</a>(hybrid)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;       <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;CEDR&#39;</span>)</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;       <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;CEDR_local&#39;</span>)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;       <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#ae747afb448da5f0376697e43d74778c5">cedr_sl_run_local</a>(minq, maxq, nets, nete, scalar_q_bounds, limiter_option)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;       <span class="comment">! Barrier needed to protect edge_g buffers use in CEDR.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">#if (defined HORIZ_OPENMP)</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor"></span>       <span class="comment">!$omp barrier</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="preprocessor"></span>       <span class="keywordflow">if</span> (barrier) <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">perf_barrier</a>(hybrid)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;       <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;CEDR_local&#39;</span>)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;       <span class="keywordflow">do</span> ie = nets, nete</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;          <span class="keywordflow">do</span> k = 1, nlev</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;             <span class="keywordflow">do</span> q = 1, qsize</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                elem(ie)%state%Qdp(:,:,k,q,np1_qdp) = elem(ie)%state%Q(:,:,k,q) * &amp;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                     elem(ie)%state%dp3d(:,:,k,tl%np1)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">! Technically, dss_Qdp is needed only if semi_lagrange_cdr_alg &gt; 1;</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="comment">! otherwise, each Q(dp) field is already continuous. But SL transport would</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="comment">! be run without a CDR only by a specialist doing some debugging. Meanwhile,</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">! dss_Qdp also DSSes derived%omega_p for diagnostics. It&#39;s important not to</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">! forget to do that, and we don&#39;t need to optimize for the</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">! semi_lagrange_cdr_alg &lt;= 1 case, so just always call dss_Qdp.</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;SL_dss&#39;</span>)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ab7dc046ce9683ab097234f77c7f76398">dss_qdp</a>(elem, nets, nete, hybrid, np1_qdp)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span> (barrier) <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">perf_barrier</a>(hybrid)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;SL_dss&#39;</span>)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span> (semi_lagrange_cdr_check) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;       <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;CEDR_check&#39;</span>)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;       <span class="keyword">call </span><a class="code" href="compose__cedr_8cpp.html#a955408f4b6bdfb672629fed0acaa3edf">cedr_sl_check</a>(minq, maxq, nets, nete)</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;       <span class="keywordflow">if</span> (barrier) <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">perf_barrier</a>(hybrid)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;       <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;CEDR_check&#39;</span>)</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="keywordflow">    end if</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">! physical viscosity for supercell test case</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacecontrol__mod.html#aa42fe46bfc88132a53ea639ea5504a24">dcmip16_mu_q</a> &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;       <span class="keyword">call </span><a class="code" href="namespaceprim__advection__base.html#aa1b3ddd0ebdfda6841170f7842eb3dcc">advance_physical_vis</a>(elem, hvcoord, hybrid, deriv, tl%np1, np1_qdp, nets, nete, dt, <a class="code" href="namespacecontrol__mod.html#aa42fe46bfc88132a53ea639ea5504a24">dcmip16_mu_q</a>)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;Prim_Advec_Tracers_remap_ALE&#39;</span>)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="preprocessor"></span>  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#a81c34130a55d41c0fd8e542c1179a3bd">prim_advec_tracers_remap_ale</a></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">! ----------------------------------------------------------------------------------!</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">!SUBROUTINE ALE_RKDSS</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  <span class="comment">! AUTHOR: CHRISTOPH ERATH, MARK TAYLOR, 06. December 2012</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">!</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">! DESCRIPTION: ! create a runge kutta taylor serios mixture to calculate the departure grid</span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">!</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">! CALLS:</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">! INPUT:</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">!</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="comment">! OUTPUT:</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">!-----------------------------------------------------------------------------------!</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  <span class="comment">! this will calculate the velocity at time t+1/2  along the trajectory s(t) given the velocities</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="comment">! at the GLL points at time t and t+1 using a second order time accurate formulation.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#ac7a5c34b24e1562b64a3b8d682f9682d">  298</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#ac7a5c34b24e1562b64a3b8d682f9682d">ale_rkdss</a>(elem, nets, nete, hy, deriv, dt, tl, independent_time_steps)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacederivative__mod.html">derivative_mod</a>,  <span class="keywordtype">only</span> : derivative_t, ugradv_sphere</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceedgetype__mod.html">edgetype_mod</a>,    <span class="keywordtype">only</span> : <a class="code" href="structedgetype__mod_1_1edgebuffer__t.html">edgebuffer_t</a></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacebndry__mod.html">bndry_mod</a>,       <span class="keywordtype">only</span> : bndry_exchangev</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>,           <span class="keywordtype">only</span> : real_kind</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacehybrid__mod.html">hybrid_mod</a>,      <span class="keywordtype">only</span> : <a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceelement__mod.html">element_mod</a>,     <span class="keywordtype">only</span> : <a class="code" href="structelement__mod_1_1element__t.html">element_t</a></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacedimensions__mod.html">dimensions_mod</a>,  <span class="keywordtype">only</span> : <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordtype">type</span> (element_t)     , <span class="keywordtype">intent(inout)</span>             :: elem(:)</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span>             :: nets</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span>             :: nete</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">type</span> (hybrid_t)      , <span class="keywordtype">intent(in)</span>                :: hy <span class="comment">! distributed parallel structure (shared)</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">type</span> (derivative_t)  , <span class="keywordtype">intent(in)</span>                :: deriv <span class="comment">! derivative struct</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">intent(in)</span>                :: dt <span class="comment">! timestep</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordtype">type</span> (TimeLevel_t)   , <span class="keywordtype">intent(in)</span>                :: tl</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordtype">logical</span>              , <span class="keywordtype">intent(in)</span>                :: independent_time_steps</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <span class="keywordtype">integer</span>                                          :: ie, k</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">dimension(np,np,2)</span>        :: vtmp</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordtype">integer</span> :: nlyr</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160; </div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">! RK-SSP 2 stage 2nd order:</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">!     x*(t+1) = x(t) + U(x(t),t) dt</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">!     x(t+1) = x(t) +  1/2 ( U(x*(t+1),t+1) + U(x(t),t) ) dt</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="comment">! apply taylor series:</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="comment">!  U(x*(t+1),t+1) = U(x(t),t+1) + (x*(t+1)-x(t)) gradU(x(t),t+1)</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">! x(t+1) = x(t) +  1/2 ( U(x(t),t+1) + (x*(t+1)-x(t)) gradU(x(t),t+1) + U(x(t),t) ) dt</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="comment">! (x(t+1) - x(t)) / dt =  1/2 ( U(x(t),t+1) + (x*(t+1)-x(t)) gradU(x(t),t+1) + U(x(t),t) )</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="comment">! (x(t+1) - x(t)) / dt =  1/2 ( U(x(t),t+1) + U(x(t),t) + (x*(t+1)-x(t)) gradU(x(t),t+1) )</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="comment">! (x(t+1) - x(t)) / dt =  1/2 ( U(x(t),t+1) + U(x(t),t) + U(x(t),t) dt  gradU(x(t),t+1) )</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="comment">!  (x(t+1)-x(t))/dt =  1/2(U(x(t),t+1) + U(x(t),t) + dt U(x(t),t) gradU(x(t),t+1))</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="comment">! suppose dt = -ts (we go backward)</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">!  (x(t-ts)-x(t))/-ts =  1/2( U(x(t),t-ts)+U(x(t),t)) - ts 1/2 U(x(t),t) gradU(x(t),t-ts)</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="comment">!  x(t-ts) = x(t)) -ts * [ 1/2( U(x(t),t-ts)+U(x(t),t)) - ts 1/2 U(x(t),t) gradU(x(t),t-ts) ]</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    nlyr = 2*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">if</span> (independent_time_steps) nlyr = nlyr + <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordflow">do</span> ie = nets,nete</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;       <span class="comment">! vstarn0 = U(x,t)</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;       <span class="comment">! vstar   = U(x,t+1)</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;       <span class="keywordflow">do</span> k=1,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          <span class="comment">! vstar is v at the start of the tracer time step, and vn0</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          <span class="comment">! is v at the end of the tracer time step.</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;          vtmp(:,:,:) = ugradv_sphere(elem(ie)%derived%vn0(:,:,:,k), elem(ie)%derived%vstar(:,:,:,k), &amp;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;               deriv, elem(ie))</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;          elem(ie)%derived%vstar(:,:,:,k) = &amp;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;               (elem(ie)%derived%vn0(:,:,:,k) + elem(ie)%derived%vstar(:,:,:,k))/2 - dt*vtmp(:,:,:)/2</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;          elem(ie)%derived%vstar(:,:,1,k) = elem(ie)%derived%vstar(:,:,1,k)*elem(ie)%spheremp*elem(ie)%rspheremp</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;          elem(ie)%derived%vstar(:,:,2,k) = elem(ie)%derived%vstar(:,:,2,k)*elem(ie)%spheremp*elem(ie)%rspheremp</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;          <span class="keywordflow">if</span> (independent_time_steps) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;             <span class="comment">! divdp contains the reconstructed dp.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;             elem(ie)%derived%divdp(:,:,k) = elem(ie)%derived%divdp(:,:,k)*elem(ie)%spheremp*elem(ie)%rspheremp</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;       <span class="keyword">call </span>edgevpack_nlyr(edge_g,elem(ie)%desc,elem(ie)%derived%vstar,2*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,0,nlyr)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;       <span class="keywordflow">if</span> (independent_time_steps) <span class="keyword">call </span>edgevpack_nlyr(edge_g,elem(ie)%desc,elem(ie)%derived%divdp,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,2*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,nlyr)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;ALE_RKdss_bexchV&#39;</span>)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">call </span>bndry_exchangev(hy,edge_g)</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;ALE_RKdss_bexchV&#39;</span>)</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="keywordflow">do</span> ie = nets,nete</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;       <span class="keyword">call </span>edgevunpack_nlyr(edge_g,elem(ie)%desc,elem(ie)%derived%vstar,2*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,0,nlyr)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;       <span class="keywordflow">if</span> (independent_time_steps) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;          <span class="keyword">call </span>edgevunpack_nlyr(edge_g,elem(ie)%desc,elem(ie)%derived%divdp,nlevp,2*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,nlyr)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="preprocessor">#if (defined HORIZ_OPENMP)</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="preprocessor"></span>    <span class="comment">!$omp barrier</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="preprocessor"></span>  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#ac7a5c34b24e1562b64a3b8d682f9682d">ale_rkdss</a></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a6e1aeb13721bdac8f49b15a97a3a7a88">  383</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#a6e1aeb13721bdac8f49b15a97a3a7a88">write_velocity_data</a>(elem, nets, nete, hy, deriv, dt, tl)</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacederivative__mod.html">derivative_mod</a>,  <span class="keywordtype">only</span> : derivative_t, ugradv_sphere</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceedgetype__mod.html">edgetype_mod</a>,    <span class="keywordtype">only</span> : <a class="code" href="structedgetype__mod_1_1edgebuffer__t.html">edgebuffer_t</a></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacebndry__mod.html">bndry_mod</a>,       <span class="keywordtype">only</span> : bndry_exchangev</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>,           <span class="keywordtype">only</span> : real_kind</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacehybrid__mod.html">hybrid_mod</a>,      <span class="keywordtype">only</span> : <a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceelement__mod.html">element_mod</a>,     <span class="keywordtype">only</span> : <a class="code" href="structelement__mod_1_1element__t.html">element_t</a></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacedimensions__mod.html">dimensions_mod</a>,  <span class="keywordtype">only</span> : <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordtype">type</span> (element_t)     , <span class="keywordtype">intent(inout)</span> :: elem(:)</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in)</span>    :: nets</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in)</span>    :: nete</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">type</span> (hybrid_t)      , <span class="keywordtype">intent(in)</span>    :: hy</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordtype">type</span> (derivative_t)  , <span class="keywordtype">intent(in)</span>    :: deriv</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">intent(in)</span>    :: dt</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordtype">type</span> (TimeLevel_t)   , <span class="keywordtype">intent(in)</span>    :: tl</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordtype">integer</span> :: ie, i, j, k, np1</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind) :: max_v, max_vstar</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160; </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    np1 = tl%np1</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    max_v = 0.d0</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    max_vstar = 0.d0</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">do</span> ie = nets,nete</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;       <span class="keywordflow">do</span> k = 1,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          <span class="keywordflow">do</span> j = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;             <span class="keywordflow">do</span> i = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                max_v = max(max_v, sqrt(sum(elem(ie)%state%v(i,j,:,k,np1)**2)))</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                max_vstar = max(max_vstar, sqrt(sum(elem(ie)%derived%vstar(i,j,:,k)**2)))</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keywordflow">             end do</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    print *, <span class="stringliteral">&#39;max_v, max_vstar on rank&#39;</span>, max_v, max_vstar, hy%par%rank</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#a6e1aeb13721bdac8f49b15a97a3a7a88">write_velocity_data</a></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="comment">! ----------------------------------------------------------------------------------!</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;  <span class="comment">!SUBROUTINE FVM_DEP_FROM_GLL----------------------------------------------CE-for FVM!</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;  <span class="comment">! AUTHOR: CHRISTOPH ERATH, MARK TAYLOR 14. December 2011                            !</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  <span class="comment">! DESCRIPTION: calculates the deparute grid for fvm coming from the gll points      !</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;  <span class="comment">!                                                                                   !</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="comment">! CALLS:</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="comment">! INPUT:</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="comment">!</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  <span class="comment">! OUTPUT:</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">!-----------------------------------------------------------------------------------!</span></div>
<div class="line"><a name="l00430"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a60c1e2943a45bdad87d374dbfd85b9df">  430</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#a60c1e2943a45bdad87d374dbfd85b9df">ale_departure_from_gll</a>(acart, vstar, elem, dt, normalize)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacephysical__constants.html">physical_constants</a>,     <span class="keywordtype">only</span> : <a class="code" href="namespacephysical__constants.html#ab0f67c26417296baa8f3b876c001ff99">rearth</a></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecoordinate__systems__mod.html">coordinate_systems_mod</a>, <span class="keywordtype">only</span> : <a class="code" href="structcoordinate__systems__mod_1_1spherical__polar__t.html">spherical_polar_t</a>, <a class="code" href="structcoordinate__systems__mod_1_1cartesian3d__t.html">cartesian3d_t</a>, change_coordinates</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacetime__mod.html">time_mod</a>,               <span class="keywordtype">only</span> : <a class="code" href="structtime__mod_1_1timelevel__t.html">timelevel_t</a></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceelement__mod.html">element_mod</a>,            <span class="keywordtype">only</span> : <a class="code" href="structelement__mod_1_1element__t.html">element_t</a></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>,                  <span class="keywordtype">only</span> : real_kind</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacedimensions__mod.html">dimensions_mod</a>,         <span class="keywordtype">only</span> : <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordtype">type</span>(<a class="code" href="structcoordinate__systems__mod_1_1cartesian3d__t.html">cartesian3d_t</a>)     ,<span class="keywordtype">intent(out)</span>  :: acart(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind)   ,<span class="keywordtype">intent(in)</span>   :: vstar(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,2)</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structelement__mod_1_1element__t.html">element_t</a>)        ,<span class="keywordtype">intent(in)</span>   :: elem</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind)   ,<span class="keywordtype">intent(in)</span>   :: dt</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: normalize</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordtype">integer</span>                               :: i,j</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind)                 :: uxyz(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,3), norm</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">! convert velocity from lat/lon to cartesian 3D</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">do</span> i=1,3</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;       <span class="comment">! Summing along the third dimension is a sum over components for each point.</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;       <span class="comment">! (This is just a faster way of doing a dot product for each grid point,</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;       <span class="comment">! since reindexing the inputs to use the intrinsic effectively would be</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;       <span class="comment">! just asking for trouble.)</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;       uxyz(:,:,i)=sum( elem%vec_sphere2cart(:,:,i,:)*vstar(:,:,:) ,3)</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="comment">! compute departure point</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="comment">! crude, 1st order accurate approximation.  to be improved</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="keywordflow">do</span> i=1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;       <span class="keywordflow">do</span> j=1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;          acart(i,j) = change_coordinates(elem%spherep(i,j)) </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;          acart(i,j)%x = acart(i,j)%x - dt*uxyz(i,j,1)/<a class="code" href="namespacephysical__constants.html#ab0f67c26417296baa8f3b876c001ff99">rearth</a></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;          acart(i,j)%y = acart(i,j)%y - dt*uxyz(i,j,2)/<a class="code" href="namespacephysical__constants.html#ab0f67c26417296baa8f3b876c001ff99">rearth</a></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;          acart(i,j)%z = acart(i,j)%z - dt*uxyz(i,j,3)/<a class="code" href="namespacephysical__constants.html#ab0f67c26417296baa8f3b876c001ff99">rearth</a></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;          <span class="keywordflow">if</span> (normalize) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;             norm = sqrt(acart(i,j)%x*acart(i,j)%x + acart(i,j)%y*acart(i,j)%y + &amp;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                  acart(i,j)%z*acart(i,j)%z)</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;             acart(i,j)%x = acart(i,j)%x / norm</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;             acart(i,j)%y = acart(i,j)%y / norm</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;             acart(i,j)%z = acart(i,j)%z / norm</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="keywordflow">          end if</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#a60c1e2943a45bdad87d374dbfd85b9df">ale_departure_from_gll</a></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#ab7dc046ce9683ab097234f77c7f76398">  478</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#ab7dc046ce9683ab097234f77c7f76398">dss_qdp</a>(elem, nets, nete, hybrid, np1_qdp)</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceedgetype__mod.html">edgetype_mod</a>,    <span class="keywordtype">only</span> : <a class="code" href="structedgetype__mod_1_1edgebuffer__t.html">edgebuffer_t</a></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacebndry__mod.html">bndry_mod</a>,       <span class="keywordtype">only</span> : bndry_exchangev</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacehybrid__mod.html">hybrid_mod</a>,      <span class="keywordtype">only</span> : <a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceelement__mod.html">element_mod</a>,     <span class="keywordtype">only</span> : <a class="code" href="structelement__mod_1_1element__t.html">element_t</a></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160; </div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structelement__mod_1_1element__t.html">element_t</a>), <span class="keywordtype">intent(inout)</span> :: elem(:)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">integer</span>         , <span class="keywordtype">intent(in   )</span> :: nets, nete, np1_qdp</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a>) , <span class="keywordtype">intent(in)</span>    :: hybrid</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordtype">integer</span>                         :: ie, q, k</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">do</span> ie = nets, nete</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;       <span class="keywordflow">do</span> q = 1, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;          <span class="keywordflow">do</span> k = 1, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;             elem(ie)%state%Qdp(:,:,k,q,np1_qdp) = elem(ie)%state%Qdp(:,:,k,q,np1_qdp)*elem(ie)%spheremp(:,:)</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;       <span class="keyword">call </span>edgevpack_nlyr(edge_g, elem(ie)%desc, elem(ie)%state%Qdp(:,:,:,:,np1_qdp), &amp;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, 0, (<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>+1)*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;       <span class="comment">! Also DSS omega_p for diagnostics. This has nothing to do with tracer</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;       <span class="comment">! transport; it&#39;s just a good place to do the DSS.</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;       <span class="keywordflow">do</span> k = 1, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;          elem(ie)%derived%omega_p(:,:,k) = elem(ie)%spheremp(:,:) * elem(ie)%derived%omega_p(:,:,k)</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;       <span class="keyword">call </span>edgevpack_nlyr(edge_g, elem(ie)%desc, elem(ie)%derived%omega_p(:,:,:), &amp;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, (<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>+1)*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;SLMM_bexchV&#39;</span>)</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keyword">call </span>bndry_exchangev(hybrid, edge_g)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;SLMM_bexchV&#39;</span>)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">do</span> ie = nets, nete</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;       <span class="keyword">call </span>edgevunpack_nlyr(edge_g, elem(ie)%desc, elem(ie)%state%Qdp(:,:,:,:,np1_qdp), &amp;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, 0, (<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>+1)*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;       <span class="keywordflow">do</span> q = 1, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;          <span class="keywordflow">do</span> k = 1, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;             elem(ie)%state%Qdp(:,:,k,q,np1_qdp) = elem(ie)%state%Qdp(:,:,k,q,np1_qdp)*elem(ie)%rspheremp(:,:)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;       <span class="keyword">call </span>edgevunpack_nlyr(edge_g, elem(ie)%desc, elem(ie)%derived%omega_p(:,:,:), &amp;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, (<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>+1)*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;       <span class="keywordflow">do</span> k = 1, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;          elem(ie)%derived%omega_p(:,:,k) = elem(ie)%rspheremp(:,:) * elem(ie)%derived%omega_p(:,:,k)</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#ab7dc046ce9683ab097234f77c7f76398">dss_qdp</a></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">! Replacement for edge_mod_base::ghostvpack_unoriented, which has a strange</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="comment">! &#39;threadsafe&#39; module variable that causes a race condition when HORIZ and</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  <span class="comment">! COLUMN threading are on at the same time.</span></div>
<div class="line"><a name="l00530"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a83bd2ae5eada0731769fc1d7b01c206e">  530</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#a83bd2ae5eada0731769fc1d7b01c206e">amb_ghostvpack_unoriented</a>(edge,v,nc,vlyr,kptr,desc)</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceedgetype__mod.html">edgetype_mod</a>, <span class="keywordtype">only</span> : <a class="code" href="structedgetype__mod_1_1edgedescriptor__t.html">edgedescriptor_t</a>, <a class="code" href="structedgetype__mod_1_1ghostbuffer3d__t.html">ghostbuffer3d_t</a> </div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    <span class="keywordtype">type</span> (Ghostbuffer3D_t),<span class="keywordtype">intent(inout)</span> :: edge</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>   :: vlyr</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>   :: nc</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind),<span class="keywordtype">intent(in)</span>   :: v(nc,nc,vlyr)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordtype">integer</span>,              <span class="keywordtype">intent(in)</span>   :: kptr</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="keywordtype">type</span> (EdgeDescriptor_t),<span class="keywordtype">intent(in)</span> :: desc</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160; </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <span class="keywordtype">integer</span> :: k,l,l_local,is</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    <span class="keywordflow">do</span> l_local=1,desc%actual_neigh_edges</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;       l=desc%loc2buf(l_local)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;       is = desc%putmapP_ghost(l)</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;       <span class="keywordflow">do</span> k=1,vlyr</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;          edge%buf(:,:,kptr+k,is) = v(:,:,k)  </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#a83bd2ae5eada0731769fc1d7b01c206e">amb_ghostvpack_unoriented</a></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#aca3c66450815ee2b91aa1a08453b8c1c">  551</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#aca3c66450815ee2b91aa1a08453b8c1c">amb_ghostvunpack_unoriented</a>(edge,v,nc,vlyr,kptr,desc,GlobalId,u)</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceedgetype__mod.html">edgetype_mod</a>, <span class="keywordtype">only</span> : <a class="code" href="structedgetype__mod_1_1ghostbuffer3d__t.html">ghostbuffer3d_t</a>, <a class="code" href="structedgetype__mod_1_1edgedescriptor__t.html">edgedescriptor_t</a></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordtype">type</span> (Ghostbuffer3D_t),<span class="keywordtype">intent(inout)</span>  :: edge</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>     :: vlyr</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>     :: nc</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">intent(out)</span>    :: v(nc,nc,vlyr,*)</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordtype">integer</span>,               <span class="keywordtype">intent(in)</span>     :: kptr</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordtype">type</span> (EdgeDescriptor_t),<span class="keywordtype">intent(in)</span>    :: desc</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordtype">integer(kind=int_kind)</span>,<span class="keywordtype">intent(in)</span>     :: GlobalId</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">intent(in)</span>     :: u(nc,nc,vlyr)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160; </div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="keywordtype">integer</span> :: k,l,n,is,m,pid,gid</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160; </div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    m=0</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    gid = globalid</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">do</span> n=1,desc%actual_neigh_edges+1</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;       l = desc%loc2buf(m+1)</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;       pid = desc%globalID(l)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;       <span class="keywordflow">if</span> (m==desc%actual_neigh_edges .OR. pid &lt; gid) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;          gid = -1</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;          v(:,:,:,n) = u(:,:,:)</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;       <span class="keywordflow">else</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;          m = m+1</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;          is = desc%getmapP_ghost(l)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;          <span class="keywordflow">do</span> k=1,vlyr</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;             v(:,:,k,n) = edge%buf(:,:,kptr+k,is) </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#aca3c66450815ee2b91aa1a08453b8c1c">amb_ghostvunpack_unoriented</a></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">  584</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">perf_barrier</a>(hybrid)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacehybrid__mod.html">hybrid_mod</a>, <span class="keywordtype">only</span> : <a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordtype">type</span> (hybrid_t), <span class="keywordtype">intent(in)</span> :: hybrid</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordtype">integer</span> :: ierr</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="preprocessor"></span>    <span class="comment">!$OMP BARRIER</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span> (hybrid%ithr == 0) <span class="keyword">call </span>mpi_barrier(hybrid%par%comm, ierr)</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor"></span>    <span class="comment">!$OMP BARRIER</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="preprocessor"></span>  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">perf_barrier</a></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a81b334fbea02bd090428fd930848fbce">  599</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#a81b334fbea02bd090428fd930848fbce">advance_hypervis_scalar</a>(elem, hvcoord , hybrid , deriv , nt , nt_qdp , nets , nete , dt2, nq)</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">!  hyperviscsoity operator for foward-in-time scheme</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">!  take one timestep of:</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="comment">!          Q(:,:,:,np) = Q(:,:,:,np) +  dt2*nu*laplacian**order ( Q )</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">!  For correct scaling, dt2 should be the same &#39;dt2&#39; used in the leapfrog advace</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>          , <span class="keywordtype">only</span> : real_kind</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacedimensions__mod.html">dimensions_mod</a> , <span class="keywordtype">only</span> : <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacehybrid__mod.html">hybrid_mod</a>     , <span class="keywordtype">only</span> : <a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceelement__mod.html">element_mod</a>    , <span class="keywordtype">only</span> : <a class="code" href="structelement__mod_1_1element__t.html">element_t</a></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacederivative__mod.html">derivative_mod</a> , <span class="keywordtype">only</span> : derivative_t</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacebndry__mod.html">bndry_mod</a>      , <span class="keywordtype">only</span> : bndry_exchangev</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordtype">use </span>perf_mod       , <span class="keywordtype">only</span> : t_startf, t_stopf                          <span class="comment">! _EXTERNAL</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>    , <span class="keywordtype">only</span> : <a class="code" href="namespacecontrol__mod.html#a0142942a55c16000237db63932980642">nu_q</a>, <a class="code" href="namespacecontrol__mod.html#a8052f2e0ac9628ef45174037b0bd8f54">nu_p</a>, <a class="code" href="namespacecontrol__mod.html#a53dd0faa4b398a355d1e4d5ee52d01fd">hypervis_subcycle_q</a></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordtype">implicit none</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordtype">type</span> (element_t)     , <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: elem(:)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordtype">type</span> (hvcoord_t)     , <span class="keywordtype">intent(in   )</span>         :: hvcoord</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordtype">type</span> (hybrid_t)      , <span class="keywordtype">intent(in   )</span>         :: hybrid</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordtype">type</span> (derivative_t)  , <span class="keywordtype">intent(in   )</span>         :: deriv</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span>         :: nt</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span>         :: nt_qdp</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span>         :: nets</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span>         :: nete</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordtype">integer</span>              , <span class="keywordtype">intent(in   )</span>         :: nq</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">intent(in   )</span>         :: dt2</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="comment">! local</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">dimension(np,np,nlev,qsize,nets:nete)</span> :: qtens</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">dimension(np,np,nlev                )</span> :: dp</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind) :: dt</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="keywordtype">integer</span> :: k , ie , ic , q</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span> ( <a class="code" href="namespacecontrol__mod.html#a0142942a55c16000237db63932980642">nu_q</a>           == 0 ) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="keywordflow">if</span> ( hypervis_order /= 2 ) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="comment">!   call t_barrierf(&#39;sync_advance_hypervis_scalar&#39;, hybrid%par%comm)</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;advance_hypervis_scalar&#39;</span>)</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    dt = dt2 / <a class="code" href="namespacecontrol__mod.html#a53dd0faa4b398a355d1e4d5ee52d01fd">hypervis_subcycle_q</a></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160; </div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="keywordflow">do</span> ic = 1 , <a class="code" href="namespacecontrol__mod.html#a53dd0faa4b398a355d1e4d5ee52d01fd">hypervis_subcycle_q</a></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;       <span class="keywordflow">do</span> ie = nets , nete</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="preprocessor">#if (defined COLUMN_OPENMP)</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="preprocessor"></span>          <span class="comment">!$omp parallel do private(q,k) collapse(2)</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="preprocessor"></span>          <span class="keywordflow">do</span> q = 1 , nq</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;             <span class="keywordflow">do</span> k = 1 , <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                qtens(:,:,k,q,ie) = elem(ie)%state%Q(:,:,k,q)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="keywordflow">       enddo</span> <span class="comment">! ie loop</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;       <span class="comment">! compute biharmonic operator. Qtens = input and output</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#a2b2f6a18ca1463b5200267e26b548bc2">biharmonic_wk_scalar</a>( elem , qtens , deriv , edge_g , hybrid , nets , nete, nq )</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160; </div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;       <span class="keywordflow">do</span> ie = nets , nete</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="preprocessor">#if (defined COLUMN_OPENMP)</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="preprocessor"></span>          <span class="comment">!$omp parallel do private(q,k,j,i) collapse(2)</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="preprocessor"></span>          <span class="keywordflow">do</span> q = 1 , nq</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;             <span class="keywordflow">do</span> k = 1 , <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                elem(ie)%state%Q(:,:,k,q) = elem(ie)%state%Q(:,:,k,q) * elem(ie)%spheremp &amp;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                     - dt * <a class="code" href="namespacecontrol__mod.html#a0142942a55c16000237db63932980642">nu_q</a> * qtens(:,:,k,q,ie)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;          <span class="keyword">call </span>edgevpack_nlyr(edge_g , elem(ie)%desc, elem(ie)%state%Q , nq*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> , 0 , nq*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> )</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="keywordflow">       enddo</span> <span class="comment">! ie loop</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;       <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;ah_scalar_bexchV&#39;</span>)</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;       <span class="keyword">call </span>bndry_exchangev( hybrid , edge_g )</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;       <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;ah_scalar_bexchV&#39;</span>)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;       <span class="keywordflow">do</span> ie = nets , nete</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;          <span class="keyword">call </span>edgevunpack_nlyr(edge_g , elem(ie)%desc, elem(ie)%state%Q , nq*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> , 0, nq*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="preprocessor">#if (defined COLUMN_OPENMP)</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="preprocessor"></span>          <span class="comment">!$omp parallel do private(q,k) collapse(2)</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="preprocessor"></span>          <span class="keywordflow">do</span> q = 1 , nq</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;             <span class="comment">! apply inverse mass matrix</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;             <span class="keywordflow">do</span> k = 1 , <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                elem(ie)%state%Q(:,:,k,q) = elem(ie)%rspheremp(:,:) * elem(ie)%state%Q(:,:,k,q)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="keywordflow">             enddo</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="keywordflow">       enddo</span> <span class="comment">! ie loop</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="preprocessor">#ifdef DEBUGOMP</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if (defined HORIZ_OPENMP)</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="preprocessor"></span>       <span class="comment">!$OMP BARRIER</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="preprocessor"></span><span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;advance_hypervis_scalar&#39;</span>)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#a81b334fbea02bd090428fd930848fbce">advance_hypervis_scalar</a></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a2b2f6a18ca1463b5200267e26b548bc2">  691</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#a2b2f6a18ca1463b5200267e26b548bc2">biharmonic_wk_scalar</a>(elem,qtens,deriv,edgeq,hybrid,nets,nete,nq)</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <span class="comment">! compute weak biharmonic operator</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <span class="comment">!    input:  qtens = Q</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">!    output: qtens = weak biharmonic of Q</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="comment">!</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    <span class="comment">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>, <span class="keywordtype">only</span> : <a class="code" href="namespacecontrol__mod.html#a3611129dec6c7ca0adf5baab19e40b32">hypervis_scaling</a></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacederivative__mod.html">derivative_mod</a>, <span class="keywordtype">only</span> : laplace_sphere_wk</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160; </div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordtype">type</span> (hybrid_t)      , <span class="keywordtype">intent(in)</span> :: hybrid</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    <span class="keywordtype">type</span> (element_t)     , <span class="keywordtype">intent(inout)</span>, <span class="keywordtype">target</span> :: elem(:)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <span class="keywordtype">integer</span> :: nets,nete,nq</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">dimension(np,np,nlev,qsize,nets:nete)</span> :: qtens</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordtype">type</span> (EdgeBuffer_t)  , <span class="keywordtype">intent(inout)</span> :: edgeq</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordtype">type</span> (derivative_t)  , <span class="keywordtype">intent(in)</span> :: deriv</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <span class="comment">! local</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordtype">integer</span> :: k,kptr,i,j,ie,ic,q</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="keywordtype">    real</span> (kind=real_kind), <span class="keywordtype">dimension(np,np)</span> :: lap_p</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keywordtype">logical</span> var_coef1</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">!if tensor hyperviscosity with tensor V is used, then biharmonic operator is (\grad\cdot V\grad) (\grad \cdot \grad) </span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">!so tensor is only used on second call to laplace_sphere_wk</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    var_coef1 = .true.</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespacecontrol__mod.html#a3611129dec6c7ca0adf5baab19e40b32">hypervis_scaling</a> &gt; 0)    var_coef1 = .false.</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">do</span> ie=nets,nete</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="preprocessor">#if (defined COLUMN_OPENMP)</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="preprocessor"></span>       <span class="comment">!$omp parallel do private(k, q, lap_p)</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="preprocessor"></span>       <span class="keywordflow">do</span> q=1,nq</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;          <span class="keywordflow">do</span> k=1,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>    <span class="comment">!  Potential loop inversion (AAM)</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;             lap_p(:,:)=qtens(:,:,k,q,ie)</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;             <span class="comment">! Original use of qtens on left and right hand sides caused OpenMP errors (AAM)</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;             qtens(:,:,k,q,ie)=laplace_sphere_wk(lap_p,deriv,elem(ie),var_coef=var_coef1)</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;          <span class="keyword">call </span>edgevpack_nlyr(edgeq, elem(ie)%desc, qtens(:,:,:,q,ie),<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>*(q-1),nq*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160; </div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;biwksc_bexchV&#39;</span>)</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keyword">call </span>bndry_exchangev(hybrid,edgeq)</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;biwksc_bexchV&#39;</span>)</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">do</span> ie=nets,nete</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160; </div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;       <span class="comment">! apply inverse mass matrix, then apply laplace again</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="preprocessor">#if (defined COLUMN_OPENMP)</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="preprocessor"></span>       <span class="comment">!$omp parallel do private(k, q, lap_p)</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="preprocessor"></span>       <span class="keywordflow">do</span> q=1,nq      </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;          <span class="keyword">call </span>edgevunpack_nlyr(edgeq,elem(ie)%desc,qtens(:,:,:,q,ie),<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>*(q-1),nq*<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;          <span class="keywordflow">do</span> k=1,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>    <span class="comment">!  Potential loop inversion (AAM)</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;             lap_p(:,:)=elem(ie)%rspheremp(:,:)*qtens(:,:,k,q,ie)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;             qtens(:,:,k,q,ie)=laplace_sphere_wk(lap_p,deriv,elem(ie),var_coef=.true.)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="keywordflow">          enddo</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="preprocessor">#ifdef DEBUGOMP</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#if (defined HORIZ_OPENMP)</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="preprocessor"></span>    <span class="comment">!$OMP BARRIER</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="preprocessor"></span>  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#a2b2f6a18ca1463b5200267e26b548bc2">biharmonic_wk_scalar</a></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#ad1e85e15e324c7b4e9796f9ec18376e0">  757</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#ad1e85e15e324c7b4e9796f9ec18376e0">calc_vertically_lagrangian_levels</a>( &amp;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;       hybrid, elem, ie, hvcoord, tl, dt, deriv, dp_tol, dprecon)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="comment">! Reconstruct the vertically Lagrangian levels, thus permitting the dynamics</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="comment">! vertical remap time step to be shorter than the tracer time step.</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="comment">!   Recall</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <span class="comment">!     p(eta,ps) = A(eta) p0 + B(eta) ps</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">!     =&gt; dp/dt = p_eta deta/dt + p_ps dps/dt</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">!              = (A_eta p0 + B_eta ps) deta/dt + B(eta) dps/dt</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">! dp3d already accounts for B(eta) dps/dt, so it does not appear in what</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    <span class="comment">! follows. We use eta as the vertical coordinate in these calculations. But</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="comment">! here, to focus on the key ideas, consider a p = (x,z) system with</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="comment">! velocities v = (u,w). Let 0, h, 1, suffixes denote start, middle, and end</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="comment">! of the time step. The algorithm is as follows.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">!   The trajectory is computed forward in time, so the departure 0 points</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    <span class="comment">! are on the grid. We need to compute z(x0,t1), the floating height at</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="comment">! horizontal grid point x0 at time t1. We start by computing z1 = z(x1,t1),</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">! the floating height at the non-grid point x1 at time t1 or, in other</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="comment">! words, the non-grid arrival point:</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="comment">!     z1 = z0 + dt/2 (w(p0,t0) + w(p1,t1)) + O(dt^3)</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="comment">!     w(p1,t1) = w(p0,t1) + grad w(p0,t1) (p1 - p0) + O(dt^2)</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="comment">!     x1 - x0 = dt u(p0,t0) + O(dt^2)</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">!     z1 - z0 = dt w(p0,t0) + O(dt^2)</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">!     z1 = z0 + dt/2 (w(p0,t0) + w(p0,t1) +</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="comment">!                     dt (w_x(p0,t1) u(p0,t0) + w_z(p0,t1) w(p0,t0))) + O(dt^3)  (*)</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">! Now we compute z(x0,t1). First, we need</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="comment">!     x0 - x1 = -dt u(p0,t0) + O(dt^2)</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="comment">! and</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">!     z_x(x1,t1) = z0_x + dt w_x(p0,t1) + O(dt^2)</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="comment">!                = dt w_x(p0,t1) + O(dt^2).</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="comment">!     z_xx(x1,t1) = z0_xx + dt w_xx(p0,t1) + O(dt^2)</span></div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">!                 = dt w_xx(p0,t1) + O(dt^2).</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <span class="comment">! Then we expand z(x0,t1) in Taylor series and substitute:</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="comment">!     z(x0,t1) = z(x1,t1) + z_x(x1,t1) (x0 - x1) + z_xx(x1,t1) (x0 - x1)^2</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">!                + O(|x0 - x1|^3)</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="comment">!              = z(x1,t1) - dt z_x(x1,t1) u(p0,t0)</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">!                + dt^2 z_xx(x1,t1) u(p0,t0)^2</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="comment">!                + O(dt^3) + O(|x0 - x1|^3)</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="comment">!              = z(x1,t1) - dt^2 w_x(p0,t1) u(p0,t0)</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="comment">!                + dt^3 w_xx(x0,t1) u(p0,t0)^2</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">!                + O(dt^3) + O(|x0 - x1|^3).</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="comment">! Gather all O(dt^3) terms, with O(|x0 - x1|^p) = O(dt^p):</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="comment">!     z(x0,t1) = z(x1,t1) - dt^2 w_x(p0,t1) u(p0,t0) + O(dt^3).</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="comment">! Now substitute (*) for z(x1,t1):</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="comment">!     z(x0,t1) = z0 + dt/2 (w(p0,t0) + w(p0,t1) +</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="comment">!                           dt (w_x(p0,t1) u(p0,t0) + w_z(p0,t1) w(p0,t0)))</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="comment">!                - dt^2 w_x(p0,t1) u(p0,t0) + O(dt^3)</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="comment">!              = z0 + dt/2 (w(p0,t0) + w(p0,t1) +</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="comment">!                           dt (-w_x(p0,t1) u(p0,t0) + w_z(p0,t1) w(p0,t0)))</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">!                + O(dt^3)</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="comment">! This is locally accurate to O(dt^3) and so globally 2nd-order</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="comment">! accurate. Notably, compared with (*), this formula differs only in a</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="comment">! sign. Note also that a straightforward first-order accurate formula is</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="comment">!     z(x0,t1) = z0 + dt w(p0,th) + O(dt^2).</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacecontrol__mod.html#a242f2b7da6d34c2ed16a4820ee0033f9">dt_remap_factor</a></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacederivative__mod.html">derivative_mod</a>, <span class="keywordtype">only</span>: derivative_t, gradient_sphere</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">iulog</a></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordtype">type</span> (hybrid_t), <span class="keywordtype">intent(in)</span> :: hybrid</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="keywordtype">type</span> (element_t), <span class="keywordtype">intent(in)</span> :: elem</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: ie</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordtype">type</span> (hvcoord_t), <span class="keywordtype">intent(in)</span> :: hvcoord</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordtype">type</span> (TimeLevel_t), <span class="keywordtype">intent(in)</span> :: tl</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind), <span class="keywordtype">intent(in)</span> :: dt, dp_tol</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordtype">type</span> (derivative_t), <span class="keywordtype">intent(in)</span> :: deriv</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind), <span class="keywordtype">intent(out)</span> :: dprecon(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">dimension(np,np,nlevp)</span> :: pref, p1r</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">dimension(np,np,nlevp,2)</span> :: eta_dot_dpdn</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">dimension(np,np)</span> :: dps, ptp0, v1, v2, divdp</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">dimension(np,np,2)</span> :: grad, vdp</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="keywordtype">    real</span>(real_kind) :: dp_neg_min</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordtype">integer</span> :: i, j, k, k1, k2, d, t</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="comment">! Reconstruct an approximation to endpoint eta_dot_dpdn on</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="comment">! Eulerian levels.</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <span class="keywordflow">do</span> t = 1,2</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;       eta_dot_dpdn(:,:,1,t) = zero</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;       <span class="keywordflow">do</span> k = 1,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;          <span class="keywordflow">do</span> d = 1,2</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;             <span class="keywordflow">if</span> (t == 1) <span class="keywordflow">then</span>      </div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                vdp(:,:,d) = elem%derived%vstar(:,:,d,k)*elem%derived%dp(:,:,k)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                vdp(:,:,d) = elem%derived%vn0(:,:,d,k)*elem%state%dp3d(:,:,k,tl%np1)</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="keywordflow">             end if</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;          divdp = divergence_sphere(vdp, deriv, elem)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;          eta_dot_dpdn(:,:,k+1,t) = eta_dot_dpdn(:,:,k,t) + divdp</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;       dps = eta_dot_dpdn(:,:,<a class="code" href="namespacedimensions__mod.html#a311b48352dde44bfd8b73213bfc94689">nlevp</a>,t)</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;       eta_dot_dpdn(:,:,<a class="code" href="namespacedimensions__mod.html#a311b48352dde44bfd8b73213bfc94689">nlevp</a>,t) = zero</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;       <span class="keywordflow">do</span> k = 2,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;          eta_dot_dpdn(:,:,k,t) = hvcoord%hybi(k)*dps - eta_dot_dpdn(:,:,k,t)</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160; </div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="comment">! Use p0 as the reference coordinate system. p0 differs from p1 by B(eta)</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <span class="comment">! (ps1 - ps0); dp3d already accounts for this term</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="comment">! w.r.t. derived%dp. Recall</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="comment">!     eta_dot_dpdn = p_eta eta_dot = (A_eta p0 + B_eta ps) deta/dt,</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="comment">! except that in the code eta_dot_dpdn is actually dp deta/dt rather than</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="comment">! dp/deta deta/dt. eta_dot_dpdn is the motion of a pressure level excluding</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">! its motion due to dps/dt.</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keyword">call </span>calc_p(hvcoord, elem%derived%dp, pref)</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordflow">do</span> k = 2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;       <span class="comment">! Gradient of eta_dot_dpdn = p_eta deta/dt at final time</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;       <span class="comment">! w.r.t. horizontal sphere coords.</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;       grad = gradient_sphere(eta_dot_dpdn(:,:,k,2), deriv, elem%Dinv)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;       <span class="comment">! Gradient of eta_dot_dpdn = p_eta deta/dt at final time w.r.t. p at</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;       <span class="comment">! initial time.</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;       k1 = k-1</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;       k2 = k+1</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ae8d04ccff09648bd264446463fe344e9">eval_lagrange_poly_derivative</a>(k2-k1+1, pref(:,:,k1:k2), &amp;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            eta_dot_dpdn(:,:,k1:k2,2), &amp;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            pref(:,:,k), ptp0)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;       <span class="comment">! Horizontal velocity at initial time.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;       k1 = k-1</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;       k2 = k</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;       v1 = half*(elem%derived%vstar(:,:,1,k1) + elem%derived%vstar(:,:,1,k2))</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;       v2 = half*(elem%derived%vstar(:,:,2,k1) + elem%derived%vstar(:,:,2,k2))</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160; </div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;       <span class="comment">! Reconstruct departure level coordinate at final time.</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;       p1r(:,:,k) = pref(:,:,k) + &amp;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            half*dt*(eta_dot_dpdn(:,:,k,1) + eta_dot_dpdn(:,:,k,2) + &amp;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                     dt*(ptp0*eta_dot_dpdn(:,:,k,1) - grad(:,:,1)*v1 - grad(:,:,2)*v2))</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="comment">! Reconstruct eta_dot_dpdn over the time interval.</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    eta_dot_dpdn(:,:,:,1) = (p1r - pref)/dt</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    <span class="comment">! Boundary points are always 0.</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    eta_dot_dpdn(:,:,1,1) = zero</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    eta_dot_dpdn(:,:,<a class="code" href="namespacedimensions__mod.html#a311b48352dde44bfd8b73213bfc94689">nlevp</a>,1) = zero</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    dp_neg_min = reconstruct_and_limit_dp(elem%state%dp3d(:,:,:,tl%np1), &amp;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;         dt, dp_tol, eta_dot_dpdn(:,:,:,1), dprecon)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#ad1e85e15e324c7b4e9796f9ec18376e0">calc_vertically_lagrangian_levels</a></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#ae8d04ccff09648bd264446463fe344e9">  898</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#ae8d04ccff09648bd264446463fe344e9">eval_lagrange_poly_derivative</a>(n, xs, ys, xi, yp)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: n</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">intent(in)</span> :: xs(np,np,n), ys(np,np,n), xi(np,np)</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">intent(out)</span> :: yp(np,np)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keywordtype">integer</span> :: i, j, k</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="keywordtype">    real</span>(real_kind) :: f(np,np), g(np,np), num(np,np)</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    yp = zero</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <span class="keywordflow">do</span> i = 1,n</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;       f = zero</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;       <span class="keywordflow">do</span> j = 1,n</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          <span class="keywordflow">if</span> (j == i) cycle</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          g = one</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;          <span class="keywordflow">do</span> k = 1,n</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;             <span class="keywordflow">if</span> (k == i) cycle</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;             <span class="keywordflow">if</span> (k == j) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                num = one</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                num = xi - xs(:,:,k)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="keywordflow">             end if</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;             g = g*(num/(xs(:,:,i) - xs(:,:,k)))</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;          f = f + g</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;       yp = yp + ys(:,:,i)*f</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#ae8d04ccff09648bd264446463fe344e9">eval_lagrange_poly_derivative</a></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  <span class="keyword">subroutine </span>calc_p(hvcoord, dp, p)</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="keywordtype">type</span> (hvcoord_t), <span class="keywordtype">intent(in)</span> :: hvcoord</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">intent(in)</span> :: dp(np,np,nlev)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">intent(out)</span> :: p(np,np,nlevp)</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordtype">integer</span> :: k</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    p(:,:,1) = hvcoord%hyai(1)*hvcoord%ps0</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">do</span> k = 1,nlev</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;       p(:,:,k+1) = p(:,:,k) + dp(:,:,k)</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keyword">end subroutine </span>calc_p</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160; </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="keyword">subroutine </span>set_dp_tol(hvcoord, dp_tol)</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="comment">! Pad by an amount ~ smallest level to keep the computed dp &gt; 0.</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keywordtype">type</span> (hvcoord_t), <span class="keywordtype">intent(in)</span> :: hvcoord</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind), <span class="keywordtype">intent(out)</span> :: dp_tol</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    dp_tol = 10_real_kind*eps*minval(hvcoord%dp0)</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="keyword">end subroutine </span>set_dp_tol</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="keyword">function </span>reconstruct_and_limit_dp(dpref, dt, dp_tol, eta_dot_dpdn, dprecon) <span class="keyword">result</span>(dp_neg_min)</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="comment">! Move mass around in a column as needed to make dp nonnegative.</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160; </div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind), <span class="keywordtype">intent(in)</span> :: dpref(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>), dt, dp_tol, eta_dot_dpdn(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a311b48352dde44bfd8b73213bfc94689">nlevp</a>)</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind), <span class="keywordtype">intent(out)</span> :: dprecon(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordtype">integer</span> :: k, i, j</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind) :: nmass, w(<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>), dp(<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>), dp_neg_min</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    dp_neg_min = dp_tol <span class="comment">! &lt; dp_tol if the limiter has to adjust dp</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordflow">do</span> j = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;       <span class="keywordflow">do</span> i = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;          nmass = zero</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;          <span class="keywordflow">do</span> k = 1,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;             dp(k) = dpref(i,j,k) + dt*(eta_dot_dpdn(i,j,k+1) - eta_dot_dpdn(i,j,k))</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;             <span class="keywordflow">if</span> (dp(k) &lt; dp_tol) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                nmass = nmass + (dp(k) - dp_tol)</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="preprocessor"></span>                dp_neg_min = min(dp_neg_min, dp(k))</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="preprocessor"></span>                dp(k) = dp_tol</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                w(k) = zero</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;             <span class="keywordflow">else</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                w(k) = dp(k) - dp_tol</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="keywordflow">             end if</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;          <span class="comment">! Store the full update rather than reconstructing</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;          <span class="comment">! eta_dot_dpdn. See comment in sl_vertically_remap_tracers</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;          <span class="comment">! for more.</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;          dprecon(i,j,:) = dp</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;          <span class="keywordflow">if</span> (nmass /= zero) dprecon(i,j,:) = dprecon(i,j,:) + nmass*(w/sum(w))</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keyword">end function </span>reconstruct_and_limit_dp</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a8ba565fd96cb9b82977c6e0b1db77098">  984</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#a8ba565fd96cb9b82977c6e0b1db77098">sl_vertically_remap_tracers</a>(hybrid, elem, nets, nete, tl, dt_q)</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    <span class="comment">! Remap the tracers after a tracer time step, in the case that the</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="comment">! vertical remap time step for dynamics is shorter than the tracer</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">! time step.</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacecontrol__mod.html">control_mod</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacecontrol__mod.html#a6909204405993d9c799d4f81181bb0c8">dt_tracer_factor</a></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacevertremap__base.html">vertremap_base</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacevertremap__base.html#af3d970dd3d2368cb76531117cc4aacc4">remap1</a></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespaceparallel__mod.html">parallel_mod</a>, <span class="keywordtype">only</span>: <a class="code" href="namespaceparallel__mod.html#a00f76482d3b7bb15da165475c828f466">abortmp</a></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">iulog</a></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordtype">use </span>perf_mod, <span class="keywordtype">only</span>: t_startf, t_stopf</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160; </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structhybrid__mod_1_1hybrid__t.html">hybrid_t</a>), <span class="keywordtype">intent(in)</span> :: hybrid</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structelement__mod_1_1element__t.html">element_t</a>), <span class="keywordtype">intent(inout)</span> :: elem(:)</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: nets, nete</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="keywordtype">    real</span>(kind=real_kind), <span class="keywordtype">intent(in)</span> :: dt_q</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structtime__mod_1_1timelevel__t.html">timelevel_t</a>), <span class="keywordtype">intent(in)</span> :: tl</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    <span class="keywordtype">integer</span> :: ie, i, j, k, q, n0_qdp, np1_qdp</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;    <span class="keyword">call </span>t_startf(<span class="stringliteral">&#39;SLMM vertical remap&#39;</span>)</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    <span class="keyword">call </span><a class="code" href="namespacetime__mod.html#a5dcb3daf686858cd2a8f3d0b6f5888b4">timelevel_qdp</a>(tl, <a class="code" href="namespacecontrol__mod.html#a6909204405993d9c799d4f81181bb0c8">dt_tracer_factor</a>, n0_qdp, np1_qdp)</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordflow">do</span> ie = nets, nete</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;       <span class="comment">! divdp contains the reconstructed vertically Lagrangian level</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;       <span class="comment">! dp_star.</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="preprocessor"></span>       <span class="keywordflow">if</span> (any(elem(ie)%derived%divdp &lt; zero)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;          <span class="keyword">write</span>(<a class="code" href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">iulog</a>,*) <span class="stringliteral">&#39;sl_vertically_remap_tracers&gt; dp_star -ve: rank, ie, dp_tol&#39;</span>, &amp;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;               hybrid%par%rank, ie, dp_tol</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;          <span class="keywordflow">do</span> j = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;             <span class="keywordflow">do</span> i = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                <span class="keywordflow">if</span> (any(elem(ie)%derived%divdp(i,j,:) &lt; zero)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                   <span class="keyword">write</span>(<a class="code" href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">iulog</a>,*) <span class="stringliteral">&#39;i,j,dp_star(i,j,:)&#39;</span>, i, j, elem(ie)%derived%divdp(i,j,:)</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                   <span class="keyword">call </span><a class="code" href="namespaceparallel__mod.html#a00f76482d3b7bb15da165475c828f466">abortmp</a>(<span class="stringliteral">&#39;sl_vertically_remap_tracers&gt; -ve dp_star&#39;</span>)</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="keywordflow">                end if</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="keywordflow">             end do</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="keywordflow">       end if</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="preprocessor"></span>       <span class="keyword">call </span><a class="code" href="namespacevertremap__base.html#af3d970dd3d2368cb76531117cc4aacc4">remap1</a>(elem(ie)%state%Qdp(:,:,:,:,np1_qdp), <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, elem(ie)%derived%divdp, &amp;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            elem(ie)%state%dp3d(:,:,:,tl%np1))</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;       <span class="keywordflow">do</span> q = 1,<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;          elem(ie)%state%Q(:,:,:,q) = elem(ie)%state%Qdp(:,:,:,q,np1_qdp)/ &amp;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                                      elem(ie)%state%dp3d(:,:,:,tl%np1)</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="keywordflow">       enddo</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keyword">call </span>t_stopf(<span class="stringliteral">&#39;SLMM vertical remap&#39;</span>)</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#a8ba565fd96cb9b82977c6e0b1db77098">sl_vertically_remap_tracers</a></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01032"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a9aed74eaf497a836fb2c67bfa4b73968"> 1032</a></span>&#160;  <span class="keyword">function </span><a class="code" href="namespacesl__advection.html#a9aed74eaf497a836fb2c67bfa4b73968">test_lagrange</a>() <span class="keyword">result</span>(nerr)</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>, <span class="keywordtype">only</span>: rt =&gt; real_kind</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="keywordtype">    real</span>(rt), <span class="keywordtype">parameter</span> :: xs(3) = (/-one, zero, half/)</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: n = 3, ntrial = 10</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="keywordtype">    real</span>(rt) :: a, b, c, x, y1, y2, alpha, ys(3), xsi(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,n), ysi(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,n), &amp;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;         xi(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>), y2i(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>)</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordtype">integer</span> :: i, j, trial, nerr</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    nerr = 0</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    a = -half; b = 0.3_rt; c = 1.7_rt</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160; </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    <span class="keywordflow">do</span> i = 1,3</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;       x = xs(i)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;       ys(i) = (a*x + b)*x + c</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    <span class="keywordflow">do</span> trial = 0,ntrial</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;       alpha = real(trial,rt)/ntrial</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;       x = (1-alpha)*(-2_rt) + alpha*2_rt</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;       y1 = 2*a*x + b</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;       <span class="keywordflow">do</span> j = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;          <span class="keywordflow">do</span> i = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;             xsi(i,j,:) = xs</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;             ysi(i,j,:) = ys</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;             xi(i,j) = x</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="keywordflow">          end do</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;       <span class="keyword">call </span><a class="code" href="namespacesl__advection.html#ae8d04ccff09648bd264446463fe344e9">eval_lagrange_poly_derivative</a>(n, xsi, ysi, xi, y2i)</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;       <span class="keywordflow">if</span> (abs(y2i(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>) - y1) &gt; 1d-14*abs(y1)) nerr = nerr + 1</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;  <span class="keyword">end function </span><a class="code" href="namespacesl__advection.html#a9aed74eaf497a836fb2c67bfa4b73968">test_lagrange</a></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160; </div>
<div class="line"><a name="l01066"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#a339d6348fb45feb25a101f4a19e4eaf1"> 1066</a></span>&#160;  <span class="keyword">function </span><a class="code" href="namespacesl__advection.html#a339d6348fb45feb25a101f4a19e4eaf1">test_reconstruct_and_limit_dp</a>() <span class="keyword">result</span>(nerr)</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacephysical__constants.html">physical_constants</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacephysical__constants.html#a723576dfdca03ef9e1ac67040270bf37">p0</a></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="keywordtype">    real</span>(real_kind), <span class="keywordtype">parameter</span> :: dt = 1800_real_kind, dp_tol = (<a class="code" href="namespacephysical__constants.html#a723576dfdca03ef9e1ac67040270bf37">p0</a>/<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)*eps, &amp;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;         tol = 100_real_kind*eps</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160; </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="keywordtype">    real</span>(real_kind) :: dpref(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>), dpfin(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>,2), eta_dot_dpdn(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,<a class="code" href="namespacedimensions__mod.html#a311b48352dde44bfd8b73213bfc94689">nlevp</a>), tmp</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordtype">integer</span> :: nerr, i, j, k</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    eta_dot_dpdn(1,1,<a class="code" href="namespacedimensions__mod.html#a311b48352dde44bfd8b73213bfc94689">nlevp</a>) = zero</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">do</span> k = 1,<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;       dpref(1,1,k) = k</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;       eta_dot_dpdn(1,1,k) = (-one)**k*0.1_real_kind*(<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>-k)</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    tmp = <a class="code" href="namespacephysical__constants.html#a723576dfdca03ef9e1ac67040270bf37">p0</a>/sum(dpref(1,1,:))</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;    dpref(1,1,:) = dpref(1,1,:)*tmp</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    eta_dot_dpdn(1,1,:) = eta_dot_dpdn(1,1,:)*tmp</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    eta_dot_dpdn(1,1,1) = zero</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; </div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="keywordflow">do</span> j = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;       <span class="keywordflow">do</span> i = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;          dpref(i,j,:) = dpref(1,1,:)</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;          eta_dot_dpdn(i,j,:) = eta_dot_dpdn(1,1,:)</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    dpfin(:,:,:,1) = dpref + dt*(eta_dot_dpdn(:,:,2:) - eta_dot_dpdn(:,:,:<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>))</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    tmp = reconstruct_and_limit_dp(dpref, dt, dp_tol, eta_dot_dpdn, dpfin(:,:,:,2))</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    </div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    nerr = 0</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="keywordflow">do</span> j = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;       <span class="keywordflow">do</span> i = 1,<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a></div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;          <span class="comment">! mass conservation</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;          tmp = sum(dpref(i,j,:))</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;          <span class="keywordflow">if</span> (abs(sum(dpfin(i,j,:,1)) - tmp) &gt; tol*tmp) nerr = nerr + 1</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;          <span class="keywordflow">if</span> (abs(sum(dpfin(i,j,:,2)) - tmp) &gt; tol*tmp) nerr = nerr + 1</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;          <span class="comment">! limiter needs to be active</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;          <span class="keywordflow">if</span> (minval(dpfin(i,j,:,1)) &gt;= zero) nerr = nerr + 1</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;          <span class="comment">! limiter succeeded</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;          <span class="keywordflow">if</span> (minval(dpfin(i,j,:,2)) &lt; zero) nerr = nerr + 1</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="keywordflow">       end do</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="keywordflow">    end do</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  <span class="keyword">end function </span><a class="code" href="namespacesl__advection.html#a339d6348fb45feb25a101f4a19e4eaf1">test_reconstruct_and_limit_dp</a></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"><a class="line" href="namespacesl__advection.html#ade3fbec219e2361b39f8db6e113d0e38"> 1110</a></span>&#160;  <span class="keyword">subroutine </span><a class="code" href="namespacesl__advection.html#ade3fbec219e2361b39f8db6e113d0e38">sl_unittest</a>(par)</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordtype">use </span><a class="code" href="namespacekinds.html">kinds</a>, <span class="keywordtype">only</span>: <a class="code" href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">iulog</a></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordtype">type</span> (<a class="code" href="structparallel__mod_1_1parallel__t.html">parallel_t</a>), <span class="keywordtype">intent(in)</span> :: par</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160; </div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordtype">integer</span> :: nerr</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160; </div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    nerr = 0</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    nerr = nerr + <a class="code" href="namespacesl__advection.html#a9aed74eaf497a836fb2c67bfa4b73968">test_lagrange</a>()</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    nerr = nerr + <a class="code" href="namespacesl__advection.html#a339d6348fb45feb25a101f4a19e4eaf1">test_reconstruct_and_limit_dp</a>()</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">if</span> (nerr &gt; 0 .and. par%masterproc) <span class="keyword">write</span>(<a class="code" href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">iulog</a>,<span class="stringliteral">&#39;(a,i3)&#39;</span>) <span class="stringliteral">&#39;sl_unittest FAIL&#39;</span>, nerr</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  <span class="keyword">end subroutine </span><a class="code" href="namespacesl__advection.html#ade3fbec219e2361b39f8db6e113d0e38">sl_unittest</a></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="keyword">end module </span><a class="code" href="namespacesl__advection.html">sl_advection</a></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a01a8e64063567601af02f3ee19e4a4c3"><div class="ttname"><a href="compose__cedr_8cpp.html#a01a8e64063567601af02f3ee19e4a4c3">cedr_sl_set_pointers_end</a></div><div class="ttdeci">void cedr_sl_set_pointers_end()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06700">compose_cedr.cpp:6700</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a6733f39eb2f96fb3a1149d1a087aedaa"><div class="ttname"><a href="compose__cedr_8cpp.html#a6733f39eb2f96fb3a1149d1a087aedaa">cedr_sl_run</a></div><div class="ttdeci">void cedr_sl_run(homme::Real *minq, const homme::Real *maxq, homme::Int nets, homme::Int nete)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06703">compose_cedr.cpp:6703</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a955408f4b6bdfb672629fed0acaa3edf"><div class="ttname"><a href="compose__cedr_8cpp.html#a955408f4b6bdfb672629fed0acaa3edf">cedr_sl_check</a></div><div class="ttdeci">void cedr_sl_check(const homme::Real *minq, const homme::Real *maxq, homme::Int nets, homme::Int nete)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06723">compose_cedr.cpp:6723</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_aac63b05d328ad81de6a8b4a6b6390f59"><div class="ttname"><a href="compose__cedr_8cpp.html#aac63b05d328ad81de6a8b4a6b6390f59">cedr_sl_set_dp3d</a></div><div class="ttdeci">void cedr_sl_set_dp3d(homme::Int ie, homme::Real *v, homme::Int tl_np1)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06692">compose_cedr.cpp:6692</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_abc8a42a818fcdafcf2eb3644a461521a"><div class="ttname"><a href="compose__cedr_8cpp.html#abc8a42a818fcdafcf2eb3644a461521a">cedr_sl_init</a></div><div class="ttdeci">homme::Int cedr_sl_init(const homme::Int np, const homme::Int nlev, const homme::Int qsize, const homme::Int qsized, const homme::Int timelevels, const homme::Int need_conservation)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06672">compose_cedr.cpp:6672</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_adb50e9b1de2f71de7cc4bd92ecd6a495"><div class="ttname"><a href="compose__cedr_8cpp.html#adb50e9b1de2f71de7cc4bd92ecd6a495">cedr_sl_set_dp0</a></div><div class="ttdeci">void cedr_sl_set_dp0(homme::Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06698">compose_cedr.cpp:6698</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae31f3ee7ed0b1796b20d315da6067bd7"><div class="ttname"><a href="compose__cedr_8cpp.html#ae31f3ee7ed0b1796b20d315da6067bd7">cedr_sl_set_spheremp</a></div><div class="ttdeci">void cedr_sl_set_spheremp(homme::Int ie, homme::Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06687">compose_cedr.cpp:6687</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae3ec6a834c0bd7647fde8f59d31cb012"><div class="ttname"><a href="compose__cedr_8cpp.html#ae3ec6a834c0bd7647fde8f59d31cb012">cedr_sl_set_qdp</a></div><div class="ttdeci">void cedr_sl_set_qdp(homme::Int ie, homme::Real *v, homme::Int n0_qdp, homme::Int n1_qdp)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06689">compose_cedr.cpp:6689</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae747afb448da5f0376697e43d74778c5"><div class="ttname"><a href="compose__cedr_8cpp.html#ae747afb448da5f0376697e43d74778c5">cedr_sl_run_local</a></div><div class="ttdeci">void cedr_sl_run_local(homme::Real *minq, const homme::Real *maxq, homme::Int nets, homme::Int nete, homme::Int use_ir, homme::Int limiter_option)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06712">compose_cedr.cpp:6712</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae8e9dd870a128686a261eb848c9a18a2"><div class="ttname"><a href="compose__cedr_8cpp.html#ae8e9dd870a128686a261eb848c9a18a2">cedr_sl_set_pointers_begin</a></div><div class="ttdeci">void cedr_sl_set_pointers_begin(homme::Int nets, homme::Int nete)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06686">compose_cedr.cpp:6686</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_af5a0276bb2dbefb74e60bc2f48777353"><div class="ttname"><a href="compose__cedr_8cpp.html#af5a0276bb2dbefb74e60bc2f48777353">cedr_sl_set_q</a></div><div class="ttdeci">void cedr_sl_set_q(homme::Int ie, homme::Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06696">compose_cedr.cpp:6696</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_af90836fbfe6950bf37bc5cfe57ad9ebc"><div class="ttname"><a href="compose__cedr_8cpp.html#af90836fbfe6950bf37bc5cfe57ad9ebc">cedr_sl_set_dp</a></div><div class="ttdeci">void cedr_sl_set_dp(homme::Int ie, homme::Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06694">compose_cedr.cpp:6694</a></div></div>
<div class="ttc" id="acompose__slmm_8cpp_html_a3b3cf3d8c264ccb732bc94edd2b2575b"><div class="ttname"><a href="compose__slmm_8cpp.html#a3b3cf3d8c264ccb732bc94edd2b2575b">slmm_csl_set_elem_data</a></div><div class="ttdeci">void slmm_csl_set_elem_data(homme::Int ie, homme::Real *metdet, homme::Real *qdp, homme::Real *dp, homme::Real *q, homme::Int nelem_in_patch)</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l04074">compose_slmm.cpp:4074</a></div></div>
<div class="ttc" id="acompose__slmm_8cpp_html_a7f1def61c5ac9e4753536215ae1fb3c6"><div class="ttname"><a href="compose__slmm_8cpp.html#a7f1def61c5ac9e4753536215ae1fb3c6">slmm_check_ref2sphere</a></div><div class="ttdeci">void slmm_check_ref2sphere(homme::Int ie, homme::Cartesian3D *p)</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l04069">compose_slmm.cpp:4069</a></div></div>
<div class="ttc" id="acompose__slmm_8cpp_html_a98fd88feb99433d9ee1ba08414134b3e"><div class="ttname"><a href="compose__slmm_8cpp.html#a98fd88feb99433d9ee1ba08414134b3e">slmm_init_local_mesh</a></div><div class="ttdeci">void slmm_init_local_mesh(homme::Int ie, homme::Cartesian3D *neigh_corners, homme::Int nnc, homme::Cartesian3D *p_inside, homme::Int)</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l04054">compose_slmm.cpp:4054</a></div></div>
<div class="ttc" id="acompose__slmm_8cpp_html_ad07d1b06cdd32a08841d0ed836bf8ace"><div class="ttname"><a href="compose__slmm_8cpp.html#ad07d1b06cdd32a08841d0ed836bf8ace">slmm_init_finalize</a></div><div class="ttdeci">void slmm_init_finalize()</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l04064">compose_slmm.cpp:4064</a></div></div>
<div class="ttc" id="acompose__slmm_8cpp_html_aeedef9961e344918a8181917bfdb31ba"><div class="ttname"><a href="compose__slmm_8cpp.html#aeedef9961e344918a8181917bfdb31ba">slmm_csl</a></div><div class="ttdeci">void slmm_csl(homme::Int nets, homme::Int nete, homme::Cartesian3D *dep_points, homme::Real *minq, homme::Real *maxq, homme::Int *info)</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l04083">compose_slmm.cpp:4083</a></div></div>
<div class="ttc" id="anamespacebndry__mod_html"><div class="ttname"><a href="namespacebndry__mod.html">bndry_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="preqx_2bndry__mod_8_f90_source.html#l00005">bndry_mod.F90:5</a></div></div>
<div class="ttc" id="anamespacecompose__mod_html"><div class="ttname"><a href="namespacecompose__mod.html">compose_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__mod_8_f90_source.html#l00001">compose_mod.F90:1</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html"><div class="ttname"><a href="namespacecontrol__mod.html">control_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00008">control_mod.F90:8</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a0142942a55c16000237db63932980642"><div class="ttname"><a href="namespacecontrol__mod.html#a0142942a55c16000237db63932980642">control_mod::nu_q</a></div><div class="ttdeci">real(kind=real_kind), public nu_q</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00153">control_mod.F90:153</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a1c2d69b8f71e9a957a5b180477a751e4"><div class="ttname"><a href="namespacecontrol__mod.html#a1c2d69b8f71e9a957a5b180477a751e4">control_mod::test_case</a></div><div class="ttdeci">character(len=max_string_len), public test_case</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00114">control_mod.F90:114</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a242f2b7da6d34c2ed16a4820ee0033f9"><div class="ttname"><a href="namespacecontrol__mod.html#a242f2b7da6d34c2ed16a4820ee0033f9">control_mod::dt_remap_factor</a></div><div class="ttdeci">integer, public dt_remap_factor</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00069">control_mod.F90:69</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a3611129dec6c7ca0adf5baab19e40b32"><div class="ttname"><a href="namespacecontrol__mod.html#a3611129dec6c7ca0adf5baab19e40b32">control_mod::hypervis_scaling</a></div><div class="ttdeci">real(kind=real_kind), public hypervis_scaling</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00167">control_mod.F90:167</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a3c37a279d8c63ac16bc5210798e1e1e7"><div class="ttname"><a href="namespacecontrol__mod.html#a3c37a279d8c63ac16bc5210798e1e1e7">control_mod::semi_lagrange_hv_q</a></div><div class="ttdeci">integer, public semi_lagrange_hv_q</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00037">control_mod.F90:37</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a4ae9f52bee36b1f0153a2431b0faafdb"><div class="ttname"><a href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">control_mod::limiter_option</a></div><div class="ttdeci">integer, public limiter_option</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00096">control_mod.F90:96</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a53dd0faa4b398a355d1e4d5ee52d01fd"><div class="ttname"><a href="namespacecontrol__mod.html#a53dd0faa4b398a355d1e4d5ee52d01fd">control_mod::hypervis_subcycle_q</a></div><div class="ttdeci">integer, public hypervis_subcycle_q</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00161">control_mod.F90:161</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a6909204405993d9c799d4f81181bb0c8"><div class="ttname"><a href="namespacecontrol__mod.html#a6909204405993d9c799d4f81181bb0c8">control_mod::dt_tracer_factor</a></div><div class="ttdeci">integer, public dt_tracer_factor</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00069">control_mod.F90:69</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a7538e7332f24585fe70aea206a84ee5d"><div class="ttname"><a href="namespacecontrol__mod.html#a7538e7332f24585fe70aea206a84ee5d">control_mod::hypervis_order</a></div><div class="ttdeci">integer, public hypervis_order</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00162">control_mod.F90:162</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a7843d1e9a4379154a53150027e49f43b"><div class="ttname"><a href="namespacecontrol__mod.html#a7843d1e9a4379154a53150027e49f43b">control_mod::transport_alg</a></div><div class="ttdeci">integer, public transport_alg</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00021">control_mod.F90:21</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a8052f2e0ac9628ef45174037b0bd8f54"><div class="ttname"><a href="namespacecontrol__mod.html#a8052f2e0ac9628ef45174037b0bd8f54">control_mod::nu_p</a></div><div class="ttdeci">real(kind=real_kind), public nu_p</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00154">control_mod.F90:154</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a9a6f4129394969bdffe333ae2e3b4990"><div class="ttname"><a href="namespacecontrol__mod.html#a9a6f4129394969bdffe333ae2e3b4990">control_mod::integration</a></div><div class="ttdeci">character(len=max_string_len), public integration</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00016">control_mod.F90:16</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_aa42fe46bfc88132a53ea639ea5504a24"><div class="ttname"><a href="namespacecontrol__mod.html#aa42fe46bfc88132a53ea639ea5504a24">control_mod::dcmip16_mu_q</a></div><div class="ttdeci">real(kind=real_kind), public dcmip16_mu_q</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00251">control_mod.F90:251</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_ab14b33338b3f65ce4aff1c5db5e299d1"><div class="ttname"><a href="namespacecontrol__mod.html#ab14b33338b3f65ce4aff1c5db5e299d1">control_mod::semi_lagrange_cdr_check</a></div><div class="ttdeci">logical, public semi_lagrange_cdr_check</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00032">control_mod.F90:32</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_ae2d01a75815e71546709ca4a63a3e6ac"><div class="ttname"><a href="namespacecontrol__mod.html#ae2d01a75815e71546709ca4a63a3e6ac">control_mod::semi_lagrange_cdr_alg</a></div><div class="ttdeci">integer, public semi_lagrange_cdr_alg</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00029">control_mod.F90:29</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_aff62de0026bd6ea7c244564a9cbf1c03"><div class="ttname"><a href="namespacecontrol__mod.html#aff62de0026bd6ea7c244564a9cbf1c03">control_mod::cubed_sphere_map</a></div><div class="ttdeci">integer, public cubed_sphere_map</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00087">control_mod.F90:87</a></div></div>
<div class="ttc" id="anamespacecoordinate__systems__mod_html"><div class="ttname"><a href="namespacecoordinate__systems__mod.html">coordinate_systems_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="coordinate__systems__mod_8_f90_source.html#l00005">coordinate_systems_mod.F90:5</a></div></div>
<div class="ttc" id="anamespacederivative__mod_html"><div class="ttname"><a href="namespacederivative__mod.html">derivative_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="preqx_2derivative__mod_8_f90_source.html#l00005">derivative_mod.F90:5</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html"><div class="ttname"><a href="namespacedimensions__mod.html">dimensions_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00005">dimensions_mod.F90:5</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a0070848a40ac48379601d9a8a183c83b"><div class="ttname"><a href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">dimensions_mod::qsize</a></div><div class="ttdeci">integer, public qsize</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00026">dimensions_mod.F90:26</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a18c8482a9b97b76f2f0f065ad2329a9d"><div class="ttname"><a href="namespacedimensions__mod.html#a18c8482a9b97b76f2f0f065ad2329a9d">dimensions_mod::max_neigh_edges</a></div><div class="ttdeci">integer, public max_neigh_edges</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00035">dimensions_mod.F90:35</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a311b48352dde44bfd8b73213bfc94689"><div class="ttname"><a href="namespacedimensions__mod.html#a311b48352dde44bfd8b73213bfc94689">dimensions_mod::nlevp</a></div><div class="ttdeci">integer, parameter, public nlevp</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00030">dimensions_mod.F90:30</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a5020e9504c2decc9d182fe296ffc3b42"><div class="ttname"><a href="namespacedimensions__mod.html#a5020e9504c2decc9d182fe296ffc3b42">dimensions_mod::qsize_d</a></div><div class="ttdeci">integer, parameter, public qsize_d</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00018">dimensions_mod.F90:18</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a6baa218e1683465acc4f37fcea8e30d5"><div class="ttname"><a href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">dimensions_mod::nlev</a></div><div class="ttdeci">integer, parameter, public nlev</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00029">dimensions_mod.F90:29</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a8648e26ae0e474ccf69d32a8148520c9"><div class="ttname"><a href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">dimensions_mod::np</a></div><div class="ttdeci">integer, parameter, public np</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00023">dimensions_mod.F90:23</a></div></div>
<div class="ttc" id="anamespaceedge__mod_html"><div class="ttname"><a href="namespaceedge__mod.html">edge_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="preqx_2edge__mod_8_f90_source.html#l00005">edge_mod.F90:5</a></div></div>
<div class="ttc" id="anamespaceedgetype__mod_html"><div class="ttname"><a href="namespaceedgetype__mod.html">edgetype_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="edgetype__mod_8_f90_source.html#l00002">edgetype_mod.F90:2</a></div></div>
<div class="ttc" id="anamespaceelement__mod_html"><div class="ttname"><a href="namespaceelement__mod.html">element_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="element__mod_8_f90_source.html#l00005">element_mod.F90:5</a></div></div>
<div class="ttc" id="anamespaceelement__state_html"><div class="ttname"><a href="namespaceelement__state.html">element_state</a></div><div class="ttdef"><b>Definition:</b> <a href="preqx_2element__state_8_f90_source.html#l00005">element_state.F90:5</a></div></div>
<div class="ttc" id="anamespaceelement__state_html_ad600dbbab5d81bfc236df4786d322a10"><div class="ttname"><a href="namespaceelement__state.html#ad600dbbab5d81bfc236df4786d322a10">element_state::timelevels</a></div><div class="ttdeci">integer, parameter, public timelevels</div><div class="ttdef"><b>Definition:</b> <a href="preqx_2element__state_8_f90_source.html#l00012">element_state.F90:12</a></div></div>
<div class="ttc" id="anamespacehybrid__mod_html"><div class="ttname"><a href="namespacehybrid__mod.html">hybrid_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="hybrid__mod_8_f90_source.html#l00010">hybrid_mod.F90:10</a></div></div>
<div class="ttc" id="anamespacehybvcoord__mod_html"><div class="ttname"><a href="namespacehybvcoord__mod.html">hybvcoord_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="hybvcoord__mod_8_f90_source.html#l00005">hybvcoord_mod.F90:5</a></div></div>
<div class="ttc" id="anamespaceinterpolate__mod_html"><div class="ttname"><a href="namespaceinterpolate__mod.html">interpolate_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="interpolate__mod_8_f90_source.html#l00019">interpolate_mod.F90:19</a></div></div>
<div class="ttc" id="anamespaceinterpolate__mod_html_a35e943dfe23cd5d993f59610823e3869"><div class="ttname"><a href="namespaceinterpolate__mod.html#a35e943dfe23cd5d993f59610823e3869">interpolate_mod::minmax_tracers</a></div><div class="ttdeci">subroutine, public minmax_tracers(r, tracers, mint, maxt)</div><div class="ttdef"><b>Definition:</b> <a href="interpolate__mod_8_f90_source.html#l00395">interpolate_mod.F90:396</a></div></div>
<div class="ttc" id="anamespaceinterpolate__mod_html_a3a616000a8ae3e578f566bd332d05188"><div class="ttname"><a href="namespaceinterpolate__mod.html#a3a616000a8ae3e578f566bd332d05188">interpolate_mod::interpolate_tracers_init</a></div><div class="ttdeci">subroutine, public interpolate_tracers_init()</div><div class="ttdef"><b>Definition:</b> <a href="interpolate__mod_8_f90_source.html#l00269">interpolate_mod.F90:270</a></div></div>
<div class="ttc" id="anamespaceinterpolate__mod_html_a664716eba599277c527f7ecd0d8036a8"><div class="ttname"><a href="namespaceinterpolate__mod.html#a664716eba599277c527f7ecd0d8036a8">interpolate_mod::interpolate_tracers</a></div><div class="ttdeci">subroutine, public interpolate_tracers(r, tracers, f)</div><div class="ttdef"><b>Definition:</b> <a href="interpolate__mod_8_f90_source.html#l00307">interpolate_mod.F90:308</a></div></div>
<div class="ttc" id="anamespacekinds_html"><div class="ttname"><a href="namespacekinds.html">kinds</a></div><div class="ttdef"><b>Definition:</b> <a href="kinds_8_f90_source.html#l00005">kinds.F90:5</a></div></div>
<div class="ttc" id="anamespacekinds_html_a3df43a1a47df308ae70f8f8e98d9337c"><div class="ttname"><a href="namespacekinds.html#a3df43a1a47df308ae70f8f8e98d9337c">kinds::int_kind</a></div><div class="ttdeci">integer(kind=4), parameter, public int_kind</div><div class="ttdef"><b>Definition:</b> <a href="kinds_8_f90_source.html#l00027">kinds.F90:27</a></div></div>
<div class="ttc" id="anamespacekinds_html_abddc5e60584151b4d48b02e6436330f3"><div class="ttname"><a href="namespacekinds.html#abddc5e60584151b4d48b02e6436330f3">kinds::real_kind</a></div><div class="ttdeci">integer(kind=4), parameter, public real_kind</div><div class="ttdef"><b>Definition:</b> <a href="kinds_8_f90_source.html#l00027">kinds.F90:27</a></div></div>
<div class="ttc" id="anamespacekinds_html_af49f799ffc0bd030b587fb57de97d162"><div class="ttname"><a href="namespacekinds.html#af49f799ffc0bd030b587fb57de97d162">kinds::iulog</a></div><div class="ttdeci">integer(kind=4), parameter, public iulog</div><div class="ttdef"><b>Definition:</b> <a href="kinds_8_f90_source.html#l00027">kinds.F90:27</a></div></div>
<div class="ttc" id="anamespaceparallel__mod_html"><div class="ttname"><a href="namespaceparallel__mod.html">parallel_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8_f90_source.html#l00004">parallel_mod.F90:4</a></div></div>
<div class="ttc" id="anamespaceparallel__mod_html_a00f76482d3b7bb15da165475c828f466"><div class="ttname"><a href="namespaceparallel__mod.html#a00f76482d3b7bb15da165475c828f466">parallel_mod::abortmp</a></div><div class="ttdeci">subroutine, public abortmp(string)</div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8_f90_source.html#l00293">parallel_mod.F90:294</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html"><div class="ttname"><a href="namespacephysical__constants.html">physical_constants</a></div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00008">physical_constants.F90:8</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_a69f714bc9b76972dfccc59b88524efd3"><div class="ttname"><a href="namespacephysical__constants.html#a69f714bc9b76972dfccc59b88524efd3">physical_constants::rgas</a></div><div class="ttdeci">real(kind=real_kind), parameter, public rgas</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00064">physical_constants.F90:64</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_a723576dfdca03ef9e1ac67040270bf37"><div class="ttname"><a href="namespacephysical__constants.html#a723576dfdca03ef9e1ac67040270bf37">physical_constants::p0</a></div><div class="ttdeci">real(kind=real_kind), parameter, public p0</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00066">physical_constants.F90:66</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_a7f66175ea1fb6d94513f85a5b57ff6db"><div class="ttname"><a href="namespacephysical__constants.html#a7f66175ea1fb6d94513f85a5b57ff6db">physical_constants::kappa</a></div><div class="ttdeci">real(kind=real_kind), parameter, public kappa</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00070">physical_constants.F90:70</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_a9e383c954fc7f7ee936c4848b91194a3"><div class="ttname"><a href="namespacephysical__constants.html#a9e383c954fc7f7ee936c4848b91194a3">physical_constants::cp</a></div><div class="ttdeci">real(kind=real_kind), parameter, public cp</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00065">physical_constants.F90:65</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_a9f7801ffaf5ec43f669eec6a85f3f784"><div class="ttname"><a href="namespacephysical__constants.html#a9f7801ffaf5ec43f669eec6a85f3f784">physical_constants::rwater_vapor</a></div><div class="ttdeci">real(kind=real_kind), parameter, public rwater_vapor</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00068">physical_constants.F90:68</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_ab0f67c26417296baa8f3b876c001ff99"><div class="ttname"><a href="namespacephysical__constants.html#ab0f67c26417296baa8f3b876c001ff99">physical_constants::rearth</a></div><div class="ttdeci">real(kind=real_kind), public rearth</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00059">physical_constants.F90:59</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_adf45737a6626ac54e4f0e4d83a69e839"><div class="ttname"><a href="namespacephysical__constants.html#adf45737a6626ac54e4f0e4d83a69e839">physical_constants::g</a></div><div class="ttdeci">real(kind=real_kind), parameter, public g</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00060">physical_constants.F90:60</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_af091abf0ec9f32e0c88a7f14ba3df1d9"><div class="ttname"><a href="namespacephysical__constants.html#af091abf0ec9f32e0c88a7f14ba3df1d9">physical_constants::rrearth</a></div><div class="ttdeci">real(kind=real_kind), public rrearth</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00074">physical_constants.F90:74</a></div></div>
<div class="ttc" id="anamespaceprim__advection__base_html"><div class="ttname"><a href="namespaceprim__advection__base.html">prim_advection_base</a></div><div class="ttdef"><b>Definition:</b> <a href="prim__advection__base_8_f90_source.html#l00038">prim_advection_base.F90:38</a></div></div>
<div class="ttc" id="anamespaceprim__advection__base_html_aa1b3ddd0ebdfda6841170f7842eb3dcc"><div class="ttname"><a href="namespaceprim__advection__base.html#aa1b3ddd0ebdfda6841170f7842eb3dcc">prim_advection_base::advance_physical_vis</a></div><div class="ttdeci">subroutine, public advance_physical_vis(elem, hvcoord, hybrid, deriv, nt, nt_qdp, nets, nete, dt, mu)</div><div class="ttdef"><b>Definition:</b> <a href="prim__advection__base_8_f90_source.html#l00740">prim_advection_base.F90:741</a></div></div>
<div class="ttc" id="anamespacesl__advection_html"><div class="ttname"><a href="namespacesl__advection.html">sl_advection</a></div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00005">sl_advection.F90:5</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a2b2f6a18ca1463b5200267e26b548bc2"><div class="ttname"><a href="namespacesl__advection.html#a2b2f6a18ca1463b5200267e26b548bc2">sl_advection::biharmonic_wk_scalar</a></div><div class="ttdeci">subroutine biharmonic_wk_scalar(elem, qtens, deriv, edgeq, hybrid, nets, nete, nq)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00691">sl_advection.F90:692</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a339d6348fb45feb25a101f4a19e4eaf1"><div class="ttname"><a href="namespacesl__advection.html#a339d6348fb45feb25a101f4a19e4eaf1">sl_advection::test_reconstruct_and_limit_dp</a></div><div class="ttdeci">integer function test_reconstruct_and_limit_dp()</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l01066">sl_advection.F90:1067</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a60c1e2943a45bdad87d374dbfd85b9df"><div class="ttname"><a href="namespacesl__advection.html#a60c1e2943a45bdad87d374dbfd85b9df">sl_advection::ale_departure_from_gll</a></div><div class="ttdeci">subroutine ale_departure_from_gll(acart, vstar, elem, dt, normalize)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00430">sl_advection.F90:431</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a6e1aeb13721bdac8f49b15a97a3a7a88"><div class="ttname"><a href="namespacesl__advection.html#a6e1aeb13721bdac8f49b15a97a3a7a88">sl_advection::write_velocity_data</a></div><div class="ttdeci">subroutine write_velocity_data(elem, nets, nete, hy, deriv, dt, tl)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00383">sl_advection.F90:384</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a81b334fbea02bd090428fd930848fbce"><div class="ttname"><a href="namespacesl__advection.html#a81b334fbea02bd090428fd930848fbce">sl_advection::advance_hypervis_scalar</a></div><div class="ttdeci">subroutine advance_hypervis_scalar(elem, hvcoord, hybrid, deriv, nt, nt_qdp, nets, nete, dt2, nq)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00599">sl_advection.F90:600</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a81c34130a55d41c0fd8e542c1179a3bd"><div class="ttname"><a href="namespacesl__advection.html#a81c34130a55d41c0fd8e542c1179a3bd">sl_advection::prim_advec_tracers_remap_ale</a></div><div class="ttdeci">subroutine, public prim_advec_tracers_remap_ale(elem, deriv, hvcoord, hybrid, dt, tl, nets, nete)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00117">sl_advection.F90:118</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a83bd2ae5eada0731769fc1d7b01c206e"><div class="ttname"><a href="namespacesl__advection.html#a83bd2ae5eada0731769fc1d7b01c206e">sl_advection::amb_ghostvpack_unoriented</a></div><div class="ttdeci">subroutine amb_ghostvpack_unoriented(edge, v, nc, vlyr, kptr, desc)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00530">sl_advection.F90:531</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a8ba565fd96cb9b82977c6e0b1db77098"><div class="ttname"><a href="namespacesl__advection.html#a8ba565fd96cb9b82977c6e0b1db77098">sl_advection::sl_vertically_remap_tracers</a></div><div class="ttdeci">subroutine, public sl_vertically_remap_tracers(hybrid, elem, nets, nete, tl, dt_q)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00984">sl_advection.F90:985</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_a9aed74eaf497a836fb2c67bfa4b73968"><div class="ttname"><a href="namespacesl__advection.html#a9aed74eaf497a836fb2c67bfa4b73968">sl_advection::test_lagrange</a></div><div class="ttdeci">integer function test_lagrange()</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l01032">sl_advection.F90:1033</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_ab7dc046ce9683ab097234f77c7f76398"><div class="ttname"><a href="namespacesl__advection.html#ab7dc046ce9683ab097234f77c7f76398">sl_advection::dss_qdp</a></div><div class="ttdeci">subroutine dss_qdp(elem, nets, nete, hybrid, np1_qdp)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00478">sl_advection.F90:479</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_ac7a5c34b24e1562b64a3b8d682f9682d"><div class="ttname"><a href="namespacesl__advection.html#ac7a5c34b24e1562b64a3b8d682f9682d">sl_advection::ale_rkdss</a></div><div class="ttdeci">subroutine ale_rkdss(elem, nets, nete, hy, deriv, dt, tl, independent_time_steps)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00298">sl_advection.F90:299</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_aca3c66450815ee2b91aa1a08453b8c1c"><div class="ttname"><a href="namespacesl__advection.html#aca3c66450815ee2b91aa1a08453b8c1c">sl_advection::amb_ghostvunpack_unoriented</a></div><div class="ttdeci">subroutine amb_ghostvunpack_unoriented(edge, v, nc, vlyr, kptr, desc, GlobalId, u)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00551">sl_advection.F90:552</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_ad168f967a583e4237010759104e7e68c"><div class="ttname"><a href="namespacesl__advection.html#ad168f967a583e4237010759104e7e68c">sl_advection::perf_barrier</a></div><div class="ttdeci">subroutine perf_barrier(hybrid)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00584">sl_advection.F90:585</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_ad1e85e15e324c7b4e9796f9ec18376e0"><div class="ttname"><a href="namespacesl__advection.html#ad1e85e15e324c7b4e9796f9ec18376e0">sl_advection::calc_vertically_lagrangian_levels</a></div><div class="ttdeci">subroutine calc_vertically_lagrangian_levels(hybrid, elem, ie, hvcoord, tl, dt, deriv, dp_tol, dprecon)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00757">sl_advection.F90:759</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_ade3fbec219e2361b39f8db6e113d0e38"><div class="ttname"><a href="namespacesl__advection.html#ade3fbec219e2361b39f8db6e113d0e38">sl_advection::sl_unittest</a></div><div class="ttdeci">subroutine, public sl_unittest(par)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l01110">sl_advection.F90:1111</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_ae8d04ccff09648bd264446463fe344e9"><div class="ttname"><a href="namespacesl__advection.html#ae8d04ccff09648bd264446463fe344e9">sl_advection::eval_lagrange_poly_derivative</a></div><div class="ttdeci">subroutine eval_lagrange_poly_derivative(n, xs, ys, xi, yp)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00898">sl_advection.F90:899</a></div></div>
<div class="ttc" id="anamespacesl__advection_html_aee757725a5699052cf486db58117ccf5"><div class="ttname"><a href="namespacesl__advection.html#aee757725a5699052cf486db58117ccf5">sl_advection::sl_init1</a></div><div class="ttdeci">subroutine, public sl_init1(par, elem)</div><div class="ttdef"><b>Definition:</b> <a href="sl__advection_8_f90_source.html#l00064">sl_advection.F90:65</a></div></div>
<div class="ttc" id="anamespaceslmm_html"><div class="ttname"><a href="namespaceslmm.html">slmm</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l01155">compose_slmm.cpp:1155</a></div></div>
<div class="ttc" id="anamespacetime__mod_html"><div class="ttname"><a href="namespacetime__mod.html">time_mod</a></div><div class="ttdef"><b>Definition:</b> <a href="time__mod_8_f90_source.html#l00005">time_mod.F90:5</a></div></div>
<div class="ttc" id="anamespacetime__mod_html_a5dcb3daf686858cd2a8f3d0b6f5888b4"><div class="ttname"><a href="namespacetime__mod.html#a5dcb3daf686858cd2a8f3d0b6f5888b4">time_mod::timelevel_qdp</a></div><div class="ttdeci">subroutine, public timelevel_qdp(tl, qsplit, n0, np1)</div><div class="ttdef"><b>Definition:</b> <a href="time__mod_8_f90_source.html#l00083">time_mod.F90:84</a></div></div>
<div class="ttc" id="anamespacevertremap__base_html"><div class="ttname"><a href="namespacevertremap__base.html">vertremap_base</a></div><div class="ttdef"><b>Definition:</b> <a href="vertremap__base_8_f90_source.html#l00018">vertremap_base.F90:18</a></div></div>
<div class="ttc" id="anamespacevertremap__base_html_af3d970dd3d2368cb76531117cc4aacc4"><div class="ttname"><a href="namespacevertremap__base.html#af3d970dd3d2368cb76531117cc4aacc4">vertremap_base::remap1</a></div><div class="ttdeci">subroutine remap1(Qdp, nx, qsize, dp1, dp2)</div><div class="ttdef"><b>Definition:</b> <a href="vertremap__base_8_f90_source.html#l00078">vertremap_base.F90:79</a></div></div>
<div class="ttc" id="astructcoordinate__systems__mod_1_1cartesian2d__t_html"><div class="ttname"><a href="structcoordinate__systems__mod_1_1cartesian2d__t.html">coordinate_systems_mod::cartesian2d_t</a></div><div class="ttdef"><b>Definition:</b> <a href="coordinate__systems__mod_8_f90_source.html#l00017">coordinate_systems_mod.F90:17</a></div></div>
<div class="ttc" id="astructcoordinate__systems__mod_1_1cartesian3d__t_html"><div class="ttname"><a href="structcoordinate__systems__mod_1_1cartesian3d__t.html">coordinate_systems_mod::cartesian3d_t</a></div><div class="ttdef"><b>Definition:</b> <a href="coordinate__systems__mod_8_f90_source.html#l00022">coordinate_systems_mod.F90:22</a></div></div>
<div class="ttc" id="astructcoordinate__systems__mod_1_1spherical__polar__t_html"><div class="ttname"><a href="structcoordinate__systems__mod_1_1spherical__polar__t.html">coordinate_systems_mod::spherical_polar_t</a></div><div class="ttdef"><b>Definition:</b> <a href="coordinate__systems__mod_8_f90_source.html#l00028">coordinate_systems_mod.F90:28</a></div></div>
<div class="ttc" id="astructedgetype__mod_1_1edgebuffer__t_html"><div class="ttname"><a href="structedgetype__mod_1_1edgebuffer__t.html">edgetype_mod::edgebuffer_t</a></div><div class="ttdef"><b>Definition:</b> <a href="edgetype__mod_8_f90_source.html#l00036">edgetype_mod.F90:36</a></div></div>
<div class="ttc" id="astructedgetype__mod_1_1edgedescriptor__t_html"><div class="ttname"><a href="structedgetype__mod_1_1edgedescriptor__t.html">edgetype_mod::edgedescriptor_t</a></div><div class="ttdef"><b>Definition:</b> <a href="edgetype__mod_8_f90_source.html#l00014">edgetype_mod.F90:14</a></div></div>
<div class="ttc" id="astructedgetype__mod_1_1ghostbuffer3d__t_html"><div class="ttname"><a href="structedgetype__mod_1_1ghostbuffer3d__t.html">edgetype_mod::ghostbuffer3d_t</a></div><div class="ttdef"><b>Definition:</b> <a href="edgetype__mod_8_f90_source.html#l00062">edgetype_mod.F90:62</a></div></div>
<div class="ttc" id="astructelement__mod_1_1element__t_html"><div class="ttname"><a href="structelement__mod_1_1element__t.html">element_mod::element_t</a></div><div class="ttdef"><b>Definition:</b> <a href="element__mod_8_f90_source.html#l00032">element_mod.F90:32</a></div></div>
<div class="ttc" id="astructhybrid__mod_1_1hybrid__t_html"><div class="ttname"><a href="structhybrid__mod_1_1hybrid__t.html">hybrid_mod::hybrid_t</a></div><div class="ttdef"><b>Definition:</b> <a href="hybrid__mod_8_f90_source.html#l00015">hybrid_mod.F90:15</a></div></div>
<div class="ttc" id="astructhybvcoord__mod_1_1hvcoord__t_html"><div class="ttname"><a href="structhybvcoord__mod_1_1hvcoord__t.html">hybvcoord_mod::hvcoord_t</a></div><div class="ttdef"><b>Definition:</b> <a href="hybvcoord__mod_8_f90_source.html#l00019">hybvcoord_mod.F90:19</a></div></div>
<div class="ttc" id="astructparallel__mod_1_1parallel__t_html"><div class="ttname"><a href="structparallel__mod_1_1parallel__t.html">parallel_mod::parallel_t</a></div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8_f90_source.html#l00050">parallel_mod.F90:50</a></div></div>
<div class="ttc" id="astructtime__mod_1_1timelevel__t_html"><div class="ttname"><a href="structtime__mod_1_1timelevel__t.html">time_mod::timelevel_t</a></div><div class="ttdef"><b>Definition:</b> <a href="time__mod_8_f90_source.html#l00023">time_mod.F90:23</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_0b9b079b26fcc9f7494e277d37e7b67d.html">share</a></li><li class="navelem"><a class="el" href="sl__advection_8_f90.html">sl_advection.F90</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
