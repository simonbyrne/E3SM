<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Homme: src/share/compose/compose_cedr.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Homme
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('compose__cedr_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">compose_cedr.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="compose__cedr_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Uncomment this to look for MPI-related memory leaks.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//#define COMPOSE_DEBUG_MPI</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160; </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//&gt;&gt; cedr_kokkos.hpp</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_KOKKOS_HPP</span></div>
<div class="line"><a name="l00009"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#aeb0caac457028e74d23dedf6fe0be84e">    9</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_KOKKOS_HPP</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160; </div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;Kokkos_Core.hpp&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#ab62d865ca5513267292f212fbb9cb9e6">   13</a></span>&#160;<span class="preprocessor">#define KIF KOKKOS_INLINE_FUNCTION</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// Clarify that a class member type is meant to be private but is</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// marked public for Cuda visibility.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#aa880d3b0360ecb807e94f0b35abc9a29">   17</a></span>&#160;<span class="preprocessor">#define PRIVATE_CUDA public</span></div>
<div class="line"><a name="l00018"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a0f2e369bf2e22cb70102fefb49e674ec">   18</a></span>&#160;<span class="preprocessor">#define PROTECTED_CUDA public</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#if defined KOKKOS_COMPILER_GNU</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">// See https://github.com/kokkos/kokkos-kernels/issues/129 </span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor"># define ConstExceptGnu</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a368104aa4a3bed637d78c0034a89cf5e">   24</a></span>&#160;<span class="preprocessor"># define ConstExceptGnu const</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="namespacecedr.html">   27</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="namespacecedr_1_1impl.html">   28</a></span>&#160;<span class="keyword">namespace </span>impl {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// Turn a View&#39;s MemoryTraits (traits::memory_traits) into the equivalent</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">// unsigned int mask.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> View&gt;</div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_memory_traits_mask.html">   33</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1impl_1_1_memory_traits_mask.html">MemoryTraitsMask</a> {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  enum : <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#ifndef KOKKOS_VERSION</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// pre-v3</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="structcedr_1_1impl_1_1_memory_traits_mask.html#acf4ed67cb31145624eb4f22cae4cbbdeab98a9c144d5d60822b845dc7b5055c52">value</a> = ((View::traits::memory_traits::RandomAccess ? Kokkos::RandomAccess : 0) |</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;             (View::traits::memory_traits::Atomic ? Kokkos::Atomic : 0) |</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;             (View::traits::memory_traits::Restrict ? Kokkos::Restrict : 0) |</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;             (View::traits::memory_traits::Aligned ? Kokkos::Aligned : 0) |</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;             (<a class="code" href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">View::traits::memory_traits::Unmanaged</a> ? <a class="code" href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">Kokkos::Unmanaged</a> : 0))</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// &gt;= v3</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <a class="code" href="structcedr_1_1impl_1_1_memory_traits_mask.html#acf4ed67cb31145624eb4f22cae4cbbdeab98a9c144d5d60822b845dc7b5055c52">value</a> = ((View::traits::memory_traits::is_random_access ? Kokkos::RandomAccess : 0) |</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;             (View::traits::memory_traits::is_atomic ? Kokkos::Atomic : 0) |</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;             (View::traits::memory_traits::is_restrict ? Kokkos::Restrict : 0) |</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;             (View::traits::memory_traits::is_aligned ? Kokkos::Aligned : 0) |</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;             (View::traits::memory_traits::is_unmanaged ? <a class="code" href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">Kokkos::Unmanaged</a> : 0))</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_memory_traits_mask.html#acf4ed67cb31145624eb4f22cae4cbbdeab98a9c144d5d60822b845dc7b5055c52">   50</a></span>&#160;      };</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;};</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">// Make the input View Unmanaged, whether or not it already is. One might</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// imagine that View::unmanaged_type would provide this.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">//   Use: Unmanaged&lt;ViewType&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> View&gt;</div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">   57</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">Unmanaged</a> =</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">// Provide a full View type specification, augmented with Unmanaged.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  Kokkos::View&lt;<span class="keyword">typename</span> View::traits::scalar_array_type,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;               <span class="keyword">typename</span> View::traits::array_layout,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;               <span class="keyword">typename</span> View::traits::device_type,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;               Kokkos::MemoryTraits&lt;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                 <span class="comment">// All the current values...</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                 <a class="code" href="structcedr_1_1impl_1_1_memory_traits_mask.html">MemoryTraitsMask&lt;View&gt;::value</a> |</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                 <span class="comment">// ... |ed with the one we want, whether or not it&#39;s</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                 <span class="comment">// already there.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                 <a class="code" href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">Kokkos::Unmanaged</a>&gt; &gt;;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> View&gt;</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="namespacecedr_1_1impl.html#a5069e7dbc6821fadf6c89b08ac324bd0">   70</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespacecedr_1_1impl.html#a5069e7dbc6821fadf6c89b08ac324bd0">Const</a> = <span class="keyword">typename</span> View::const_type;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> View&gt;</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="namespacecedr_1_1impl.html#a9333a756f97752d17b2cfe51a508ddb3">   73</a></span>&#160;<span class="keyword">using</span> <a class="code" href="namespacecedr_1_1impl.html#a9333a756f97752d17b2cfe51a508ddb3">ConstUnmanaged</a> = <a class="code" href="namespacecedr_1_1impl.html#a5069e7dbc6821fadf6c89b08ac324bd0">Const&lt;Unmanaged&lt;View&gt;</a> &gt;;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ExeSpace&gt;</div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_device_type.html">   76</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1impl_1_1_device_type.html">DeviceType</a> {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keyword">typedef</span> Kokkos::Device&lt;<span class="keyword">typename</span> ExeSpace::execution_space,</div>
<div class="line"><a name="l00078"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_device_type.html#a316a06dae4264eeeb58f1507aeb9fc53">   78</a></span>&#160;                         <span class="keyword">typename</span> ExeSpace::memory_space&gt; <a class="code" href="structcedr_1_1impl_1_1_device_type.html#a316a06dae4264eeeb58f1507aeb9fc53">type</a>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;};</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#ifdef KOKKOS_HAVE_CUDA</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keyword">typedef</span> Kokkos::Device&lt;Kokkos::CudaSpace::execution_space,</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                       Kokkos::CudaSpace::memory_space&gt; <a class="code" href="namespacecedr_1_1impl.html#ade10df214ab86a43d760c425716ab26f">DefaultDeviceType</a>;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keyword">template</span> &lt;&gt; <span class="keyword">struct </span><a class="code" href="structcedr_1_1impl_1_1_device_type.html">DeviceType</a>&lt;<a class="code" href="namespace_kokkos.html">Kokkos</a>::Cuda&gt; {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacecedr_1_1impl.html#ade10df214ab86a43d760c425716ab26f">DefaultDeviceType</a> <a class="code" href="structcedr_1_1impl_1_1_device_type.html#a316a06dae4264eeeb58f1507aeb9fc53">type</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;};</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">typedef</span> Kokkos::Device&lt;Kokkos::DefaultExecutionSpace::execution_space,</div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="namespacecedr_1_1impl.html#ade10df214ab86a43d760c425716ab26f">   90</a></span>&#160;                       Kokkos::DefaultExecutionSpace::memory_space&gt; <a class="code" href="namespacecedr_1_1impl.html#ade10df214ab86a43d760c425716ab26f">DefaultDeviceType</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_on_gpu.html">   93</a></span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; <span class="keyword">struct </span><a class="code" href="structcedr_1_1impl_1_1_on_gpu.html">OnGpu</a> {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  enum : <span class="keywordtype">bool</span> { <a class="code" href="structcedr_1_1impl_1_1_on_gpu.html#a275caf39ce69261780aa94a4a4f62a96adcb1815c6dc942ff90ddf2afa9bc7a2b">value</a> =</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="preprocessor">#ifdef COMPOSE_MIMIC_GPU</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="keyword">true</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="keyword">false</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_on_gpu.html#a275caf39ce69261780aa94a4a4f62a96adcb1815c6dc942ff90ddf2afa9bc7a2b">  100</a></span>&#160;  };</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;};</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_CUDA</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">template</span> &lt;&gt; <span class="keyword">struct </span>OnGpu&lt;<a class="code" href="namespace_kokkos.html">Kokkos</a>::Cuda&gt; { enum : <span class="keywordtype">bool</span> { <a class="code" href="structcedr_1_1impl_1_1_on_gpu.html#a275caf39ce69261780aa94a4a4f62a96adcb1815c6dc942ff90ddf2afa9bc7a2b">value</a> = <span class="keyword">true</span> }; };</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ExeSpace = Kokkos::DefaultExecutionSpace&gt;</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_exe_space_utils.html">  107</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html">ExeSpaceUtils</a> {</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">  108</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">TeamPolicy</a> = Kokkos::TeamPolicy&lt;ExeSpace&gt;;</div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_exe_space_utils.html#a05464d4fa037da54688672e65e92c05d">  109</a></span>&#160;  <span class="keyword">using</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a05464d4fa037da54688672e65e92c05d">Member</a> = <span class="keyword">typename</span> TeamPolicy::member_type;</div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="structcedr_1_1impl_1_1_exe_space_utils.html#a453a15c7f15b8fc831baa73cb477dc99">  110</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">TeamPolicy</a> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a453a15c7f15b8fc831baa73cb477dc99">get_default_team_policy</a> (<span class="keywordtype">int</span> outer, <span class="keywordtype">int</span> inner) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="preprocessor">#ifdef COMPOSE_MIMIC_GPU</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> max_threads =</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_OPENMP</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      ExeSpace::concurrency()</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      1</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      ;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> team_size = max_threads &lt; 7 ? max_threads : 7;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">TeamPolicy</a>(outer, team_size, 1);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">TeamPolicy</a>(outer, 1, 1);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;}</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;};</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_CUDA</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keyword">struct </span>ExeSpaceUtils&lt;<a class="code" href="namespace_kokkos.html">Kokkos</a>::Cuda&gt; {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <span class="keyword">using</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">TeamPolicy</a> = Kokkos::TeamPolicy&lt;Kokkos::Cuda&gt;;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="keyword">using</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a05464d4fa037da54688672e65e92c05d">Member</a> = <span class="keyword">typename</span> TeamPolicy::member_type;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keyword">static</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">TeamPolicy</a> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a453a15c7f15b8fc831baa73cb477dc99">get_default_team_policy</a> (<span class="keywordtype">int</span> outer, <span class="keywordtype">int</span> inner) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">TeamPolicy</a>(outer, <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(128, 32*((inner + 31)/32)), 1);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;};</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">// GPU-friendly replacements for std::*.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">  140</a></span>&#160;<span class="keyword">const</span> T&amp; <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a> (<span class="keyword">const</span> T&amp; <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> T&amp; <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>) { <span class="keywordflow">return</span> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> &lt; <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> ? <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> : <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>; }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">  142</a></span>&#160;<span class="keyword">const</span> T&amp; <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a> (<span class="keyword">const</span> T&amp; <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> T&amp; <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>) { <span class="keywordflow">return</span> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> &gt; <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> ? <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> : <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>; }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="namespacecedr_1_1impl.html#a8e755217625cff5769f89160b2bdcd68">  144</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1impl.html#a8e755217625cff5769f89160b2bdcd68">swap</a> (T&amp; <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, T&amp; <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>) { <span class="keyword">const</span> T tmp = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>; <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> = <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>; <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = tmp; }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;} <span class="comment">// namespace impl</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">//&gt;&gt; cedr.hpp</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_HPP</span></div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#acf6335c28c00055c13b3da6debbaafb6">  156</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_HPP</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">//#include &quot;cedr_kokkos.hpp&quot;</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160; </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">// Communication-Efficient Constrained Density Reconstructors</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">  162</a></span>&#160;<span class="keyword">typedef</span> <span class="keywordtype">int</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="namespacecedr.html#a9b1ef9093cb8aed0e6bb1317bc27053e">  163</a></span>&#160;<span class="keyword">typedef</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="namespacecedr.html#a9b1ef9093cb8aed0e6bb1317bc27053e">Long</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="namespacecedr.html#a8b8f6c83cd7036cafc573f61c91244ef">  164</a></span>&#160;<span class="keyword">typedef</span> std::size_t <a class="code" href="namespacecedr.html#a8b8f6c83cd7036cafc573f61c91244ef">Size</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">  165</a></span>&#160;<span class="keyword">typedef</span> <span class="keywordtype">double</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">// CDRs in general implement</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">// * tracer mass, Qm, conservation;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">// * mixing ratio, q, shape preservation: any of local bound preservation,</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">//   dynamic range preservation, or simply non-negativity; and</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">// * tracer consistency, which follows from dynamic range preservation or</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">//   stronger (including local bound preservation) with rhom coming from the</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">//   dynamics.</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">// One can solve a subset of these.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">//   If !conserve, then the CDR does not alter the tracer mass, but it does not</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">// correct for any failure in mass conservation in the field given to it.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">//   If consistent but !shapepreserve, then the CDR solves the dynamic range</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">// preservation problem rather than the local bound preservation problem.</span></div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="structcedr_1_1_problem_type.html">  180</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1_problem_type.html">ProblemType</a> {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  enum : <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> {</div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">  182</a></span>&#160;    <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">conserve</a> = 1, <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">shapepreserve</a> = 1 &lt;&lt; 1, <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fac7b193334c098ff0d8259103fa8ce007">consistent</a> = 1 &lt;&lt; 2,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// The &#39;nonnegative&#39; problem type can be combined only with &#39;conserve&#39;. The</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">// caller can implement nonnegativity when running with &#39;shapepreserve&#39; or</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// &#39;consistent&#39; simply by setting Qm_min = 0. The &#39;nonnegativity&#39; type is</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="comment">// reserved for a particularly efficient type of problem in which</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// Qm_{min,max} are not specified.</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">nonnegative</a> = 1 &lt;&lt; 3</div>
<div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">  189</a></span>&#160;  };</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;};</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;}</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">//&gt;&gt; cedr_mpi.hpp</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160; </div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_MPI_HPP</span></div>
<div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#afaee6c10fdc73c66f67b8d83aebbff31">  200</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_MPI_HPP</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">//#include &quot;compose_config.hpp&quot;</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">//#include &quot;cedr.hpp&quot;</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html">  210</a></span>&#160;<span class="keyword">namespace </span>mpi {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="classcedr_1_1mpi_1_1_parallel.html">  212</a></span>&#160;<span class="keyword">class </span><a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a> {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  MPI_Comm comm_;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">  215</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;Parallel&gt; <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Ptr</a>;</div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="classcedr_1_1mpi_1_1_parallel.html#a19b8ad85d1408f6114421e328f617577">  216</a></span>&#160;  <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#a19b8ad85d1408f6114421e328f617577">Parallel</a>(MPI_Comm <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a>) : comm_(<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a>) {}</div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">  217</a></span>&#160;  MPI_Comm <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> comm_; }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#a4679f09fa87c42310ac9b90b712c2809">size</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#ad5a5d63fd5ed9d639834857757606b19">rank</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00220"></a><span class="lineno"><a class="line" href="classcedr_1_1mpi_1_1_parallel.html#a5f796868b6a39b81295292def0196fe3">  220</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#a5f796868b6a39b81295292def0196fe3">root</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> 0; }</div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="classcedr_1_1mpi_1_1_parallel.html#ad956465e5758049c7587929595d52299">  221</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#ad956465e5758049c7587929595d52299">amroot</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#ad5a5d63fd5ed9d639834857757606b19">rank</a>() == <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#a5f796868b6a39b81295292def0196fe3">root</a>(); }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;};</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="structcedr_1_1mpi_1_1_request.html">  224</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a> {</div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="structcedr_1_1mpi_1_1_request.html#a4b34b505d84b830b36538152c39151b2">  225</a></span>&#160;  MPI_Request <a class="code" href="structcedr_1_1mpi_1_1_request.html#a4b34b505d84b830b36538152c39151b2">request</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="preprocessor">#ifdef COMPOSE_DEBUG_MPI</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;  <span class="keywordtype">int</span> unfreed;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>();</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  ~<a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>();</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;};</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a> <a class="code" href="namespacecedr_1_1mpi.html#a6e572b78e7d5d0ff5a43cab685375bb3">make_parallel</a>(MPI_Comm comm);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160; </div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a8aa2d3a508c129246605b5750632bf2c">  236</a></span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; MPI_Datatype <a class="code" href="namespacecedr_1_1mpi.html#a8aa2d3a508c129246605b5750632bf2c">get_type</a>();</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* sendbuf, T* rcvbuf, <span class="keywordtype">int</span> count, MPI_Op op,</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;           <span class="keywordtype">int</span> root);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">all_reduce</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* sendbuf, T* rcvbuf, <span class="keywordtype">int</span> count, MPI_Op op);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">isend</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* buf, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> dest, <span class="keywordtype">int</span> tag,</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;          <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>* ireq = <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">irecv</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, T* buf, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> src, <span class="keywordtype">int</span> tag,</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;          <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>* ireq = <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#ae0e941fa3748495376c11d4ff65b30e7">waitany</a>(<span class="keywordtype">int</span> count, <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>* reqs, <span class="keywordtype">int</span>* index, MPI_Status* stats = <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">waitall</a>(<span class="keywordtype">int</span> count, <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>* reqs, MPI_Status* stats = <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a81666edb64563b7477056b7612b9ef16">gather</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* sendbuf, <span class="keywordtype">int</span> sendcount,</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;           T* recvbuf, <span class="keywordtype">int</span> recvcount, <span class="keywordtype">int</span> root);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160; </div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a400d5cae4d1c0616beee60e458a54f36">gatherv</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* sendbuf, <span class="keywordtype">int</span> sendcount,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            T* recvbuf, <span class="keyword">const</span> <span class="keywordtype">int</span>* recvcounts, <span class="keyword">const</span> <span class="keywordtype">int</span>* displs, <span class="keywordtype">int</span> root);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacecedr_1_1mpi.html#acdb744561335e178b128fd66512c7dca">all_ok</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keywordtype">bool</span> im_ok);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno"><a class="line" href="structcedr_1_1mpi_1_1_op.html">  267</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1mpi_1_1_op.html">Op</a> {</div>
<div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="structcedr_1_1mpi_1_1_op.html#aaf68fcf95b791b02bb232ee91a3c570a">  268</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;Op&gt; <a class="code" href="structcedr_1_1mpi_1_1_op.html#aaf68fcf95b791b02bb232ee91a3c570a">Ptr</a>;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="structcedr_1_1mpi_1_1_op.html#abcd53e121f0327ef0e1f86d6f10581a4">  270</a></span>&#160;  <a class="code" href="structcedr_1_1mpi_1_1_op.html#abcd53e121f0327ef0e1f86d6f10581a4">Op</a> (MPI_User_function* <span class="keyword">function</span>, <span class="keywordtype">bool</span> commute) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    MPI_Op_create(<span class="keyword">function</span>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(commute), &amp;op_);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="structcedr_1_1mpi_1_1_op.html#ab08fb1807a8e963b14fcaa7f3b6c92d4">  274</a></span>&#160;  <a class="code" href="structcedr_1_1mpi_1_1_op.html#ab08fb1807a8e963b14fcaa7f3b6c92d4">~Op</a> () { MPI_Op_free(&amp;op_); }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="structcedr_1_1mpi_1_1_op.html#ae5809d9c733e2e22650358548df631fc">  276</a></span>&#160;  <span class="keyword">const</span> MPI_Op&amp; <a class="code" href="structcedr_1_1mpi_1_1_op.html#ae5809d9c733e2e22650358548df631fc">get</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> op_; }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  MPI_Op op_;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;};</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;} <span class="comment">// namespace mpi</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">//#include &quot;cedr_mpi_inl.hpp&quot;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160; </div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">//&gt;&gt; cedr_util.hpp</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_UTIL_HPP</span></div>
<div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a7d4b3911384bb194e2dbde5a0e4f516d">  294</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_UTIL_HPP</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">//#include &quot;cedr_kokkos.hpp&quot;</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">//#include &quot;cedr_mpi.hpp&quot;</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l00302"></a><span class="lineno"><a class="line" href="namespacecedr_1_1util.html">  302</a></span>&#160;<span class="keyword">namespace </span>util {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; KOKKOS_INLINE_FUNCTION constexpr</div>
<div class="line"><a name="l00305"></a><span class="lineno"><a class="line" href="namespacecedr_1_1util.html#aebb086baeee1459e0a42a4d659e044dc">  305</a></span>&#160;T <a class="code" href="namespacecedr_1_1util.html#aebb086baeee1459e0a42a4d659e044dc">square</a> (<span class="keyword">const</span> T&amp; <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>) { <span class="keywordflow">return</span> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>; }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(<span class="keyword">const</span> std::string&amp; <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> b1, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> b2 = 0);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">// Uniform rand in [0, 1).</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>();</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">  312</a></span>&#160;<span class="preprocessor">#define pr(m) do {                                      \</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="preprocessor">    int _pid_ = 0;                                      \</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;_pid_);              \</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">    std::stringstream _ss_;                             \</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor">    _ss_.precision(15);                                 \</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="preprocessor">    _ss_ &lt;&lt; &quot;pid &quot;</span> &lt;&lt; _pid_ &lt;&lt; &quot; &quot; &lt;&lt; m &lt;&lt; std::endl;   \</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    std::cerr &lt;&lt; _ss_.str();                            \</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  } while (0)</div>
<div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a72e9d004e93b15cc394fac1ffccdc477">  320</a></span>&#160;<span class="preprocessor">#define pr0(m) do {                                     \</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="preprocessor">    int _pid_; MPI_Comm_rank(MPI_COMM_WORLD, &amp;_pid_);   \</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">    if (_pid_ != 0) break;                              \</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="preprocessor">    std::stringstream _ss_;                             \</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="preprocessor">    _ss_ &lt;&lt; &quot;pid &quot;</span> &lt;&lt; _pid_ &lt;&lt; &quot; &quot; &lt;&lt; m &lt;&lt; std::endl;   \</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    std::cerr &lt;&lt; _ss_.str();                            \</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  } while (0)</div>
<div class="line"><a name="l00327"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#aee1c2a81a0aaa758fb41ff058dd320bb">  327</a></span>&#160;<span class="preprocessor">#define prc(m) pr(#m &lt;&lt; &quot; | &quot;</span> &lt;&lt; (m))</div>
<div class="line"><a name="l00328"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a42ac7a2fac9b8c6a92c05881844402cc">  328</a></span>&#160;<span class="preprocessor">#define pr0c(m) pr0(#m &lt;&lt; &quot; | &quot;</span> &lt;&lt; (m))</div>
<div class="line"><a name="l00329"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">  329</a></span>&#160;<span class="preprocessor">#define puf(m) &quot;(&quot;</span> &lt;&lt; #m &lt;&lt; &quot; &quot; &lt;&lt; (m) &lt;&lt; &quot;)&quot;</div>
<div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">  330</a></span>&#160;<span class="preprocessor">#define pu(m) &lt;&lt; &quot; &quot;</span> &lt;&lt; puf(m)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">  332</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a> (<span class="keyword">const</span> std::string&amp; name, <span class="keyword">const</span> T* <span class="keyword">const</span> v, <span class="keyword">const</span> <span class="keywordtype">size_t</span> n) {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  std::stringstream ss;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  ss.precision(15);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  ss &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot; = [&quot;</span>;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) ss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; v[i];</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;];&quot;</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(ss.str());</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div>
<div class="line"><a name="l00340"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a7c3c704df71e1a19ad95990aa8120aa0">  340</a></span>&#160;<span class="preprocessor">#define mprarr(m) cedr::util::prarr(#m, m.data(), m.size())</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160; </div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l00343"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">  343</a></span>&#160;<span class="preprocessor"># define cedr_assert(condition) do {                                    \</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">    if ( ! (condition)) {                                               \</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="preprocessor">      std::stringstream _ss_;                                           \</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="preprocessor">      _ss_ &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot;</span> &lt;&lt; __LINE__ &lt;&lt; &quot;: FAIL:\n&quot; &lt;&lt; #condition  \</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        &lt;&lt; &quot;\n&quot;;                                                        \</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        throw std::logic_error(_ss_.str());                             \</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    }                                                                   \</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  } while (0)</div>
<div class="line"><a name="l00351"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">  351</a></span>&#160;<span class="preprocessor"># define cedr_kernel_assert(condition) do {     \</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">    if ( ! (condition))                         \</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">      Kokkos::abort(#condition);                \</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="preprocessor">  } while (0)</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="preprocessor"># define cedr_assert(condition)</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor"># define cedr_kernel_assert(condition)</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">  359</a></span>&#160;<span class="preprocessor">#define cedr_throw_if(condition, message) do {                          \</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">    if (condition) {                                                    \</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="preprocessor">      std::stringstream _ss_;                                           \</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">      _ss_ &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot;</span> &lt;&lt; __LINE__ &lt;&lt; &quot;: The condition:\n&quot;       \</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;           &lt;&lt; #condition &quot;\nled to the exception\n&quot; &lt;&lt; message &lt;&lt; &quot;\n&quot;; \</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        throw std::logic_error(_ss_.str());                             \</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    }                                                                   \</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  } while (0)</div>
<div class="line"><a name="l00367"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a69e47429f12cecc8d0019d3611431ef1">  367</a></span>&#160;<span class="preprocessor">#define cedr_kernel_throw_if(condition, message) do {                   \</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="preprocessor">    if (condition)                                                      \</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="preprocessor">      Kokkos::abort(#condition &quot; led to the exception\n&quot;</span> message);      \</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  } while (0)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">  372</a></span>&#160;<span class="keyword">inline</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">reldif</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;{ <span class="keywordflow">return</span> std::abs(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> - <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>)/<a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(std::abs(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>), std::abs(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>)); }</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">reldif</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno"><a class="line" href="structcedr_1_1util_1_1_f_i_l_e_closer.html#a628a5c38409e8571169ca24df78c9ed3">  377</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1util_1_1_f_i_l_e_closer.html">FILECloser</a> { <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1util_1_1_f_i_l_e_closer.html#a628a5c38409e8571169ca24df78c9ed3">operator() </a>(FILE* fh) { fclose(fh); } };</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> ExeSpace&gt;</div>
<div class="line"><a name="l00380"></a><span class="lineno"><a class="line" href="structcedr_1_1util_1_1_raw_array_raft.html">  380</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html">RawArrayRaft</a> {</div>
<div class="line"><a name="l00381"></a><span class="lineno"><a class="line" href="structcedr_1_1util_1_1_raw_array_raft.html#a0c93fb7bedaefa430740c716fc9b5679">  381</a></span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structcedr_1_1impl_1_1_device_type.html#a316a06dae4264eeeb58f1507aeb9fc53">cedr::impl::DeviceType&lt;ExeSpace&gt;::type</a> <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a0c93fb7bedaefa430740c716fc9b5679">Device</a>;</div>
<div class="line"><a name="l00382"></a><span class="lineno"><a class="line" href="structcedr_1_1util_1_1_raw_array_raft.html#a82c44a66fe4bb3fa084a173c02b9df6a">  382</a></span>&#160;  <span class="keyword">typedef</span> Kokkos::View&lt;T*, Device&gt; <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a82c44a66fe4bb3fa084a173c02b9df6a">List</a>;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;  </div>
<div class="line"><a name="l00384"></a><span class="lineno"><a class="line" href="structcedr_1_1util_1_1_raw_array_raft.html#a68a6e0b2cca3384d2f91b067b11e46fd">  384</a></span>&#160;  <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a68a6e0b2cca3384d2f91b067b11e46fd">RawArrayRaft</a> (T* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n)</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    : a_(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>), n_(n)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  {</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    a_d_ = <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a82c44a66fe4bb3fa084a173c02b9df6a">List</a>(<span class="stringliteral">&quot;RawArrayRaft::a_d_&quot;</span>, n_);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    a_h_ = <span class="keyword">typename</span> List::HostMirror(a_, n_);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  }</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno"><a class="line" href="structcedr_1_1util_1_1_raw_array_raft.html#a80ddb92836fd045166cca9068999d90e">  391</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a82c44a66fe4bb3fa084a173c02b9df6a">List</a>&amp; <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a80ddb92836fd045166cca9068999d90e">sync_device</a> () {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    Kokkos::deep_copy(a_d_, a_h_);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">return</span> a_d_;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="structcedr_1_1util_1_1_raw_array_raft.html#a6984d9f19d5f816ecce7ebf08dc92b9d">  396</a></span>&#160;  T* <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a6984d9f19d5f816ecce7ebf08dc92b9d">sync_host</a> () {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    Kokkos::deep_copy(a_h_, a_d_);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">return</span> a_;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  }</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno"><a class="line" href="structcedr_1_1util_1_1_raw_array_raft.html#a6477a26e112f9bdcd241f943836991f2">  401</a></span>&#160;  T* <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a6477a26e112f9bdcd241f943836991f2">device_ptr</a> () { <span class="keywordflow">return</span> a_d_.data(); }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  T* a_;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n_;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html#a82c44a66fe4bb3fa084a173c02b9df6a">List</a> a_d_;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  <span class="keyword">typename</span> List::HostMirror a_h_;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;};</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;}</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;}</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160; </div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">//&gt;&gt; cedr_cdr.hpp</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_CDR_HPP</span></div>
<div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a13bc33994facfeb5a9daff70e39e5e89">  420</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_CDR_HPP</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">//#include &quot;cedr_mpi.hpp&quot;</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">// Constrained Density Reconstructor interface.</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">//   Find a point Qm in the set</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">//      { Qm: ( i) e&#39;Qm = Qm_global</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">//            (ii) Qm_min &lt;= Qm &lt;= Qm_max },</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">// where e is the vector of 1s. Each algorithm in CEDR has its own optimality</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">// principle to decide on the point.</span></div>
<div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html">  431</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1_c_d_r.html">CDR</a> {</div>
<div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a3c8346ee469398a071419e53fdbe7b74">  432</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;CDR&gt; <a class="code" href="structcedr_1_1_c_d_r.html#a3c8346ee469398a071419e53fdbe7b74">Ptr</a>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r_1_1_options.html">  434</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">Options</a> {</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// In exact arithmetic, mass is conserved exactly and bounds of a feasible</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="comment">// problem are not violated. In inexact arithmetic, these properties are</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// inexact, and approximation quality of one can be preferred to that of the</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// other. Use this option to prefer numerical mass conservation over</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="comment">// numerical bounds nonviolation. In practice, this option governs errrs at</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="comment">// the level of 10 to 1000 times numeric_limits&lt;Real&gt;::epsilon().</span></div>
<div class="line"><a name="l00441"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r_1_1_options.html#a9a6fa254247b874087170c3b86db13a3">  441</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html#a9a6fa254247b874087170c3b86db13a3">prefer_numerical_mass_conservation_to_numerical_bounds</a>;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r_1_1_options.html#afd18af8ddc6582a59e84a16059ffa832">  443</a></span>&#160;    <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html#afd18af8ddc6582a59e84a16059ffa832">Options</a> ()</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      : <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html#a9a6fa254247b874087170c3b86db13a3">prefer_numerical_mass_conservation_to_numerical_bounds</a>(false)</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    {}</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  };</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#aa4a6a4dd2583b886ea2345109526cbfd">  448</a></span>&#160;  <a class="code" href="structcedr_1_1_c_d_r.html#aa4a6a4dd2583b886ea2345109526cbfd">CDR</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">Options</a> options = <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">Options</a>()) : <a class="code" href="structcedr_1_1_c_d_r.html#a0f079d40fdc243e68be879d40e286767">options_</a>(options) {}</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a8f36942e03a3bf1cb2a9ba823244faa8">  450</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#a8f36942e03a3bf1cb2a9ba823244faa8">print</a>(std::ostream&amp; os)<span class="keyword"> const </span>{}</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a466e671d6f74d6915246951e68ab3614">  452</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">Options</a>&amp; <a class="code" href="structcedr_1_1_c_d_r.html#a466e671d6f74d6915246951e68ab3614">get_options</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="structcedr_1_1_c_d_r.html#a0f079d40fdc243e68be879d40e286767">options_</a>; }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160; </div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="comment">// Set up QLT tracer metadata. Call declare_tracer in order of the tracer</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  <span class="comment">// index in the caller&#39;s numbering. Once end_tracer_declarations is called, it</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="comment">// is an error to call declare_tracer again.</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="comment">//   Associate the tracer with a rhom index. In many problems, there will be</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="comment">// only one rhom, so rhomidx is always 0.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  <span class="comment">//   It is an error to call this function from a parallel region.</span></div>
<div class="line"><a name="l00460"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#aaaab72126510943e4ea028c6028de64d">  460</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#aaaab72126510943e4ea028c6028de64d">declare_tracer</a>(<span class="keywordtype">int</span> problem_type, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx) = 0;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  <span class="comment">// It is an error to call this function from a parallel region.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a09ce830b9d53db7a7a26afe23a84bd3b">  463</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#a09ce830b9d53db7a7a26afe23a84bd3b">end_tracer_declarations</a>() = 0;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">// Optionally query the sizes of the two primary memory buffers. This</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  <span class="comment">// operation is valid after end_tracer_declarations was called.</span></div>
<div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a54f40ac08ba0a53af5a7388a3881f025">  467</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#a54f40ac08ba0a53af5a7388a3881f025">get_buffers_sizes</a>(<span class="keywordtype">size_t</span>&amp; buf1, <span class="keywordtype">size_t</span>&amp; buf2) = 0;</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">// Optionally provide the two primary memory buffers. These pointers must</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">// point to memory having at least the sizes returned by get_buffer_sizes.</span></div>
<div class="line"><a name="l00470"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a43b82d0e0517bb5b7250c66dea37ca59">  470</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#a43b82d0e0517bb5b7250c66dea37ca59">set_buffers</a>(<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf1, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf2) = 0;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160; </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="comment">// Call this method to finish the setup phase. The subsequent methods are</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="comment">// valid only after this method has been called.</span></div>
<div class="line"><a name="l00474"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a024f5f3db801c5add24053c5f4df4c30">  474</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#a024f5f3db801c5add24053c5f4df4c30">finish_setup</a>() = 0;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#aa2ea72b6689f1611245976c35014505d">  476</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="structcedr_1_1_c_d_r.html#aa2ea72b6689f1611245976c35014505d">get_problem_type</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx) <span class="keyword">const</span> = 0;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#aab0c355174d756a73f7d70c07c962f09">  478</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1_c_d_r.html#aab0c355174d756a73f7d70c07c962f09">get_num_tracers</a>() <span class="keyword">const</span> = 0;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  <span class="comment">// set_{rhom,Qm}: Set cell values prior to running the QLT algorithm.</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">//   Notation:</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;  <span class="comment">//     rho: Total density.</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">//       Q: Tracer density.</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="comment">//       q: Tracer mixing ratio = Q/rho.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  <span class="comment">//      *m: Mass corresponding to the density; results from an integral over a</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;  <span class="comment">//          region, such as a cell.</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  <span class="comment">//   Some CDRs have a nontrivial local &lt;-&gt; global cell index map. For these</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;  <span class="comment">// CDRs, lclcellidx may be nontrivial. For others, the caller should provide</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  <span class="comment">// the index into the local cell.</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <span class="comment">//   set_rhom must be called before set_Qm.</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  KOKKOS_FUNCTION</div>
<div class="line"><a name="l00494"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a49513f55696d058b2a799318b32770de">  494</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#a49513f55696d058b2a799318b32770de">set_rhom</a>(</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx,</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">// Current total mass in this cell.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom) <span class="keyword">const</span> = 0;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  KOKKOS_FUNCTION</div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#ab3033b2dc6b8acf8868adc840e8687cb">  500</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#ab3033b2dc6b8acf8868adc840e8687cb">set_Qm</a>(</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx,</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// Current tracer mass in this cell.</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm,</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="comment">// Minimum and maximum permitted tracer mass in this cell. Ignored if</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">// ProblemType is &#39;nonnegative&#39;.</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_min, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_max,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="comment">// If mass conservation is requested, provide the previous Qm, which will be</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="comment">// summed to give the desired global mass.</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_prev = std::numeric_limits&lt;Real&gt;::infinity()) <span class="keyword">const</span> = 0;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="comment">// Run the QLT algorithm with the values set by set_{rho,Q}. It is an error to</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="comment">// call this function from a parallel region.</span></div>
<div class="line"><a name="l00513"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#aa988cb015d9ac7de1464d4e5f7240e2c">  513</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_c_d_r.html#aa988cb015d9ac7de1464d4e5f7240e2c">run</a>() = 0;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="comment">// Get a cell&#39;s tracer mass Qm after the QLT algorithm has run.</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  KOKKOS_FUNCTION</div>
<div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a00c495105fab3b2436e6c97d2da5135d">  517</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="structcedr_1_1_c_d_r.html#a00c495105fab3b2436e6c97d2da5135d">get_Qm</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx) <span class="keyword">const</span> = 0;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="structcedr_1_1_c_d_r.html#a0f079d40fdc243e68be879d40e286767">  520</a></span>&#160;  <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">Options</a> <a class="code" href="structcedr_1_1_c_d_r.html#a0f079d40fdc243e68be879d40e286767">options_</a>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;};</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">//&gt;&gt; cedr_qlt.hpp</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160; </div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_QLT_HPP</span></div>
<div class="line"><a name="l00531"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a9d13f8762fc4acf6e58c00ee8517cd75">  531</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_QLT_HPP</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160; </div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">//#include &quot;cedr_cdr.hpp&quot;</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">//#include &quot;cedr_util.hpp&quot;</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">// QLT: Quasi-local tree-based non-iterative tracer density reconstructor for</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">//      mass conservation, shape preservation, and tracer consistency.</span></div>
<div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt.html">  548</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr_1_1qlt.html">qlt</a> {</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keyword">using</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">cedr::mpi::Parallel</a>;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html">  551</a></span>&#160;<span class="keyword">namespace </span>impl {</div>
<div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">  552</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a> {</div>
<div class="line"><a name="l00553"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a80c73a0bd8c3eedb2c7206008d398369">  553</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;const NodeSets&gt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a80c73a0bd8c3eedb2c7206008d398369">ConstPtr</a>;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  </div>
<div class="line"><a name="l00555"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ae6835ea8185bc6ea84ead71203869fbca308a0ac1e8070200a48c6b84239bb60a">  555</a></span>&#160;  enum : <span class="keywordtype">int</span> { <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ae6835ea8185bc6ea84ead71203869fbca308a0ac1e8070200a48c6b84239bb60a">mpitag</a> = 42 };</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160; </div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  <span class="comment">// A node in the tree that is relevant to this rank.</span></div>
<div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">  558</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">Node</a> {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">// Rank of the node. If the node is in a level, then its rank is my rank. If</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// it&#39;s not in a level, then it is a comm partner of a node on this rank.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">  561</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">// cellidx if leaf node, ie, if nkids == 0; otherwise, undefined.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a8fd5cc5c891fb77f704bb5c28926ea82">  563</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a8fd5cc5c891fb77f704bb5c28926ea82">id</a>;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <span class="comment">// This node&#39;s parent, a comm partner, if such a partner is required.</span></div>
<div class="line"><a name="l00565"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#aa22fc635907a421d3a7874ea6f09a43a">  565</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#aa22fc635907a421d3a7874ea6f09a43a">parent</a>;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">// This node&#39;s kids, comm partners, if such partners are required. Parent</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="comment">// and kid nodes are pruned relative to the full tree over the mesh to</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">// contain just the nodes that matter to this rank.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">  569</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">nkids</a>;</div>
<div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a62ddeb52897d22624365a25e4cad5662">  570</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a62ddeb52897d22624365a25e4cad5662">kids</a>[2];</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// Offset factor into bulk data. An offset is a unit; actual buffer sizes</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">// are multiples of this unit.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">  573</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a26a4b8a2c362cf90dc088cdb0a419050">  575</a></span>&#160;    KOKKOS_FUNCTION <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a26a4b8a2c362cf90dc088cdb0a419050">Node</a> () : <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a>(-1), <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a8fd5cc5c891fb77f704bb5c28926ea82">id</a>(-1), <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#aa22fc635907a421d3a7874ea6f09a43a">parent</a>(-1), <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">nkids</a>(0), <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>(-1) {}</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  };</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="comment">// A level in the level schedule that is constructed to orchestrate</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  <span class="comment">// communication. A node in a level depends only on nodes in lower-numbered</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="comment">// levels (l2r) or higher-numbered (r2l).</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="comment">//</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  <span class="comment">// The communication patterns are as follows:</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  <span class="comment">//   &gt; l2r</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="comment">//   MPI rcv into kids</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="comment">//   sum into node</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  <span class="comment">//   MPI send from node</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="comment">//   &gt; r2l</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="comment">//   MPI rcv into node</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="comment">//   solve QP for kids</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="comment">//   MPI send from kids</span></div>
<div class="line"><a name="l00591"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">  591</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">Level</a> {</div>
<div class="line"><a name="l00592"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html">  592</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html">MPIMetaData</a> {</div>
<div class="line"><a name="l00593"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#ab95674919a44c629cea0bf7710f4c8a8">  593</a></span>&#160;      <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#ab95674919a44c629cea0bf7710f4c8a8">rank</a>;   <span class="comment">// Rank of comm partner.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#a18780fe0b7ac08571587d3e6f5cf509d">  594</a></span>&#160;      <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#a18780fe0b7ac08571587d3e6f5cf509d">offset</a>; <span class="comment">// Offset to start of buffer for this comm.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#a0ed18ff2290e9cc3e3a42ca672ffc437">  595</a></span>&#160;      <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#a0ed18ff2290e9cc3e3a42ca672ffc437">size</a>;   <span class="comment">// Size of this buffer in units of offsets.</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    };</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">// The nodes in the level.</span></div>
<div class="line"><a name="l00599"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">  599</a></span>&#160;    std::vector&lt;Int&gt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="comment">// MPI information for this level.</span></div>
<div class="line"><a name="l00601"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">  601</a></span>&#160;    std::vector&lt;MPIMetaData&gt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>;</div>
<div class="line"><a name="l00602"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">  602</a></span>&#160;    <span class="keyword">mutable</span> std::vector&lt;mpi::Request&gt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a64ec9159b1349d3b14b0df7f9644481b">me_send_req</a>, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a1958b88c6ac291db0d61b9097a4a0594">me_recv_req</a>, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">kids_req</a>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  };</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">// Levels. nodes[0] is level 0, the leaf level.</span></div>
<div class="line"><a name="l00606"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">  606</a></span>&#160;  std::vector&lt;Level&gt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  <span class="comment">// Number of data slots this rank needs. Each node owned by this rank, plus</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <span class="comment">// kids on other ranks, have an associated slot.</span></div>
<div class="line"><a name="l00609"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">  609</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">nslots</a>;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  <span class="comment">// Allocate a node. The list node_mem_ is the mechanism for memory ownership;</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="comment">// node_mem_ isn&#39;t used for anything other than owning nodes.</span></div>
<div class="line"><a name="l00613"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad2f4f2e6a12a2a14af52bdeea6b0dd39">  613</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad2f4f2e6a12a2a14af52bdeea6b0dd39">alloc</a> () {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> idx = node_mem_.size();</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    node_mem_.push_back(<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">Node</a>());</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordflow">return</span> idx;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;  }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#aee6389fbf05b013dff31e396d2548c5e">  619</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#aee6389fbf05b013dff31e396d2548c5e">nnode</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> node_mem_.size(); }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">  621</a></span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">Node</a>* <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; idx) {</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(idx &gt;= 0 &amp;&amp; idx &lt; <span class="keyword">static_cast&lt;</span><a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a><span class="keyword">&gt;</span>(node_mem_.size()));</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordflow">return</span> &amp;node_mem_[idx];</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  }</div>
<div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a2168adf08a01a3cdc1e506d7bb843066">  625</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">Node</a>* <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a2168adf08a01a3cdc1e506d7bb843066">node_h</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; idx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a>*<span class="keyword">&gt;</span>(<span class="keyword">this</span>)-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a46d290212390f403a3e00d16d5674636">print</a>(std::ostream&amp; os) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;  </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  std::vector&lt;Node&gt; node_mem_;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;};</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160; </div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ExeSpace&gt;</div>
<div class="line"><a name="l00636"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html">  636</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html">NodeSetsDeviceData</a> {</div>
<div class="line"><a name="l00637"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#ae2e0552864e4da6d10318d087ea45dfe">  637</a></span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structcedr_1_1impl_1_1_device_type.html#a316a06dae4264eeeb58f1507aeb9fc53">cedr::impl::DeviceType&lt;ExeSpace&gt;::type</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#ae2e0552864e4da6d10318d087ea45dfe">Device</a>;</div>
<div class="line"><a name="l00638"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#ad5e6cc429699f72099a6ed6f8a8f78e5">  638</a></span>&#160;  <span class="keyword">typedef</span> Kokkos::View&lt;Int*, Device&gt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#ad5e6cc429699f72099a6ed6f8a8f78e5">IntList</a>;</div>
<div class="line"><a name="l00639"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#afaaed340bcf7e1c7cb6e1d8ec5075a79">  639</a></span>&#160;  <span class="keyword">typedef</span> Kokkos::View&lt;NodeSets::Node*, Device&gt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#afaaed340bcf7e1c7cb6e1d8ec5075a79">NodeList</a>;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">  641</a></span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#afaaed340bcf7e1c7cb6e1d8ec5075a79">NodeList</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">node</a>;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;  <span class="comment">// lvl(lvlptr(l):lvlptr(l+1)-1) is the list of node indices into node for</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;  <span class="comment">// level l.</span></div>
<div class="line"><a name="l00644"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">  644</a></span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#ad5e6cc429699f72099a6ed6f8a8f78e5">IntList</a> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">lvl</a>, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;};</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160; </div>
<div class="line"><a name="l00647"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a60a33d14250e0f94489b76589052590b">  647</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html">impl::NodeSetsDeviceData&lt;Kokkos::DefaultHostExecutionSpace&gt;</a> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a60a33d14250e0f94489b76589052590b">NodeSetsHostData</a>;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;} <span class="comment">// namespace impl</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1tree.html">  650</a></span>&#160;<span class="keyword">namespace </span>tree {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">// The caller builds a tree of these nodes to pass to QLT.</span></div>
<div class="line"><a name="l00652"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html">  652</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html">Node</a> {</div>
<div class="line"><a name="l00653"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">  653</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;Node&gt; <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">Ptr</a>;</div>
<div class="line"><a name="l00654"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#aa7c74cf6f178da4d95fba73f7d8957ac">  654</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html">Node</a>* <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#aa7c74cf6f178da4d95fba73f7d8957ac">parent</a>; <span class="comment">// (Can&#39;t be a shared_ptr: would be a circular dependency.)</span></div>
<div class="line"><a name="l00655"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#ad3cded9e7dc5ae27003bec236ef60bed">  655</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#ad3cded9e7dc5ae27003bec236ef60bed">rank</a>;           <span class="comment">// Owning rank.</span></div>
<div class="line"><a name="l00656"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a897b7034c85009fac0ad1cff38666d12">  656</a></span>&#160;  <a class="code" href="namespacecedr.html#a9b1ef9093cb8aed0e6bb1317bc27053e">Long</a> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a897b7034c85009fac0ad1cff38666d12">cellidx</a>;       <span class="comment">// If a leaf, the cell to which this node corresponds.</span></div>
<div class="line"><a name="l00657"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a792a2ecbc99f2bef73976b1560124dd3">  657</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a792a2ecbc99f2bef73976b1560124dd3">nkids</a>;          <span class="comment">// 0 at leaf, 1 or 2 otherwise.</span></div>
<div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#aae95dadec9c763ed43b5ce73f0eafa9e">  658</a></span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">Node::Ptr</a> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#aae95dadec9c763ed43b5ce73f0eafa9e">kids</a>[2];</div>
<div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a89687110e6b7977fd8315fd8fd876b33">  659</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a89687110e6b7977fd8315fd8fd876b33">reserved</a>;       <span class="comment">// For internal use.</span></div>
<div class="line"><a name="l00660"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a935d3a370b4643ae2c846970b9701d40">  660</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a935d3a370b4643ae2c846970b9701d40">level</a>;          <span class="comment">// If providing only partial trees, set level to</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                      <span class="comment">// the level of this node, with a leaf node at</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                      <span class="comment">// level 0.</span></div>
<div class="line"><a name="l00663"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1tree_1_1_node.html#aaa27c4241f11ccd06b85ef015bd139f1">  663</a></span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#aaa27c4241f11ccd06b85ef015bd139f1">Node</a> () : <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#aa7c74cf6f178da4d95fba73f7d8957ac">parent</a>(nullptr), <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#ad3cded9e7dc5ae27003bec236ef60bed">rank</a>(-1), <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a897b7034c85009fac0ad1cff38666d12">cellidx</a>(-1), <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a792a2ecbc99f2bef73976b1560124dd3">nkids</a>(0), <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a89687110e6b7977fd8315fd8fd876b33">reserved</a>(-1), <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a935d3a370b4643ae2c846970b9701d40">level</a>(-1) {}</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;};</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">// Utility to make a tree over a 1D mesh. For testing, it can be useful to</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">// create an imbalanced tree.</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">Node::Ptr</a> <a class="code" href="namespacecedr_1_1qlt_1_1tree.html#a30aba1281f9c0c2c90d3066d6d17d78c">make_tree_over_1d_mesh</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells,</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                                 <span class="keyword">const</span> <span class="keywordtype">bool</span> imbalanced = <span class="keyword">false</span>);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;} <span class="comment">// namespace tree</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160; </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ExeSpace = Kokkos::DefaultExecutionSpace&gt;</div>
<div class="line"><a name="l00673"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html">  673</a></span>&#160;<span class="keyword">class </span><a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT</a> : <span class="keyword">public</span> <a class="code" href="structcedr_1_1_c_d_r.html">cedr::CDR</a> {</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00675"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#af1a0b1b2a8800fe7a49045308bd61ee2">  675</a></span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structcedr_1_1impl_1_1_device_type.html#a316a06dae4264eeeb58f1507aeb9fc53">cedr::impl::DeviceType&lt;ExeSpace&gt;::type</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#af1a0b1b2a8800fe7a49045308bd61ee2">Device</a>;</div>
<div class="line"><a name="l00676"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a0fe6b6b89981974d682b4096ac210b1e">  676</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ExeSpace&gt;</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a0fe6b6b89981974d682b4096ac210b1e">Me</a>;</div>
<div class="line"><a name="l00677"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a84478e9b51aaa88ce6f926a4a41c07a5">  677</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;Me&gt; <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a84478e9b51aaa88ce6f926a4a41c07a5">Ptr</a>;</div>
<div class="line"><a name="l00678"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a073b0d26f059d049d8b66c5d1799e3e3">  678</a></span>&#160;  <span class="keyword">typedef</span> Kokkos::View&lt;Real*, Device&gt; <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a073b0d26f059d049d8b66c5d1799e3e3">RealList</a>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;  </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="comment">// Set up QLT topology and communication data structures based on a tree. Both</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <span class="comment">// ncells and tree refer to the global mesh, not just this processor&#39;s</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <span class="comment">// part. The tree must be identical across ranks.</span></div>
<div class="line"><a name="l00683"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a9018bfb30d655cb813ffd035498d4b52">  683</a></span>&#160;  <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a9018bfb30d655cb813ffd035498d4b52">QLT</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree,</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">CDR::Options</a> options = <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">Options</a>());</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160; </div>
<div class="line"><a name="l00686"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a8318d3741486e1e54865d2c3d8133653">  686</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a8318d3741486e1e54865d2c3d8133653">print</a>(std::ostream&amp; os) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160; </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">// Number of cells owned by this rank.</span></div>
<div class="line"><a name="l00689"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ae887c2546eb47eafdeb8e58fe6a1e288">  689</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ae887c2546eb47eafdeb8e58fe6a1e288">nlclcells</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  <span class="comment">// Cells owned by this rank, in order of local numbering. Thus,</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="comment">// gci2lci(gcis[i]) == i. Ideally, the caller never actually calls gci2lci(),</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  <span class="comment">// and instead uses the information from get_owned_glblcells to determine</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  <span class="comment">// local cell indices.</span></div>
<div class="line"><a name="l00695"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a1ee460e97c8285bebfbbd17af959564b">  695</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a1ee460e97c8285bebfbbd17af959564b">get_owned_glblcells</a>(std::vector&lt;Long&gt;&amp; gcis) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160; </div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="comment">// For global cell index cellidx, i.e., the globally unique ordinal associated</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// with a cell in the caller&#39;s tree, return this rank&#39;s local index for</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  <span class="comment">// it. This is not an efficient operation.</span></div>
<div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#aa9b83575295958b3ecc89e6ef81d8df4">  700</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#aa9b83575295958b3ecc89e6ef81d8df4">gci2lci</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; gci) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a3267afdf17e6a873b9267087ab1b2d3e">  702</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a3267afdf17e6a873b9267087ab1b2d3e">declare_tracer</a>(<span class="keywordtype">int</span> problem_type, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a9cbe7b87776dcf8ab9c5c56e5685d974">  704</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a9cbe7b87776dcf8ab9c5c56e5685d974">end_tracer_declarations</a>() <span class="keyword">override</span>;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160; </div>
<div class="line"><a name="l00706"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ab3021096085b1400b07e0d39fe6f9ae7">  706</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ab3021096085b1400b07e0d39fe6f9ae7">get_buffers_sizes</a>(<span class="keywordtype">size_t</span>&amp; buf1, <span class="keywordtype">size_t</span>&amp; buf2) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160; </div>
<div class="line"><a name="l00708"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a8855469fbf2739b8b3b9c94ede02eb67">  708</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a8855469fbf2739b8b3b9c94ede02eb67">set_buffers</a>(<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf1, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf2) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
<div class="line"><a name="l00710"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ad85d32b7277b27a39d6bda5e605daac7">  710</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ad85d32b7277b27a39d6bda5e605daac7">finish_setup</a>() <span class="keyword">override</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ad9c51a9177892aa04c600773abe6ac11">  712</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ad9c51a9177892aa04c600773abe6ac11">get_problem_type</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160; </div>
<div class="line"><a name="l00714"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ac09df17ae7c38e04f41dcb5700092c0c">  714</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ac09df17ae7c38e04f41dcb5700092c0c">get_num_tracers</a>() <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="comment">// lclcellidx is gci2lci(cellidx).</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00718"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ae5bcfd4e69486bda74225278f513b3c3">  718</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ae5bcfd4e69486bda74225278f513b3c3">set_rhom</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="comment">// lclcellidx is gci2lci(cellidx).</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;  KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00722"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a6a8d2cda6321bd2f6a59e4dd85f9bfc6">  722</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a6a8d2cda6321bd2f6a59e4dd85f9bfc6">set_Qm</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx,</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;              <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_min, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_max,</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;              <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_prev = std::numeric_limits&lt;Real&gt;::infinity()) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a596f975d028550632ee5fb3e70b5eed5">  726</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a596f975d028550632ee5fb3e70b5eed5">run</a>() <span class="keyword">override</span>;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00729"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a99f352c9b0cf724a5b45b70b0d288c1c">  729</a></span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a99f352c9b0cf724a5b45b70b0d288c1c">get_Qm</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l00732"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a055eac02ef22081e738e735fa68578d1">  732</a></span>&#160;  <span class="keyword">typedef</span> Kokkos::View&lt;Int*, Device&gt; <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a055eac02ef22081e738e735fa68578d1">IntList</a>;</div>
<div class="line"><a name="l00733"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a3ef39b340f964d6965517076750726e3">  733</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacecedr_1_1impl.html#a5069e7dbc6821fadf6c89b08ac324bd0">cedr::impl::Const&lt;IntList&gt;</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a3ef39b340f964d6965517076750726e3">ConstIntList</a>;</div>
<div class="line"><a name="l00734"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a95d862da426b1f9348837e9c73bfa7b3">  734</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacecedr_1_1impl.html#a9333a756f97752d17b2cfe51a508ddb3">cedr::impl::ConstUnmanaged&lt;IntList&gt;</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a95d862da426b1f9348837e9c73bfa7b3">ConstUnmanagedIntList</a>;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6">  736</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6">init</a>(<span class="keyword">const</span> std::string&amp; name, <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a055eac02ef22081e738e735fa68578d1">IntList</a>&amp; d,</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                   <span class="keyword">typename</span> IntList::HostMirror&amp; h, <span class="keywordtype">size_t</span> n);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html">  739</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html">MetaDataBuilder</a> {</div>
<div class="line"><a name="l00740"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html#acac9da1d9d3ad145e75d5f8ff2bf20a3">  740</a></span>&#160;    <span class="keyword">typedef</span> std::shared_ptr&lt;MetaDataBuilder&gt; <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html#acac9da1d9d3ad145e75d5f8ff2bf20a3">Ptr</a>;</div>
<div class="line"><a name="l00741"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html#af35f9a2f88cf3ee57123a3e201616ff9">  741</a></span>&#160;    std::vector&lt;int&gt; <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html#af35f9a2f88cf3ee57123a3e201616ff9">trcr2prob</a>;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  };</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a9b3bb53f1243612163efbabee2f2cc65">  744</a></span>&#160;<a class="code" href="compose__cedr_8cpp.html#a0f2e369bf2e22cb70102fefb49e674ec">PROTECTED_CUDA</a>:</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="keyword">struct </span>MetaData {</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    enum : <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> { nprobtypes = 6 };</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> IntListT&gt;</div>
<div class="line"><a name="l00749"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html">  749</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html">Arrays</a> {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="comment">// trcr2prob(i) is the ProblemType of tracer i.</span></div>
<div class="line"><a name="l00751"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad2714cc0919e9e0a1f5cf8baa540642f">  751</a></span>&#160;      IntListT <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad2714cc0919e9e0a1f5cf8baa540642f">trcr2prob</a>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="comment">// bidx2trcr(prob2trcrptr(i) : prob2trcrptr(i+1)-1) is the list of</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="comment">// tracers having ProblemType index i. bidx2trcr is the permutation</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <span class="comment">// from the user&#39;s tracer index to the bulk data&#39;s ordering (bidx).</span></div>
<div class="line"><a name="l00755"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a29e16e577774d503cd09e64b13652eee">  755</a></span>&#160;      <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> prob2trcrptr[nprobtypes+1];</div>
<div class="line"><a name="l00756"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ac7e103c98969b33015ba8d9def91601f">  756</a></span>&#160;      IntListT <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ac7e103c98969b33015ba8d9def91601f">bidx2trcr</a>;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="comment">// Inverse of bidx2trcr.</span></div>
<div class="line"><a name="l00758"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad445fe9e8595795ac65ed704e91f6baf">  758</a></span>&#160;      IntListT <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad445fe9e8595795ac65ed704e91f6baf">trcr2bidx</a>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="comment">// Points to the start of l2r bulk data for each problem type, within a</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="comment">// slot.</span></div>
<div class="line"><a name="l00761"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a82c1ec992eb8eacbf40cd36fb3597a7c">  761</a></span>&#160;      <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> prob2bl2r[nprobtypes + 1];</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <span class="comment">// Point to the start of l2r bulk data for each tracer, within a slot.</span></div>
<div class="line"><a name="l00763"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a5e73df43cb23f600d25596cbf56be503">  763</a></span>&#160;      IntListT <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a5e73df43cb23f600d25596cbf56be503">trcr2bl2r</a>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="comment">// Same for r2l bulk data.</span></div>
<div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad51124248b30607a6159b0984b2c2b7a">  765</a></span>&#160;      <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> prob2br2l[nprobtypes + 1];</div>
<div class="line"><a name="l00766"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a869c5b42f9ad3209fe0f913b73db23b8">  766</a></span>&#160;      IntListT <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a869c5b42f9ad3209fe0f913b73db23b8">trcr2br2l</a>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    };</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160; </div>
<div class="line"><a name="l00769"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a449fb834c32f927c0d70c86c8199116f">  769</a></span>&#160;    KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a449fb834c32f927c0d70c86c8199116f">get_problem_type</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; idx);</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="comment">// icpc doesn&#39;t let us use problem_type_ here, even though it&#39;s constexpr.</span></div>
<div class="line"><a name="l00772"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#aa4ae6dfd97ee6c328511f0f7e45976fb">  772</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#aa4ae6dfd97ee6c328511f0f7e45976fb">get_problem_type_idx</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; mask);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#afffa19071eec946749272d9ad1dbd0dd">  774</a></span>&#160;    KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#afffa19071eec946749272d9ad1dbd0dd">get_problem_type_l2r_bulk_size</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; mask);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a4098edea0e28e95f830dcbcf914f48e0">  776</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a4098edea0e28e95f830dcbcf914f48e0">get_problem_type_r2l_bulk_size</a>(<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; mask);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html">  778</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html">CPT</a> {</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="comment">//   The only problem not supported is conservation alone. It makes very</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="comment">// little sense to use QLT for conservation alone.</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="comment">//   The remaining problems fall into 6 categories of details. These</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <span class="comment">// categories are tracked by QLT; which of the original problems being</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="comment">// solved is not important.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keyword">enum</span> {</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="comment">// l2r: rhom, (Qm_min, Qm, Qm_max)*; r2l: Qm*</span></div>
<div class="line"><a name="l00786"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html#acb496446940d04f2a3ac68b4026e01c2a56c111b286b18f4dcac142893fb33df7">  786</a></span>&#160;        s  = <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">ProblemType::shapepreserve</a>,</div>
<div class="line"><a name="l00787"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html#acb496446940d04f2a3ac68b4026e01c2acc3df01bc003c976c5d7e9f933ec2b44">  787</a></span>&#160;        st = <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">ProblemType::shapepreserve</a> | <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fac7b193334c098ff0d8259103fa8ce007">ProblemType::consistent</a>,</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="comment">// l2r: rhom, (Qm_min, Qm, Qm_max, Qm_prev)*; r2l: Qm*</span></div>
<div class="line"><a name="l00789"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html#acb496446940d04f2a3ac68b4026e01c2ad7a32e08a0ac7fb2878f3dd6a4bb4b5a">  789</a></span>&#160;        cs  = <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a> | s,</div>
<div class="line"><a name="l00790"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html#acb496446940d04f2a3ac68b4026e01c2a40c9e467d82c772727de47c665518760">  790</a></span>&#160;        cst = <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a> | st,</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="comment">// l2r: rhom, (q_min, Qm, q_max)*; r2l: (Qm, q_min, q_max)*</span></div>
<div class="line"><a name="l00792"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html#acb496446940d04f2a3ac68b4026e01c2a18807fdfa66ad6a57888240ce4537e8c">  792</a></span>&#160;        t = <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fac7b193334c098ff0d8259103fa8ce007">ProblemType::consistent</a>,</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="comment">// l2r: rhom, (q_min, Qm, q_max, Qm_prev)*; r2l: (Qm, q_min, q_max)*</span></div>
<div class="line"><a name="l00794"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html#acb496446940d04f2a3ac68b4026e01c2a199aab1e60564daa3699171226df51dc">  794</a></span>&#160;        ct = <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a> | t,</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="comment">// l2r: rhom, Qm*; r2l: Qm*</span></div>
<div class="line"><a name="l00796"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html#acb496446940d04f2a3ac68b4026e01c2ac720c244fcc69eabd940cbe6b7aac9d9">  796</a></span>&#160;        nn = <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">ProblemType::nonnegative</a>,</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="comment">// l2r: rhom, (Qm, Qm_prev)*; r2l: Qm*</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        cnn = <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a> | nn</div>
<div class="line"><a name="l00799"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html#acb496446940d04f2a3ac68b4026e01c2a20d0dd72272bde015547e38284896144">  799</a></span>&#160;      };</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    };</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00802"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ad4f52d10cdefba976a000b5f0a186a95">  802</a></span>&#160;    <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html">Arrays&lt;typename ConstUnmanagedIntList::HostMirror&gt;</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ad4f52d10cdefba976a000b5f0a186a95">a_h</a>;</div>
<div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ad74c27f1a2680f0c76d9b2991b6f18fe">  803</a></span>&#160;    <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html">Arrays&lt;ConstUnmanagedIntList&gt;</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ad74c27f1a2680f0c76d9b2991b6f18fe">a_d</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a3447eb3c22f536ef0816e8625df7f69b">  805</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a3447eb3c22f536ef0816e8625df7f69b">init</a>(<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html">MetaDataBuilder</a>&amp; mdb);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html">Arrays&lt;typename IntList::HostMirror&gt;</a> a_h_;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html">Arrays&lt;IntList&gt;</a> a_d_;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  };</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keyword">struct </span>BulkData {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">cedr::impl::Unmanaged&lt;RealList&gt;</a> UnmanagedRealList;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160; </div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    UnmanagedRealList l2r_data, r2l_data;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    BulkData () : inited_(false) {}</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordtype">bool</span> inited ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> inited_; }</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6">init</a>(<span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; l2r_sz, <span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; r2l_sz);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6">init</a>(<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* l2r_buf, <span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; l2r_sz,</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;              <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* r2l_buf, <span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; r2l_sz);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordtype">bool</span> inited_;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a073b0d26f059d049d8b66c5d1799e3e3">RealList</a> l2r_data_, r2l_data_;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  };</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160; </div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l00831"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a4bce582840cb58a4ce70fbd740cbfacf">  831</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a4bce582840cb58a4ce70fbd740cbfacf">init</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160; </div>
<div class="line"><a name="l00833"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a1a8a3cf478360277dc875eef4b4250d7">  833</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a1a8a3cf478360277dc875eef4b4250d7">init_ordinals</a>();</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00836"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ae584a8a8c6ded31710928b0bfffeb242">  836</a></span>&#160;  <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ae584a8a8c6ded31710928b0bfffeb242">p_</a>;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="comment">// Tree and communication topology.</span></div>
<div class="line"><a name="l00838"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a586e7f48cf1fd309d37f6c67da0dc76c">  838</a></span>&#160;  std::shared_ptr&lt;const impl::NodeSets&gt; <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a586e7f48cf1fd309d37f6c67da0dc76c">ns_</a>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="comment">// Data extracted from ns_ for use in run() on device.</span></div>
<div class="line"><a name="l00840"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a86d63f43bc89c9244408775e6b29ade1">  840</a></span>&#160;  std::shared_ptr&lt;impl::NodeSetsDeviceData&lt;ExeSpace&gt; &gt; <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a86d63f43bc89c9244408775e6b29ade1">nsdd_</a>;</div>
<div class="line"><a name="l00841"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#aa347f16c8c195dc3a9eea28b841e7dc0">  841</a></span>&#160;  std::shared_ptr&lt;impl::NodeSetsHostData&gt; <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#aa347f16c8c195dc3a9eea28b841e7dc0">nshd_</a>;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// Globally unique cellidx -&gt; rank-local index.</span></div>
<div class="line"><a name="l00843"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#abff0963db1a1bd0c00a46ee0ce48a3f6">  843</a></span>&#160;  <span class="keyword">typedef</span> std::map&lt;Int,Int&gt; <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#abff0963db1a1bd0c00a46ee0ce48a3f6">Gci2LciMap</a>;</div>
<div class="line"><a name="l00844"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ab6765f1390332eddf8f644fe60128433">  844</a></span>&#160;  std::shared_ptr&lt;Gci2LciMap&gt; <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ab6765f1390332eddf8f644fe60128433">gci2lci_</a>;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  <span class="comment">// Temporary to collect caller&#39;s tracer information prior to calling</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="comment">// end_tracer_declarations().</span></div>
<div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a63777cbd5e67f5ed92a2612513dece18">  847</a></span>&#160;  <span class="keyword">typename</span> <a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html#acac9da1d9d3ad145e75d5f8ff2bf20a3">MetaDataBuilder::Ptr</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a63777cbd5e67f5ed92a2612513dece18">mdb_</a>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="comment">// Constructed in end_tracer_declarations().</span></div>
<div class="line"><a name="l00850"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a969c2dfcff33c9a462d65896808f9623">  850</a></span>&#160;  MetaData <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a969c2dfcff33c9a462d65896808f9623">md_</a>;</div>
<div class="line"><a name="l00851"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#af79ccbf41643efd58dcc29de8260199a">  851</a></span>&#160;  BulkData <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#af79ccbf41643efd58dcc29de8260199a">bd_</a>;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160; </div>
<div class="line"><a name="l00853"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a46d88be28124ad16902a170610883dc1">  853</a></span>&#160;<a class="code" href="compose__cedr_8cpp.html#aa880d3b0360ecb807e94f0b35abc9a29">PRIVATE_CUDA</a>:</div>
<div class="line"><a name="l00854"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a89cd086580da5d13f31e71ae477d0d98">  854</a></span>&#160;  <span class="keywordtype">void</span> l2r_recv(<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">impl::NodeSets::Level</a>&amp; lvl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00855"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a0c1a4d9fd58ff961f01578a04a15e02e">  855</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a0c1a4d9fd58ff961f01578a04a15e02e">l2r_combine_kid_data</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lvlidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00856"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#adbfb99b85e927e80b9f1a6fb69f76047">  856</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#adbfb99b85e927e80b9f1a6fb69f76047">l2r_send_to_parents</a>(<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">impl::NodeSets::Level</a>&amp; lvl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a5273c47c902c24b4f2a0741f27956120">  857</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a5273c47c902c24b4f2a0741f27956120">root_compute</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00858"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a4ed32b7c9d2c3f2889b89dcc01c452fe">  858</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a4ed32b7c9d2c3f2889b89dcc01c452fe">r2l_recv</a>(<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">impl::NodeSets::Level</a>&amp; lvl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00859"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a6fcf4740b2f4b23a2ad03ec133ead2ee">  859</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a6fcf4740b2f4b23a2ad03ec133ead2ee">r2l_solve_qp</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lvlidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00860"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a495b3a172143d2de992f477bc529e2b1">  860</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a495b3a172143d2de992f477bc529e2b1">r2l_send_to_kids</a>(<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">impl::NodeSets::Level</a>&amp; lvl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;};</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160; </div>
<div class="line"><a name="l00863"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1test.html">  863</a></span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l00864"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1test_1_1_input.html">  864</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html">Input</a> {</div>
<div class="line"><a name="l00865"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1test_1_1_input.html#ab62561957a57c9969924cf7cefaf25cf">  865</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a64b2c5e120cc9ba459c69a6f29bc6bd7">unittest</a>, <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ab62561957a57c9969924cf7cefaf25cf">perftest</a>, <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a6c43827bc4fa990eb3fb972249b92403">write</a>;</div>
<div class="line"><a name="l00866"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">  866</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">ncells</a>, <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a4e1833af1045e63a2a2532fa7db02b6a">ntracers</a>, <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a0a6ccc5d94ae8e3f487f331da739ba94">tracer_type</a>, <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#aa0f64406587f313e9309fa0c13530e16">nrepeat</a>;</div>
<div class="line"><a name="l00867"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1test_1_1_input.html#a7317dba6f9385c1369b162913ed7ab92">  867</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a7317dba6f9385c1369b162913ed7ab92">pseudorandom</a>, <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a3891ebb2177bb10e34b50fee35a6a908">verbose</a>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;};</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160; </div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1test.html#abcc1c3037c40bfabd109c2046c1c8e11">run_unit_and_randomized_tests</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html">Input</a>&amp; in);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1test.html#a097812f6cbbfba363a2a7501d7d6e1ca">test_qlt</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells,</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;             <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nrepeat,</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;             <span class="comment">// Diagnostic output for dev and illustration purposes. To be</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;             <span class="comment">// clear, no QLT unit test requires output to be checked; each</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;             <span class="comment">// checks in-memory data and returns a failure count.</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;             <span class="keyword">const</span> <span class="keywordtype">bool</span> write,</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;             <span class="comment">// Provide memory to QLT for its buffers.</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;             <span class="keyword">const</span> <span class="keywordtype">bool</span> external_memory,</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;             <span class="comment">// Set CDR::Options.prefer_numerical_mass_conservation_to_numerical_bounds.</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;             <span class="keyword">const</span> <span class="keywordtype">bool</span> prefer_mass_con_to_bounds,</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;             <span class="keyword">const</span> <span class="keywordtype">bool</span> verbose);</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;} <span class="comment">// namespace qlt</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160; </div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">// These are the definitions that must be visible in the calling translation</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">// unit, unless Cuda relocatable device code is enabled.</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">//#include &quot;cedr_qlt_inl.hpp&quot;</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160; </div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">//&gt;&gt; cedr_caas.hpp</span></div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_CAAS_HPP</span></div>
<div class="line"><a name="l00898"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a7d2a5708e8a18744ac500362cac429be">  898</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_CAAS_HPP</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">//#include &quot;cedr_cdr.hpp&quot;</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">// ClipAndAssuredSum.</span></div>
<div class="line"><a name="l00904"></a><span class="lineno"><a class="line" href="namespacecedr_1_1caas.html">  904</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a> {</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ExeSpace = Kokkos::DefaultExecutionSpace&gt;</div>
<div class="line"><a name="l00907"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html">  907</a></span>&#160;<span class="keyword">class </span><a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">CAAS</a> : <span class="keyword">public</span> <a class="code" href="structcedr_1_1_c_d_r.html">CDR</a> {</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00909"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a86de64c7ffe1084260e45518997e99c0">  909</a></span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structcedr_1_1impl_1_1_device_type.html#a316a06dae4264eeeb58f1507aeb9fc53">cedr::impl::DeviceType&lt;ExeSpace&gt;::type</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a86de64c7ffe1084260e45518997e99c0">Device</a>;</div>
<div class="line"><a name="l00910"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#ab4a8fa2d175e48f52f7ab80bf3bdcce1">  910</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">CAAS&lt;ExeSpace&gt;</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ab4a8fa2d175e48f52f7ab80bf3bdcce1">Me</a>;</div>
<div class="line"><a name="l00911"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#ace4111c506c2eee9eabe531907e5d650">  911</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;Me&gt; <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ace4111c506c2eee9eabe531907e5d650">Ptr</a>;</div>
<div class="line"><a name="l00912"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">  912</a></span>&#160;  <span class="keyword">typedef</span> Kokkos::View&lt;Real*, Kokkos::LayoutLeft, Device&gt; <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">RealList</a>;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160; </div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00915"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html">  915</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html">UserAllReducer</a> {</div>
<div class="line"><a name="l00916"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a04b71f510cb275314b3221fb04bad1b2">  916</a></span>&#160;    <span class="keyword">typedef</span> std::shared_ptr&lt;const UserAllReducer&gt; <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a04b71f510cb275314b3221fb04bad1b2">Ptr</a>;</div>
<div class="line"><a name="l00917"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#ae06c422ee554740d8758bf6bf7e2f304">  917</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#ae06c422ee554740d8758bf6bf7e2f304">n_accum_in_place</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> 1; }</div>
<div class="line"><a name="l00918"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a2bb9b9d2f7970318f27b5b939a3e0aca">  918</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a2bb9b9d2f7970318f27b5b939a3e0aca">operator()</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">mpi::Parallel</a>&amp; p,</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                           <span class="comment">// In Fortran, these are formatted as</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                           <span class="comment">//   sendbuf(nlocal, nfld)</span></div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                           <span class="comment">//   rcvbuf(nfld)</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                           <span class="comment">// The implementation is permitted to modify sendbuf.</span></div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                           <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* sendbuf, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* rcvbuf,</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                           <span class="comment">// nlocal is number of values to reduce in this rank.</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                           <span class="comment">// nfld is number of fields.</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                           <span class="keywordtype">int</span> nlocal, <span class="keywordtype">int</span> nfld,</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                           MPI_Op op) <span class="keyword">const</span> = 0;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  };</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; </div>
<div class="line"><a name="l00930"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#aff00f5067fdecb35aa64116f20c7aa98">  930</a></span>&#160;  <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#aff00f5067fdecb35aa64116f20c7aa98">CAAS</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nlclcells,</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;       <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a04b71f510cb275314b3221fb04bad1b2">UserAllReducer::Ptr</a>&amp; r = <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160; </div>
<div class="line"><a name="l00933"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a816b83a8487dbc88d8fa843e722dd732">  933</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a816b83a8487dbc88d8fa843e722dd732">declare_tracer</a>(<span class="keywordtype">int</span> problem_type, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a286accaaf020796734e0e8984ada62b1">  935</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a286accaaf020796734e0e8984ada62b1">end_tracer_declarations</a>() <span class="keyword">override</span>;</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; </div>
<div class="line"><a name="l00937"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a4b3b86d7004bd8db749714c58372733d">  937</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a4b3b86d7004bd8db749714c58372733d">get_buffers_sizes</a>(<span class="keywordtype">size_t</span>&amp; buf1, <span class="keywordtype">size_t</span>&amp; buf2) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a3fd3c6018001a747e0b40c80b2a2e01c">  939</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a3fd3c6018001a747e0b40c80b2a2e01c">set_buffers</a>(<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf1, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf2) <span class="keyword">override</span>;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160; </div>
<div class="line"><a name="l00941"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a434388bd16d754c7091654788b23878b">  941</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a434388bd16d754c7091654788b23878b">finish_setup</a>() <span class="keyword">override</span>;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8cc7e3549e2e8ce2c2f6ad3671deeeb5">  943</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8cc7e3549e2e8ce2c2f6ad3671deeeb5">get_problem_type</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a9a2993d2c0cc0ffc38344bacd1a2361f">  945</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a9a2993d2c0cc0ffc38344bacd1a2361f">get_num_tracers</a>() <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160; </div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">// lclcellidx is trivial; it is the user&#39;s index for the cell.</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00949"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a2187699bf313cd248971790e17e7143c">  949</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a2187699bf313cd248971790e17e7143c">set_rhom</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00952"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a48d6656e20903fd21bffcc11c1f908b3">  952</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a48d6656e20903fd21bffcc11c1f908b3">set_Qm</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx,</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;              <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_min, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_max,</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;              <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_prev = std::numeric_limits&lt;Real&gt;::infinity()) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160; </div>
<div class="line"><a name="l00956"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#ac499842d68aca0ba4d9a675664ea8fbe">  956</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ac499842d68aca0ba4d9a675664ea8fbe">run</a>() <span class="keyword">override</span>;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160; </div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l00959"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a51db49b62432ed6b0ea1875114157421">  959</a></span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a51db49b62432ed6b0ea1875114157421">get_Qm</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx) <span class="keyword">const override</span>;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l00962"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#aebd9e499ed880c2e79a00ff21e324fa7">  962</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">cedr::impl::Unmanaged&lt;RealList&gt;</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#aebd9e499ed880c2e79a00ff21e324fa7">UnmanagedRealList</a>;</div>
<div class="line"><a name="l00963"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a43c3ccd110b8401cf4c82219d197fe5e">  963</a></span>&#160;  <span class="keyword">typedef</span> Kokkos::View&lt;Int*, Kokkos::LayoutLeft, Device&gt; <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a43c3ccd110b8401cf4c82219d197fe5e">IntList</a>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160; </div>
<div class="line"><a name="l00965"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html">  965</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html">Decl</a> {</div>
<div class="line"><a name="l00966"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#ac98cdb7856f6dd3ddaa0cb35281c26b5">  966</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#ac98cdb7856f6dd3ddaa0cb35281c26b5">probtype</a>;</div>
<div class="line"><a name="l00967"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#ab0e4100cf9faed8d10fab951689b6db1">  967</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#ab0e4100cf9faed8d10fab951689b6db1">rhomidx</a>;</div>
<div class="line"><a name="l00968"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#a1b52b74fa233e5a0b7683af59e2c1c5b">  968</a></span>&#160;    <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#a1b52b74fa233e5a0b7683af59e2c1c5b">Decl</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> probtype_, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> rhomidx_)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      : <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#ac98cdb7856f6dd3ddaa0cb35281c26b5">probtype</a>(probtype_), <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#ab0e4100cf9faed8d10fab951689b6db1">rhomidx</a>(rhomidx_) {}</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  };</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8d46460cee51108c435def65ab5da015">  972</a></span>&#160;  <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8d46460cee51108c435def65ab5da015">p_</a>;</div>
<div class="line"><a name="l00973"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a85e4fa2a2a4ab325e53845943ed61f48">  973</a></span>&#160;  <span class="keyword">typename</span> <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a04b71f510cb275314b3221fb04bad1b2">UserAllReducer::Ptr</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a85e4fa2a2a4ab325e53845943ed61f48">user_reducer_</a>;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#af2bfbf0700298c8dda3152791f11b395">  975</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#af2bfbf0700298c8dda3152791f11b395">nlclcells_</a>, <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8fcae413e992c1ca191f21e6b0debcf8">nrhomidxs_</a>;</div>
<div class="line"><a name="l00976"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#adce4bcf380215208609e80f43984981c">  976</a></span>&#160;  std::shared_ptr&lt;std::vector&lt;Decl&gt; &gt; <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#adce4bcf380215208609e80f43984981c">tracer_decls_</a>;</div>
<div class="line"><a name="l00977"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a3c487a7cbfd1c15e707036bf6010f55f">  977</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a3c487a7cbfd1c15e707036bf6010f55f">need_conserve_</a>;</div>
<div class="line"><a name="l00978"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8c398d85becddf2d94ac02991e4556a4">  978</a></span>&#160;  <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a43c3ccd110b8401cf4c82219d197fe5e">IntList</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8c398d85becddf2d94ac02991e4556a4">probs_</a>, <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ab74c81a9f681b58929af5f84a49c352f">t2r_</a>;</div>
<div class="line"><a name="l00979"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a9dcb6c61166e724ef9539b296d924591">  979</a></span>&#160;  <span class="keyword">typename</span> IntList::HostMirror <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a9dcb6c61166e724ef9539b296d924591">probs_h_</a>;</div>
<div class="line"><a name="l00980"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8a50dc5d74b570ea11de351a3b9b5bb6">  980</a></span>&#160;  <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">RealList</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8a50dc5d74b570ea11de351a3b9b5bb6">d_</a>, <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8aa95b7eb655b14bea7a61182ff69c09">send_</a>, <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a9b173cba1219ec2b87de4c11dc6f8dc3">recv_</a>;</div>
<div class="line"><a name="l00981"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a123e7bc147038d85752b51dbc0e0d52a">  981</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a123e7bc147038d85752b51dbc0e0d52a">finished_setup_</a>;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a328c8238b4279baff795f97d3acdf173">  983</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a328c8238b4279baff795f97d3acdf173">reduce_globally</a>();</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a9d882cfead21ea097bd300f11ce332c1">  985</a></span>&#160;<a class="code" href="compose__cedr_8cpp.html#aa880d3b0360ecb807e94f0b35abc9a29">PRIVATE_CUDA</a>:</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="keywordtype">void</span> reduce_locally();</div>
<div class="line"><a name="l00987"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a25fb8c96e17a5cf52fa8f5d1a121d0ad">  987</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a25fb8c96e17a5cf52fa8f5d1a121d0ad">finish_locally</a>();</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a4b3b86d7004bd8db749714c58372733d">get_buffers_sizes</a>(<span class="keywordtype">size_t</span>&amp; buf1, <span class="keywordtype">size_t</span>&amp; buf2, <span class="keywordtype">size_t</span>&amp; buf3);</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;};</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160; </div>
<div class="line"><a name="l00993"></a><span class="lineno"><a class="line" href="namespacecedr_1_1caas_1_1test.html">  993</a></span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1caas_1_1test.html#a76970efe7100a1c7ab6ef420e0a45d5c">unittest</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; p);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;} <span class="comment">// namespace caas</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160; </div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">//#include &quot;cedr_caas_inl.hpp&quot;</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160; </div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">//&gt;&gt; cedr_caas_inl.hpp</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_CAAS_INL_HPP</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#af0d6942ee42379244c34190f180461ba"> 1008</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_CAAS_INL_HPP</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">//#include &quot;cedr_util.hpp&quot;</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">// ClipAndAssuredSum.</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a> {</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01017"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a2187699bf313cd248971790e17e7143c"> 1017</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a2187699bf313cd248971790e17e7143c">CAAS&lt;ES&gt;::set_rhom</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx,</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                         <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(lclcellidx &gt;= 0 &amp;&amp; lclcellidx &lt; nlclcells_);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(rhomidx &gt;= 0 &amp;&amp; rhomidx &lt; nrhomidxs_);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  d_(lclcellidx) = rhom;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a48d6656e20903fd21bffcc11c1f908b3">CAAS&lt;ES&gt;</a></div>
<div class="line"><a name="l01026"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a48d6656e20903fd21bffcc11c1f908b3"> 1026</a></span>&#160;<a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a48d6656e20903fd21bffcc11c1f908b3">::set_Qm</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx,</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_min, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_max,</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_prev)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(lclcellidx &gt;= 0 &amp;&amp; lclcellidx &lt; nlclcells_);</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(tracer_idx &gt;= 0 &amp;&amp; tracer_idx &lt; probs_.extent_int(0));</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nt = probs_.size();</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  d_((1 +               tracer_idx)*nlclcells_ + lclcellidx) = Qm;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  d_((1 +   nt + tracer_idx)*nlclcells_ + lclcellidx) = Qm_min;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  d_((1 + 2*nt + tracer_idx)*nlclcells_ + lclcellidx) = Qm_max;</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  <span class="keywordflow">if</span> (need_conserve_)</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    d_((1 + 3*nt + tracer_idx)*nlclcells_ + lclcellidx) = Qm_prev;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;}</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01040"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a51db49b62432ed6b0ea1875114157421"> 1040</a></span>&#160;<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a51db49b62432ed6b0ea1875114157421">CAAS&lt;ES&gt;::get_Qm</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(lclcellidx &gt;= 0 &amp;&amp; lclcellidx &lt; nlclcells_);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(tracer_idx &gt;= 0 &amp;&amp; tracer_idx &lt; probs_.extent_int(0));</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="keywordflow">return</span> d_((1 + tracer_idx)*nlclcells_ + lclcellidx);</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;}</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;} <span class="comment">// namespace caas</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160; </div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">//&gt;&gt; cedr_local.hpp</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_LOCAL_HPP</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a78b7fd3895761f2b3429ef424a271e54"> 1056</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_LOCAL_HPP</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">//#include &quot;cedr.hpp&quot;</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">//#include &quot;cedr_kokkos.hpp&quot;</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01062"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local.html"> 1062</a></span>&#160;<span class="keyword">namespace </span>local {</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">// The following routines solve</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">//     min_x norm(x - y; w)</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">//      st   a&#39;x = b</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">//           xlo &lt;= x &lt;= xhi,</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">// a &gt; 0, w &gt; 0.</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">// Minimize the weighted 2-norm. Return 0 on success and x == y, 1 on success</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">// and x != y, -1 if infeasible, -2 if max_its hit with no solution. See section</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">// 3 of Bochev, Ridzal, Shashkov, Fast optimization-based conservative remap of</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">// scalar fields through aggregate mass transfer.</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938">solve_1eq_bc_qp</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* w, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi,</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> max_its = 100);</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160; </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local.html#aeec5c3e64900ac50f51105cafb9b0668">solve_1eq_bc_qp_2d</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* w, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                       <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi,</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                       <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>,</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                       <span class="keyword">const</span> <span class="keywordtype">bool</span> clip = <span class="keyword">true</span>,</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                       <span class="comment">// The 2D algorithm doesn&#39;t need to terminate based on a</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                       <span class="comment">// tolerance, but by default it will exit early if the ND</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                       <span class="comment">// algorithm would. Set this to false to run the full 2D</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                       <span class="comment">// algorithm w/o checking the tolerance at start. If this</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                       <span class="comment">// is false, the feasibility check is also disabled.</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                       <span class="keyword">const</span> <span class="keywordtype">bool</span> early_exit_on_tol = <span class="keyword">true</span>);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160; </div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">// ClipAndAssuredSum. Minimize the 1-norm with w = 1s. Does not check for</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">// feasibility.</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi,</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>,</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">bool</span> clip = <span class="keyword">true</span>);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"><a class="line" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0a12e240876312c9b5e79fadb028bd6176"> 1099</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1local_1_1_method.html">Method</a> { <span class="keyword">enum</span> <a class="code" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0">Enum</a> { <a class="code" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0aeb7ed44142d1af44ca1226f6c2c54d1f">least_squares</a>, <a class="code" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0a12e240876312c9b5e79fadb028bd6176">caas</a> }; };</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">// Solve</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">//     min_x norm(x - y; w)</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">//      st   a&#39;x = b</span></div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">//           x &gt;= 0,</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">// a, w &gt; 0. Return 0 on success and x == y, 1 on success and x != y, -1 if</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">// infeasible. w is used only if lcl_method = least_squares.</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local.html#a61447f212fd00919206121765d9d5e54">solve_1eq_nonneg</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>,</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                     <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* w, <span class="keyword">const</span> <a class="code" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0">Method::Enum</a> lcl_method);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160; </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local.html#a0cae8843ba7d55d41e672b37311725c8">unittest</a>();</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160; </div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;} <span class="comment">// namespace local</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160; </div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">//#include &quot;cedr_local_inl.hpp&quot;</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">//&gt;&gt; cedr_mpi_inl.hpp</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_MPI_INL_HPP</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#ad2c35fa5e7d1c01432ffb57f797d88c6"> 1125</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_MPI_INL_HPP</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160; </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="keyword">namespace </span>mpi {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160; </div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l01131"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a"> 1131</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* sendbuf, T* rcvbuf, <span class="keywordtype">int</span> count, MPI_Op op,</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            <span class="keywordtype">int</span> root) {</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  MPI_Datatype dt = get_type&lt;T&gt;();</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  <span class="keywordflow">return</span> MPI_Reduce(<span class="keyword">const_cast&lt;</span>T*<span class="keyword">&gt;</span>(sendbuf), rcvbuf, count, dt, op, root, p.<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a>());</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;}</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160; </div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l01138"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf"> 1138</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">all_reduce</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* sendbuf, T* rcvbuf, <span class="keywordtype">int</span> count, MPI_Op op) {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  MPI_Datatype dt = get_type&lt;T&gt;();</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  <span class="keywordflow">return</span> MPI_Allreduce(<span class="keyword">const_cast&lt;</span>T*<span class="keyword">&gt;</span>(sendbuf), rcvbuf, count, dt, op, p.<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a>());</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;}</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160; </div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l01144"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358"> 1144</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">isend</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* buf, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> dest, <span class="keywordtype">int</span> tag,</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;           <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>* ireq) {</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  MPI_Datatype dt = get_type&lt;T&gt;();</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;  MPI_Request ureq;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  MPI_Request* req = ireq ? &amp;ireq-&gt;<a class="code" href="structcedr_1_1mpi_1_1_request.html#a4b34b505d84b830b36538152c39151b2">request</a> : &amp;ureq;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  <span class="keywordtype">int</span> ret = MPI_Isend(<span class="keyword">const_cast&lt;</span>T*<span class="keyword">&gt;</span>(buf), count, dt, dest, tag, p.<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a>(), req);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  <span class="keywordflow">if</span> ( ! ireq) MPI_Request_free(req);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="preprocessor">#ifdef COMPOSE_DEBUG_MPI</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  <span class="keywordflow">else</span> ireq-&gt;unfreed++;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;}</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160; </div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l01158"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f"> 1158</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">irecv</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, T* buf, <span class="keywordtype">int</span> count, <span class="keywordtype">int</span> src, <span class="keywordtype">int</span> tag, <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>* ireq) {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  MPI_Datatype dt = get_type&lt;T&gt;();</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  MPI_Request ureq;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  MPI_Request* req = ireq ? &amp;ireq-&gt;<a class="code" href="structcedr_1_1mpi_1_1_request.html#a4b34b505d84b830b36538152c39151b2">request</a> : &amp;ureq;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  <span class="keywordtype">int</span> ret = MPI_Irecv(buf, count, dt, src, tag, p.<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a>(), req);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  <span class="keywordflow">if</span> ( ! ireq) MPI_Request_free(req);</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="preprocessor">#ifdef COMPOSE_DEBUG_MPI</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">else</span> ireq-&gt;unfreed++;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  <span class="keywordflow">return</span> ret;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;}</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l01171"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a81666edb64563b7477056b7612b9ef16"> 1171</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a81666edb64563b7477056b7612b9ef16">gather</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* sendbuf, <span class="keywordtype">int</span> sendcount,</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            T* recvbuf, <span class="keywordtype">int</span> recvcount, <span class="keywordtype">int</span> root) {</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  MPI_Datatype dt = get_type&lt;T&gt;();</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="keywordflow">return</span> MPI_Gather(sendbuf, sendcount, dt, recvbuf, recvcount, dt, root, p.<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a>());</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;}</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l01178"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a400d5cae4d1c0616beee60e458a54f36"> 1178</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#a400d5cae4d1c0616beee60e458a54f36">gatherv</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keyword">const</span> T* sendbuf, <span class="keywordtype">int</span> sendcount,</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;             T* recvbuf, <span class="keyword">const</span> <span class="keywordtype">int</span>* recvcounts, <span class="keyword">const</span> <span class="keywordtype">int</span>* displs, <span class="keywordtype">int</span> root) {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  MPI_Datatype dt = get_type&lt;T&gt;();</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  <span class="keywordflow">return</span> MPI_Gatherv(sendbuf, sendcount, dt, recvbuf, recvcounts, displs, dt, root,</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                     p.<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">comm</a>());</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;}</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160; </div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;} <span class="comment">// namespace mpi</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment">//&gt;&gt; cedr_local_inl.hpp</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_LOCAL_INL_HPP</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a3fb10699d710fde0587ea9bb24885ad6"> 1195</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_LOCAL_INL_HPP</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">//#include &quot;cedr_util.hpp&quot;</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="keyword">namespace </span>local {</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local_1_1impl.html"> 1202</a></span>&#160;<span class="keyword">namespace </span>impl {</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01204"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local_1_1impl.html#a8b83e71c647cda8a5e7fe355dcc16bdd"> 1204</a></span>&#160;<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1local_1_1impl.html#a8b83e71c647cda8a5e7fe355dcc16bdd">calc_r_tol</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n) {</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> ab = std::abs(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>);</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) ab = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(ab, std::abs(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*y[i]));</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;  <span class="keywordflow">return</span> 1e1*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>()*std::abs(ab);</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;}</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">// Eval r at end points to check for feasibility, and also possibly a quick exit</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">// on a common case. Return -1 if infeasible, 1 if a corner is a solution, 0 if</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment">// feasible and a corner is not.</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01214"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local_1_1impl.html#a42d22fd1c7d68c43aba1a2d25758b351"> 1214</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local_1_1impl.html#a42d22fd1c7d68c43aba1a2d25758b351">check_lu</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo,</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;              <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; r_tol, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>) {</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> r = -<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = xlo[i];</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    r += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  }</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="keywordflow">if</span> (std::abs(r) &lt;= r_tol) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  <span class="keywordflow">if</span> (r &gt; 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  r = -<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = xhi[i];</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    r += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  }</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  <span class="keywordflow">if</span> (std::abs(r) &lt;= r_tol) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordflow">if</span> (r &lt; 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;}</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01234"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local_1_1impl.html#a5c9833133735f9d3293b5d0f6526bd2c"> 1234</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1local_1_1impl.html#a5c9833133735f9d3293b5d0f6526bd2c">calc_r</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* w, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;             <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi,  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; lambda,</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;             <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; r, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; r_lambda) {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  r = 0;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  r_lambda = 0;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]/w[i];</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> x_trial = y[i] + lambda*q;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> xtmp;</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <span class="keywordflow">if</span> (x_trial &lt; (xtmp = xlo[i]))</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = xtmp;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x_trial &gt; (xtmp = xhi[i]))</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = xtmp;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = x_trial;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      r_lambda += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*q;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    }</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    r += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  }</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  r -= <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>;</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;}</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;} <span class="comment">// namespace impl</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">// 2D special case for efficiency.</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01259"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local.html#aeec5c3e64900ac50f51105cafb9b0668"> 1259</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local.html#aeec5c3e64900ac50f51105cafb9b0668">solve_1eq_bc_qp_2d</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* w, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi, </div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>,</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">bool</span> clip, <span class="keyword">const</span> <span class="keywordtype">bool</span> early_exit_on_tol) {</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> info;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  <span class="keywordflow">if</span> (early_exit_on_tol) {</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> r_tol = <a class="code" href="namespacecedr_1_1local_1_1impl.html#a8b83e71c647cda8a5e7fe355dcc16bdd">impl::calc_r_tol</a>(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, y, 2);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> info = <a class="code" href="namespacecedr_1_1local_1_1impl.html#a42d22fd1c7d68c43aba1a2d25758b351">impl::check_lu</a>(2, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, r_tol, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="keywordflow">if</span> (info == -1) <span class="keywordflow">return</span> info;</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  }</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160; </div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  { <span class="comment">// Check if the optimal point ignoring bound constraints is in bounds.</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> qmass = 0, dm = <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) {</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> qi = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]/w[i];</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      qmass += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*qi;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      dm -= <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*y[i];</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    }</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> lambda = dm/qmass;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i) {</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = y[i] + lambda*(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]/w[i]);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &lt; xlo[i] || <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &gt; xhi[i]) {</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      }</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    }</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keywordflow">if</span> (ok) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;  }</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160; </div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="comment">// Solve for intersection of a&#39;x = b, given by the parameterized line</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  <span class="comment">//     p(alpa) = x_base + alpha x_dir,</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  <span class="comment">// with a bounding line.</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160; </div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">// Get parameterized line.</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> x_base[2];</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; ++i)</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    x_base[i] = 0.5*<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>/<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i];</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> x_dir[] = {-<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[1], <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[0]};</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  <span class="comment">// Get the 4 alpha values.</span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> alphas[4];</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  alphas[0] = (xlo[1] - x_base[1])/x_dir[1]; <span class="comment">// bottom</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  alphas[1] = (xhi[0] - x_base[0])/x_dir[0]; <span class="comment">// right</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  alphas[2] = (xhi[1] - x_base[1])/x_dir[1]; <span class="comment">// top</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  alphas[3] = (xlo[0] - x_base[0])/x_dir[0]; <span class="comment">// left</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160; </div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  <span class="comment">// Find the middle two in the sorted alphas.</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a> = alphas[0], <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a> = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> imin = 0, imax = 0;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt; 4; ++i) {</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> alpha = alphas[i];</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="keywordflow">if</span> (alpha &lt; <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>) { <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a> = alpha; imin = i; }</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="keywordflow">if</span> (alpha &gt; <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a>) { <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a> = alpha; imax = i; }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;  }</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ais[2];</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> cnt = 0;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; 4; ++i)</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordflow">if</span> (i != imin &amp;&amp; i != imax) {</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      ais[cnt++] = i;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="keywordflow">if</span> (cnt == 2) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    }</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> objs[2];</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> alpha_mid = 0;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> j = 0; j &lt; 2; ++j) {</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> alpha = alphas[ais[j]];</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    alpha_mid += alpha;</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> obj = 0;</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; 2; ++i) {</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = x_base[i] + alpha*x_dir[i];</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      obj += w[i]*<a class="code" href="namespacecedr_1_1util.html#aebb086baeee1459e0a42a4d659e044dc">cedr::util::square</a>(y[i] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    }</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    objs[j] = obj;</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  }</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160; </div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ai = ais[objs[0] &lt;= objs[1] ? 0 : 1];</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160; </div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  info = 1;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i0 = 0;</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  <span class="keywordflow">switch</span> (ai) {</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  <span class="keywordflow">case</span> 0: <span class="keywordflow">case</span> 2:</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[1] = ai == 0 ? xlo[1] : xhi[1];</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    i0 = 1;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  <span class="keywordflow">case</span> 1: <span class="keywordflow">case</span> 3:</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[0] = ai == 1 ? xhi[0] : xlo[0];</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    i0 = 0;</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  <span class="keywordflow">default</span>: <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(0); info = -2;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i1 = (i0 + 1) % 2;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i1] = (<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> - <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i0]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i0])/<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i1];</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  <span class="keywordflow">if</span> (clip)</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i1] = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(xhi[i1], <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(xlo[i1], <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i1]));</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  <span class="keywordflow">return</span> info;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;}</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160; </div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01358"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938"> 1358</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938">solve_1eq_bc_qp</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* w, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                     <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>,</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                     <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> max_its) {</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> r_tol = <a class="code" href="namespacecedr_1_1local_1_1impl.html#a8b83e71c647cda8a5e7fe355dcc16bdd">impl::calc_r_tol</a>(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, y, n);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> info = <a class="code" href="namespacecedr_1_1local_1_1impl.html#a42d22fd1c7d68c43aba1a2d25758b351">impl::check_lu</a>(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, r_tol, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  <span class="keywordflow">if</span> (info != 0) <span class="keywordflow">return</span> info;</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160; </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] != y[i]) {</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      info = 1;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = y[i];</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="comment">// In our use case, the caller has already checked (more cheaply) for a quick</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="comment">// exit.</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  { <span class="comment">// Check for a quick exit.</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    <span class="keywordtype">bool</span> all_in = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> r = 0;</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &lt; xlo[i] || <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &gt; xhi[i]) {</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        all_in = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;      }</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      r += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    }</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    <span class="keywordflow">if</span> (all_in) {</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;      r -= <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>;</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <span class="keywordflow">if</span> (std::abs(r) &lt;= r_tol)</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <span class="keywordflow">return</span> info;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    }</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160; </div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> wall_dist = 1e-3;</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160; </div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="comment">// Get lambda endpoints.</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> lamlo = 0, lamhi = 0;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rq = w[i]/<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i];</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> lamlo_i = rq*(xlo[i] - y[i]);</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> lamhi_i = rq*(xhi[i] - y[i]);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    <span class="keywordflow">if</span> (i == 0) {</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      lamlo = lamlo_i;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      lamhi = lamhi_i;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      lamlo = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(lamlo, lamlo_i);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      lamhi = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(lamhi, lamhi_i);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  }</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> lamlo_feas = lamlo, lamhi_feas = lamhi;</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> lambda = lamlo &lt;= 0 &amp;&amp; lamhi &gt;= 0 ? 0 : lamlo;</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160; </div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <span class="comment">// Bisection-safeguarded Newton iteration for r(lambda) = 0.</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;  <span class="keywordtype">bool</span> prev_step_bisect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nbisect = 0;</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  info = -2;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> iteration = 0; iteration &lt; max_its; ++iteration) {</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="comment">// Compute x, r, r_lambda.</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> r, r_lambda;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <a class="code" href="namespacecedr_1_1local_1_1impl.html#a5c9833133735f9d3293b5d0f6526bd2c">impl::calc_r</a>(n, w, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, y, lambda, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, r, r_lambda);</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    <span class="comment">// Is r(lambda) - b sufficiently == 0?</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordflow">if</span> (std::abs(r) &lt;= r_tol) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      info = 1;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    }</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="comment">// Check if the lambda bounds are too close.</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">if</span> (nbisect &gt; 64) {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;      <span class="keywordflow">if</span> (lamhi == lamhi_feas || lamlo == lamlo_feas) {</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        <span class="comment">// r isn&#39;t small enough and one lambda bound is on the feasibility</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        <span class="comment">// limit. The QP must not be feasible.</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        info = -1;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      }</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      info = 1;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    }</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="comment">// Adjust lambda bounds.</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keywordflow">if</span> (r &gt; 0)</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      lamhi = lambda;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      lamlo = lambda;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <span class="keywordflow">if</span> (r_lambda != 0) {</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <span class="comment">// Newton step.</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      lambda -= r/r_lambda;</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      <span class="comment">// Force bisection.</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      lambda = lamlo;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="comment">// Safeguard. The wall distance check assures progress, but use it only</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="comment">// every other potential bisection.</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> D = prev_step_bisect ? 0 : wall_dist*(lamhi - lamlo);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keywordflow">if</span> (lambda - lamlo &lt; D || lamhi - lambda &lt; D) {</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      lambda = 0.5*(lamlo + lamhi);</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      ++nbisect;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      prev_step_bisect = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      prev_step_bisect = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    }</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;  }</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160; </div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  <span class="keywordflow">return</span> info;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;}</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160; </div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01463"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c"> 1463</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;           <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi,</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;           <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>,</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;           <span class="keyword">const</span> <span class="keywordtype">bool</span> clip) {</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> dm = <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(xlo[i], <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(xhi[i], y[i]));</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    dm -= <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  }</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  <span class="keywordflow">if</span> (dm == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="keywordflow">if</span> (dm &gt; 0) {</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> fac = 0;</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      fac += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*(xhi[i] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]);</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    <span class="keywordflow">if</span> (fac &gt; 0) {</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      fac = dm/fac;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] += fac*(xhi[i] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]);</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    }</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dm &lt; 0) {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> fac = 0;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      fac += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] - xlo[i]);</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">if</span> (fac &gt; 0) {</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      fac = dm/fac;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] += fac*(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] - xlo[i]);</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    }</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  }</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  <span class="comment">// Clip again for numerics.</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;  <span class="keywordflow">if</span> (clip)</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(xlo[i], <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(xhi[i], <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]));</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;}</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01499"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local.html#a61447f212fd00919206121765d9d5e54"> 1499</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local.html#a61447f212fd00919206121765d9d5e54">solve_1eq_nonneg</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>,</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* w,  <span class="keyword">const</span> <a class="code" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0">Method::Enum</a> method) {</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(n &lt;= 16);</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> &lt; 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> zero[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;  <span class="comment">// Set the upper bound to the value that implies that just one slot gets all</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;  <span class="comment">// of the mass.</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> xhi[16];</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    xhi[i] = <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>/<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i];</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160; </div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;  <span class="keywordflow">if</span> (method == <a class="code" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0a12e240876312c9b5e79fadb028bd6176">Method::caas</a>) {</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a>(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, zero, xhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="keywordflow">if</span> (n == 2)</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacecedr_1_1local.html#aeec5c3e64900ac50f51105cafb9b0668">solve_1eq_bc_qp_2d</a>(w, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, zero, xhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938">solve_1eq_bc_qp</a>(n, w, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, zero, xhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  }</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;}</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160; </div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;} <span class="comment">// namespace local</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160; </div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160; </div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">//&gt;&gt; cedr_qlt_inl.hpp</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160; </div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_QLT_INL_HPP</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a0c21671c6c9b7b5c482e477217dc66b3"> 1532</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_QLT_INL_HPP</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160; </div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment">//#include &quot;cedr_local.hpp&quot;</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160; </div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr_1_1qlt.html">qlt</a> {</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160; </div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01542"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ae5bcfd4e69486bda74225278f513b3c3"> 1542</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ae5bcfd4e69486bda74225278f513b3c3">QLT&lt;ES&gt;::set_rhom</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx,</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ndps = md_.a_d.prob2bl2r[md_.nprobtypes];</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  bd_.l2r_data(ndps*lclcellidx) = rhom;  </div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;}</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160; </div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01549"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a6a8d2cda6321bd2f6a59e4dd85f9bfc6"> 1549</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::set_Qm</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx,</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;                      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm,</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;                      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_min, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_max,</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_prev)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ndps = md_.<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ad74c27f1a2680f0c76d9b2991b6f18fe">a_d</a>.<a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a82c1ec992eb8eacbf40cd36fb3597a7c">prob2bl2r</a>[md_.nprobtypes];</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* bd; {</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bdi = md_.a_d.trcr2bl2r(tracer_idx);</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    bd = &amp;bd_.l2r_data(ndps*lclcellidx + bdi);</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  }</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  {</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> problem_type = md_.a_d.trcr2prob(tracer_idx);</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> next = 0;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="keywordflow">if</span> (problem_type &amp; ProblemType::shapepreserve) {</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      bd[0] = Qm_min;</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      bd[1] = Qm;</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      bd[2] = Qm_max;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      next = 3;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (problem_type &amp; ProblemType::consistent) {</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rhom = bd_.l2r_data(ndps*lclcellidx);</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;      bd[0] = Qm_min / rhom;</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      bd[1] = Qm;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      bd[2] = Qm_max / rhom;</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      next = 3;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (problem_type &amp; ProblemType::nonnegative) {</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      bd[0] = Qm;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      next = 1;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a69e47429f12cecc8d0019d3611431ef1">cedr_kernel_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;set_Q: invalid problem_type.&quot;</span>);</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    }</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">if</span> (problem_type &amp; ProblemType::conserve) {</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a69e47429f12cecc8d0019d3611431ef1">cedr_kernel_throw_if</a>(Qm_prev == std::numeric_limits&lt;Real&gt;::infinity(),</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                           <span class="stringliteral">&quot;Qm_prev was not provided to set_Q.&quot;</span>);</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;      bd[next] = Qm_prev;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    }</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  }</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;}</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160; </div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01587"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a99f352c9b0cf724a5b45b70b0d288c1c"> 1587</a></span>&#160;<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::get_Qm</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lclcellidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ndps = md_.<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ad74c27f1a2680f0c76d9b2991b6f18fe">a_d</a>.<a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad51124248b30607a6159b0984b2c2b7a">prob2br2l</a>[md_.nprobtypes];</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bdi = md_.a_d.trcr2br2l(tracer_idx);</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;  <span class="keywordflow">return</span> bd_.r2l_data(ndps*lclcellidx + bdi);</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;}</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160; </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">//todo Replace this and the calling code with ReconstructSafely.</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01595"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt.html#a0d5051a5914c1d93500b80ffedb636a8"> 1595</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt.html#a0d5051a5914c1d93500b80ffedb636a8">r2l_nl_adjust_bounds</a> (<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_bnd[2], <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rhom[2], <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_extra) {</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q[2];</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; 2; ++i) q[i] = Qm_bnd[i] / rhom[i];</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;  <span class="keywordflow">if</span> (Qm_extra &lt; 0) {</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i0, i1;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordflow">if</span> (q[0] &gt;= q[1]) { i0 = 0; i1 = 1; } <span class="keywordflow">else</span> { i0 = 1; i1 = 0; }</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_gap = (q[i1] - q[i0])*rhom[i0];</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;    <span class="keywordflow">if</span> (Qm_gap &lt;= Qm_extra) {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      Qm_bnd[i0] += Qm_extra;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i0, i1;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">if</span> (q[0] &lt;= q[1]) { i0 = 0; i1 = 1; } <span class="keywordflow">else</span> { i0 = 1; i1 = 0; }</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_gap = (q[i1] - q[i0])*rhom[i0];</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordflow">if</span> (Qm_gap &gt;= Qm_extra) {</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      Qm_bnd[i0] += Qm_extra;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    }</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  }</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;  { <span class="comment">// Have to adjust both. Adjust so that the q bounds are the same. This</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    <span class="comment">// procedure assures that as long as rhom is conservative, then the</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <span class="comment">// adjustment never pushes q_{min,max} out of the safety bounds.</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_tot = Qm_bnd[0] + Qm_bnd[1] + Qm_extra;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rhom_tot = rhom[0] + rhom[1];</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q_tot = Qm_tot / rhom_tot;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; 2; ++i)</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;      Qm_bnd[i] = q_tot*rhom[i];</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  }</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;}</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160; </div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="keywordtype">int</span> QLT&lt;ES&gt;::MetaData::get_problem_type (<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; idx) {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> problem_type[] = {</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    CPT::st, CPT::cst, CPT::t, CPT::ct, CPT::nn, CPT::cnn</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  };</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;  <span class="keywordflow">return</span> problem_type[idx];</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;}</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    </div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="keywordtype">int</span> QLT&lt;ES&gt;::MetaData::get_problem_type_l2r_bulk_size (<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; mask) {</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  <span class="keywordflow">if</span> (mask &amp; ProblemType::nonnegative) {</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <span class="keywordflow">if</span> (mask &amp; ProblemType::conserve) <span class="keywordflow">return</span> 2;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  }</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  <span class="keywordflow">if</span> (mask &amp; ProblemType::conserve) <span class="keywordflow">return</span> 4;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <span class="keywordflow">return</span> 3;</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;}</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160; </div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;<span class="keyword">namespace </span>impl {</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01646"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a260e2670b5693de806396dae4059a947"> 1646</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ad78a836ebfaee833c929dbe37dec8105">solve_node_problem</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* pd, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm,</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                         <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom0, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* k0d, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm0,</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                         <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom1, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* k1d, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm1,</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                         <span class="keyword">const</span> <span class="keywordtype">bool</span> prefer_mass_con_to_bounds) {</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_min_kids [] = {k0d[0], k1d[0]};</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_orig_kids[] = {k0d[1], k1d[1]};</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_max_kids [] = {k0d[2], k1d[2]};</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;  { <span class="comment">// The ideal problem is not assuredly feasible. Test for feasibility. If not</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="comment">// feasible, adjust bounds to solve the safety problem, which is assuredly</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    <span class="comment">// feasible if the total density field rho is mass conserving (Q doesn&#39;t</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    <span class="comment">// have to be mass conserving, of course; achieving mass conservation is one</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    <span class="comment">// use for QLT).</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_min = pd[0], Qm_max = pd[2];</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> lo = Qm &lt; Qm_min, hi = Qm &gt; Qm_max;</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    <span class="keywordflow">if</span> (lo || hi) {</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <span class="comment">// If the discrepancy is numerical noise, don&#39;t act on it.</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecontrol__mod.html#a19f70697971fe3e6502be3097865437a">tol</a> = 10*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>();</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> discrepancy = lo ? Qm_min - Qm : Qm - Qm_max;</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;      <span class="keywordflow">if</span> (discrepancy &gt; <a class="code" href="namespacecontrol__mod.html#a19f70697971fe3e6502be3097865437a">tol</a>*(Qm_max - Qm_min)) {</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rhom_kids[] = {rhom0, rhom1};</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;        <a class="code" href="namespacecedr_1_1qlt.html#a0d5051a5914c1d93500b80ffedb636a8">r2l_nl_adjust_bounds</a>(lo ? Qm_min_kids : Qm_max_kids,</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                             rhom_kids,</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                             Qm - (lo ? Qm_min : Qm_max));</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      }</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="comment">// Quick exit if everything is OK as is. This is a speedup, and it also</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      <span class="comment">// lets the subnode solver make ~1 ulp changes instead of having to keep x</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      <span class="comment">// = y if y satisfies the conditions. Without this block, the</span></div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="comment">// no_change_should_hold tests can fail.</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;      <span class="keywordflow">if</span> (Qm == pd[1] &amp;&amp; <span class="comment">// Was our total tracer mass adjusted?</span></div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;          <span class="comment">// Are the kids&#39; problems feasible?</span></div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;          Qm_orig_kids[0] &gt;= Qm_min_kids[0] &amp;&amp; Qm_orig_kids[0] &lt;= Qm_max_kids[0] &amp;&amp;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;          Qm_orig_kids[1] &gt;= Qm_min_kids[1] &amp;&amp; Qm_orig_kids[1] &lt;= Qm_max_kids[1]) {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="comment">// Don&#39;t need to do anything, so skip even the math-based quick exits in</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <span class="comment">// solve_node_problem.</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        Qm0 = Qm_orig_kids[0];</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        Qm1 = Qm_orig_kids[1];</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      }</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    }</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;  }</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;  { <span class="comment">// Solve the node&#39;s QP.</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> ones[] = {1, 1};</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> w[] = {1/rhom0, 1/rhom1};</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_kids[] = {k0d[1], k1d[1]};</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    <a class="code" href="namespacecedr_1_1local.html#aeec5c3e64900ac50f51105cafb9b0668">local::solve_1eq_bc_qp_2d</a>(w, ones, Qm, Qm_min_kids, Qm_max_kids,</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                              Qm_orig_kids, Qm_kids,</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;                              ! prefer_mass_con_to_bounds <span class="comment">/* clip */</span>,</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                              ! prefer_mass_con_to_bounds <span class="comment">/* early_exit_on_tol */</span>);</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    Qm0 = Qm_kids[0];</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    Qm1 = Qm_kids[1];</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;  }</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;}</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160; </div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l01701"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#ad78a836ebfaee833c929dbe37dec8105"> 1701</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ad78a836ebfaee833c929dbe37dec8105">solve_node_problem</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> problem_type,</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                         <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* pd, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm,</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                         <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom0, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* k0d, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm0,</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                         <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; rhom1, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* k1d, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm1,</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                         <span class="keyword">const</span> <span class="keywordtype">bool</span> prefer_mass_con_to_bounds) {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  <span class="keywordflow">if</span> ((problem_type &amp; ProblemType::consistent) &amp;&amp;</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;      ! (problem_type &amp; ProblemType::shapepreserve)) {      </div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> mpd[3], mk0d[3], mk1d[3];</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    mpd[0]  = pd [0]*rhom ; mpd [1] = pd[1] ; mpd [2] = pd [2]*rhom ;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    mk0d[0] = k0d[0]*rhom0; mk0d[1] = k0d[1]; mk0d[2] = k0d[2]*rhom0;</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    mk1d[0] = k1d[0]*rhom1; mk1d[1] = k1d[1]; mk1d[2] = k1d[2]*rhom1;</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ad78a836ebfaee833c929dbe37dec8105">solve_node_problem</a>(rhom, mpd, Qm, rhom0, mk0d, Qm0, rhom1, mk1d, Qm1,</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                       prefer_mass_con_to_bounds);</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (problem_type &amp; ProblemType::nonnegative) {</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> ones[] = {1, 1};</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> w[] = {1/rhom0, 1/rhom1};</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_orig_kids[] = {k0d[0], k1d[0]};</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_kids[2] = {k0d[0], k1d[0]};</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <a class="code" href="namespacecedr_1_1local.html#a61447f212fd00919206121765d9d5e54">local::solve_1eq_nonneg</a>(2, ones, Qm, Qm_orig_kids, Qm_kids, w,</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                            local::Method::least_squares);</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    Qm0 = Qm_kids[0];</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    Qm1 = Qm_kids[1];</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ad78a836ebfaee833c929dbe37dec8105">solve_node_problem</a>(rhom, pd, Qm, rhom0, k0d, Qm0, rhom1, k1d, Qm1,</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                       prefer_mass_con_to_bounds);</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  }</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;}</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160; </div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;} <span class="comment">// namespace impl</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;} <span class="comment">// namespace qlt</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160; </div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160; </div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment">//&gt;&gt; cedr_test_randomized.hpp</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160; </div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_TEST_RANDOMIZED_HPP</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a2cdb4bc55555100912af7144faa26f3b"> 1741</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_TEST_RANDOMIZED_HPP</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160; </div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">//#include &quot;cedr_cdr.hpp&quot;</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">//#include &quot;cedr_mpi.hpp&quot;</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">//#include &quot;cedr_util.hpp&quot;</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160; </div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01748"></a><span class="lineno"><a class="line" href="namespacecedr_1_1test.html"> 1748</a></span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160; </div>
<div class="line"><a name="l01750"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html"> 1750</a></span>&#160;<span class="keyword">class </span><a class="code" href="classcedr_1_1test_1_1_test_randomized.html">TestRandomized</a> {</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a3ee5a0a03f871180cbac3bc818572022">TestRandomized</a>(<span class="keyword">const</span> std::string&amp; cdr_name, <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; p,</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                 <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells, <span class="keyword">const</span> <span class="keywordtype">bool</span> verbose = <span class="keyword">false</span>,</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                 <span class="keyword">const</span> <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">CDR::Options</a> options = <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">CDR::Options</a>());</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160; </div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;  <span class="comment">// The subclass should call this, probably in its constructor.</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#acae3d5885de88a009da51bcfe2e818c5">init</a>();</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160; </div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> CDRT, <span class="keyword">typename</span> ExeSpace = Kokkos::DefaultExecutionSpace&gt;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a2b823e264295db343e072086f2ac80f7">run</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nrepeat = 1, <span class="keyword">const</span> <span class="keywordtype">bool</span> write=<span class="keyword">false</span>);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160; </div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;  <span class="keyword">const</span> std::string cdr_name_;</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;  <span class="keyword">const</span> <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">CDR::Options</a> options_;</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160; </div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l01767"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html"> 1767</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">Tracer</a> {</div>
<div class="line"><a name="l01768"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#ac6e02fc6c9238e222edf39a7a0e82778"> 1768</a></span>&#160;    <span class="keyword">typedef</span> <a class="code" href="structcedr_1_1_problem_type.html">ProblemType</a> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#ac6e02fc6c9238e222edf39a7a0e82778">PT</a>;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    </div>
<div class="line"><a name="l01770"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a03dc0f277c68639a62ebb08b6081ebb2"> 1770</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a03dc0f277c68639a62ebb08b6081ebb2">idx</a>;</div>
<div class="line"><a name="l01771"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a71069357c9ff73580f40302e06157e94"> 1771</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a71069357c9ff73580f40302e06157e94">problem_type</a>;</div>
<div class="line"><a name="l01772"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#af703e6851dbf67b2a1314cbb12fe0063"> 1772</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#af703e6851dbf67b2a1314cbb12fe0063">perturbation_type</a>;</div>
<div class="line"><a name="l01773"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#ac5fabda7fac9149a4f017fea51df5c4c"> 1773</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a49ee7e7623121a14eebd29ef3d4f1dc6">no_change_should_hold</a>, <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#aa67e9f878ebc02e7d9f7af1bf7e2bd35">safe_should_hold</a>, <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#ac5fabda7fac9149a4f017fea51df5c4c">local_should_hold</a>;</div>
<div class="line"><a name="l01774"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#af81a8689094afe7aac9ebcce83e4c179"> 1774</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#af81a8689094afe7aac9ebcce83e4c179">write</a>;</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160; </div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    std::string <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a5e211d7b5ce0d93e738b39c969ffa580">str</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160; </div>
<div class="line"><a name="l01778"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a08ba125e4e78b508248c402b2db4b38b"> 1778</a></span>&#160;    <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a08ba125e4e78b508248c402b2db4b38b">Tracer</a> ()</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      : <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a03dc0f277c68639a62ebb08b6081ebb2">idx</a>(-1), <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a71069357c9ff73580f40302e06157e94">problem_type</a>(-1), <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#af703e6851dbf67b2a1314cbb12fe0063">perturbation_type</a>(-1), <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a49ee7e7623121a14eebd29ef3d4f1dc6">no_change_should_hold</a>(false),</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#aa67e9f878ebc02e7d9f7af1bf7e2bd35">safe_should_hold</a>(true), <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#ac5fabda7fac9149a4f017fea51df5c4c">local_should_hold</a>(true), <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#af81a8689094afe7aac9ebcce83e4c179">write</a>(false)</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    {}</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;  };</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160; </div>
<div class="line"><a name="l01784"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html"> 1784</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html">ValuesPartition</a> {</div>
<div class="line"><a name="l01785"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744"> 1785</a></span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744">ncells</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ncells_; }</div>
<div class="line"><a name="l01786"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a5a8a5b0f3d8f8f052ec909b82d7cc80c"> 1786</a></span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ab62d865ca5513267292f212fbb9cb9e6">KIF</a> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a5a8a5b0f3d8f8f052ec909b82d7cc80c">rhom</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> v_; }</div>
<div class="line"><a name="l01787"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a16f153cebcaaa7ab76a54309e5b620d1"> 1787</a></span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ab62d865ca5513267292f212fbb9cb9e6">KIF</a> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a16f153cebcaaa7ab76a54309e5b620d1">Qm_min</a>  (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ti)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> v_ + ncells_*(1 + 4*ti    ); }</div>
<div class="line"><a name="l01788"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a037049779c8e59c56442d30d1c9fd41b"> 1788</a></span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ab62d865ca5513267292f212fbb9cb9e6">KIF</a> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a037049779c8e59c56442d30d1c9fd41b">Qm</a>      (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ti)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> v_ + ncells_*(1 + 4*ti + 1); }</div>
<div class="line"><a name="l01789"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#adb70e989019217376bb3d1546ad97280"> 1789</a></span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ab62d865ca5513267292f212fbb9cb9e6">KIF</a> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#adb70e989019217376bb3d1546ad97280">Qm_max</a>  (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ti)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> v_ + ncells_*(1 + 4*ti + 2); }</div>
<div class="line"><a name="l01790"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a694cbce474a91ab6650d81824890ba22"> 1790</a></span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ab62d865ca5513267292f212fbb9cb9e6">KIF</a> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a694cbce474a91ab6650d81824890ba22">Qm_prev</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ti)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> v_ + ncells_*(1 + 4*ti + 3); }</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;  <span class="keyword">protected</span>:</div>
<div class="line"><a name="l01792"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a693d6f396fc94541b61e60851b69d0d1"> 1792</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a693d6f396fc94541b61e60851b69d0d1">init</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744">ncells</a>, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* v) {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      ncells_ = <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744">ncells</a>;</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      v_ = v;</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    }</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ncells_;</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* v_;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  };</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160; </div>
<div class="line"><a name="l01801"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html"> 1801</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a> : <span class="keyword">public</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html">ValuesPartition</a> {</div>
<div class="line"><a name="l01802"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#a19afaa1a320cc3cae65366f585b42513"> 1802</a></span>&#160;    <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#a19afaa1a320cc3cae65366f585b42513">Values</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ntracers, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744">ncells</a>)</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;      : v_((4*ntracers + 1)*<a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744">ncells</a>)</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    { <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a693d6f396fc94541b61e60851b69d0d1">init</a>(<a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744">ncells</a>, v_.data()); }</div>
<div class="line"><a name="l01805"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#a448e626a73eb6be271c50a6c0536f10d"> 1805</a></span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#a448e626a73eb6be271c50a6c0536f10d">data</a> () { <span class="keywordflow">return</span> v_.data(); }</div>
<div class="line"><a name="l01806"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#ae62c80499961f7f61b62feabeb13d787"> 1806</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#ae62c80499961f7f61b62feabeb13d787">size</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> v_.size(); }</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    std::vector&lt;Real&gt; v_;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  };</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160; </div>
<div class="line"><a name="l01811"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a0bed6fec68e9088a57ffd06726a12cec"> 1811</a></span>&#160;<a class="code" href="compose__cedr_8cpp.html#aa880d3b0360ecb807e94f0b35abc9a29">PRIVATE_CUDA</a>:</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> ExeSpace&gt;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="keyword">struct </span>ValuesDevice : <span class="keyword">public</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html">ValuesPartition</a> {</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    <span class="comment">// This Values object is the source of data and gets updated by sync_host.</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    ValuesDevice (<a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v)</div>
<div class="line"><a name="l01816"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#acdc2dc3c674df805f7838bd8f016b7b2"> 1816</a></span>&#160;      : rar_(v.data(), v.<a class="code" href="classcedr_1_1test_1_1_test_randomized.html#acdc2dc3c674df805f7838bd8f016b7b2">size</a>())</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    { <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#acae3d5885de88a009da51bcfe2e818c5">init</a>(v.<a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744">ncells</a>(), rar_.device_ptr()); }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="comment">// Values -&gt; device.</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a337141a0fb828d667912e67be42c5999"> 1819</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a337141a0fb828d667912e67be42c5999">sync_device</a> () { rar_.sync_device(); }</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="comment">// Update Values from device.</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a6c8f45ba1a961b27cbd49aa32b068bc4"> 1821</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a6c8f45ba1a961b27cbd49aa32b068bc4">sync_host</a> () { rar_.sync_host(); }</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;  <span class="keyword">private</span>:</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <a class="code" href="structcedr_1_1util_1_1_raw_array_raft.html">util::RawArrayRaft&lt;Real, ExeSpace&gt;</a> rar_;</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;  };</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160; </div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;  <span class="comment">// For solution output, if requested.</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html"> 1828</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html">Writer</a> {</div>
<div class="line"><a name="l01829"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a3f6a632979c2b9c1218df22215eff8f8"> 1829</a></span>&#160;    std::unique_ptr&lt;FILE, cedr::util::FILECloser&gt; <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a3f6a632979c2b9c1218df22215eff8f8">fh</a>;</div>
<div class="line"><a name="l01830"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a2325c74c693d3ad4e8b5995e32bb4991"> 1830</a></span>&#160;    std::vector&lt;Int&gt; <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a2325c74c693d3ad4e8b5995e32bb4991">ngcis</a>;  <span class="comment">// Number of i&#39;th rank&#39;s gcis_ array.</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a9455b49982ce8ff82ead07b02fbf72f9"> 1831</a></span>&#160;    std::vector&lt;Long&gt; <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a9455b49982ce8ff82ead07b02fbf72f9">gcis</a>;  <span class="comment">// Global cell indices packed by rank&#39;s gcis_ vector.</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a1fd27f80de4c4b4b4e3fc325dfb75d5e"> 1832</a></span>&#160;    std::vector&lt;int&gt; <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a1fd27f80de4c4b4b4e3fc325dfb75d5e">displs</a>; <span class="comment">// Cumsum of above.</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#afea30e4be158d5f880325c10443c273b">~Writer</a>();</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;  };</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160; </div>
<div class="line"><a name="l01836"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a717b1a6ba6a4dd401efe982912bac82d"> 1836</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a717b1a6ba6a4dd401efe982912bac82d">p_</a>;</div>
<div class="line"><a name="l01837"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a61cffe426f3ac3d14cdf7e5b8b9716bb"> 1837</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a61cffe426f3ac3d14cdf7e5b8b9716bb">ncells_</a>;</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  <span class="comment">// Global mesh entity IDs, 1-1 with reduction array index or QLT leaf node.</span></div>
<div class="line"><a name="l01839"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#aa0fe4c695707cf12cb688c56dbf74290"> 1839</a></span>&#160;  std::vector&lt;Long&gt; <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#aa0fe4c695707cf12cb688c56dbf74290">gcis_</a>;</div>
<div class="line"><a name="l01840"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c"> 1840</a></span>&#160;  std::vector&lt;Tracer&gt; <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">tracers_</a>;</div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160; </div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  <span class="comment">// Tell this class the CDR.</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a20ed81ef52a6a3496cf041c1325f59e7"> 1843</a></span>&#160;  <span class="keyword">virtual</span> <a class="code" href="structcedr_1_1_c_d_r.html">CDR</a>&amp; <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a20ed81ef52a6a3496cf041c1325f59e7">get_cdr</a>() = 0;</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160; </div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;  <span class="comment">// Fill gcis_.</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a505fa093661dc6068f2979042a766d28"> 1846</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a505fa093661dc6068f2979042a766d28">init_numbering</a>() = 0;</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160; </div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;  <span class="comment">// Using tracers_, the vector of Tracers, initialize the CDR&#39;s tracers.</span></div>
<div class="line"><a name="l01849"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#ab9eaa4b79cfd68e55fd677a04ecae4e8"> 1849</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#ab9eaa4b79cfd68e55fd677a04ecae4e8">init_tracers</a>() = 0;</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160; </div>
<div class="line"><a name="l01851"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a6b11b2248d6ec1bad4ef42a0ef44ce2b"> 1851</a></span>&#160;  <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a6b11b2248d6ec1bad4ef42a0ef44ce2b">run_impl</a>(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> trial) = 0;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160; </div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="comment">// For optional output.</span></div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;  <span class="keywordtype">bool</span> write_inited_;</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;  std::shared_ptr&lt;Writer&gt; w_; <span class="comment">// Only on root.</span></div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160; </div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;  <span class="keywordtype">void</span> init_tracers_vector();</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160; </div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="keywordtype">void</span> add_const_to_Q(</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    <span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">Tracer</a>&amp; t, <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v,</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    <span class="comment">// Move 0 &lt; alpha &lt;= 1 of the way to the QLT or safety feasibility bound.</span></div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; alpha,</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    <span class="comment">// Whether the modification should be done in a mass-conserving way.</span></div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> conserve_mass,</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    <span class="comment">// Only safety problem is feasible.</span></div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> safety_problem);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160; </div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;  <span class="keywordtype">void</span> perturb_Q(<span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">Tracer</a>&amp; t, <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v);</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;  <span class="keywordtype">void</span> init_writer();</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  <span class="keywordtype">void</span> gather_field(<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* Qm_lcl, std::vector&lt;Real&gt;&amp; Qm_gbl,</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                    std::vector&lt;Real&gt;&amp; wrk);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  <span class="keywordtype">void</span> write_field(<span class="keyword">const</span> std::string&amp; tracer_name, <span class="keyword">const</span> std::string&amp; field_name,</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                   <span class="keyword">const</span> std::vector&lt;Real&gt;&amp; Qm);</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;  <span class="keywordtype">void</span> write_pre(<span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">Tracer</a>&amp; t, <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v);</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;  <span class="keywordtype">void</span> write_post(<span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">Tracer</a>&amp; t, <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v);</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160; </div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> generate_rho(<a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v);</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> generate_Q(<span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">Tracer</a>&amp; t, <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> permute_Q(<span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">Tracer</a>&amp; t, <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v);</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;  <span class="keyword">static</span> std::string get_tracer_name(<span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">Tracer</a>&amp; t);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> check(<span class="keyword">const</span> std::string&amp; cdr_name, <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">mpi::Parallel</a>&amp; p,</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            <span class="keyword">const</span> std::vector&lt;Tracer&gt;&amp; ts, <span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a>&amp; v);</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;};</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160; </div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160; </div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="comment">//#include &quot;cedr_test_randomized_inl.hpp&quot;</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160; </div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160; </div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;<span class="comment">//&gt;&gt; cedr_test_randomized_inl.hpp</span></div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160; </div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_TEST_RANDOMIZED_INL_HPP</span></div>
<div class="line"><a name="l01898"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a6fc276f307731e31849bae59f1d9fa68"> 1898</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_TEST_RANDOMIZED_INL_HPP</span></div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160; </div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;<span class="comment">//#include &quot;cedr_test_randomized.hpp&quot;</span></div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160; </div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> CDRT, <span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l01906"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a2b823e264295db343e072086f2ac80f7"> 1906</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a2b823e264295db343e072086f2ac80f7">TestRandomized::run</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nrepeat, <span class="keyword">const</span> <span class="keywordtype">bool</span> write) {</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nt = <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">tracers_</a>.size(), nlclcells = <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#aa0fe4c695707cf12cb688c56dbf74290">gcis_</a>.size();</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160; </div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <a class="code" href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">Values</a> v(nt, nlclcells);</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;  generate_rho(v);</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; t : <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">tracers_</a>) {</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    generate_Q(t, v);</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    perturb_Q(t, v);</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;  }</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160; </div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;  <span class="keywordflow">if</span> (write)</div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; t : <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">tracers_</a>)</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;      write_pre(t, v);</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160; </div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;  CDRT cdr = <span class="keyword">static_cast&lt;</span>CDRT&amp;<span class="keyword">&gt;</span>(<a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a20ed81ef52a6a3496cf041c1325f59e7">get_cdr</a>());</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;  ValuesDevice&lt;ES&gt; vd(v);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;  vd.sync_device();</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; </div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;  {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> rhom = vd.rhom();</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> set_rhom = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; i) {</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      cdr.set_rhom(i, 0, rhom[i]);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    };</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    Kokkos::parallel_for(Kokkos::RangePolicy&lt;ES&gt;(0, nlclcells), set_rhom);</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;  }</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <span class="comment">// repeat &gt; 1 runs the same values repeatedly for performance</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;  <span class="comment">// meaurement.</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> trial = 0; trial &lt;= nrepeat; ++trial) {</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> set_Qm = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; j) {</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> ti = j / nlclcells;</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> i = j % nlclcells;</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      cdr.set_Qm(i, ti, vd.Qm(ti)[i], vd.Qm_min(ti)[i], vd.Qm_max(ti)[i],</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;                 vd.Qm_prev(ti)[i]);</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    };</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    Kokkos::parallel_for(Kokkos::RangePolicy&lt;ES&gt;(0, nt*nlclcells), set_Qm);</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a6b11b2248d6ec1bad4ef42a0ef44ce2b">run_impl</a>(trial);</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;  }</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;  {</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> get_Qm = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; j) {</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> ti = j / nlclcells;</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> i = j % nlclcells;</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      vd.Qm(ti)[i] = cdr.get_Qm(i, ti);</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    };</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    Kokkos::parallel_for(Kokkos::RangePolicy&lt;ES&gt;(0, nt*nlclcells), get_Qm);</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;  }</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;  vd.sync_host(); <span class="comment">// =&gt; v contains computed values</span></div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160; </div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;  <span class="keywordflow">if</span> (write)</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; t : <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">tracers_</a>)</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      write_post(t, v);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;  <span class="keywordflow">return</span> check(cdr_name_, *<a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a717b1a6ba6a4dd401efe982912bac82d">p_</a>, <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">tracers_</a>, v);</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;}</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160; </div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160; </div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160; </div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;<span class="comment">//&gt;&gt; cedr_test.hpp</span></div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160; </div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="preprocessor">#ifndef INCLUDE_CEDR_TEST_HPP</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#afa535f086819b46dd3bd3077902a61ec"> 1969</a></span>&#160;<span class="preprocessor">#define INCLUDE_CEDR_TEST_HPP</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160; </div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment">//#include &quot;cedr.hpp&quot;</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment">//#include &quot;cedr_mpi.hpp&quot;</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160; </div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l01976"></a><span class="lineno"><a class="line" href="namespacecedr_1_1test_1_1transport1d.html"> 1976</a></span>&#160;<span class="keyword">namespace </span>transport1d {</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160; </div>
<div class="line"><a name="l01978"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1transport1d_1_1_input.html"> 1978</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html">Input</a> {</div>
<div class="line"><a name="l01979"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b"> 1979</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>;</div>
<div class="line"><a name="l01980"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1transport1d_1_1_input.html#ab1ce2cdac0384c4e09992db35e1a25b7"> 1980</a></span>&#160;  <span class="keywordtype">bool</span> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#ab1ce2cdac0384c4e09992db35e1a25b7">verbose</a>;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;};</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160; </div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">run</a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html">Input</a>&amp; in);</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160; </div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;} <span class="comment">// namespace transport1d</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160; </div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160; </div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">//&gt;&gt; cedr_util.cpp</span></div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160; </div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">//#include &quot;cedr_util.hpp&quot;</span></div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160; </div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="keyword">namespace </span>util {</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160; </div>
<div class="line"><a name="l02000"></a><span class="lineno"><a class="line" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e"> 2000</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a> (<span class="keyword">const</span> std::string&amp; <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> b1, <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> b2) {</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;  <span class="keywordflow">return</span> (<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> == std::string(b1) || (b2 &amp;&amp; <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> == std::string(b2)) ||</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;          <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> == std::string(<span class="stringliteral">&quot;-&quot;</span>) + std::string(b1));</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;}</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160; </div>
<div class="line"><a name="l02005"></a><span class="lineno"><a class="line" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0"> 2005</a></span>&#160;<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a> () { <span class="keywordflow">return</span> std::rand() / ((<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>) RAND_MAX + 1.0); }</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160; </div>
<div class="line"><a name="l02007"></a><span class="lineno"><a class="line" href="namespacecedr_1_1util.html#a8cc6be245e1ed9a0338ed9b26f1b51e7"> 2007</a></span>&#160;<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">reldif</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n) {</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> num = 0, den = 0;</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    num += std::abs(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i] - <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>[i]);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    den += std::abs(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]);</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;  }</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;  <span class="keywordflow">return</span> num/den;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;}</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;}</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;}</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160; </div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">//&gt;&gt; cedr_local.cpp</span></div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160; </div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;<span class="comment">//#include &quot;cedr_local.hpp&quot;</span></div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">//#include &quot;cedr_local_inl.hpp&quot;</span></div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160; </div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="keyword">namespace </span>local {</div>
<div class="line"><a name="l02028"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local_1_1test.html"> 2028</a></span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">// Check the first-order optimality conditions. Return true if OK, false</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">// otherwise. If quiet, don&#39;t print anything.</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local_1_1test.html#a8187e641f42aba1db0579d7486cee077"> 2031</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacecedr_1_1local_1_1test.html#a8187e641f42aba1db0579d7486cee077">check_1eq_bc_qp_foc</a> (</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* label, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* w, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xlo, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xhi, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> verbose)</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;{</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;  <span class="keyword">auto</span>&amp; os = std::cout;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;  <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> xtmp;</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;  <span class="comment">// Check the bound constraints.</span></div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &lt; (xtmp = xlo[i])) {</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;x[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] = &quot;</span> &lt;&lt; <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;           &lt;&lt; <span class="stringliteral">&quot; but x[i] - xlo[i] = &quot;</span> &lt;&lt; (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] - xtmp) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    }</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &gt; (xtmp = xhi[i])) {</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        os &lt;&lt; <span class="stringliteral">&quot;x[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] = &quot;</span> &lt;&lt; <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;           &lt;&lt; <span class="stringliteral">&quot; but xhi[i] - x[i] = &quot;</span> &lt;&lt; (xtmp - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;      ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    }</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;  <span class="comment">// Check the equality constraint.</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> r = 0;</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    r += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  r -= <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>;</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <span class="keywordflow">if</span> (std::abs(r) &gt; <a class="code" href="namespacecedr_1_1local_1_1impl.html#a8b83e71c647cda8a5e7fe355dcc16bdd">impl::calc_r_tol</a>(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, y, n)) {</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;r = &quot;</span> &lt;&lt; r &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;    ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  }</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;  <span class="comment">// Check the gradient is 0 when projected into the constraints. Compute</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;  <span class="comment">//     g = W (x - y)</span></div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  <span class="comment">//     g_reduced = g - C ((C&#39;C) \ (C&#39;g))</span></div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;  <span class="comment">// where</span></div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  <span class="comment">//     IA = I(:,A)</span></div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  <span class="comment">//     C = [IA a],</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <span class="comment">// and A is the active set.</span></div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> padtol = 1e5*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>();</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> lambda = 0, den = 0;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> pad = padtol*(xhi[i] - xlo[i]);</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    <span class="keywordflow">if</span> (xlo[i] + pad &lt;= <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &amp;&amp; <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &lt;= xhi[i] - pad) {</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> gi = w[i]*(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] - y[i]);</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      lambda += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*gi;</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      den += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i];</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    }</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;  }</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;  lambda /= den;</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> normg = 0, normy = 0;</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    normy += <a class="code" href="namespacecedr_1_1util.html#aebb086baeee1459e0a42a4d659e044dc">cedr::util::square</a>(y[i]);</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> pad = padtol*(xhi[i] - xlo[i]);</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">if</span> (xlo[i] + pad &lt;= <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &amp;&amp; <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &lt;= xhi[i] - pad)</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      normg += <a class="code" href="namespacecedr_1_1util.html#aebb086baeee1459e0a42a4d659e044dc">cedr::util::square</a>(w[i]*(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] - y[i]) - <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*lambda);</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;  }</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;  normy = std::sqrt(normy);</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;  normg = std::sqrt(normg);</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> gtol = 1e4*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>()*normy;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;  <span class="keywordflow">if</span> (normg &gt; gtol) {</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;      os &lt;&lt; <span class="stringliteral">&quot;norm(g) = &quot;</span> &lt;&lt; normg &lt;&lt; <span class="stringliteral">&quot; gtol = &quot;</span> &lt;&lt; gtol &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;  }</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;  <span class="comment">// Check the gradient at the active boundaries.</span></div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> onlo = <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] == xlo[i];</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> onhi = onlo ? false : <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] == xhi[i];</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;    <span class="keywordflow">if</span> (onlo || onhi) {</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rg = w[i]*(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] - y[i]) - <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*lambda;</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <span class="keywordflow">if</span> (onlo &amp;&amp; rg &lt; -gtol) {</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;onlo but rg = &quot;</span> &lt;&lt; rg &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (onhi &amp;&amp; rg &gt; gtol) {</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;          os &lt;&lt; <span class="stringliteral">&quot;onhi but rg = &quot;</span> &lt;&lt; rg &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      }</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    }</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;  }</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  <span class="keywordflow">if</span> ( ! ok &amp;&amp; verbose)</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;label: &quot;</span> &lt;&lt; label &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  <span class="keywordflow">return</span> ok;</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;}</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160; </div>
<div class="line"><a name="l02118"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local_1_1test.html#a6c211e87158b2e61682f2f2908f6692f"> 2118</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local_1_1test.html#a6c211e87158b2e61682f2f2908f6692f">test_1eq_bc_qp</a> () {</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <span class="keywordtype">bool</span> verbose = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160; </div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n;</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> N = 16;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> w[N], <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[N], <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo[N], xhi[N], y[N], <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[N], al, au;</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160; </div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  <span class="keyword">auto</span> <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">run</a> = [&amp;] () {</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> info = <a class="code" href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938">solve_1eq_bc_qp</a>(n, w, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> ok = <a class="code" href="namespacecedr_1_1local_1_1test.html#a8187e641f42aba1db0579d7486cee077">test::check_1eq_bc_qp_foc</a>(</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      <span class="stringliteral">&quot;unittest&quot;</span>, n, w, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, verbose);</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <span class="keywordflow">if</span> ( ! ok) ++nerr;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160; </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <span class="keywordflow">if</span> (n == 2) {</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;      <span class="comment">// This version never returns 0.</span></div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;      <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> x2[2];</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> info2 = <a class="code" href="namespacecedr_1_1local.html#aeec5c3e64900ac50f51105cafb9b0668">solve_1eq_bc_qp_2d</a>(w, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, y, x2);</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      <span class="keywordflow">if</span> (info2 != 1 &amp;&amp; (info == 0 || info == 1)) {</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        <span class="keywordflow">if</span> (verbose) <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(info) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(info2));</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        ++nerr;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      }</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a> = <a class="code" href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">cedr::util::reldif</a>(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, x2, 2);</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a> &gt; 1e4*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>()) {</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        <span class="keywordflow">if</span> (verbose)</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;          printf(<span class="stringliteral">&quot;%1.1e | y %1.15e %1.15e | x %1.15e %1.15e | &quot;</span></div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;                 <span class="stringliteral">&quot;x2 %1.15e %1.15e | l %1.15e %1.15e | u %1.15e %1.15e\n&quot;</span>,</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                 <a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a>, y[0], y[1], <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[0], <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[1], x2[0], x2[1],</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;                 xlo[0], xlo[1], xhi[0], xhi[1]);</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        ++nerr;</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      }</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    }</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160; </div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a>(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> m = 0, den = 0;</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      m += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      den += std::abs(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]);</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &lt; xlo[i]) ++nerr;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &gt; xhi[i]) ++nerr;</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    }</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a> = std::abs(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> - m)/den;</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a> &gt; 1e3*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>()) {</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      <span class="keywordflow">if</span> (verbose) <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(<a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(n) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(m));</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;      ++nerr;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;  };</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160; </div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;  <span class="keyword">auto</span> gena = [&amp;] () {</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;      <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i] = 0.1 + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;  };</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;  <span class="keyword">auto</span> genw = [&amp;] () {</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;      w[i] = 0.1 + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;  };</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;  <span class="keyword">auto</span> genbnds = [&amp;] () {</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    al = au = 0;</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      xlo[i] = <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>() - 0.5;</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      al += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*xlo[i];</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      xhi[i] = xlo[i] + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      au += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*xhi[i];</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    }</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  };</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="keyword">auto</span> genb = [&amp;] (<span class="keyword">const</span> <span class="keywordtype">bool</span> in) {</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="keywordflow">if</span> (in) {</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> alpha = <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;      <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = alpha*al + (1 - alpha)*au;</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>() &gt; 0.5)</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = au + 0.01 + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = al - 0.01 - <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    }</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  };</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  <span class="keyword">auto</span> geny = [&amp;] (<span class="keyword">const</span> <span class="keywordtype">bool</span> in) {</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    <span class="keywordflow">if</span> (in) {</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> alpha = <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;        y[i] = alpha*xlo[i] + (1 - alpha)*xhi[i];</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      }</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>() &gt; 0.2) {</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt; n; i += 2) {</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> alpha = <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        y[i] = alpha*xlo[i] + (1 - alpha)*xhi[i];</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(y[i] &gt;= xlo[i] &amp;&amp; y[i] &lt;= xhi[i]);</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      }      </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; i += 4)</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        y[i] = xlo[i] - <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 2; i &lt; n; i += 4)</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        y[i] = xhi[i] + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; i += 2)</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        y[i] = xlo[i] - <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt; n; i += 2)</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        y[i] = xhi[i] + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    }</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;  };</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  <span class="keyword">auto</span> b4y = [&amp;] () {</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = 0;</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*y[i];</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;  };</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160; </div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <span class="keywordflow">for</span> (n = 2; n &lt;= N; ++n) {</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> count = n == 2 ? 100 : 10;</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      gena();</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      genw();</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      genbnds();</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      genb(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;      geny(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;      <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">run</a>();</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      b4y();</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">run</a>();</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      genb(<span class="keyword">true</span>);</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      geny(<span class="keyword">false</span>);</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">run</a>();</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    }</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;  }</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160; </div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  <span class="keywordflow">return</span>  nerr;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;}</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160; </div>
<div class="line"><a name="l02243"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local_1_1test.html#ae2953f323781ba2bb1dec9c208b6c3a5"> 2243</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local_1_1test.html#ae2953f323781ba2bb1dec9c208b6c3a5">test_1eq_nonneg</a> () {</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">cedr::util::reldif</a>;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160; </div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <span class="keywordtype">bool</span> verbose = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160; </div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n;</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> N = 16;</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> w[N], <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[N], <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo[N], xhi[N], y[N], x_ls[N], x_caas[N], x1_ls[N], x1_caas[N];</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160; </div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  <span class="keywordflow">for</span> (n = 2; n &lt;= 2; ++n) {</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> count = 20;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> trial = 0; trial &lt; count; ++trial) {</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = 0.5*n*urand();</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;        w[i] = 0.1 + urand();</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;        <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i] = 0.1 + urand();</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        xlo[i] = 0;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        xhi[i] = <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>/<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i];</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        y[i] = urand();</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        <span class="keywordflow">if</span> (urand() &gt; 0.8) y[i] *= -1;</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        x1_caas[i] = urand() &gt; 0.5 ? y[i] : -1;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        x1_ls[i] = urand() &gt; 0.5 ? y[i] : -1;</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;      }</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      <a class="code" href="namespacecedr_1_1local.html#a61447f212fd00919206121765d9d5e54">solve_1eq_nonneg</a>(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, y, x1_caas, w, <a class="code" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0a12e240876312c9b5e79fadb028bd6176">Method::caas</a>);</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;      <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a>(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, y, x_caas);</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      <a class="code" href="namespacecedr_1_1local.html#a61447f212fd00919206121765d9d5e54">solve_1eq_nonneg</a>(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, y, x1_ls, w, <a class="code" href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0aeb7ed44142d1af44ca1226f6c2c54d1f">Method::least_squares</a>);</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      <a class="code" href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938">solve_1eq_bc_qp</a>(n, w, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, y, x_ls);</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rd_caas = <a class="code" href="namespacecedr_1_1util.html#a8cc6be245e1ed9a0338ed9b26f1b51e7">reldif</a>(x_caas, x1_caas, 2);</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rd_ls = <a class="code" href="namespacecedr_1_1util.html#a8cc6be245e1ed9a0338ed9b26f1b51e7">reldif</a>(x_ls, x1_ls, 2);</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      <span class="keywordflow">if</span> (rd_ls &gt; 5e1*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>() ||</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;          rd_caas &gt; 1e1*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>()) {</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(rd_ls) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(rd_caas));</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="keywordflow">if</span> (verbose) {</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;          <span class="keyword">using</span> <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">cedr::util::prarr</a>;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;          <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a>(<span class="stringliteral">&quot;w&quot;</span>, w, n);</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;          <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a>(<span class="stringliteral">&quot;a&quot;</span>, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, n);</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;          <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a>(<span class="stringliteral">&quot;xhi&quot;</span>, xhi, n);</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;          <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a>(<span class="stringliteral">&quot;y&quot;</span>, y, n);</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;          <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a>(<span class="stringliteral">&quot;x_ls&quot;</span>, x_ls, n);</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;          <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a>(<span class="stringliteral">&quot;x1_ls&quot;</span>, x1_ls, n);</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;          <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a>(<span class="stringliteral">&quot;x_caas&quot;</span>, x_caas, n);</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;          <a class="code" href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">prarr</a>(<span class="stringliteral">&quot;x1_caas&quot;</span>, x1_caas, n);</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;          <a class="code" href="compose__cedr_8cpp.html#aee1c2a81a0aaa758fb41ff058dd320bb">prc</a>(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>);</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;          <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> mass = 0;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) mass += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*x_ls[i];</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;          <a class="code" href="compose__cedr_8cpp.html#aee1c2a81a0aaa758fb41ff058dd320bb">prc</a>(mass);</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;          mass = 0;</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) mass += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*x_ls[i];</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;          <a class="code" href="compose__cedr_8cpp.html#aee1c2a81a0aaa758fb41ff058dd320bb">prc</a>(mass);</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;          mass = 0;</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) mass += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*x_caas[i];</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;          <a class="code" href="compose__cedr_8cpp.html#aee1c2a81a0aaa758fb41ff058dd320bb">prc</a>(mass);</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;        }</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        ++nerr;</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      }</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    }</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  }</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160; </div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;}</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160; </div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160; </div>
<div class="line"><a name="l02308"></a><span class="lineno"><a class="line" href="namespacecedr_1_1local.html#a0cae8843ba7d55d41e672b37311725c8"> 2308</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1local.html#a0cae8843ba7d55d41e672b37311725c8">unittest</a> () {</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;  nerr += <a class="code" href="namespacecedr_1_1local_1_1test.html#a6c211e87158b2e61682f2f2908f6692f">test::test_1eq_bc_qp</a>();</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;  nerr += <a class="code" href="namespacecedr_1_1local_1_1test.html#ae2953f323781ba2bb1dec9c208b6c3a5">test::test_1eq_nonneg</a>();</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;}</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160; </div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;} <span class="comment">// namespace local</span></div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160; </div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;<span class="comment">//&gt;&gt; cedr_mpi.cpp</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160; </div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment">//#include &quot;cedr_mpi.hpp&quot;</span></div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;<span class="comment">//#include &quot;cedr_util.hpp&quot;</span></div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160; </div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;<span class="keyword">namespace </span>mpi {</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160; </div>
<div class="line"><a name="l02328"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a6e572b78e7d5d0ff5a43cab685375bb3"> 2328</a></span>&#160;<a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a> <a class="code" href="namespacecedr_1_1mpi.html#a6e572b78e7d5d0ff5a43cab685375bb3">make_parallel</a> (MPI_Comm comm) {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;  <span class="keywordflow">return</span> std::make_shared&lt;Parallel&gt;(comm);</div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;}</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160; </div>
<div class="line"><a name="l02332"></a><span class="lineno"><a class="line" href="classcedr_1_1mpi_1_1_parallel.html#a4679f09fa87c42310ac9b90b712c2809"> 2332</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#a4679f09fa87c42310ac9b90b712c2809">Parallel::size</a> ()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;  <span class="keywordtype">int</span> sz = 0;</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  MPI_Comm_size(comm_, &amp;sz);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;  <span class="keywordflow">return</span> sz;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;}</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160; </div>
<div class="line"><a name="l02338"></a><span class="lineno"><a class="line" href="classcedr_1_1mpi_1_1_parallel.html#ad5a5d63fd5ed9d639834857757606b19"> 2338</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#ad5a5d63fd5ed9d639834857757606b19">Parallel::rank</a> ()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <span class="keywordtype">int</span> pid = 0;</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;  MPI_Comm_rank(comm_, &amp;pid);</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;  <span class="keywordflow">return</span> pid;</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;}</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160; </div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="preprocessor">#ifdef COMPOSE_DEBUG_MPI</span></div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;Request::Request () : unfreed(0) {}</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;Request::~Request () {</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;  <span class="keywordflow">if</span> (unfreed) {</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    std::stringstream ss;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;Request is being deleted with unfreed = &quot;</span> &lt;&lt; unfreed;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    <span class="keywordtype">int</span> fin;</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    MPI_Finalized(&amp;fin);</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <span class="keywordflow">if</span> (fin) {</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      ss &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      std::cerr &lt;&lt; ss.str();</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(ss.str());</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    }</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;  }</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;}</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160; </div>
<div class="line"><a name="l02362"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#abbfab661857550024ee1c2a18f107649"> 2362</a></span>&#160;<span class="keyword">template</span> &lt;&gt; MPI_Datatype <a class="code" href="namespacecedr_1_1mpi.html#abbfab661857550024ee1c2a18f107649">get_type&lt;int&gt;</a>() { <span class="keywordflow">return</span> MPI_INT; }</div>
<div class="line"><a name="l02363"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a5b8d958bebd9c6b0885b8179adc985f2"> 2363</a></span>&#160;<span class="keyword">template</span> &lt;&gt; MPI_Datatype <a class="code" href="namespacecedr_1_1mpi.html#a5b8d958bebd9c6b0885b8179adc985f2">get_type&lt;double&gt;</a>() { <span class="keywordflow">return</span> MPI_DOUBLE; }</div>
<div class="line"><a name="l02364"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#a5405e4778663ed0790594ca71430f4a1"> 2364</a></span>&#160;<span class="keyword">template</span> &lt;&gt; MPI_Datatype <a class="code" href="namespacecedr_1_1mpi.html#a5405e4778663ed0790594ca71430f4a1">get_type&lt;long&gt;</a>() { <span class="keywordflow">return</span> MPI_LONG_INT; }</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160; </div>
<div class="line"><a name="l02366"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#ae0e941fa3748495376c11d4ff65b30e7"> 2366</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#ae0e941fa3748495376c11d4ff65b30e7">waitany</a> (<span class="keywordtype">int</span> count, <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>* reqs, <span class="keywordtype">int</span>* index, MPI_Status* stats) {</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;<span class="preprocessor">#ifdef COMPOSE_DEBUG_MPI</span></div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;  std::vector&lt;MPI_Request&gt; vreqs(count);</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; count; ++i) vreqs[i] = reqs[i].request;</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> out = MPI_Waitany(count, vreqs.data(), index,</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;                               stats ? stats : MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; count; ++i) reqs[i].request = vreqs[i];</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;  reqs[*index].unfreed--;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;  <span class="keywordflow">return</span> out;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  <span class="keywordflow">return</span> MPI_Waitany(count, <span class="keyword">reinterpret_cast&lt;</span>MPI_Request*<span class="keyword">&gt;</span>(reqs), index,</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                     stats ? stats : MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;}</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160; </div>
<div class="line"><a name="l02381"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213"> 2381</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">waitall</a> (<span class="keywordtype">int</span> count, <a class="code" href="structcedr_1_1mpi_1_1_request.html">Request</a>* reqs, MPI_Status* stats) {</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;<span class="preprocessor">#ifdef COMPOSE_DEBUG_MPI</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  std::vector&lt;MPI_Request&gt; vreqs(count);</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; count; ++i) vreqs[i] = reqs[i].request;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> out = MPI_Waitall(count, vreqs.data(),</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;                               stats ? stats : MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; count; ++i) {</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    reqs[i].<a class="code" href="structcedr_1_1mpi_1_1_request.html#a4b34b505d84b830b36538152c39151b2">request</a> = vreqs[i];</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    reqs[i].unfreed--;</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;  }</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="keywordflow">return</span> out;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="keywordflow">return</span> MPI_Waitall(count, <span class="keyword">reinterpret_cast&lt;</span>MPI_Request*<span class="keyword">&gt;</span>(reqs),</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                     stats ? stats : MPI_STATUS_IGNORE);</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;}</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160; </div>
<div class="line"><a name="l02398"></a><span class="lineno"><a class="line" href="namespacecedr_1_1mpi.html#acdb744561335e178b128fd66512c7dca"> 2398</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespacecedr_1_1mpi.html#acdb744561335e178b128fd66512c7dca">all_ok</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">Parallel</a>&amp; p, <span class="keywordtype">bool</span> im_ok) {</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keywordtype">int</span> ok = im_ok, msg;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;  all_reduce&lt;int&gt;(p, &amp;ok, &amp;msg, 1, MPI_LAND);</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(msg);</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;}</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160; </div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;} <span class="comment">// namespace mpi</span></div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160; </div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;<span class="comment">//&gt;&gt; cedr_qlt.cpp</span></div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160; </div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;<span class="comment">//#include &quot;cedr_qlt.hpp&quot;</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;<span class="comment">//#include &quot;cedr_test_randomized.hpp&quot;</span></div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160; </div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;<span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160; </div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160; </div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;<span class="preprocessor">#include &lt;limits&gt;</span></div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160; </div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr_1_1qlt.html">qlt</a> {</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160; </div>
<div class="line"><a name="l02426"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_timer.html"> 2426</a></span>&#160;<span class="keyword">class </span><a class="code" href="classcedr_1_1qlt_1_1_timer.html">Timer</a> {</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l02428"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea9501181ea4c574b8b4440411ceaa8a96"> 2428</a></span>&#160;  <span class="keyword">enum</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edae">Op</a> { <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaeae63447b32c00b834471886966f833c36">tree</a>, <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea9501181ea4c574b8b4440411ceaa8a96">analyze</a>, <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea41a1f4c4684ecd85db778bbd2a3fce18">qltrun</a>, <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea043af0b185f9b1d1af6cc8c103783b75">qltrunl2r</a>, <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea45f2e86e39d230aafc930343c1d23811">qltrunr2l</a>, <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaeacb820002d5d6448bfb255d832fefed63">snp</a>, <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea0af5ae2b492422e8ea6a44e6c21cf343">waitall</a>,</div>
<div class="line"><a name="l02429"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30"> 2429</a></span>&#160;            <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea8932f4c5fd83511800461ddeaf96a997">total</a>, <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">NTIMERS</a> };</div>
<div class="line"><a name="l02430"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_timer.html#a18e6dd3b80c54ca258b202d81daa1abf"> 2430</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a18e6dd3b80c54ca258b202d81daa1abf">init</a> () {</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;<span class="preprocessor">#ifdef COMPOSE_QLT_TIME</span></div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">NTIMERS</a>; ++i) {</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      et_[i] = 0;</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      cnt_[i] = 0;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;    }</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;  }</div>
<div class="line"><a name="l02438"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_timer.html#ae11111b5eac47aa7c5dba40f87247f92"> 2438</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#ae11111b5eac47aa7c5dba40f87247f92">reset</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edae">Op</a> op) {</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="preprocessor">#ifdef COMPOSE_QLT_TIME</span></div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;    et_[op] = 0;</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;    cnt_[op] = 0;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;  }</div>
<div class="line"><a name="l02444"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_timer.html#a67433f0f91c7000b32ad545239f2cd4f"> 2444</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a67433f0f91c7000b32ad545239f2cd4f">start</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edae">Op</a> op) {</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;<span class="preprocessor">#ifdef COMPOSE_QLT_TIME</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;    gettimeofday(&amp;t_start_[op], 0);</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;    ++cnt_[op];</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;  }</div>
<div class="line"><a name="l02450"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_timer.html#a29a2432f3e24ae376275e855319b47b6"> 2450</a></span>&#160;  <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a29a2432f3e24ae376275e855319b47b6">stop</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edae">Op</a> op) {</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;<span class="preprocessor">#ifdef COMPOSE_QLT_TIME</span></div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    timeval t2;</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;    gettimeofday(&amp;t2, 0);</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    <span class="keyword">const</span> timeval&amp; t1 = t_start_[op];</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespacesupercell.html#a8afb838193de1fd0aeb14e727966a8e6">us</a> = 1.0e6;</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    et_[op] += (t2.tv_sec*<a class="code" href="namespacesupercell.html#a8afb838193de1fd0aeb14e727966a8e6">us</a> + t2.tv_usec - t1.tv_sec*<a class="code" href="namespacesupercell.html#a8afb838193de1fd0aeb14e727966a8e6">us</a> - t1.tv_usec)/<a class="code" href="namespacesupercell.html#a8afb838193de1fd0aeb14e727966a8e6">us</a>;</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;  }</div>
<div class="line"><a name="l02459"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e"> 2459</a></span>&#160;<span class="preprocessor"># define tpr(op) do {                                                   \</span></div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;<span class="preprocessor">    printf(&quot;%-20s %10.3e %10.1f (%4d %10.3e)\n&quot;</span>,                        \</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;           #op, et_[op], 100*et_[op]/tot, cnt_[op], et_[op]/cnt_[op]);  \</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;  } while (0)</div>
<div class="line"><a name="l02463"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_timer.html#abee29aaee4b6a40fe9fb95e17a78e7a6"> 2463</a></span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_timer.html#abee29aaee4b6a40fe9fb95e17a78e7a6">print</a> () {</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="preprocessor">#ifdef COMPOSE_QLT_TIME</span></div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> tot = et_[<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea8932f4c5fd83511800461ddeaf96a997">total</a>];</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e">tpr</a>(<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaeae63447b32c00b834471886966f833c36">tree</a>); <a class="code" href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e">tpr</a>(<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea9501181ea4c574b8b4440411ceaa8a96">analyze</a>);</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e">tpr</a>(<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea41a1f4c4684ecd85db778bbd2a3fce18">qltrun</a>); <a class="code" href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e">tpr</a>(<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea043af0b185f9b1d1af6cc8c103783b75">qltrunl2r</a>); <a class="code" href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e">tpr</a>(<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea45f2e86e39d230aafc930343c1d23811">qltrunr2l</a>); <a class="code" href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e">tpr</a>(<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaeacb820002d5d6448bfb255d832fefed63">snp</a>); <a class="code" href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e">tpr</a>(<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea0af5ae2b492422e8ea6a44e6c21cf343">waitall</a>);</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    printf(<span class="stringliteral">&quot;%-20s %10.3e %10.1f\n&quot;</span>, <span class="stringliteral">&quot;total&quot;</span>, tot, 100.0);</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;  }</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;<span class="preprocessor">#undef tpr</span></div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="preprocessor">#ifdef COMPOSE_QLT_TIME</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;  <span class="keyword">static</span> timeval t_start_[<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">NTIMERS</a>];</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> et_[<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">NTIMERS</a>];</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">int</span> cnt_[<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">NTIMERS</a>];</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;};</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="preprocessor">#ifdef COMPOSE_QLT_TIME</span></div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;timeval Timer::t_start_[<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">Timer::NTIMERS</a>];</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="keywordtype">double</span> Timer::et_[<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">Timer::NTIMERS</a>];</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;<span class="keywordtype">int</span> Timer::cnt_[<a class="code" href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">Timer::NTIMERS</a>];</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160; </div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="keyword">namespace </span>impl {</div>
<div class="line"><a name="l02486"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a46d290212390f403a3e00d16d5674636"> 2486</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a46d290212390f403a3e00d16d5674636">NodeSets::print</a> (std::ostream&amp; os)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  std::stringstream ss;</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.empty()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> myrank = <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[0].nodes[0])-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a>;</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;pid &quot;</span> &lt;&lt; myrank &lt;&lt; <span class="stringliteral">&quot;:&quot;</span>;</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot; #levels &quot;</span> &lt;&lt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.size();</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.size(); ++i) {</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; lvl = <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[i];</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot;\n  &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; lvl.nodes.size();</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;    std::set&lt;Int&gt; ps, ks;</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 0; j &lt; lvl.nodes.size(); ++j) {</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(lvl.nodes[j]);</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; n-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>])-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a> != myrank)</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;          ks.insert(<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>])-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a>);</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      <span class="keywordflow">if</span> (n-&gt;parent &gt;= 0 &amp;&amp; <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;parent)-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a> != myrank)</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;        ps.insert(<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;parent)-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a>);</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;    }</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    ss &lt;&lt; <span class="stringliteral">&quot; |&quot;</span>;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; e : ks) ss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; e;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    <span class="keywordflow">if</span> ( ! lvl.kids.empty()) ss &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; lvl.kids.size() &lt;&lt; <span class="stringliteral">&quot;) |&quot;</span>;</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; e : ps) ss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; e;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    <span class="keywordflow">if</span> ( ! lvl.me.empty()) ss &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; lvl.me.size() &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;  }</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;  os &lt;&lt; ss.str();</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;}</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160; </div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;<span class="comment">// Find tree depth, assign ranks to non-leaf nodes, and init &#39;reserved&#39;.</span></div>
<div class="line"><a name="l02515"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#aec739810f3d854f37286d9f057eef65c"> 2515</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#aec739810f3d854f37286d9f057eef65c">init_tree</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; my_rank, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; node, <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; <span class="keywordtype">id</span>) {</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;  node-&gt;reserved = -1;</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> depth = 0;</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; node-&gt;nkids; ++i) {</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(node.get() == node-&gt;kids[i]-&gt;parent);</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    depth = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(depth, <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#aec739810f3d854f37286d9f057eef65c">init_tree</a>(my_rank, node-&gt;kids[i], <span class="keywordtype">id</span>));</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;  }</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;  <span class="keywordflow">if</span> (node-&gt;nkids) {</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <span class="keywordflow">if</span> (node-&gt;rank &lt; 0) node-&gt;rank = node-&gt;kids[0]-&gt;rank;</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    node-&gt;cellidx = <span class="keywordtype">id</span>++;</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(node-&gt;rank == my_rank &amp;&amp; (node-&gt;cellidx &lt; 0 || node-&gt;cellidx &gt;= <span class="keywordtype">id</span>),</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;                  <span class="stringliteral">&quot;cellidx is &quot;</span> &lt;&lt; node-&gt;cellidx &lt;&lt; <span class="stringliteral">&quot; but should be between &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;                  0 &lt;&lt; <span class="stringliteral">&quot; and &quot;</span> &lt;&lt; <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;  }</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;  <span class="keywordflow">return</span> depth + 1;</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;}</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160; </div>
<div class="line"><a name="l02533"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a341881488f4888139714451dacf13205"> 2533</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a341881488f4888139714451dacf13205">level_schedule_and_collect</a> (</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a>&amp; ns, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; my_rank, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; node, <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; level,</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;  <span class="keywordtype">bool</span>&amp; need_parent_ns_node)</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;{</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(node-&gt;rank != -1);</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;  level = -1;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;  <span class="keywordtype">bool</span> make_ns_node = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; node-&gt;nkids; ++i) {</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> kid_level;</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keywordtype">bool</span> kid_needs_ns_node;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;    <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a341881488f4888139714451dacf13205">level_schedule_and_collect</a>(ns, my_rank, node-&gt;kids[i], kid_level,</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;                               kid_needs_ns_node);</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    level = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(level, kid_level);</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    <span class="keywordflow">if</span> (kid_needs_ns_node) make_ns_node = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;  }</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;  ++level;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;  <span class="keywordflow">if</span> (node-&gt;level &gt;= 0) {</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;    <span class="comment">// The caller built only partial trees and so must provide the</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    <span class="comment">// level.</span></div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;    level = node-&gt;level;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(level &lt; <span class="keyword">static_cast&lt;</span><a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a><span class="keyword">&gt;</span>(ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.size()));</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;  }</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;  <span class="comment">// Is parent node needed for isend?</span></div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> node_is_owned = node-&gt;rank == my_rank;</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;  need_parent_ns_node = node_is_owned;</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <span class="keywordflow">if</span> (node_is_owned || make_ns_node) {</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(node-&gt;reserved == -1);</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> ns_node_idx = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad2f4f2e6a12a2a14af52bdeea6b0dd39">alloc</a>();</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    <span class="comment">// Levels hold only owned nodes.</span></div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    <span class="keywordflow">if</span> (node_is_owned) ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[level].nodes.push_back(ns_node_idx);</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    node-&gt;reserved = ns_node_idx;</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">NodeSets::Node</a>* ns_node = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(ns_node_idx);</div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    ns_node-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a> = node-&gt;rank;</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    <span class="keywordflow">if</span> (node-&gt;nkids == 0) ns_node-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a8fd5cc5c891fb77f704bb5c28926ea82">id</a> = node-&gt;cellidx;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="keywordflow">if</span> (node_is_owned) {</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      <span class="comment">// If this node is owned, it needs to have information about all kids.</span></div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      ns_node-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">nkids</a> = node-&gt;nkids;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; node-&gt;nkids; ++i) {</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; kid = node-&gt;kids[i];</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        <span class="keywordflow">if</span> (kid-&gt;reserved == -1) {</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;          <span class="comment">// This kid isn&#39;t owned by this rank. But need it for irecv.</span></div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> ns_kid_idx = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad2f4f2e6a12a2a14af52bdeea6b0dd39">alloc</a>();</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;          <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">NodeSets::Node</a>* ns_kid = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(ns_kid_idx);</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;          kid-&gt;reserved = ns_kid_idx;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;          ns_node = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(ns_node_idx);</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;          ns_node-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a62ddeb52897d22624365a25e4cad5662">kids</a>[i] = ns_kid_idx;</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;          <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(kid-&gt;rank != my_rank);</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;          ns_kid-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a> = kid-&gt;rank;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;          ns_kid-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a8fd5cc5c891fb77f704bb5c28926ea82">id</a> = kid-&gt;cellidx;</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;          <span class="comment">// The kid may have kids in the original tree, but in the tree pruned</span></div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;          <span class="comment">// according to rank, it does not.</span></div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;          ns_kid-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">nkids</a> = 0;</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;          <span class="comment">// This kid is owned by this rank, so fill in its parent pointer.</span></div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;          <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">NodeSets::Node</a>* ns_kid = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(kid-&gt;reserved);</div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;          ns_node = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(ns_node_idx);</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;          ns_node-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a62ddeb52897d22624365a25e4cad5662">kids</a>[i] = kid-&gt;reserved;</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;          ns_kid-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#aa22fc635907a421d3a7874ea6f09a43a">parent</a> = ns_node_idx;</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        }</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      }</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;      <span class="comment">// This node is not owned. Update the owned kids with its parent.</span></div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;      ns_node-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">nkids</a> = 0;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; node-&gt;nkids; ++i) {</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; kid = node-&gt;kids[i];</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        <span class="keywordflow">if</span> (kid-&gt;reserved &gt;= 0 &amp;&amp; kid-&gt;rank == my_rank) {</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> ns_kid_idx = kid-&gt;reserved;</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;          ns_node-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a62ddeb52897d22624365a25e4cad5662">kids</a>[ns_node-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">nkids</a>++] = ns_kid_idx;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;          <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">NodeSets::Node</a>* ns_kid = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(ns_kid_idx);</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;          ns_kid-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#aa22fc635907a421d3a7874ea6f09a43a">parent</a> = ns_node_idx;</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;        }</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;      }</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    }</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;  }</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;}</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160; </div>
<div class="line"><a name="l02609"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#ad3aee01b4cd6bc4808306ef938aebde6"> 2609</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a341881488f4888139714451dacf13205">level_schedule_and_collect</a> (<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a>&amp; ns, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; my_rank,</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree) {</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> iunused;</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;  <span class="keywordtype">bool</span> bunused;</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;  <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a341881488f4888139714451dacf13205">level_schedule_and_collect</a>(ns, my_rank, tree, iunused, bunused);</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;}</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160; </div>
<div class="line"><a name="l02616"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#ae964fe4c8b82233ab3d00631ce47c147"> 2616</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ae964fe4c8b82233ab3d00631ce47c147">consolidate</a> (<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a>&amp; ns) {</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;  <span class="keyword">auto</span> levels = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;  ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.clear();</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; level : levels)</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <span class="keywordflow">if</span> ( ! level.nodes.empty())</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.push_back(level);</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;}</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160; </div>
<div class="line"><a name="l02624"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a4c3d085892f315ae1f1f134413fc2edb"> 2624</a></span>&#160;<span class="keyword">typedef</span> std::pair&lt;Int, NodeSets::Node*&gt; <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a4c3d085892f315ae1f1f134413fc2edb">RankNode</a>;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160; </div>
<div class="line"><a name="l02626"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a2978e68a93684ed0847042c137b7a73e"> 2626</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a2978e68a93684ed0847042c137b7a73e">init_offsets</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> my_rank, std::vector&lt;RankNode&gt;&amp; rns,</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                   std::vector&lt;NodeSets::Level::MPIMetaData&gt;&amp; mmds, <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; offset) {</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  <span class="comment">// Set nodes on my rank to have rank -1 so that they sort first.</span></div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; rn : rns)</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="keywordflow">if</span> (rn.first == my_rank)</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      rn.first = -1;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160; </div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;  <span class="comment">// Sort so that all comms with a given rank are contiguous. Stable sort so</span></div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;  <span class="comment">// that rns retains its order, in particular in the leaf node level.</span></div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;  std::stable_sort(rns.begin(), rns.end());</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160; </div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="comment">// Collect nodes into groups by rank and set up comm metadata for each group.</span></div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> prev_rank = -1;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; rn : rns) {</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> rank = rn.first;</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    <span class="keywordflow">if</span> (rank == -1) {</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;      <span class="keywordflow">if</span> (rn.second-&gt;offset == -1)</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        rn.second-&gt;offset = offset++;</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;      <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;    }</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    <span class="keywordflow">if</span> (rank != prev_rank) {</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(rank &gt; prev_rank);</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;      prev_rank = rank;</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      mmds.push_back(<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html">NodeSets::Level::MPIMetaData</a>());</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      <span class="keyword">auto</span>&amp; mmd = mmds.back();</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      mmd.rank = rank;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;      mmd.offset = offset;</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;      mmd.size = 0;</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;    }</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;    ++mmds.back().size;</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    rn.second-&gt;offset = offset++;</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  }</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;}</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160; </div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;<span class="comment">// Set up comm data. Consolidate so that there is only one message between me</span></div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;<span class="comment">// and another rank per level. Determine an offset for each node, to be</span></div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;<span class="comment">// multiplied by data-size factors later, for use in data buffers.</span></div>
<div class="line"><a name="l02663"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a2af675dd004b8fdfc4b5534500d5716c"> 2663</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a2af675dd004b8fdfc4b5534500d5716c">init_comm</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> my_rank, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a>&amp; ns) {</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;  ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">nslots</a> = 0;</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; lvl : ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>) {</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nkids = 0;</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : lvl.nodes) {</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      nkids += n-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">nkids</a>;</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    }</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160; </div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    std::vector&lt;RankNode&gt; me(lvl.nodes.size()), kids(nkids);</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0, mi = 0, ki = 0; i &lt; lvl.nodes.size(); ++i) {</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(lvl.nodes[i]);</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;      me[mi].first = n-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#aa22fc635907a421d3a7874ea6f09a43a">parent</a> &gt;= 0 ? ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;parent)-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a> : my_rank;</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;      me[mi].second = <span class="keyword">const_cast&lt;</span><a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">NodeSets::Node</a>*<span class="keyword">&gt;</span>(n);</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;      ++mi;</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; n-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        kids[ki].first = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>])-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">rank</a>;</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        kids[ki].second = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>]);</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        ++ki;</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      }</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    }</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160; </div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;    <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a2978e68a93684ed0847042c137b7a73e">init_offsets</a>(my_rank, me, lvl.me, ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">nslots</a>);</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    lvl.me_send_req.resize(lvl.me.size());</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;    lvl.me_recv_req.resize(lvl.me.size());</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;    <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a2978e68a93684ed0847042c137b7a73e">init_offsets</a>(my_rank, kids, lvl.kids, ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">nslots</a>);</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    lvl.kids_req.resize(lvl.kids.size());</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  }</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;}</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160; </div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment">// Analyze the tree to extract levels. Levels are run from 0 to #level - 1. Each</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">// level has nodes whose corresponding operations depend on only nodes in</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="comment">// lower-indexed levels. This mechanism prevents deadlock in the general case of</span></div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="comment">// multiple cells per rank, with multiple ranks appearing in a subtree other</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="comment">// than the root.</span></div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="comment">//   In addition, the set of nodes collected into levels are just those owned by</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="comment">// this rank, and those with which owned nodes must communicate.</span></div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;<span class="comment">//   Once this function is done, the tree can be deleted.</span></div>
<div class="line"><a name="l02701"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#ac46929bd66312874d443dd21155f8019"> 2701</a></span>&#160;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a80c73a0bd8c3eedb2c7206008d398369">NodeSets::ConstPtr</a> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ac46929bd66312874d443dd21155f8019">analyze</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells,</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;                            <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree) {</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nodesets = std::make_shared&lt;NodeSets&gt;();</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>( ! tree-&gt;parent);</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <span class="keywordtype">id</span> = ncells;</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> depth = <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#aec739810f3d854f37286d9f057eef65c">init_tree</a>(p-&gt;rank(), tree, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;  <span class="keywordflow">if</span> (tree-&gt;level &gt;= 0) {</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    <span class="comment">// If level is provided, don&#39;t trust depth from init_tree. Partial trees can</span></div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <span class="comment">// make depth too small.</span></div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    depth = tree-&gt;level + 1;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  }</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  nodesets-&gt;levels.resize(depth);</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a341881488f4888139714451dacf13205">level_schedule_and_collect</a>(*nodesets, p-&gt;rank(), tree);</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;  <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ae964fe4c8b82233ab3d00631ce47c147">consolidate</a>(*nodesets);</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;  <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a2af675dd004b8fdfc4b5534500d5716c">init_comm</a>(p-&gt;rank(), *nodesets);</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  <span class="keywordflow">return</span> nodesets;</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;}</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160; </div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="comment">// Check that the offsets are self consistent.</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#aefef0e8c4df812514c90416f481c5e8b"> 2720</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#aefef0e8c4df812514c90416f481c5e8b">check_comm</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a>&amp; ns) {</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  std::vector&lt;Int&gt; offsets(ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">nslots</a>, 0);</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; lvl : ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>)</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : lvl.nodes) {</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;offset &lt; ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">nslots</a>);</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      ++offsets[n-&gt;offset];</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n-&gt;nkids; ++i) {</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> kid = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;kids[i]);</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        <span class="keywordflow">if</span> (kid-&gt;rank != n-&gt;rank)</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;          ++offsets[kid-&gt;offset];</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      }</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    }</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; e : offsets)</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    <span class="keywordflow">if</span> (e != 1) ++nerr;</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;}</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160; </div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="comment">// Check that there are the correct number of leaf nodes, and that their offsets</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="comment">// all come first and are ordered the same as ns-&gt;levels[0]-&gt;nodes.</span></div>
<div class="line"><a name="l02741"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a34248cb5c089cabdf20318ff1eb794e2"> 2741</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a34248cb5c089cabdf20318ff1eb794e2">check_leaf_nodes</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a>&amp; ns,</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;                      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ncells) {</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>( ! ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.empty());</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>( ! ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[0].nodes.empty());</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> my_nleaves = 0;</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[0].nodes) {</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>( ! n-&gt;nkids);</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    ++my_nleaves;</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;  }</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[0].nodes) {</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;offset &lt; my_nleaves);</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;id &lt; ncells);</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;  }</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> glbl_nleaves = 0;</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;  <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">mpi::all_reduce</a>(*p, &amp;my_nleaves, &amp;glbl_nleaves, 1, MPI_SUM);</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;  <span class="keywordflow">if</span> (glbl_nleaves != ncells)</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    ++nerr;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;}</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160; </div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="comment">// Sum cellidx using the QLT comm pattern.</span></div>
<div class="line"><a name="l02765"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a84f6c0cb8e8bd600979400cb5cfe0b29"> 2765</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a84f6c0cb8e8bd600979400cb5cfe0b29">test_comm_pattern</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">NodeSets</a>&amp; ns,</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;                       <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ncells) {</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;  <span class="comment">// Rank-wide data buffer.</span></div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;  std::vector&lt;Int&gt; data(ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">nslots</a>);</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;  <span class="comment">// Sum this rank&#39;s cellidxs.</span></div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[0].nodes) {</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;    data[n-&gt;offset] = n-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a8fd5cc5c891fb77f704bb5c28926ea82">id</a>;</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;  }</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;  <span class="comment">// Leaves to root.</span></div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> il = 0; il &lt; ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.size(); ++il) {</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="keyword">auto</span>&amp; lvl = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[il];</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="comment">// Set up receives.</span></div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.kids.size(); ++i) {</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.kids[i];</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;      <a class="code" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">mpi::irecv</a>(*p, &amp;data[mmd.offset], mmd.size, mmd.rank, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ae6835ea8185bc6ea84ead71203869fbca308a0ac1e8070200a48c6b84239bb60a">NodeSets::mpitag</a>,</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;                 &amp;lvl.kids_req[i]);</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    }</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">mpi::waitall</a>(lvl.kids_req.size(), lvl.kids_req.data());</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    <span class="comment">// Combine kids&#39; data.</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : lvl.nodes) {</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;      <span class="keywordflow">if</span> ( ! n-&gt;nkids) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;      data[n-&gt;offset] = 0;</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n-&gt;nkids; ++i)</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        data[n-&gt;offset] += data[ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;kids[i])-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>];</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    }</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    <span class="comment">// Send to parents.</span></div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.me.size(); ++i) {</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.me[i];</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      <a class="code" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">mpi::isend</a>(*p, &amp;data[mmd.offset], mmd.size, mmd.rank, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ae6835ea8185bc6ea84ead71203869fbca308a0ac1e8070200a48c6b84239bb60a">NodeSets::mpitag</a>);</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    }</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;  }</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;  <span class="comment">// Root to leaves.</span></div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> il = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.size(); il &gt; 0; --il) {</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <span class="keyword">auto</span>&amp; lvl = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[il-1];</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="comment">// Get the global sum from parent.</span></div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.me.size(); ++i) {</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.me[i];</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;      <a class="code" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">mpi::irecv</a>(*p, &amp;data[mmd.offset], mmd.size, mmd.rank, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ae6835ea8185bc6ea84ead71203869fbca308a0ac1e8070200a48c6b84239bb60a">NodeSets::mpitag</a>,</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;                 &amp;lvl.me_recv_req[i]);</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    }    </div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">mpi::waitall</a>(lvl.me_recv_req.size(), lvl.me_recv_req.data());</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    <span class="comment">// Pass to kids.</span></div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : lvl.nodes) {</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      <span class="keywordflow">if</span> ( ! n-&gt;nkids) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n-&gt;nkids; ++i)</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        data[ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(n-&gt;kids[i])-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>] = data[n-&gt;offset];</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;    }</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="comment">// Send.</span></div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.kids.size(); ++i) {</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a62ddeb52897d22624365a25e4cad5662">kids</a>[i];</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;      <a class="code" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">mpi::isend</a>(*p, &amp;data[mmd.offset], mmd.size, mmd.rank, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ae6835ea8185bc6ea84ead71203869fbca308a0ac1e8070200a48c6b84239bb60a">NodeSets::mpitag</a>);</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    }</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;  }</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;  { <span class="comment">// Check that all leaf nodes have the right number.</span></div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> desired_sum = (ncells*(ncells - 1)) / 2;</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[0].nodes) {</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(idx);</div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;      <span class="keywordflow">if</span> (data[n-&gt;offset] != desired_sum) ++nerr;</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    }</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    <span class="keywordflow">if</span> (<span class="keyword">false</span> &amp;&amp; p-&gt;amroot()) {</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; data[ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[0].nodes[0])-&gt;<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>];</div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;      std::cout.flush();</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    }</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;  }</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;}</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160; </div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;<span class="comment">// Unit tests for NodeSets.</span></div>
<div class="line"><a name="l02837"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1impl.html#a5e38a1906b866bc8943b7052fb961574"> 2837</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a5e38a1906b866bc8943b7052fb961574">unittest</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a80c73a0bd8c3eedb2c7206008d398369">NodeSets::ConstPtr</a>&amp; ns,</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;              <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ncells) {</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0, <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;  <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#aefef0e8c4df812514c90416f481c5e8b">check_comm</a>(*ns);</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> &amp;&amp; p-&gt;amroot()) <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;check_comm failed&quot;</span>);</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;  nerr += <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;  <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a34248cb5c089cabdf20318ff1eb794e2">check_leaf_nodes</a>(p, *ns, ncells);</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> &amp;&amp; p-&gt;amroot()) <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;check_leaf_nodes failed&quot;</span>);</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;  nerr += <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> trial = 0; trial &lt; 11; ++trial) {</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;    <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a84f6c0cb8e8bd600979400cb5cfe0b29">test_comm_pattern</a>(p, *ns, ncells);</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> &amp;&amp; p-&gt;amroot()) <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;test_comm_pattern failed for trial&quot;</span> <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(trial));</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    nerr += <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;  }</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;}</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;} <span class="comment">// namespace impl</span></div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160; </div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02856"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6"> 2856</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6">QLT&lt;ES&gt;::init</a> (<span class="keyword">const</span> std::string&amp; name, <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a055eac02ef22081e738e735fa68578d1">IntList</a>&amp; d,</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;                    <span class="keyword">typename</span> IntList::HostMirror&amp; h, <span class="keywordtype">size_t</span> n) {</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;  d = <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a055eac02ef22081e738e735fa68578d1">IntList</a>(<span class="stringliteral">&quot;QLT &quot;</span> + name, n);</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;  h = Kokkos::create_mirror_view(d);</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;}</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160; </div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;<span class="keywordtype">int</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::MetaData::get_problem_type_idx</a> (<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; mask) {</div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;  <span class="keywordflow">switch</span> (mask) {</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;  <span class="keywordflow">case</span> CPT::s:   <span class="keywordflow">case</span> CPT::st:  <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;  <span class="keywordflow">case</span> CPT::cs:  <span class="keywordflow">case</span> CPT::cst: <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;  <span class="keywordflow">case</span> CPT::t:   <span class="keywordflow">return</span> 2;</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;  <span class="keywordflow">case</span> CPT::ct:  <span class="keywordflow">return</span> 3;</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;  <span class="keywordflow">case</span> CPT::nn:  <span class="keywordflow">return</span> 4;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;  <span class="keywordflow">case</span> CPT::cnn: <span class="keywordflow">return</span> 5;</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;  <span class="keywordflow">default</span>: <a class="code" href="compose__cedr_8cpp.html#a69e47429f12cecc8d0019d3611431ef1">cedr_kernel_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;Invalid problem type.&quot;</span>); <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;  }</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;}</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160; </div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="keywordtype">int</span> QLT&lt;ES&gt;::MetaData::get_problem_type_r2l_bulk_size (<span class="keyword">const</span> <span class="keywordtype">int</span>&amp; mask) {</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;  <span class="keywordflow">if</span> (mask &amp; ProblemType::shapepreserve) <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;  <span class="keywordflow">return</span> 3;</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;}</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160; </div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">QLT&lt;ES&gt;::MetaData::init</a> (<span class="keyword">const</span> MetaDataBuilder&amp; mdb) {</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ntracers = mdb.trcr2prob.size();</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160; </div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;  <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">Me::init</a>(<span class="stringliteral">&quot;trcr2prob&quot;</span>, a_d_.trcr2prob, a_h_.trcr2prob, ntracers);</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;  std::copy(mdb.trcr2prob.begin(), mdb.trcr2prob.end(), a_h_.trcr2prob.data());</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;  Kokkos::deep_copy(a_d_.trcr2prob, a_h_.trcr2prob);</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160; </div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;  <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">Me::init</a>(<span class="stringliteral">&quot;bidx2trcr&quot;</span>, a_d_.bidx2trcr, a_h_.bidx2trcr, ntracers);</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;  <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">Me::init</a>(<span class="stringliteral">&quot;trcr2bl2r&quot;</span>, a_d_.trcr2bl2r, a_h_.trcr2bl2r, ntracers);</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;  <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">Me::init</a>(<span class="stringliteral">&quot;trcr2br2l&quot;</span>, a_d_.trcr2br2l, a_h_.trcr2br2l, ntracers);</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;  a_h_.prob2trcrptr[0] = 0;</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  a_h_.prob2bl2r[0] = 1; <span class="comment">// rho is at 0.</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;  a_h_.prob2br2l[0] = 0;</div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a> = 0; <a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a> &lt; nprobtypes; ++<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>) {</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;    a_h_.prob2trcrptr[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>+1] = a_h_.prob2trcrptr[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>];</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> l2rbulksz = get_problem_type_l2r_bulk_size(get_problem_type(<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>));</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> r2lbulksz = get_problem_type_r2l_bulk_size(get_problem_type(<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>));</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ti = 0; ti &lt; ntracers; ++ti) {</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> problem_type = a_h_.trcr2prob[ti];</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      <span class="keywordflow">if</span> (problem_type != get_problem_type(<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>)) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> tcnt = a_h_.prob2trcrptr[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>+1] - a_h_.prob2trcrptr[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>];</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      a_h_.trcr2bl2r[ti] = a_h_.prob2bl2r[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>] + tcnt*l2rbulksz;</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      a_h_.trcr2br2l[ti] = a_h_.prob2br2l[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>] + tcnt*r2lbulksz;</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      a_h_.bidx2trcr[a_h_.prob2trcrptr[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>+1]++] = ti;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    }</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ni = a_h_.prob2trcrptr[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>+1] - a_h_.prob2trcrptr[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>];</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;    a_h_.prob2bl2r[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>+1] = a_h_.prob2bl2r[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>] + ni*l2rbulksz;</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    a_h_.prob2br2l[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>+1] = a_h_.prob2br2l[<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>] + ni*r2lbulksz;</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;  }</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;  Kokkos::deep_copy(a_d_.bidx2trcr, a_h_.bidx2trcr);</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;  Kokkos::deep_copy(a_d_.trcr2bl2r, a_h_.trcr2bl2r);</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;  Kokkos::deep_copy(a_d_.trcr2br2l, a_h_.trcr2br2l);</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160; </div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;  <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">Me::init</a>(<span class="stringliteral">&quot;trcr2bidx&quot;</span>, a_d_.trcr2bidx, a_h_.trcr2bidx, ntracers);</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ti = 0; ti &lt; ntracers; ++ti)</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;    a_h_.trcr2bidx(a_h_.bidx2trcr(ti)) = ti;</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;  Kokkos::deep_copy(a_d_.trcr2bidx, a_h_.trcr2bidx);</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160; </div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;  a_h = a_h_;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160; </div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;  <span class="comment">// Won&#39;t default construct Unmanaged, so have to do pointer stuff and raw</span></div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;  <span class="comment">// array copy explicitly.</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;  a_d.trcr2prob = a_d_.trcr2prob;</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;  a_d.bidx2trcr = a_d_.bidx2trcr;</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;  a_d.trcr2bidx = a_d_.trcr2bidx;</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;  a_d.trcr2bl2r = a_d_.trcr2bl2r;</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;  a_d.trcr2br2l = a_d_.trcr2br2l;</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;  std::copy(a_h_.prob2trcrptr, a_h_.prob2trcrptr + nprobtypes + 1,</div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;            a_d.prob2trcrptr);</div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;  std::copy(a_h_.prob2bl2r, a_h_.prob2bl2r + nprobtypes + 1, a_d.prob2bl2r);</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;  std::copy(a_h_.prob2br2l, a_h_.prob2br2l + nprobtypes + 1, a_d.prob2br2l);</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(a_d.prob2trcrptr[nprobtypes] == ntracers);</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;}</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160; </div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">QLT&lt;ES&gt;::BulkData::init</a> (<span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; l2r_sz, <span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; r2l_sz) {</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;  l2r_data_ = RealList(<span class="stringliteral">&quot;QLT l2r_data&quot;</span>, l2r_sz);</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;  r2l_data_ = RealList(<span class="stringliteral">&quot;QLT r2l_data&quot;</span>, r2l_sz);</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;  l2r_data = l2r_data_;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;  r2l_data = r2l_data_;</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;  inited_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;}</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160; </div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">QLT&lt;ES&gt;::BulkData::init</a> (<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf1, <span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; l2r_sz,</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;                              <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf2, <span class="keyword">const</span> <span class="keywordtype">size_t</span>&amp; r2l_sz) {</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;  l2r_data_ = RealList(buf1, l2r_sz);</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;  r2l_data_ = RealList(buf2, r2l_sz);</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;  l2r_data = l2r_data_;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;  r2l_data = r2l_data_;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;  inited_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;}</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160; </div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02956"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt.html#a1f3514319e5f8eca070482f5295b599d"> 2956</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt.html#a1f3514319e5f8eca070482f5295b599d">init_device_data</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">impl::NodeSets</a>&amp; ns, <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html">impl::NodeSetsHostData</a>&amp; h,</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;                       <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html">impl::NodeSetsDeviceData&lt;ES&gt;</a>&amp; d) {</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html">impl::NodeSetsDeviceData&lt;ES&gt;</a> NSDD;</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;  d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">node</a> = <span class="keyword">typename</span> NSDD::NodeList(<span class="stringliteral">&quot;NSDD::node&quot;</span>, ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#aee6389fbf05b013dff31e396d2548c5e">nnode</a>());</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;  h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">node</a> = Kokkos::create_mirror_view(d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">node</a>);</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;  d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a> = <span class="keyword">typename</span> NSDD::IntList(<span class="stringliteral">&quot;NSDD::lvlptr&quot;</span>, ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.size() + 1);</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;  h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a> = Kokkos::create_mirror_view(d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>);</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nnode = 0;</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; lvl : ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>)</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    nnode += lvl.nodes.size();</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;  d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">lvl</a> = <span class="keyword">typename</span> NSDD::IntList(<span class="stringliteral">&quot;NSDD::lvl&quot;</span>, nnode);</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;  h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">lvl</a> = Kokkos::create_mirror_view(d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">lvl</a>);</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;  h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>(0) = 0;</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> il = 0; il &lt; ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>.size(); ++il) {</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; level = ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">levels</a>[il];</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>(il+1) = h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>(il) + level.nodes.size();</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> os = h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>(il), i = 0; i &lt; h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>(il+1) - os; ++i)</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;      h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">lvl</a>(os+i) = level.nodes[i];</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    nnode += level.nodes.size();</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;  }</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#aee6389fbf05b013dff31e396d2548c5e">nnode</a>(); ++i)</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;    h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">node</a>(i) = *ns.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">node_h</a>(i);</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;  Kokkos::deep_copy(d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">node</a>, h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">node</a>);</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;  Kokkos::deep_copy(d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">lvl</a>, h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">lvl</a>);</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;  Kokkos::deep_copy(d.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>, h.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">lvlptr</a>);</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;}</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160; </div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02984"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a4bce582840cb58a4ce70fbd740cbfacf"> 2984</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">QLT&lt;ES&gt;::init</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells,</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;                    <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree) {</div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;  p_ = p;</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;  Timer::start(<a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ac46929bd66312874d443dd21155f8019">Timer::analyze</a>);</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;  ns_ = <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ac46929bd66312874d443dd21155f8019">impl::analyze</a>(p, ncells, tree);</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;  nshd_ = std::make_shared&lt;impl::NodeSetsHostData&gt;();</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;  nsdd_ = std::make_shared&lt;impl::NodeSetsDeviceData&lt;ES&gt; &gt;();</div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;  <a class="code" href="namespacecedr_1_1qlt.html#a1f3514319e5f8eca070482f5295b599d">init_device_data</a>(*ns_, *nshd_, *nsdd_);</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;  init_ordinals();</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;  Timer::stop(<a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ac46929bd66312874d443dd21155f8019">Timer::analyze</a>);</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;  mdb_ = std::make_shared&lt;MetaDataBuilder&gt;();</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;}</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160; </div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l02998"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a1a8a3cf478360277dc875eef4b4250d7"> 2998</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::init_ordinals</a> () {</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;  gci2lci_ = std::make_shared&lt;Gci2LciMap&gt;();</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : ns_-&gt;levels[0].nodes) {</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> n = ns_-&gt;node_h(idx);</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    (*gci2lci_)[n-&gt;id] = n-&gt;offset;</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;  }</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;}</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160; </div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03007"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a9018bfb30d655cb813ffd035498d4b52"> 3007</a></span>&#160;<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::QLT</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree,</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;              <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">Options</a> options)</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;  : <a class="code" href="structcedr_1_1_c_d_r.html">CDR</a>(options)</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;{</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;  <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6">init</a>(p, ncells, tree);</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ae887c2546eb47eafdeb8e58fe6a1e288">nlclcells</a>() == 0, <span class="stringliteral">&quot;QLT does not support 0 cells on a rank.&quot;</span>);</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;}</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160; </div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03016"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a8318d3741486e1e54865d2c3d8133653"> 3016</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a8318d3741486e1e54865d2c3d8133653">QLT&lt;ES&gt;::print</a> (std::ostream&amp; os)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;  ns_-&gt;print(os);</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;}</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160; </div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;<span class="comment">// Number of cells owned by this rank.</span></div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03022"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ae887c2546eb47eafdeb8e58fe6a1e288"> 3022</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::nlclcells</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> ns_-&gt;levels[0].nodes.size(); }</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160; </div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="comment">// Cells owned by this rank, in order of local numbering. Thus,</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;<span class="comment">// gci2lci(gcis[i]) == i. Ideally, the caller never actually calls gci2lci(),</span></div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;<span class="comment">// and instead uses the information from get_owned_glblcells to determine</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;<span class="comment">// local cell indices.</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03029"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a1ee460e97c8285bebfbbd17af959564b"> 3029</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::get_owned_glblcells</a> (std::vector&lt;Long&gt;&amp; gcis)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;  gcis.resize(ns_-&gt;levels[0].nodes.size());</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; idx : ns_-&gt;levels[0].nodes) {</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> n = ns_-&gt;node_h(idx);</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    gcis[n-&gt;offset] = n-&gt;id;</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;  }</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;}</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160; </div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;<span class="comment">// For global cell index cellidx, i.e., the globally unique ordinal associated</span></div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;<span class="comment">// with a cell in the caller&#39;s tree, return this rank&#39;s local index for</span></div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;<span class="comment">// it. This is not an efficient operation.</span></div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03041"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#aa9b83575295958b3ecc89e6ef81d8df4"> 3041</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::gci2lci</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; gci)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> it = gci2lci_-&gt;find(gci);</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;  <span class="keywordflow">if</span> (it == gci2lci_-&gt;end()) {</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(gci));</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    std::vector&lt;Long&gt; gcis;</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    get_owned_glblcells(gcis);</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a7c3c704df71e1a19ad95990aa8120aa0">mprarr</a>(gcis);</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;  }</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(it == gci2lci_-&gt;end(), <span class="stringliteral">&quot;gci &quot;</span> &lt;&lt; gci &lt;&lt; <span class="stringliteral">&quot; not in gci2lci map.&quot;</span>);</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;  <span class="keywordflow">return</span> it-&gt;second;</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;}</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160; </div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03054"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a3267afdf17e6a873b9267087ab1b2d3e"> 3054</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::declare_tracer</a> (<span class="keywordtype">int</span> problem_type, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx) {</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>( ! mdb_, <span class="stringliteral">&quot;end_tracer_declarations was already called; &quot;</span></div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;                 <span class="stringliteral">&quot;it is an error to call declare_tracer now.&quot;</span>);</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(rhomidx &gt; 0, <span class="stringliteral">&quot;rhomidx &gt; 0 is not supported yet.&quot;</span>);</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;  <span class="comment">// For its exception side effect, and to get canonical problem type, since</span></div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;  <span class="comment">// some possible problem types map to the same canonical one:</span></div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;  problem_type = md_.get_problem_type(md_.get_problem_type_idx(problem_type));</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;  mdb_-&gt;trcr2prob.push_back(problem_type);</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;}</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160; </div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03065"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a9cbe7b87776dcf8ab9c5c56e5685d974"> 3065</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::end_tracer_declarations</a> () {</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;  md_.<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6">init</a>(*mdb_);</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;  mdb_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;}</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160; </div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03071"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ab3021096085b1400b07e0d39fe6f9ae7"> 3071</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::get_buffers_sizes</a> (<span class="keywordtype">size_t</span>&amp; buf1, <span class="keywordtype">size_t</span>&amp; buf2) {</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nslots = ns_-&gt;nslots;</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;  buf1 = md_.<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ad4f52d10cdefba976a000b5f0a186a95">a_h</a>.<a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a82c1ec992eb8eacbf40cd36fb3597a7c">prob2bl2r</a>[md_.nprobtypes]*nslots;</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;  buf2 = md_.a_h.prob2br2l[md_.nprobtypes]*nslots;</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;}</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160; </div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03078"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a8855469fbf2739b8b3b9c94ede02eb67"> 3078</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::set_buffers</a> (<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf1, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf2) {</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;  <span class="keywordtype">size_t</span> l2r_sz, r2l_sz;</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;  get_buffers_sizes(l2r_sz, r2l_sz);</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;  bd_.init(buf1, l2r_sz, buf2, r2l_sz);</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;}</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160; </div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03085"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ad85d32b7277b27a39d6bda5e605daac7"> 3085</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::finish_setup</a> () {</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;  <span class="keywordflow">if</span> (bd_.inited()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;  <span class="keywordtype">size_t</span> l2r_sz, r2l_sz;</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;  get_buffers_sizes(l2r_sz, r2l_sz);</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;  bd_.init(l2r_sz, r2l_sz);</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;}</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160; </div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03093"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ad9c51a9177892aa04c600773abe6ac11"> 3093</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::get_problem_type</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(tracer_idx &lt; 0 || tracer_idx &gt; md_.a_h.trcr2prob.extent_int(0),</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;                <span class="stringliteral">&quot;tracer_idx is out of bounds: &quot;</span> &lt;&lt; tracer_idx);</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;  <span class="keywordflow">return</span> md_.a_h.trcr2prob[tracer_idx];</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;}</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160; </div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03100"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#ac09df17ae7c38e04f41dcb5700092c0c"> 3100</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;::get_num_tracers</a> ()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;  <span class="keywordflow">return</span> md_.<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#ad4f52d10cdefba976a000b5f0a186a95">a_h</a>.<a class="code" href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad2714cc0919e9e0a1f5cf8baa540642f">trcr2prob</a>.size();</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;}</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160; </div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;</a></div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">::l2r_recv</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">impl::NodeSets::Level</a>&amp; lvl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>.size(); ++i) {</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>[i];</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">mpi::irecv</a>(*p_, bd_.l2r_data.data() + mmd.offset*l2rndps, mmd.size*l2rndps,</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;               mmd.rank, impl::NodeSets::mpitag, &amp;lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">kids_req</a>[i]);</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;  }</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;  Timer::start(<a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">Timer::waitall</a>);</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;  <a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">mpi::waitall</a>(lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">kids_req</a>.size(), lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">kids_req</a>.data());</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;  Timer::stop(<a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">Timer::waitall</a>);</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;}</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160; </div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; <span class="keywordtype">void</span> QLT&lt;ES&gt;</div>
<div class="line"><a name="l03117"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a0c1a4d9fd58ff961f01578a04a15e02e"> 3117</a></span>&#160;::l2r_combine_kid_data (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lvlidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structcedr_1_1impl_1_1_on_gpu.html">cedr::impl::OnGpu&lt;ES&gt;::value</a>) {</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> d = *nsdd_;</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> l2r_data = bd_.l2r_data;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> = md_.a_d;</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ntracer = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2prob.size();</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nfield = ntracer + 1;</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> lvl_os = nshd_-&gt;lvlptr(lvlidx);</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> N = nfield*(nshd_-&gt;lvlptr(lvlidx+1) - lvl_os);</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> combine_kid_data = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> il = lvl_os + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> / nfield;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> fi = <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> % nfield;</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> node_idx = d.lvl(il);</div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; n = d.node(node_idx);</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      <span class="keywordflow">if</span> ( ! n.nkids) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(n.nkids == 2);</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;      <span class="keywordflow">if</span> (fi == 0) {</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;        <span class="comment">// Total density.</span></div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;        l2r_data(n.offset*l2rndps) =</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;          (l2r_data(d.node(n.kids[0]).offset*l2rndps) +</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;           l2r_data(d.node(n.kids[1]).offset*l2rndps));</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;        <span class="comment">// Tracers. Order by bulk index for efficiency of memory access.</span></div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bi = fi - 1; <span class="comment">// bulk index</span></div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ti = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.bidx2trcr(bi); <span class="comment">// tracer (user) index</span></div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> problem_type = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2prob(ti);</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> nonnegative = problem_type &amp; ProblemType::nonnegative;</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> shapepreserve = problem_type &amp; ProblemType::shapepreserve;</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> conserve = problem_type &amp; ProblemType::conserve;</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bdi = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2bl2r(ti);</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;        <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> me = &amp;l2r_data(n.offset*l2rndps + bdi);</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; kid0 = d.node(n.kids[0]);</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; kid1 = d.node(n.kids[1]);</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> k0 = &amp;l2r_data(kid0.offset*l2rndps + bdi);</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> k1 = &amp;l2r_data(kid1.offset*l2rndps + bdi);</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;        <span class="keywordflow">if</span> (nonnegative) {</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;          me[0] = k0[0] + k1[0];</div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;          <span class="keywordflow">if</span> (conserve) me[1] = k0[1] + k1[1];</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;          me[0] = shapepreserve ? k0[0] + k1[0] : <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(k0[0], k1[0]);</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;          me[1] = k0[1] + k1[1];</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;          me[2] = shapepreserve ? k0[2] + k1[2] : <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(k0[2], k1[2]);</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;          <span class="keywordflow">if</span> (conserve) me[3] = k0[3] + k1[3] ;</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        }</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;      }</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    };</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    Kokkos::parallel_for(Kokkos::RangePolicy&lt;ES&gt;(0, N), combine_kid_data);</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    Kokkos::fence();</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; lvl = ns_-&gt;levels[lvlidx];</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n_lvl_nodes = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>.size();</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_OPENMP</span></div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;<span class="preprocessor">#   pragma omp parallel for</span></div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ni = 0; ni &lt; n_lvl_nodes; ++ni) {</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> lvlidx = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>[ni];</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = ns_-&gt;node_h(lvlidx);</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;      <span class="keywordflow">if</span> ( ! n-&gt;nkids) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;nkids == 2);</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;      <span class="comment">// Total density.</span></div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;      bd_.l2r_data(n-&gt;offset*l2rndps) =</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;        (bd_.l2r_data(ns_-&gt;node_h(n-&gt;kids[0])-&gt;offset*l2rndps) +</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;         bd_.l2r_data(ns_-&gt;node_h(n-&gt;kids[1])-&gt;offset*l2rndps));</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;      <span class="comment">// Tracers.</span></div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> pti = 0; pti &lt; md_.nprobtypes; ++pti) {</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> problem_type = md_.get_problem_type(pti);</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> nonnegative = problem_type &amp; ProblemType::nonnegative;</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> shapepreserve = problem_type &amp; ProblemType::shapepreserve;</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> conserve = problem_type &amp; ProblemType::conserve;</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bis = md_.a_d.prob2trcrptr[pti], bie = md_.a_d.prob2trcrptr[pti+1];</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bi = bis; bi &lt; bie; ++bi) {</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bdi = md_.a_d.trcr2bl2r(md_.a_d.bidx2trcr(bi));</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;          <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> me = &amp;bd_.l2r_data(n-&gt;offset*l2rndps + bdi);</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> kid0 = ns_-&gt;node_h(n-&gt;kids[0]);</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> kid1 = ns_-&gt;node_h(n-&gt;kids[1]);</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> k0 = &amp;bd_.l2r_data(kid0-&gt;offset*l2rndps + bdi);</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> k1 = &amp;bd_.l2r_data(kid1-&gt;offset*l2rndps + bdi);</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;          <span class="keywordflow">if</span> (nonnegative) {</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;            me[0] = k0[0] + k1[0];</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;            <span class="keywordflow">if</span> (conserve) me[1] = k0[1] + k1[1];</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;            me[0] = shapepreserve ? k0[0] + k1[0] : <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(k0[0], k1[0]);</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;            me[1] = k0[1] + k1[1];</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;            me[2] = shapepreserve ? k0[2] + k1[2] : <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(k0[2], k1[2]);</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;            <span class="keywordflow">if</span> (conserve) me[3] = k0[3] + k1[3] ;</div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;          }</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;        }</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;      }</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    }</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;  }</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;}</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160; </div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;</a></div>
<div class="line"><a name="l03210"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#adbfb99b85e927e80b9f1a6fb69f76047"> 3210</a></span>&#160;<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">::l2r_send_to_parents</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">impl::NodeSets::Level</a>&amp; lvl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>.size(); ++i) {</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>[i];</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">mpi::isend</a>(*p_, bd_.l2r_data.data() + mmd.offset*l2rndps, mmd.size*l2rndps,</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;               mmd.rank, impl::NodeSets::mpitag);</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;  }  </div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;}</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160; </div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;</a></div>
<div class="line"><a name="l03219"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a5273c47c902c24b4f2a0741f27956120"> 3219</a></span>&#160;<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">::root_compute</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;  <span class="keywordflow">if</span> (ns_-&gt;levels.empty() || ns_-&gt;levels.back().nodes.size() != 1 ||</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;      ns_-&gt;node_h(ns_-&gt;levels.back().nodes[0])-&gt;parent &gt;= 0)</div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> d = *nsdd_;</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> l2r_data = bd_.l2r_data;</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> r2l_data = bd_.r2l_data;</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> = md_.a_d;</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> = nshd_-&gt;lvlptr.size() - 1;</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> node_idx = nshd_-&gt;lvl(nshd_-&gt;lvlptr(<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>-1));</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ntracer = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2prob.size();</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> compute = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; bi) {</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; n = d.node(node_idx);</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ti = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.bidx2trcr(bi);</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> problem_type = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2prob(ti);</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> l2rbdi = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2bl2r(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.bidx2trcr(bi));</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> r2lbdi = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2br2l(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.bidx2trcr(bi));</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    <span class="comment">// If QLT is enforcing global mass conservation, set root&#39;s r2l Qm value to</span></div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    <span class="comment">// the l2r Qm_prev&#39;s sum; otherwise, copy the l2r Qm value to the r2l one.</span></div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> os = (problem_type &amp; ProblemType::conserve ?</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;                    md_.get_problem_type_l2r_bulk_size(problem_type) - 1 :</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;                    (problem_type &amp; ProblemType::nonnegative ? 0 : 1));</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    r2l_data(n.offset*r2lndps + r2lbdi) = l2r_data(n.offset*l2rndps + l2rbdi + os);</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    <span class="keywordflow">if</span> ((problem_type &amp; ProblemType::consistent) &amp;&amp;</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;        ! (problem_type &amp; ProblemType::shapepreserve)) {</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;      <span class="comment">// Consistent but not shape preserving, so we&#39;re solving a dynamic range</span></div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;      <span class="comment">// preservation problem. We now know the global q_{min,max}. Start</span></div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;      <span class="comment">// propagating it leafward.</span></div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;      r2l_data(n.offset*r2lndps + r2lbdi + 1) = l2r_data(n.offset*l2rndps + l2rbdi + 0);</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;      r2l_data(n.offset*r2lndps + r2lbdi + 2) = l2r_data(n.offset*l2rndps + l2rbdi + 2);</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    }</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;  };</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;  Kokkos::parallel_for(Kokkos::RangePolicy&lt;ES&gt;(0, ntracer), compute);</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;  Kokkos::fence();</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;}</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160; </div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;</a></div>
<div class="line"><a name="l03256"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a4ed32b7c9d2c3f2889b89dcc01c452fe"> 3256</a></span>&#160;<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">::r2l_recv</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">impl::NodeSets::Level</a>&amp; lvl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>.size(); ++i) {</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>[i];</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">mpi::irecv</a>(*p_, bd_.r2l_data.data() + mmd.offset*r2lndps, mmd.size*r2lndps,</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;               mmd.rank, impl::NodeSets::mpitag, &amp;lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a1958b88c6ac291db0d61b9097a4a0594">me_recv_req</a>[i]);</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;  }</div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;  Timer::start(<a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">Timer::waitall</a>);</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;  <a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">mpi::waitall</a>(lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a1958b88c6ac291db0d61b9097a4a0594">me_recv_req</a>.size(), lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a1958b88c6ac291db0d61b9097a4a0594">me_recv_req</a>.data());</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;  Timer::stop(<a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">Timer::waitall</a>);</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;}</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160; </div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Data&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l03268"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt.html#a48184f32fcafb0fdfd9e2fc9a0e042b5"> 3268</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt.html#a48184f32fcafb0fdfd9e2fc9a0e042b5">r2l_solve_qp_set_q</a> (</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;  <span class="keyword">const</span> Data&amp; l2r_data, <span class="keyword">const</span> Data&amp; r2l_data,</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; os, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps,</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rbdi, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lbdi, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; q_min, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; q_max)</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;{</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;  l2r_data(os*l2rndps + l2rbdi + 0) = q_min;</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;  l2r_data(os*l2rndps + l2rbdi + 2) = q_max;</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;  r2l_data(os*r2lndps + r2lbdi + 1) = q_min;</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;  r2l_data(os*r2lndps + r2lbdi + 2) = q_max; </div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;}</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160; </div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Data&gt; KOKKOS_INLINE_FUNCTION</div>
<div class="line"><a name="l03280"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt.html#abf5106256ba521c713427b1d79c061be"> 3280</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt.html#abf5106256ba521c713427b1d79c061be">r2l_solve_qp_solve_node_problem</a> (</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;  <span class="keyword">const</span> Data&amp; l2r_data, <span class="keyword">const</span> Data&amp; r2l_data, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; problem_type,</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;  <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">impl::NodeSets::Node</a>&amp; n,</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;  <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">impl::NodeSets::Node</a>&amp; k0, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">impl::NodeSets::Node</a>&amp; k1,</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps,</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rbdi, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lbdi,</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> prefer_mass_con_to_bounds)</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;{</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;  <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ad78a836ebfaee833c929dbe37dec8105">impl::solve_node_problem</a>(</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;    problem_type,</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;     l2r_data( n.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*l2rndps),</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;    &amp;l2r_data( n.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*l2rndps + l2rbdi),</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;     r2l_data( n.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*r2lndps + r2lbdi),</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;     l2r_data(k0.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*l2rndps),</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    &amp;l2r_data(k0.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*l2rndps + l2rbdi),</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;     r2l_data(k0.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*r2lndps + r2lbdi),</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;     l2r_data(k1.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*l2rndps),</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;    &amp;l2r_data(k1.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*l2rndps + l2rbdi),</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;     r2l_data(k1.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">offset</a>*r2lndps + r2lbdi),</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;    prefer_mass_con_to_bounds);</div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;}</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160; </div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; <span class="keywordtype">void</span> QLT&lt;ES&gt;</div>
<div class="line"><a name="l03303"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a6fcf4740b2f4b23a2ad03ec133ead2ee"> 3303</a></span>&#160;::r2l_solve_qp (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; lvlidx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; l2rndps, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;  Timer::start(Timer::snp);</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> prefer_mass_con_to_bounds =</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    options_.prefer_numerical_mass_conservation_to_numerical_bounds;</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structcedr_1_1impl_1_1_on_gpu.html">cedr::impl::OnGpu&lt;ES&gt;::value</a>) {</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> d = *nsdd_;</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> l2r_data = bd_.l2r_data;</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> r2l_data = bd_.r2l_data;</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> = md_.a_d;</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ntracer = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2prob.size();</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> lvl_os = nshd_-&gt;lvlptr(lvlidx);</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> N = ntracer*(nshd_-&gt;lvlptr(lvlidx+1) - lvl_os);</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> solve_qp = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> il = lvl_os + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> / ntracer;</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bi = <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> % ntracer;</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> node_idx = d.lvl(il);</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; n = d.node(node_idx);</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;      <span class="keywordflow">if</span> ( ! n.nkids) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ti = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.bidx2trcr(bi);</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> problem_type = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2prob(ti);</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> l2rbdi = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2bl2r(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.bidx2trcr(bi));</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> r2lbdi = <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.trcr2br2l(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>.bidx2trcr(bi));</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(n.nkids == 2);</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;      <span class="keywordflow">if</span> ((problem_type &amp; ProblemType::consistent) &amp;&amp;</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;          ! (problem_type &amp; ProblemType::shapepreserve)) {</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;        <span class="comment">// Pass q_{min,max} info along. l2r data are updated for use in</span></div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        <span class="comment">// solve_node_problem. r2l data are updated for use in isend.</span></div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q_min = r2l_data(n.offset*r2lndps + r2lbdi + 1);</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q_max = r2l_data(n.offset*r2lndps + r2lbdi + 2);</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;        l2r_data(n.offset*l2rndps + l2rbdi + 0) = q_min;</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;        l2r_data(n.offset*l2rndps + l2rbdi + 2) = q_max;</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; 2; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;          <a class="code" href="namespacecedr_1_1qlt.html#a48184f32fcafb0fdfd9e2fc9a0e042b5">r2l_solve_qp_set_q</a>(l2r_data, r2l_data, d.node(n.kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>]).offset,</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;                             l2rndps, r2lndps, l2rbdi, r2lbdi, q_min, q_max);</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;      }</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;      <a class="code" href="namespacecedr_1_1qlt.html#abf5106256ba521c713427b1d79c061be">r2l_solve_qp_solve_node_problem</a>(</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;        l2r_data, r2l_data, problem_type, n, d.node(n.kids[0]), d.node(n.kids[1]),</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;        l2rndps, r2lndps, l2rbdi, r2lbdi, prefer_mass_con_to_bounds);</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;    };</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;    Kokkos::parallel_for(Kokkos::RangePolicy&lt;ES&gt;(0, N), solve_qp);</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;    Kokkos::fence();</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; lvl = ns_-&gt;levels[lvlidx];</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n_lvl_nodes = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>.size();</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_OPENMP</span></div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;<span class="preprocessor">#   pragma omp parallel for</span></div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ni = 0; ni &lt; n_lvl_nodes; ++ni) {</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> lvlidx = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>[ni];</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> n = ns_-&gt;node_h(lvlidx);</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      <span class="keywordflow">if</span> ( ! n-&gt;nkids) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> pti = 0; pti &lt; md_.nprobtypes; ++pti) {</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> problem_type = md_.get_problem_type(pti);</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bis = md_.a_d.prob2trcrptr[pti], bie = md_.a_d.prob2trcrptr[pti+1];</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> bi = bis; bi &lt; bie; ++bi) {</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> l2rbdi = md_.a_d.trcr2bl2r(md_.a_d.bidx2trcr(bi));</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> r2lbdi = md_.a_d.trcr2br2l(md_.a_d.bidx2trcr(bi));</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;          <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;nkids == 2);</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;          <span class="keywordflow">if</span> ((problem_type &amp; ProblemType::consistent) &amp;&amp;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;              ! (problem_type &amp; ProblemType::shapepreserve)) {</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q_min = bd_.r2l_data(n-&gt;offset*r2lndps + r2lbdi + 1);</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q_max = bd_.r2l_data(n-&gt;offset*r2lndps + r2lbdi + 2);</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;            bd_.l2r_data(n-&gt;offset*l2rndps + l2rbdi + 0) = q_min;</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;            bd_.l2r_data(n-&gt;offset*l2rndps + l2rbdi + 2) = q_max;</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; 2; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;              <a class="code" href="namespacecedr_1_1qlt.html#a48184f32fcafb0fdfd9e2fc9a0e042b5">r2l_solve_qp_set_q</a>(bd_.l2r_data, bd_.r2l_data,</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;                                 ns_-&gt;node_h(n-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>])-&gt;offset,</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;                                 l2rndps, r2lndps, l2rbdi, r2lbdi, q_min, q_max);</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;          }</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;          <a class="code" href="namespacecedr_1_1qlt.html#abf5106256ba521c713427b1d79c061be">r2l_solve_qp_solve_node_problem</a>(</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;            bd_.l2r_data, bd_.r2l_data, problem_type, *n, *ns_-&gt;node_h(n-&gt;kids[0]),</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;            *ns_-&gt;node_h(n-&gt;kids[1]), l2rndps, r2lndps, l2rbdi, r2lbdi,</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;            prefer_mass_con_to_bounds);</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;        }</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;      }</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;    }</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;  }</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;  Timer::stop(Timer::snp);</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;}</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160; </div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt; <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;ES&gt;</a></div>
<div class="line"><a name="l03384"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a495b3a172143d2de992f477bc529e2b1"> 3384</a></span>&#160;<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">::r2l_send_to_kids</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">impl::NodeSets::Level</a>&amp; lvl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; r2lndps)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>.size(); ++i) {</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>[i];</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">mpi::isend</a>(*p_, bd_.r2l_data.data() + mmd.offset*r2lndps, mmd.size*r2lndps,</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;               mmd.rank, impl::NodeSets::mpitag);</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;  }</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;}</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160; </div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03393"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1_q_l_t.html#a596f975d028550632ee5fb3e70b5eed5"> 3393</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">QLT&lt;ES&gt;::run</a> () {</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(bd_.inited());</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;  Timer::start(Timer::qltrunl2r);</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;  <span class="comment">// Number of data per slot.</span></div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> l2rndps = md_.a_h.prob2bl2r[md_.nprobtypes];</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> r2lndps = md_.a_h.prob2br2l[md_.nprobtypes];</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> il = 0; il &lt; ns_-&gt;levels.size(); ++il) {</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;    <span class="keyword">auto</span>&amp; lvl = ns_-&gt;levels[il];</div>
<div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;    <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>.size()) l2r_recv(lvl, l2rndps);</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;    l2r_combine_kid_data(il, l2rndps);    </div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>.size()) l2r_send_to_parents(lvl, l2rndps);</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;  }</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;  Timer::stop(Timer::qltrunl2r); Timer::start(Timer::qltrunr2l);</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;  root_compute(l2rndps, r2lndps);</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> il = ns_-&gt;levels.size(); il &gt; 0; --il) {</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    <span class="keyword">auto</span>&amp; lvl = ns_-&gt;levels[il-1];</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;    <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>.size()) r2l_recv(lvl, r2lndps);</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;    r2l_solve_qp(il-1, l2rndps, r2lndps);</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;    <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>.size()) r2l_send_to_kids(lvl, r2lndps);</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;  }</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;  Timer::stop(Timer::qltrunr2l);</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;}</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160; </div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="keyword">using namespace </span>impl;</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160; </div>
<div class="line"><a name="l03419"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html"> 3419</a></span>&#160;<span class="keyword">class </span><a class="code" href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html">TestQLT</a> : <span class="keyword">public</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html">cedr::test::TestRandomized</a> {</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l03421"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html#a466ced59652d893b8faf62e4d36bb2c9"> 3421</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">QLT&lt;Kokkos::DefaultExecutionSpace&gt;</a> <a class="code" href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html#a466ced59652d893b8faf62e4d36bb2c9">QLTT</a>;</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160; </div>
<div class="line"><a name="l03423"></a><span class="lineno"><a class="line" href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html#a895fda361434740baa765be426a04877"> 3423</a></span>&#160;  <a class="code" href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html#a895fda361434740baa765be426a04877">TestQLT</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree,</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;           <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells, <span class="keyword">const</span> <span class="keywordtype">bool</span> external_memory, <span class="keyword">const</span> <span class="keywordtype">bool</span> verbose,</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;           <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">CDR::Options</a> options)</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;    : TestRandomized(<span class="stringliteral">&quot;QLT&quot;</span>, p, ncells, verbose, options),</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;      qlt_(p, ncells, tree, options), tree_(tree), external_memory_(external_memory)</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;  {</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;    <span class="keywordflow">if</span> (verbose) qlt_.print(std::cout);</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;    <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">init</a>();</div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;  }</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160; </div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;  QLTT qlt_;</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> tree_;</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;  <span class="keywordtype">bool</span> external_memory_;</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;  <span class="keyword">typename</span> QLTT::RealList buf1_, buf2_;</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160; </div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;  <a class="code" href="structcedr_1_1_c_d_r.html">CDR</a>&amp; get_cdr ()<span class="keyword"> override </span>{ <span class="keywordflow">return</span> qlt_; }</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160; </div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;  <span class="keywordtype">void</span> init_numbering ()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;    init_numbering(tree_);</div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;  }</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160; </div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;  <span class="keywordtype">void</span> init_numbering (<span class="keyword">const</span> tree::Node::Ptr&amp; node) {</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#a46e9e2574a59bf3476d8965cb14167bf">check</a>(qlt_);</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;    <span class="comment">// TestQLT doesn&#39;t actually care about a particular ordering, as there is no</span></div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    <span class="comment">// geometry to the test problem. However, use *some* ordering to model what</span></div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;    <span class="comment">// a real problem must do.</span></div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;    <span class="keywordflow">if</span> ( ! node-&gt;nkids) {</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;      <span class="keywordflow">if</span> (node-&gt;rank == p_-&gt;rank())</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;        gcis_.push_back(node-&gt;cellidx);</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;      <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;    }</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; node-&gt;nkids; ++i)</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;      init_numbering(node-&gt;kids[i]);</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;  }</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160; </div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#a46e9e2574a59bf3476d8965cb14167bf">check</a> (<span class="keyword">const</span> QLTT&amp; <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>) {</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n = <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>.nlclcells();</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    std::vector&lt;Long&gt; gcis;</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>.get_owned_glblcells(gcis);</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<span class="keyword">static_cast&lt;</span><a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a><span class="keyword">&gt;</span>(gcis.size()) == n);</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<a class="code" href="namespacecedr_1_1qlt.html">qlt</a>.gci2lci(gcis[i]) == i);</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;  }</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160; </div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;  <span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#ad617c49d38a616dba83ab782ade127b1">init_tracers</a> ()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; t : tracers_)</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;      qlt_.declare_tracer(t.problem_type, 0);</div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    qlt_.end_tracer_declarations();</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;    <span class="keywordflow">if</span> (external_memory_) {</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;      <span class="keywordtype">size_t</span> l2r_sz, r2l_sz;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      qlt_.get_buffers_sizes(l2r_sz, r2l_sz);</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;      buf1_ = <span class="keyword">typename</span> QLTT::RealList(<span class="stringliteral">&quot;buf1&quot;</span>, l2r_sz);</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;      buf2_ = <span class="keyword">typename</span> QLTT::RealList(<span class="stringliteral">&quot;buf2&quot;</span>, r2l_sz);</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;      qlt_.set_buffers(buf1_.data(), buf2_.data());</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    }</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    qlt_.finish_setup();</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(qlt_.get_num_tracers() == <span class="keyword">static_cast&lt;</span><a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a><span class="keyword">&gt;</span>(tracers_.size()));</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; tracers_.size(); ++i) {</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> pt = qlt_.get_problem_type(i);</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>((pt == ((tracers_[i].problem_type | ProblemType::consistent) &amp;</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;                          ~ProblemType::nonnegative)) ||</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;                  (pt == ((tracers_[i].problem_type | ProblemType::nonnegative) &amp;</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;                          ~ProblemType::consistent)));</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;    }</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;  }</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;  </div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;  <span class="keywordtype">void</span> run_impl (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> trial)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;    MPI_Barrier(p_-&gt;comm());</div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;    Timer::start(Timer::qltrun);</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;    qlt_.run();</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;    MPI_Barrier(p_-&gt;comm());</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;    Timer::stop(Timer::qltrun);</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;    <span class="keywordflow">if</span> (trial == 0) {</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;      Timer::reset(Timer::qltrun);</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;      Timer::reset(Timer::qltrunl2r);</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;      Timer::reset(Timer::qltrunr2l);</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;      Timer::reset(<a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">Timer::waitall</a>);</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;      Timer::reset(Timer::snp);</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    }</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;  }</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;};</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160; </div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;<span class="comment">// Test all QLT variations and situations.</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1test.html#a097812f6cbbfba363a2a7501d7d6e1ca"> 3507</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1test.html#a097812f6cbbfba363a2a7501d7d6e1ca">test_qlt</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; tree,</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;              <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nrepeat,</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">bool</span> write, <span class="keyword">const</span> <span class="keywordtype">bool</span> external_memory,</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">bool</span> prefer_mass_con_to_bounds, <span class="keyword">const</span> <span class="keywordtype">bool</span> verbose) {</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;  <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">CDR::Options</a> options;</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;  options.<a class="code" href="structcedr_1_1_c_d_r_1_1_options.html#a9a6fa254247b874087170c3b86db13a3">prefer_numerical_mass_conservation_to_numerical_bounds</a> =</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    prefer_mass_con_to_bounds;</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html">TestQLT</a>(p, tree, ncells, external_memory, verbose, options)</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;    .<a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a2b823e264295db343e072086f2ac80f7">run</a>&lt;<a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">TestQLT::QLTT</a>&gt;(nrepeat, write);</div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;}</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160; </div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;<span class="comment">// Tree for a 1-D periodic domain, for unit testing.</span></div>
<div class="line"><a name="l03520"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1oned.html"> 3520</a></span>&#160;<span class="keyword">namespace </span>oned {</div>
<div class="line"><a name="l03521"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html"> 3521</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">Mesh</a> {</div>
<div class="line"><a name="l03522"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html"> 3522</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html">ParallelDecomp</a> {</div>
<div class="line"><a name="l03523"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31"> 3523</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31">Enum</a> {</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;      <span class="comment">// The obvious distribution of ranks: 1 rank takes exactly 1 contiguous</span></div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;      <span class="comment">// set of cell indices.</span></div>
<div class="line"><a name="l03526"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31a1da2969eecb0ed9914a58de2e0bbfae1"> 3526</a></span>&#160;      <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31a1da2969eecb0ed9914a58de2e0bbfae1">contiguous</a>,</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;      <span class="comment">// For heavy-duty testing of QLT comm pattern, use a ridiculous assignment</span></div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;      <span class="comment">// of ranks to cell indices. This forces the QLT tree to communicate,</span></div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;      <span class="comment">// pack, and unpack in silly ways.</span></div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;      pseudorandom</div>
<div class="line"><a name="l03531"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31ae49fe4afe9b189a6487b6723ee316ff1"> 3531</a></span>&#160;    };</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;  };</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;  </div>
<div class="line"><a name="l03534"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#a79b3f76cb7fc5abf605f41fde61d118d"> 3534</a></span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#a79b3f76cb7fc5abf605f41fde61d118d">Mesh</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nc, <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p,</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;        <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31">ParallelDecomp::Enum</a>&amp; parallel_decomp = ParallelDecomp::contiguous) {</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">init</a>(nc, p, parallel_decomp);</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;  }</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;  </div>
<div class="line"><a name="l03539"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ae93021b1ad618e19cd9c6a4b6904280d"> 3539</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ae93021b1ad618e19cd9c6a4b6904280d">init</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nc, <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p,</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;             <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31">ParallelDecomp::Enum</a>&amp; parallel_decomp) {</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;    nc_ = nc;</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;    nranks_ = p-&gt;size();</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;    p_ = p;</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;    pd_ = parallel_decomp;</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(nranks_ &gt; nc_, <span class="stringliteral">&quot;#GIDs &lt; #ranks is not supported.&quot;</span>);</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;  }</div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160; </div>
<div class="line"><a name="l03548"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ad0dc88f38b653772ac6d66ad088c926c"> 3548</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ad0dc88f38b653772ac6d66ad088c926c">ncell</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> nc_; }</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160; </div>
<div class="line"><a name="l03550"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ab5825c8b59906112f369266651390dc5"> 3550</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ab5825c8b59906112f369266651390dc5">parallel</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> p_; }</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160; </div>
<div class="line"><a name="l03552"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#abeae5a51abcd1bca1ea4228a782849af"> 3552</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#abeae5a51abcd1bca1ea4228a782849af">rank</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ci)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;    <span class="keywordflow">switch</span> (pd_) {</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    <span class="keywordflow">case</span> ParallelDecomp::contiguous:</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(nranks_ - 1, ci / (nc_ / nranks_));</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;    <span class="keywordflow">default</span>: {</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> chunk = ci / nranks_;</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;      <span class="keywordflow">return</span> (ci + chunk) % nranks_;</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;    }</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;    }</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;  }</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160; </div>
<div class="line"><a name="l03563"></a><span class="lineno"><a class="line" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#aa6c579129d55b44a99ba355a8925cd2f"> 3563</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#aa6c579129d55b44a99ba355a8925cd2f">unittest</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p) {</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;    <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31">Mesh::ParallelDecomp::Enum</a> dists[] = { Mesh::ParallelDecomp::pseudorandom,</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;                                                 Mesh::ParallelDecomp::contiguous };</div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = 0;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <span class="keyword">sizeof</span>(dists)/<span class="keyword">sizeof</span>(*dists); ++id) {</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;      <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">Mesh</a> m(<a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(42, 3*p-&gt;size()), p, dists[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nc = m.<a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ad0dc88f38b653772ac6d66ad088c926c">ncell</a>();</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ci = 0; ci &lt; nc; ++ci)</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;        <span class="keywordflow">if</span> (m.<a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#abeae5a51abcd1bca1ea4228a782849af">rank</a>(ci) &lt; 0 || m.<a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#abeae5a51abcd1bca1ea4228a782849af">rank</a>(ci) &gt;= p-&gt;size())</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;          ++<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;    }</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;  }</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160; </div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nc_, nranks_;</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;  <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a> p_;</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;  ParallelDecomp::Enum pd_;</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;};</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160; </div>
<div class="line"><a name="l03583"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1oned.html#addfa57aa3a382bb2b6ba95ae9f6931ed"> 3583</a></span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">Mesh</a>&amp; m, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> cs, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ce,</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;                           <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html">tree::Node</a>* parent, <span class="keyword">const</span> <span class="keywordtype">bool</span> imbalanced) {</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a></div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;    cn = ce - cs,</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;    cn0 = ( imbalanced &amp;&amp; cn &gt; 2 ?</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;            cn/3 :</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;            cn/2 );</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> n = std::make_shared&lt;tree::Node&gt;();</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;  n-&gt;parent = parent;</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;  <span class="keywordflow">if</span> (cn == 1) {</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;    n-&gt;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#a792a2ecbc99f2bef73976b1560124dd3">nkids</a> = 0;</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;    n-&gt;rank = m.<a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#abeae5a51abcd1bca1ea4228a782849af">rank</a>(cs);</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;    n-&gt;cellidx = cs;</div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;    <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;  }</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;  n-&gt;nkids = 2;</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;  n-&gt;kids[0] = <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(m, cs, cs + cn0, n.get(), imbalanced);</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;  n-&gt;kids[1] = <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(m, cs + cn0, ce, n.get(), imbalanced);</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;  <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;}</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160; </div>
<div class="line"><a name="l03604"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1oned.html#aeacf5122f3e386382bf785c5244ab753"> 3604</a></span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">Mesh</a>&amp; m, <span class="keyword">const</span> <span class="keywordtype">bool</span> imbalanced) {</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(m, 0, m.<a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ad0dc88f38b653772ac6d66ad088c926c">ncell</a>(), <span class="keyword">nullptr</span>, imbalanced);</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;}</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160; </div>
<div class="line"><a name="l03608"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1oned.html#a06b6b50ec1c93684e6299ff7f2888b27"> 3608</a></span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells,</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;                           <span class="keyword">const</span> <span class="keywordtype">bool</span> imbalanced) {</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">Mesh</a> m(ncells, p);</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(m, imbalanced);</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;}</div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160; </div>
<div class="line"><a name="l03614"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1oned_1_1test.html"> 3614</a></span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l03615"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a1b4fae859c2c49b25fd8e8fe30c9acc4"> 3615</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a1b4fae859c2c49b25fd8e8fe30c9acc4">mark_cells</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a>&amp; node, std::vector&lt;Int&gt;&amp; cells) {</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;  <span class="keywordflow">if</span> ( ! node-&gt;nkids) {</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;    ++cells[node-&gt;cellidx];</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;  }</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; node-&gt;nkids; ++i)</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;    <a class="code" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a1b4fae859c2c49b25fd8e8fe30c9acc4">mark_cells</a>(node-&gt;kids[i], cells);</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;}</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160; </div>
<div class="line"><a name="l03624"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a79a8c8e0339adeec705d1a2e243708e1"> 3624</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a79a8c8e0339adeec705d1a2e243708e1">unittest</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p) {</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;  <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31">Mesh::ParallelDecomp::Enum</a> dists[] = { Mesh::ParallelDecomp::pseudorandom,</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;                                               Mesh::ParallelDecomp::contiguous };</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = 0;</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <span class="keyword">sizeof</span>(dists)/<span class="keyword">sizeof</span>(*dists); ++id)</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">bool</span> imbalanced: {<span class="keyword">false</span>, <span class="keyword">true</span>}) {</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;      <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">Mesh</a> m(<a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(42, 3*p-&gt;size()), p, Mesh::ParallelDecomp::pseudorandom);</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;      <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> tree = <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(m, imbalanced);</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;      std::vector&lt;Int&gt; cells(m.<a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ad0dc88f38b653772ac6d66ad088c926c">ncell</a>(), 0);</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;      <a class="code" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a1b4fae859c2c49b25fd8e8fe30c9acc4">mark_cells</a>(tree, cells);</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; m.<a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ad0dc88f38b653772ac6d66ad088c926c">ncell</a>(); ++i)</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;        <span class="keywordflow">if</span> (cells[i] != 1) ++<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    }</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;}</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;} <span class="comment">// namespace oned</span></div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160; </div>
<div class="line"><a name="l03642"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1tree.html#a30aba1281f9c0c2c90d3066d6d17d78c"> 3642</a></span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> <a class="code" href="namespacecedr_1_1qlt_1_1tree.html#a30aba1281f9c0c2c90d3066d6d17d78c">tree::make_tree_over_1d_mesh</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells,</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;                                              <span class="keyword">const</span> <span class="keywordtype">bool</span> imbalanced) {</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">oned::make_tree</a>(<a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">oned::Mesh</a>(ncells, p), imbalanced);</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;}</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160; </div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l03648"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1test.html#ad8facd3eb0f21a69fee66bec77a4c5c4"> 3648</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1test.html#ad8facd3eb0f21a69fee66bec77a4c5c4">unittest_NodeSets</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p) {</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">Mesh</a> = <a class="code" href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">oned::Mesh</a>;</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> szs[] = { p-&gt;size(), 3*p-&gt;size() };</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;  <span class="keyword">const</span> Mesh::ParallelDecomp::Enum dists[] = { Mesh::ParallelDecomp::pseudorandom,</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;                                               Mesh::ParallelDecomp::contiguous };</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> is = 0; is &lt; <span class="keyword">sizeof</span>(szs)/<span class="keyword">sizeof</span>(*szs); ++is)</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = 0; <span class="keywordtype">id</span> &lt; <span class="keyword">sizeof</span>(dists)/<span class="keyword">sizeof</span>(*dists); ++id)</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">bool</span> imbalanced: {<span class="keyword">false</span>, <span class="keyword">true</span>}) {</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;        <a class="code" href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">Mesh</a> m(szs[is], p, dists[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;        <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> tree = <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(m, imbalanced);</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;        <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a80c73a0bd8c3eedb2c7206008d398369">impl::NodeSets::ConstPtr</a> nodesets = <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#ac46929bd66312874d443dd21155f8019">impl::analyze</a>(p, m.ncell(), tree);</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;        tree = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;        nerr += <a class="code" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a79a8c8e0339adeec705d1a2e243708e1">impl::unittest</a>(p, nodesets, m.ncell());</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;      }</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;}</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160; </div>
<div class="line"><a name="l03666"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1test.html#ac2d5f7d3e1a15b97276f0f6d1cfebe09"> 3666</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1test.html#ac2d5f7d3e1a15b97276f0f6d1cfebe09">unittest_QLT</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <span class="keywordtype">bool</span> write_requested=<span class="keyword">false</span>) {</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">Mesh</a> = <a class="code" href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">oned::Mesh</a>;</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> szs[] = { p-&gt;size(), 2*p-&gt;size(), 7*p-&gt;size(), 21*p-&gt;size() };</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;  <span class="keyword">const</span> Mesh::ParallelDecomp::Enum dists[] = { Mesh::ParallelDecomp::contiguous,</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;                                               Mesh::ParallelDecomp::pseudorandom };</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> is = 0, islim = <span class="keyword">sizeof</span>(szs)/<span class="keyword">sizeof</span>(*szs); is &lt; islim; ++is) {</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <span class="keywordtype">id</span> = 0, idlim = <span class="keyword">sizeof</span>(dists)/<span class="keyword">sizeof</span>(*dists); <span class="keywordtype">id</span> &lt; idlim; ++id) {</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">bool</span> imbalanced : {<span class="keyword">false</span>, <span class="keyword">true</span>}) {</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">bool</span> prefer_mass_con_to_bounds : {<span class="keyword">false</span>, <span class="keyword">true</span>}) {</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> external_memory = imbalanced;</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;          <span class="keywordflow">if</span> (p-&gt;amroot()) {</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;            std::cout &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; szs[is] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; imbalanced &lt;&lt; <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;                      &lt;&lt; prefer_mass_con_to_bounds &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;            std::cout.flush();</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;          }</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;          <a class="code" href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">Mesh</a> m(szs[is], p, dists[<span class="keywordtype">id</span>]);</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;          <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> tree = <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(m, imbalanced);</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">bool</span> write = (write_requested &amp;&amp; m.ncell() &lt; 3000 &amp;&amp;</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;                              is == islim-1 &amp;&amp; <span class="keywordtype">id</span> == idlim-1);</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;          nerr += <a class="code" href="namespacecedr_1_1qlt_1_1test.html#a097812f6cbbfba363a2a7501d7d6e1ca">test::test_qlt</a>(p, tree, m.ncell(), 1, write, external_memory,</div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;                                 prefer_mass_con_to_bounds, <span class="keyword">false</span>);</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;        }</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;      }</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;    }</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;  }</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;}</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160; </div>
<div class="line"><a name="l03695"></a><span class="lineno"><a class="line" href="namespacecedr_1_1qlt_1_1test.html#abcc1c3037c40bfabd109c2046c1c8e11"> 3695</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1qlt_1_1test.html#abcc1c3037c40bfabd109c2046c1c8e11">run_unit_and_randomized_tests</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html">Input</a>&amp; in) {</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;  <span class="keywordflow">if</span> (in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a64b2c5e120cc9ba459c69a6f29bc6bd7">unittest</a>) {</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;    <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = <a class="code" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a79a8c8e0339adeec705d1a2e243708e1">oned::Mesh::unittest</a>(p);</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> &amp;&amp; p-&gt;amroot()) std::cerr &lt;&lt; <span class="stringliteral">&quot;FAIL: Mesh::unittest()\n&quot;</span>;</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;    nerr += <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;    <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = <a class="code" href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a79a8c8e0339adeec705d1a2e243708e1">oned::test::unittest</a>(p);</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> &amp;&amp; p-&gt;amroot()) std::cerr &lt;&lt; <span class="stringliteral">&quot;FAIL: oned::unittest_tree()\n&quot;</span>;</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;    nerr += <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;    <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = <a class="code" href="namespacecedr_1_1qlt_1_1test.html#ad8facd3eb0f21a69fee66bec77a4c5c4">unittest_NodeSets</a>(p);</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> &amp;&amp; p-&gt;amroot()) std::cerr &lt;&lt; <span class="stringliteral">&quot;FAIL: oned::unittest_NodeSets()\n&quot;</span>;</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;    nerr += <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> = <a class="code" href="namespacecedr_1_1qlt_1_1test.html#ac2d5f7d3e1a15b97276f0f6d1cfebe09">unittest_QLT</a>(p, in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a6c43827bc4fa990eb3fb972249b92403">write</a>);</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a> &amp;&amp; p-&gt;amroot()) std::cerr &lt;&lt; <span class="stringliteral">&quot;FAIL: oned::unittest_QLT()\n&quot;</span>;</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;    nerr += <a class="code" href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">ne</a>;</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;    <span class="keywordflow">if</span> (p-&gt;amroot()) std::cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;  }</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;  <span class="comment">// Performance test.</span></div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;  <span class="keywordflow">if</span> (in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ab62561957a57c9969924cf7cefaf25cf">perftest</a> &amp;&amp; in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">ncells</a> &gt; 0) {</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;    <a class="code" href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">oned::Mesh</a> m(in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">ncells</a>, p,</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;                 (in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a7317dba6f9385c1369b162913ed7ab92">pseudorandom</a> ?</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;                  oned::Mesh::ParallelDecomp::pseudorandom :</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                  oned::Mesh::ParallelDecomp::contiguous));</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;    <a class="code" href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">Timer::init</a>();</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;    Timer::start(Timer::total); Timer::start(Timer::tree);</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;    <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">tree::Node::Ptr</a> tree = <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(m, <span class="keyword">false</span>);</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;    Timer::stop(Timer::tree);</div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;    <a class="code" href="namespacecedr_1_1qlt_1_1test.html#a097812f6cbbfba363a2a7501d7d6e1ca">test::test_qlt</a>(p, tree, in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">ncells</a>, in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#aa0f64406587f313e9309fa0c13530e16">nrepeat</a>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, in.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a3891ebb2177bb10e34b50fee35a6a908">verbose</a>);</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;    Timer::stop(Timer::total);</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;    <span class="keywordflow">if</span> (p-&gt;amroot()) Timer::print();</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;  }</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;}</div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160; </div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;} <span class="comment">// namespace qlt</span></div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160; </div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_SERIAL</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">cedr::qlt::QLT&lt;Kokkos::Serial&gt;</a>;</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_OPENMP</span></div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">cedr::qlt::QLT&lt;Kokkos::OpenMP&gt;</a>;</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_CUDA</span></div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">cedr::qlt::QLT&lt;Kokkos::Cuda&gt;</a>;</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_THREADS</span></div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">cedr::qlt::QLT&lt;Kokkos::Threads&gt;</a>;</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160; </div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;<span class="comment">//&gt;&gt; cedr_caas.cpp</span></div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160; </div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;<span class="comment">//#include &quot;cedr_caas.hpp&quot;</span></div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;<span class="comment">//#include &quot;cedr_util.hpp&quot;</span></div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;<span class="comment">//#include &quot;cedr_test_randomized.hpp&quot;</span></div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160; </div>
<div class="line"><a name="l03755"></a><span class="lineno"><a class="line" href="namespace_kokkos.html"> 3755</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_kokkos.html">Kokkos</a> {</div>
<div class="line"><a name="l03756"></a><span class="lineno"><a class="line" href="struct_kokkos_1_1_real2.html"> 3756</a></span>&#160;<span class="keyword">struct </span><a class="code" href="struct_kokkos_1_1_real2.html">Real2</a> {</div>
<div class="line"><a name="l03757"></a><span class="lineno"><a class="line" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b"> 3757</a></span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">cedr::Real</a> v[2];</div>
<div class="line"><a name="l03758"></a><span class="lineno"><a class="line" href="struct_kokkos_1_1_real2.html#acceec37cc5b3c3ca8ed70f60024a6371"> 3758</a></span>&#160;  KOKKOS_INLINE_FUNCTION <a class="code" href="struct_kokkos_1_1_real2.html#acceec37cc5b3c3ca8ed70f60024a6371">Real2</a> () { v[0] = v[1] = 0; }</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160; </div>
<div class="line"><a name="l03760"></a><span class="lineno"><a class="line" href="struct_kokkos_1_1_real2.html#a858a928e6fab2d3d22fd9ee1950abac9"> 3760</a></span>&#160;  KOKKOS_INLINE_FUNCTION <span class="keywordtype">void</span> operator= (<span class="keyword">const</span> <a class="code" href="struct_kokkos_1_1_real2.html">Real2</a>&amp; s) {</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;    v[0] = s.<a class="code" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">v</a>[0];</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;    v[1] = s.<a class="code" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">v</a>[1];</div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;  }</div>
<div class="line"><a name="l03764"></a><span class="lineno"><a class="line" href="struct_kokkos_1_1_real2.html#a527bc318fa69c1b5ab636f27bfd74c2c"> 3764</a></span>&#160;  KOKKOS_INLINE_FUNCTION <span class="keywordtype">void</span> operator= (<span class="keyword">const</span> <span class="keyword">volatile</span> <a class="code" href="struct_kokkos_1_1_real2.html">Real2</a>&amp; s)<span class="keyword"> volatile </span>{</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;    v[0] = s.<a class="code" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">v</a>[0];</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;    v[1] = s.<a class="code" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">v</a>[1];</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;  }</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160; </div>
<div class="line"><a name="l03769"></a><span class="lineno"><a class="line" href="struct_kokkos_1_1_real2.html#a8819a77ad71c62f1e28221dfab867be7"> 3769</a></span>&#160;  KOKKOS_INLINE_FUNCTION <a class="code" href="struct_kokkos_1_1_real2.html">Real2</a>&amp; operator+= (<span class="keyword">const</span> <a class="code" href="struct_kokkos_1_1_real2.html">Real2</a>&amp; o) {</div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;    v[0] += o.<a class="code" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">v</a>[0];</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;    v[1] += o.<a class="code" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">v</a>[1];</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;  }</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;};</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160; </div>
<div class="line"><a name="l03776"></a><span class="lineno"><a class="line" href="struct_kokkos_1_1reduction__identity_3_01_real2_01_4.html"> 3776</a></span>&#160;<span class="keyword">template</span>&lt;&gt; <span class="keyword">struct </span><a class="code" href="struct_kokkos_1_1reduction__identity_3_01_real2_01_4.html">reduction_identity&lt;Real2&gt;</a> {</div>
<div class="line"><a name="l03777"></a><span class="lineno"><a class="line" href="struct_kokkos_1_1reduction__identity_3_01_real2_01_4.html#a673bb4ce53e92a8be7c337204b6670d7"> 3777</a></span>&#160;  KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <a class="code" href="struct_kokkos_1_1_real2.html">Real2</a> <a class="code" href="struct_kokkos_1_1reduction__identity_3_01_real2_01_4.html#a673bb4ce53e92a8be7c337204b6670d7">sum</a>() { <span class="keywordflow">return</span> <a class="code" href="struct_kokkos_1_1_real2.html">Real2</a>(); }</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;};</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;} <span class="comment">// namespace Kokkos</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160; </div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a> {</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160; </div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03785"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#aff00f5067fdecb35aa64116f20c7aa98"> 3785</a></span>&#160;<a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">CAAS&lt;ES&gt;::CAAS</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nlclcells,</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;                <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a04b71f510cb275314b3221fb04bad1b2">UserAllReducer::Ptr</a>&amp; uar)</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;  : p_(p), user_reducer_(uar), nlclcells_(nlclcells), nrhomidxs_(0),</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;    need_conserve_(false), finished_setup_(false)</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;{</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(nlclcells == 0, <span class="stringliteral">&quot;CAAS does not support 0 cells on a rank.&quot;</span>);</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;  <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#adce4bcf380215208609e80f43984981c">tracer_decls_</a> = std::make_shared&lt;std::vector&lt;Decl&gt; &gt;();  </div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;}</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160; </div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03795"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a816b83a8487dbc88d8fa843e722dd732"> 3795</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a816b83a8487dbc88d8fa843e722dd732">CAAS&lt;ES&gt;::declare_tracer</a>(<span class="keywordtype">int</span> problem_type, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rhomidx) {</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>( ! (problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">ProblemType::shapepreserve</a>),</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;                <span class="stringliteral">&quot;CAAS does not support ! shapepreserve yet.&quot;</span>);</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(rhomidx &gt; 0, <span class="stringliteral">&quot;rhomidx &gt; 0 is not supported yet.&quot;</span>);</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;  tracer_decls_-&gt;push_back(<a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html">Decl</a>(problem_type, rhomidx));</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;  <span class="keywordflow">if</span> (problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a>)</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;    need_conserve_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;  nrhomidxs_ = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(nrhomidxs_, rhomidx+1);</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;}</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160; </div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03806"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a286accaaf020796734e0e8984ada62b1"> 3806</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a286accaaf020796734e0e8984ada62b1">CAAS&lt;ES&gt;::end_tracer_declarations</a> () {</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(tracer_decls_-&gt;size() == 0, <span class="stringliteral">&quot;#tracers is 0.&quot;</span>);</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(nrhomidxs_ == 0, <span class="stringliteral">&quot;#rhomidxs is 0.&quot;</span>);</div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;  probs_ = <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a43c3ccd110b8401cf4c82219d197fe5e">IntList</a>(<span class="stringliteral">&quot;CAAS probs&quot;</span>, <span class="keyword">static_cast&lt;</span><a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a><span class="keyword">&gt;</span>(tracer_decls_-&gt;size()));</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;  probs_h_ = Kokkos::create_mirror_view(probs_);</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;  <span class="comment">//t2r_ = IntList(&quot;CAAS t2r&quot;, static_cast&lt;Int&gt;(tracer_decls_-&gt;size()));</span></div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; probs_.extent_int(0); ++i) {</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;    probs_h_(i) = (*tracer_decls_)[i].probtype;</div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;    <span class="comment">//t2r_(i) = (*tracer_decls_)[i].rhomidx;</span></div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;  }</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;  Kokkos::deep_copy(probs_, probs_h_);</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;  tracer_decls_ = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;}</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160; </div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a4b3b86d7004bd8db749714c58372733d">CAAS&lt;ES&gt;::get_buffers_sizes</a> (<span class="keywordtype">size_t</span>&amp; buf1, <span class="keywordtype">size_t</span>&amp; buf2, <span class="keywordtype">size_t</span>&amp; buf3) {</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> e = need_conserve_ ? 1 : 0;</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> nslots = 4*probs_.size();</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;  buf1 = nlclcells_ * ((3+e)*probs_.size() + 1);</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>( ! user_reducer_ || nlclcells_ % user_reducer_-&gt;n_accum_in_place() == 0);</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;  buf2 = nslots*(user_reducer_ ? (nlclcells_ / user_reducer_-&gt;n_accum_in_place()) : 1);</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;  buf3 = nslots;</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;}</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160; </div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03831"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a4b3b86d7004bd8db749714c58372733d"> 3831</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a4b3b86d7004bd8db749714c58372733d">CAAS&lt;ES&gt;::get_buffers_sizes</a> (<span class="keywordtype">size_t</span>&amp; buf1, <span class="keywordtype">size_t</span>&amp; buf2) {</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;  <span class="keywordtype">size_t</span> buf3;</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;  get_buffers_sizes(buf1, buf2, buf3);</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;  buf2 += buf3;</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;}</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160; </div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03838"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a3fd3c6018001a747e0b40c80b2a2e01c"> 3838</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a3fd3c6018001a747e0b40c80b2a2e01c">CAAS&lt;ES&gt;::set_buffers</a> (<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf1, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* buf2) {</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;  <span class="keywordtype">size_t</span> buf1sz, buf2sz, buf3sz;</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;  get_buffers_sizes(buf1sz, buf2sz, buf3sz);</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;  d_ = <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">RealList</a>(buf1, buf1sz);</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;  send_ = <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">RealList</a>(buf2, buf2sz);</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;  recv_ = <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">RealList</a>(buf2 + buf2sz, buf3sz);</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;}</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160; </div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03847"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a434388bd16d754c7091654788b23878b"> 3847</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a434388bd16d754c7091654788b23878b">CAAS&lt;ES&gt;::finish_setup</a> () {</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;  <span class="keywordflow">if</span> (recv_.size() &gt; 0) {</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;    finished_setup_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;  }</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;  <span class="keywordtype">size_t</span> buf1, buf2, buf3;</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;  get_buffers_sizes(buf1, buf2, buf3);</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;  <span class="comment">// (rho, Qm, Qm_min, Qm_max, [Qm_prev])</span></div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  d_ = <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">RealList</a>(<span class="stringliteral">&quot;CAAS data&quot;</span>, buf1);</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;  <span class="comment">// (e&#39;Qm_clip, e&#39;Qm, e&#39;Qm_min, e&#39;Qm_max, [e&#39;Qm_prev])</span></div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;  send_ = <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">RealList</a>(<span class="stringliteral">&quot;CAAS send&quot;</span>, buf2);</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;  recv_ = <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">RealList</a>(<span class="stringliteral">&quot;CAAS recv&quot;</span>, buf3);</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;  finished_setup_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;}</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160; </div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03863"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8cc7e3549e2e8ce2c2f6ad3671deeeb5"> 3863</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a8cc7e3549e2e8ce2c2f6ad3671deeeb5">CAAS&lt;ES&gt;::get_problem_type</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; tracer_idx)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(tracer_idx &gt;= 0 &amp;&amp; tracer_idx &lt; probs_.extent_int(0));</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;  <span class="keywordflow">return</span> probs_h_[tracer_idx];</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;}</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160; </div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03869"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a9a2993d2c0cc0ffc38344bacd1a2361f"> 3869</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a9a2993d2c0cc0ffc38344bacd1a2361f">CAAS&lt;ES&gt;::get_num_tracers</a> ()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;  <span class="keywordflow">return</span> probs_.extent_int(0);</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;}</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160; </div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> RealList, <span class="keyword">typename</span> IntList&gt;</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;KOKKOS_INLINE_FUNCTION <span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;calc_Qm_scalars (<span class="keyword">const</span> RealList&amp; d, <span class="keyword">const</span> IntList&amp; probs,</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;                 <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; nt, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; nlclcells,</div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;                 <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; os, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; i,</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;                 <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_clip, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; Qm_term) {</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm = d(os+i);</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;  Qm_term = (probs(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a> ?</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;             d(os + nlclcells*3*nt + i) <span class="comment">/* Qm_prev */</span> :</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;             Qm);</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_min = d(os + nlclcells*  nt + i);</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_max = d(os + nlclcells*2*nt + i);</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;  Qm_clip = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(Qm_max, <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(Qm_min, Qm));</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;}</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160; </div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Func&gt;</div>
<div class="line"><a name="l03889"></a><span class="lineno"><a class="line" href="namespacecedr_1_1caas.html#a6260f5a193dc31cd8f4c83c4313e9827"> 3889</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1caas.html#a6260f5a193dc31cd8f4c83c4313e9827">homme_parallel_for</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; beg, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; end, <span class="keyword">const</span> Func&amp; f) {</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;<span class="preprocessor"># pragma omp for</span></div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = beg; i &lt; end; ++i)</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;    f(i);</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;}</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160; </div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;<span class="keywordtype">void</span> CAAS&lt;ES&gt;::reduce_locally () {</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> user_reduces = user_reducer_ != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a368104aa4a3bed637d78c0034a89cf5e">ConstExceptGnu</a> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nt = probs_.size(), nlclcells = nlclcells_;</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160; </div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> probs = probs_;</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> send = send_;</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> d = d_;</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;  <span class="keywordflow">if</span> (user_reduces) {</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n_accum_in_place = user_reducer_-&gt;n_accum_in_place();</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nlclaccum = nlclcells / n_accum_in_place;</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> calc_Qm_clip = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; j) {</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = j / nlclaccum;</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> bi = j % nlclaccum;</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> os = (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>+1)*nlclcells;</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;      <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> accum_clip = 0, accum_term = 0;</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ai = 0; ai &lt; n_accum_in_place; ++ai) {</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = n_accum_in_place*bi + ai;</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;        <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_clip, Qm_term;</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;        calc_Qm_scalars(d, probs, nt, nlclcells, <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, os, i, Qm_clip, Qm_term);</div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;        d(os + i) = Qm_clip;</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;        accum_clip += Qm_clip;</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;        accum_term += Qm_term;</div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;      }</div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;      send(nlclaccum*      <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>  + bi) = accum_clip;</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;      send(nlclaccum*(nt + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) + bi) = accum_term;</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;    };</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;    <a class="code" href="namespacecedr_1_1caas.html#a6260f5a193dc31cd8f4c83c4313e9827">homme_parallel_for</a>(0, nt*nlclaccum, calc_Qm_clip);</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> set_Qm_minmax = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; j) {</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 2*nt + j / nlclaccum;</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> bi = j % nlclaccum;</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> os = (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>-nt+1)*nlclcells;</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;      <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> accum_ext = 0;</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ai = 0; ai &lt; n_accum_in_place; ++ai) {</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = n_accum_in_place*bi + ai;</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;        accum_ext += d(os + i);</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;      }</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;      send(nlclaccum*<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> + bi) = accum_ext;</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;    };</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;    <a class="code" href="namespacecedr_1_1caas.html#a6260f5a193dc31cd8f4c83c4313e9827">homme_parallel_for</a>(0, 2*nt*nlclaccum, set_Qm_minmax);</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;    <span class="keyword">using</span> ESU = <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html">cedr::impl::ExeSpaceUtils&lt;ES&gt;</a>;</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> calc_Qm_clip = KOKKOS_LAMBDA (<span class="keyword">const</span> <span class="keyword">typename</span> ESU::Member&amp; t) {</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = t.league_rank();</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> os = (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>+1)*nlclcells;</div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a> = [&amp;] (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; i, <a class="code" href="struct_kokkos_1_1_real2.html">Kokkos::Real2</a>&amp; accum) {</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;        <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_clip, Qm_term;</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;        calc_Qm_scalars(d, probs, nt, nlclcells, <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, os, i, Qm_clip, Qm_term);</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;        d(os+i) = Qm_clip;</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;        accum.v[0] += Qm_clip;</div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;        accum.v[1] += Qm_term;</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;      };</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;      <a class="code" href="struct_kokkos_1_1_real2.html">Kokkos::Real2</a> accum;</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;      Kokkos::parallel_reduce(Kokkos::TeamThreadRange(t, nlclcells),</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;                              <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>, Kokkos::Sum&lt;Kokkos::Real2&gt;(accum));</div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;      send(     <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) = accum.<a class="code" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">v</a>[0];</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;      send(nt + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) = accum.<a class="code" href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">v</a>[1];</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;    };</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;    Kokkos::parallel_for(<a class="code" href="namespace_homme.html#ae7a6813a53e3f9affa8f76c91acaeac3">ESU::get_default_team_policy</a>(nt, nlclcells),</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;                         calc_Qm_clip);</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> set_Qm_minmax = KOKKOS_LAMBDA (<span class="keyword">const</span> <span class="keyword">typename</span> ESU::Member&amp; t) {</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 2*nt + t.league_rank();</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> os = (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>-nt+1)*nlclcells;</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;      <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> accum = 0;</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;      Kokkos::parallel_reduce(Kokkos::TeamThreadRange(t, nlclcells),</div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;                              [&amp;] (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; i, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; accum) { accum += d(os+i); },</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;                              Kokkos::Sum&lt;Real&gt;(accum));</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;      send(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) = accum;</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;    };</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;    Kokkos::parallel_for(<a class="code" href="namespace_homme.html#ae7a6813a53e3f9affa8f76c91acaeac3">ESU::get_default_team_policy</a>(2*nt, nlclcells),</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;                         set_Qm_minmax);</div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;  }</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;}</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160; </div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03972"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a328c8238b4279baff795f97d3acdf173"> 3972</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a328c8238b4279baff795f97d3acdf173">CAAS&lt;ES&gt;::reduce_globally</a> () {</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> err = <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">mpi::all_reduce</a>(*p_, send_.data(), recv_.data(),</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;                                  send_.size(), MPI_SUM);</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(err != MPI_SUCCESS,</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;                <span class="stringliteral">&quot;CAAS::reduce_globally MPI_Allreduce returned &quot;</span> &lt;&lt; err);</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;}</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160; </div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l03980"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#a25fb8c96e17a5cf52fa8f5d1a121d0ad"> 3980</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#a25fb8c96e17a5cf52fa8f5d1a121d0ad">CAAS&lt;ES&gt;::finish_locally</a> () {</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;  <span class="keyword">using</span> ESU = <a class="code" href="structcedr_1_1impl_1_1_exe_space_utils.html">cedr::impl::ExeSpaceUtils&lt;ES&gt;</a>;</div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a368104aa4a3bed637d78c0034a89cf5e">ConstExceptGnu</a> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nt = probs_.size(), nlclcells = nlclcells_;</div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacehomme_1_1cslmpi.html#a2b713e2734729354e7c6f52f90ec64d6">recv</a> = recv_;</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> d = d_;</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> adjust_Qm = KOKKOS_LAMBDA (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> os = (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>+1)*nlclcells;</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> Qm_clip_sum = <a class="code" href="namespacehomme_1_1cslmpi.html#a2b713e2734729354e7c6f52f90ec64d6">recv</a>(     <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> Qm_sum      = <a class="code" href="namespacehomme_1_1cslmpi.html#a2b713e2734729354e7c6f52f90ec64d6">recv</a>(nt + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> m = Qm_sum - Qm_clip_sum;</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;    <span class="keywordflow">if</span> (m &lt; 0) {</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> Qm_min_sum = <a class="code" href="namespacehomme_1_1cslmpi.html#a2b713e2734729354e7c6f52f90ec64d6">recv</a>(2*nt + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;      <span class="keyword">auto</span> fac = Qm_clip_sum - Qm_min_sum;</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;      <span class="keywordflow">if</span> (fac &gt; 0) {</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;        fac = m/fac;</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; nlclcells; ++i) {</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> Qm_min = d(os + nlclcells * nt + i);</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;          <span class="keyword">auto</span>&amp; Qm = d(os+i);</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;          Qm += fac*(Qm - Qm_min);</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;          Qm = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">impl::max</a>(Qm_min, Qm);</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;        };</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;      }</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m &gt; 0) {</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> Qm_max_sum = <a class="code" href="namespacehomme_1_1cslmpi.html#a2b713e2734729354e7c6f52f90ec64d6">recv</a>(3*nt + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;      <span class="keyword">auto</span> fac = Qm_max_sum - Qm_clip_sum;</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;      <span class="keywordflow">if</span> (fac &gt; 0) {</div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;        fac = m/fac;</div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; nlclcells; ++i) {</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> Qm_max = d(os + nlclcells*2*nt + i);</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;          <span class="keyword">auto</span>&amp; Qm = d(os+i);</div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;          Qm += fac*(Qm_max - Qm);</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;          Qm = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">impl::min</a>(Qm_max, Qm);</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;        };</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;      }</div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;    }</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;  };</div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;  <a class="code" href="namespacecedr_1_1caas.html#a6260f5a193dc31cd8f4c83c4313e9827">homme_parallel_for</a>(0, nt, adjust_Qm);</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;}</div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160; </div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l04020"></a><span class="lineno"><a class="line" href="classcedr_1_1caas_1_1_c_a_a_s.html#ac499842d68aca0ba4d9a675664ea8fbe"> 4020</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ac499842d68aca0ba4d9a675664ea8fbe">CAAS&lt;ES&gt;::run</a> () {</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(finished_setup_);</div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;  reduce_locally();</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> user_reduces = user_reducer_ != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;  <span class="keywordflow">if</span> (user_reduces)</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;    (*user_reducer_)(*p_, send_.data(), recv_.data(),</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;                     nlclcells_ / user_reducer_-&gt;n_accum_in_place(),</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;                     recv_.size(), MPI_SUM);</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;    reduce_globally();</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;  finish_locally();</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;}</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160; </div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l04034"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html"> 4034</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html">TestCAAS</a> : <span class="keyword">public</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html">cedr::test::TestRandomized</a> {</div>
<div class="line"><a name="l04035"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a6d684d1617810c485350b2bf3a5f14e1"> 4035</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">CAAS&lt;Kokkos::DefaultExecutionSpace&gt;</a> <a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a6d684d1617810c485350b2bf3a5f14e1">CAAST</a>;</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160; </div>
<div class="line"><a name="l04037"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s_1_1_test_all_reducer.html"> 4037</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s_1_1_test_all_reducer.html">TestAllReducer</a> : <span class="keyword">public</span> <a class="code" href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html">CAAST::UserAllReducer</a> {</div>
<div class="line"><a name="l04038"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s_1_1_test_all_reducer.html#a670824dce56173cfc95e66d1519a394c"> 4038</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s_1_1_test_all_reducer.html#a670824dce56173cfc95e66d1519a394c">operator() </a>(<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">mpi::Parallel</a>&amp; p, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* sendbuf, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* rcvbuf,</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;                    <span class="keywordtype">int</span> nlcl, <span class="keywordtype">int</span> count, MPI_Op op)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;      Kokkos::View&lt;Real*&gt; s(sendbuf, nlcl*count), r(rcvbuf, count);</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> s_h = Kokkos::create_mirror_view(s);</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;      Kokkos::deep_copy(s_h, s);</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> r_h = Kokkos::create_mirror_view(r);</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; nlcl; ++i)</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;        s_h(0) += s_h(i);</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 1; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; count; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;        s_h(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) = s_h(nlcl*<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; nlcl; ++i)</div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;          s_h(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) += s_h(nlcl*<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> + i);</div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;      }</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">int</span> err = <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">mpi::all_reduce</a>(p, s_h.data(), r_h.data(), count, op);</div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;      Kokkos::deep_copy(r, r_h);</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;      <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;    }</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;  };</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160; </div>
<div class="line"><a name="l04057"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#af73725e00319814f0d14518197b64337"> 4057</a></span>&#160;  <a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#af73725e00319814f0d14518197b64337">TestCAAS</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells,</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> use_own_reducer, <span class="keyword">const</span> <span class="keywordtype">bool</span> external_memory,</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> verbose)</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;    : <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a3ee5a0a03f871180cbac3bc818572022">TestRandomized</a>(<span class="stringliteral">&quot;CAAS&quot;</span>, p, ncells, verbose),</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;      p_(p), external_memory_(external_memory)</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;  {</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> = p-&gt;size(), rank = p-&gt;rank();</div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;    nlclcells_ = ncells / <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>;</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> todo = ncells - nlclcells_ * <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>;</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;    <span class="keywordflow">if</span> (rank &lt; todo) ++nlclcells_;</div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;    caas_ = std::make_shared&lt;CAAST&gt;(</div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;      p, nlclcells_,</div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;      use_own_reducer ? std::make_shared&lt;TestAllReducer&gt;() : <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;    <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#acae3d5885de88a009da51bcfe2e818c5">init</a>();</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;  }</div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160; </div>
<div class="line"><a name="l04073"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a519ad30d791c28c7a77d39a7ad919c0f"> 4073</a></span>&#160;  <a class="code" href="structcedr_1_1_c_d_r.html">CDR</a>&amp; <a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a519ad30d791c28c7a77d39a7ad919c0f">get_cdr</a> ()<span class="keyword"> override </span>{ <span class="keywordflow">return</span> *caas_; }</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160; </div>
<div class="line"><a name="l04075"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a3ed9adf8835cbd8d2bcf18433e5f9915"> 4075</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a3ed9adf8835cbd8d2bcf18433e5f9915">init_numbering</a> ()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> = p_-&gt;size(), rank = p_-&gt;rank();</div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> start = 0;</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> lrank = 0; lrank &lt; rank; ++lrank)</div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;      start += get_nllclcells(<a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a61cffe426f3ac3d14cdf7e5b8b9716bb">ncells_</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, lrank);</div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;    <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#aa0fe4c695707cf12cb688c56dbf74290">gcis_</a>.resize(nlclcells_);</div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; nlclcells_; ++i)</div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;      <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#aa0fe4c695707cf12cb688c56dbf74290">gcis_</a>[i] = start + i;</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;  }</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160; </div>
<div class="line"><a name="l04085"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#acaeea9e48be92b872f1163191e864aae"> 4085</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#acaeea9e48be92b872f1163191e864aae">init_tracers</a> ()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;    <span class="comment">// CAAS doesn&#39;t yet support everything, so remove a bunch of the tracers.</span></div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;    std::vector&lt;TestRandomized::Tracer&gt; tracers;</div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> idx = 0;</div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; t : <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">tracers_</a>) {</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;      <span class="keywordflow">if</span> ( ! (t.problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">ProblemType::shapepreserve</a>) ||</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;           ! t.local_should_hold)</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;      t.idx = idx++;</div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;      tracers.push_back(t);</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;      caas_-&gt;declare_tracer(t.problem_type, 0);</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;    }</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;    <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">tracers_</a> = tracers;</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;    caas_-&gt;end_tracer_declarations();</div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;    <span class="keywordflow">if</span> (external_memory_) {</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;      <span class="keywordtype">size_t</span> l2r_sz, r2l_sz;</div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;      caas_-&gt;get_buffers_sizes(l2r_sz, r2l_sz);</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;      buf1_ = <span class="keyword">typename</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">CAAST::RealList</a>(<span class="stringliteral">&quot;buf1&quot;</span>, l2r_sz);</div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;      buf2_ = <span class="keyword">typename</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">CAAST::RealList</a>(<span class="stringliteral">&quot;buf2&quot;</span>, r2l_sz);</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;      caas_-&gt;set_buffers(buf1_.data(), buf2_.data());</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;    }</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;    caas_-&gt;finish_setup();</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;  }</div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160; </div>
<div class="line"><a name="l04109"></a><span class="lineno"><a class="line" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a66967dc293a3b9d16b6f1e6c24018004"> 4109</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a66967dc293a3b9d16b6f1e6c24018004">run_impl</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> trial)<span class="keyword"> override </span>{</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;    caas_-&gt;run();</div>
<div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;  }</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160; </div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;  <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a> p_;</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;  <span class="keywordtype">bool</span> external_memory_;</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nlclcells_;</div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;  <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ace4111c506c2eee9eabe531907e5d650">CAAST::Ptr</a> caas_;</div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;  <span class="keyword">typename</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">CAAST::RealList</a> buf1_, buf2_;</div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160; </div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;  <span class="keyword">static</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> get_nllclcells (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; rank) {</div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nlclcells = ncells / <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>;</div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> todo = ncells - nlclcells * <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>;</div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;    <span class="keywordflow">if</span> (rank &lt; todo) ++nlclcells;</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;    <span class="keywordflow">return</span> nlclcells;</div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;  }</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;};</div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160; </div>
<div class="line"><a name="l04128"></a><span class="lineno"><a class="line" href="namespacecedr_1_1caas_1_1test.html#a76970efe7100a1c7ab6ef420e0a45d5c"> 4128</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1caas_1_1test.html#a76970efe7100a1c7ab6ef420e0a45d5c">unittest</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; p) {</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> = p-&gt;size();</div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nlclcells : {1, 2, 4, 11}) {</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;    <a class="code" href="namespacecedr.html#a9b1ef9093cb8aed0e6bb1317bc27053e">Long</a> ncells = <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>*nlclcells;</div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;    <span class="keywordflow">if</span> (ncells &gt; <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>) ncells -= <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>/2;</div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">bool</span> own_reducer : {<span class="keyword">false</span>, <span class="keyword">true</span>})</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;      <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">bool</span> external_memory : {<span class="keyword">false</span>, <span class="keyword">true</span>})</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;        nerr += <a class="code" href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html">TestCAAS</a>(p, ncells, own_reducer, external_memory, <span class="keyword">false</span>)</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;          .<a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a2b823e264295db343e072086f2ac80f7">run</a>&lt;<a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">TestCAAS::CAAST</a>&gt;(1, <span class="keyword">false</span>);</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;  }</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;}</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;} <span class="comment">// namespace caas</span></div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160; </div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_SERIAL</span></div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">cedr::caas::CAAS&lt;Kokkos::Serial&gt;</a>;</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_OPENMP</span></div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">cedr::caas::CAAS&lt;Kokkos::OpenMP&gt;</a>;</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_CUDA</span></div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">cedr::caas::CAAS&lt;Kokkos::Cuda&gt;</a>;</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;<span class="preprocessor">#ifdef KOKKOS_ENABLE_THREADS</span></div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;<span class="keyword">template</span> <span class="keyword">class </span><a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">cedr::caas::CAAS&lt;Kokkos::Threads&gt;</a>;</div>
<div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160; </div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;<span class="comment">//&gt;&gt; cedr_test_randomized.cpp</span></div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160; </div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;<span class="comment">//#include &quot;cedr_test_randomized.hpp&quot;</span></div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160; </div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160; </div>
<div class="line"><a name="l04167"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a5e211d7b5ce0d93e738b39c969ffa580"> 4167</a></span>&#160;std::string TestRandomized::Tracer::str ()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;  std::stringstream ss;</div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;(ti &quot;</span> &lt;&lt; idx;</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;  <span class="keywordflow">if</span> (problem_type &amp; PT::conserve) ss &lt;&lt; <span class="stringliteral">&quot; c&quot;</span>;</div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;  <span class="keywordflow">if</span> (problem_type &amp; PT::shapepreserve) ss &lt;&lt; <span class="stringliteral">&quot; s&quot;</span>;</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;  <span class="keywordflow">if</span> (problem_type &amp; PT::consistent) ss &lt;&lt; <span class="stringliteral">&quot; t&quot;</span>;</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;  <span class="keywordflow">if</span> (problem_type &amp; PT::nonnegative) ss &lt;&lt; <span class="stringliteral">&quot; nn&quot;</span>;</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot; pt &quot;</span> &lt;&lt; perturbation_type &lt;&lt; <span class="stringliteral">&quot; ssh &quot;</span> &lt;&lt; safe_should_hold</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;     &lt;&lt; <span class="stringliteral">&quot; lsh &quot;</span> &lt;&lt; local_should_hold &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;  <span class="keywordflow">return</span> ss.str();</div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;}</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160; </div>
<div class="line"><a name="l04179"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#afea30e4be158d5f880325c10443c273b"> 4179</a></span>&#160;TestRandomized::Writer::~Writer () {</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;  <span class="keywordflow">if</span> ( ! fh) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;  fprintf(fh.get(), <span class="stringliteral">&quot;  return s\n&quot;</span>);</div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;}</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160; </div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;<span class="keywordtype">void</span> TestRandomized::init_tracers_vector () {</div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="structcedr_1_1_problem_type.html">Tracer::PT</a> PT;</div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> pts[] = {</div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;    PT::conserve | PT::shapepreserve | PT::consistent,</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;    PT::shapepreserve,</div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;    PT::conserve | PT::consistent,</div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;    PT::consistent,</div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;    PT::nonnegative,</div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;    PT::nonnegative | PT::conserve</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;  };</div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> tracer_idx = 0;</div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> perturb = 0; perturb &lt; 6; ++perturb)</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ti = 0; ti &lt; <span class="keyword">sizeof</span>(pts)/<span class="keyword">sizeof</span>(*pts); ++ti) {</div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;      Tracer t;</div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;      t.problem_type = pts[ti];</div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> shapepreserve = t.problem_type &amp; PT::shapepreserve;</div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> nonnegative = t.problem_type &amp; PT::nonnegative;</div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;      t.idx = tracer_idx++;</div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;      t.perturbation_type = perturb;</div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;      t.safe_should_hold = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;      t.no_change_should_hold = perturb == 0;</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;      t.local_should_hold = perturb &lt; 4 &amp;&amp; (shapepreserve || nonnegative);</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;      t.write = perturb == 2 &amp;&amp; ti == 2;</div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;      tracers_.push_back(t);</div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;    }</div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;}</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160; </div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;<span class="keyword">static</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> urand () { <span class="keywordflow">return</span> rand() / ((<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>) RAND_MAX + 1.0); }</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160; </div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;<span class="keywordtype">void</span> TestRandomized::generate_rho (Values&amp; v) {</div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;  <span class="keyword">auto</span> r = v.rhom();</div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n = v.ncells();</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;    r[i] = 0.5*(1 + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>());</div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;}</div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160; </div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;<span class="keywordtype">void</span> TestRandomized::generate_Q (<span class="keyword">const</span> Tracer&amp; t, Values&amp; v) {</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* rhom = v.rhom(), * Qm_min = v.Qm_min(t.idx), * Qm = v.Qm(t.idx),</div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;    * Qm_max = v.Qm_max(t.idx), * Qm_prev = v.Qm_prev(t.idx);</div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n = v.ncells();</div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> nonneg_only = t.problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">ProblemType::nonnegative</a>;</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;    <span class="keywordflow">if</span> (nonneg_only) {</div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      <span class="comment">// Make sure the generated Qm is globally positive.</span></div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;      Qm[i] = (t.no_change_should_hold ?</div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;               <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>() :</div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;               ((i % 2 == 0) ? 0.75 : -0.75) + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>());</div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;      <span class="comment">// Qm_min,max are unused in QLT, but need them to be set here for</span></div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;      <span class="comment">// bookkeeping in check().</span></div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;      Qm_min[i] = 0;</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;      Qm_max[i] = 10;</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;      <span class="comment">// The typical use case has 0 &lt;= q_min &lt;= q, but test with general sign.</span></div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a></div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;        q_min = -0.75 + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>(),</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;        q_max = q_min + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>(),</div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;        q = q_min + (q_max - q_min)*<a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>();</div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;      <span class="comment">// Check correctness up to FP.</span></div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(q_min &lt;= q &amp;&amp; q &lt;= q_max);</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;      Qm_min[i] = q_min*rhom[i];</div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;      Qm_max[i] = q_max*rhom[i];</div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;      <span class="comment">// Protect against FP error.</span></div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;      Qm[i] = std::max&lt;Real&gt;(Qm_min[i], <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(Qm_max[i], q*rhom[i]));</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;    }</div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;    <span class="comment">// Set previous Qm to the current unperturbed value.</span></div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    Qm_prev[i] = Qm[i];</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;  }</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;}</div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160; </div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> gen_rand_perm (<span class="keyword">const</span> <span class="keywordtype">size_t</span> n, std::vector&lt;Int&gt;&amp; p) {</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;  p.resize(n);</div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;    p[i] = i;</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> j = <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>()*n, <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">urand</a>()*n;</div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;    <a class="code" href="namespacecedr_1_1impl.html#a8e755217625cff5769f89160b2bdcd68">std::swap</a>(p[j], p[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>]);</div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;  }</div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;}</div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160; </div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;<span class="comment">// Permuting the Qm array, even just on a rank as long as there is &gt; 1 cell,</span></div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;<span class="comment">// produces a problem likely requiring considerable reconstruction, which</span></div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;<span class="comment">// reconstruction assuredly satisfies the properties. But because this is a</span></div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;<span class="comment">// local operation only, it doesn&#39;t test the 1 cell/rank case.</span></div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;<span class="keywordtype">void</span> TestRandomized::permute_Q (<span class="keyword">const</span> Tracer&amp; t, Values&amp; v) {</div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> Qm = v.Qm(t.idx);</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> N = v.ncells();</div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;  std::vector&lt;Int&gt; p;</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;  gen_rand_perm(N, p);</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;  std::vector&lt;Real&gt; Qm_orig(N);</div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;  std::copy(Qm, Qm + N, Qm_orig.begin());</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; N; ++i)</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;    Qm[i] = Qm_orig[p[i]];</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;}</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160; </div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;<span class="keywordtype">void</span> TestRandomized</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;::add_const_to_Q (<span class="keyword">const</span> Tracer&amp; t, Values&amp; v,</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;                  <span class="comment">// Move 0 &lt; alpha &lt;= 1 of the way to the QLT or safety</span></div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;                  <span class="comment">// feasibility bound.</span></div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;                  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; alpha,</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;                  <span class="comment">// Whether the modification should be done in a</span></div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;                  <span class="comment">// mass-conserving way.</span></div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;                  <span class="keyword">const</span> <span class="keywordtype">bool</span> conserve_mass,</div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;                  <span class="comment">// Only safety problem is feasible.</span></div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;                  <span class="keyword">const</span> <span class="keywordtype">bool</span> safety_problem) {</div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;  <span class="comment">// Some of these reductions aren&#39;t used at present. Might add more test</span></div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;  <span class="comment">// options later that use them.</span></div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> rhom, Qm, Qm_max; {</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_sum_lcl[3] = {0};</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; v.ncells(); ++i) {</div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;      Qm_sum_lcl[0] += v.rhom()[i];</div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;      Qm_sum_lcl[1] += v.Qm(t.idx)[i];</div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;      Qm_sum_lcl[2] += v.Qm_max(t.idx)[i];</div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;    }</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_sum_gbl[3] = {0};</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">mpi::all_reduce</a>(*p_, Qm_sum_lcl, Qm_sum_gbl, 3, MPI_SUM);</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;    rhom = Qm_sum_gbl[0]; Qm = Qm_sum_gbl[1]; Qm_max = Qm_sum_gbl[2];</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;  }</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> Qm_max_safety = 0;</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;  <span class="keywordflow">if</span> (safety_problem &amp;&amp; v.ncells()) {</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q_safety_lcl = v.Qm_max(t.idx)[0] / v.rhom()[0];</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt; v.ncells(); ++i)</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;      q_safety_lcl = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(q_safety_lcl, v.Qm_max(t.idx)[i] / v.rhom()[i]);</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q_safety_gbl = 0;</div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">mpi::all_reduce</a>(*p_, &amp;q_safety_lcl, &amp;q_safety_gbl, 1, MPI_MAX);</div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;    Qm_max_safety = q_safety_gbl*rhom;</div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;  }</div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> dQm = safety_problem ?</div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;    ((Qm_max - Qm) + alpha * (Qm_max_safety - Qm_max)) / ncells_ :</div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;    alpha * (Qm_max - Qm) / ncells_;</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; v.ncells(); ++i)</div>
<div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;    v.Qm(t.idx)[i] += dQm;</div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;  <span class="comment">// Now permute Qm so that it&#39;s a little more interesting.</span></div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;  permute_Q(t, v);</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;  <span class="comment">// Adjust Qm_prev. Qm_prev is used to test the PT::conserve case, and also</span></div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;  <span class="comment">// simply to record the correct total mass. The modification above modified</span></div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;  <span class="comment">// Q&#39;s total mass. If conserve_mass, then Qm_prev needs to be made to sum to</span></div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;  <span class="comment">// the same new mass. If ! conserve_mass, we want Qm_prev to be modified in</span></div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;  <span class="comment">// an interesting way, so that PT::conserve doesn&#39;t trivially undo the mod</span></div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;  <span class="comment">// that was made above when the root fixes the mass discrepancy.</span></div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a></div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;    relax = 0.9,</div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;    dQm_prev = (conserve_mass ? dQm :</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;                (safety_problem ?</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;                 ((Qm_max - Qm) + relax*alpha * (Qm_max_safety - Qm_max)) / ncells_ :</div>
<div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;                 relax*alpha * (Qm_max - Qm) / ncells_));</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; v.ncells(); ++i)</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;    v.Qm_prev(t.idx)[i] += dQm_prev;</div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;}</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160; </div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;<span class="keywordtype">void</span> TestRandomized::perturb_Q (<span class="keyword">const</span> Tracer&amp; t, Values&amp; v) {</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;  <span class="comment">// QLT is naturally mass conserving. But if QLT isn&#39;t being asked to impose</span></div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;  <span class="comment">// mass conservation, then the caller better have a conservative</span></div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;  <span class="comment">// method. Here, we model that by saying that Qm_prev and Qm should sum to</span></div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;  <span class="comment">// the same mass.</span></div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> cm = ! (t.problem_type &amp; Tracer::PT::conserve);</div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;  <span class="comment">// For the edge cases, we cannot be exactly on the edge and still expect the</span></div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;  <span class="comment">// q-limit checks to pass to machine precision. Thus, back away from the</span></div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;  <span class="comment">// edge by an amount that bounds the error in the global mass due to FP,</span></div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;  <span class="comment">// assuming each cell&#39;s mass is O(1).</span></div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> edg = 1 - ncells_*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>();</div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;  <span class="keywordflow">switch</span> (t.perturbation_type) {</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;  <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;    <span class="comment">// Do nothing, to test that QLT doesn&#39;t make any changes if none is</span></div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;    <span class="comment">// needed.</span></div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;  <span class="keywordflow">case</span> 1: permute_Q(t, v); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;  <span class="keywordflow">case</span> 2: add_const_to_Q(t, v, 0.5, cm, <span class="keyword">false</span>); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;  <span class="keywordflow">case</span> 3: add_const_to_Q(t, v, edg, cm, <span class="keyword">false</span>); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;  <span class="keywordflow">case</span> 4: add_const_to_Q(t, v, 0.5, cm, <span class="keyword">true</span> ); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;  <span class="keywordflow">case</span> 5: add_const_to_Q(t, v, edg, cm, <span class="keyword">true</span> ); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;  }</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;}</div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160; </div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;std::string TestRandomized::get_tracer_name (<span class="keyword">const</span> Tracer&amp; t) {</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;  std::stringstream ss;</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;  ss &lt;&lt; <span class="stringliteral">&quot;t&quot;</span> &lt;&lt; t.idx;</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;  <span class="keywordflow">return</span> ss.str();</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;}</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160; </div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;<span class="keywordtype">void</span> TestRandomized::init_writer () {</div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;  <span class="keywordflow">if</span> (p_-&gt;amroot()) {</div>
<div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;    w_ = std::make_shared&lt;Writer&gt;();</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;    w_-&gt;fh = std::unique_ptr&lt;FILE, cedr::util::FILECloser&gt;(fopen(<span class="stringliteral">&quot;out_QLT.py&quot;</span>, <span class="stringliteral">&quot;w&quot;</span>));</div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;    <span class="keywordtype">int</span> n = gcis_.size();</div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;    w_-&gt;ngcis.resize(p_-&gt;size());</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a81666edb64563b7477056b7612b9ef16">mpi::gather</a>(*p_, &amp;n, 1, w_-&gt;ngcis.data(), 1, p_-&gt;root());</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;    w_-&gt;displs.resize(p_-&gt;size() + 1);</div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;    w_-&gt;displs[0] = 0;</div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; w_-&gt;ngcis.size(); ++i)</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;      w_-&gt;displs[i+1] = w_-&gt;displs[i] + w_-&gt;ngcis[i];</div>
<div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(w_-&gt;displs.back() == ncells_);</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;    w_-&gt;gcis.resize(ncells_);</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a400d5cae4d1c0616beee60e458a54f36">mpi::gatherv</a>(*p_, gcis_.data(), gcis_.size(), w_-&gt;gcis.data(), w_-&gt;ngcis.data(),</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;                 w_-&gt;displs.data(), p_-&gt;root());</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;    <span class="keywordtype">int</span> n = gcis_.size();</div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a81666edb64563b7477056b7612b9ef16">mpi::gather</a>(*p_, &amp;n, 1, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span>*<span class="keyword">&gt;</span>(<span class="keyword">nullptr</span>), 0, p_-&gt;root());</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;    <a class="code" href="namespacecedr.html#a9b1ef9093cb8aed0e6bb1317bc27053e">Long</a>* Lnull = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span>* inull = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a400d5cae4d1c0616beee60e458a54f36">mpi::gatherv</a>(*p_, gcis_.data(), gcis_.size(), Lnull, inull, inull, p_-&gt;root());</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;  }</div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;  write_inited_ = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;}</div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160; </div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;<span class="keywordtype">void</span> TestRandomized</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;::gather_field (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* Qm_lcl, std::vector&lt;Real&gt;&amp; Qm_gbl,</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;                std::vector&lt;Real&gt;&amp; wrk) {</div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;  <span class="keywordflow">if</span> (p_-&gt;amroot()) {</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;    Qm_gbl.resize(ncells_);</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;    wrk.resize(ncells_);</div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a400d5cae4d1c0616beee60e458a54f36">mpi::gatherv</a>(*p_, Qm_lcl, gcis_.size(), wrk.data(), w_-&gt;ngcis.data(),</div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;                 w_-&gt;displs.data(), p_-&gt;root());</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; ncells_; ++i)</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;      Qm_gbl[w_-&gt;gcis[i]] = wrk[i];</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* rnull = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span>* inull = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#a400d5cae4d1c0616beee60e458a54f36">mpi::gatherv</a>(*p_, Qm_lcl, gcis_.size(), rnull, inull, inull, p_-&gt;root());</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;  }</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;}</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160; </div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;<span class="keywordtype">void</span> TestRandomized</div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;::write_field (<span class="keyword">const</span> std::string&amp; tracer_name, <span class="keyword">const</span> std::string&amp; field_name,</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;               <span class="keyword">const</span> std::vector&lt;Real&gt;&amp; Qm) {</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;  <span class="keywordflow">if</span> ( ! p_-&gt;amroot()) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;  fprintf(w_-&gt;fh.get(), <span class="stringliteral">&quot;  s.%s.%s = [&quot;</span>, tracer_name.c_str(), field_name.c_str());</div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; e : Qm)</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;    fprintf(w_-&gt;fh.get(), <span class="stringliteral">&quot;%1.15e, &quot;</span>, e);</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;  fprintf(w_-&gt;fh.get(), <span class="stringliteral">&quot;]\n&quot;</span>);</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;}</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160; </div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;<span class="keywordtype">void</span> TestRandomized::write_pre (<span class="keyword">const</span> Tracer&amp; t, Values&amp; v) {</div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;  <span class="keywordflow">if</span> ( ! t.write) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;  std::vector&lt;Real&gt; f, wrk;</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;  <span class="keywordflow">if</span> ( ! write_inited_) {</div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;    init_writer();</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;    <span class="keywordflow">if</span> (w_)</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;      fprintf(w_-&gt;fh.get(),</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;              <span class="stringliteral">&quot;def getsolns():\n&quot;</span></div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;              <span class="stringliteral">&quot;  class Struct:\n&quot;</span></div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;              <span class="stringliteral">&quot;    pass\n&quot;</span></div>
<div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;              <span class="stringliteral">&quot;  s = Struct()\n&quot;</span></div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;              <span class="stringliteral">&quot;  s.all = Struct()\n&quot;</span>);</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;    gather_field(v.rhom(), f, wrk);</div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;    write_field(<span class="stringliteral">&quot;all&quot;</span>, <span class="stringliteral">&quot;rhom&quot;</span>, f);</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;  }</div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> name = get_tracer_name(t);</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;  <span class="keywordflow">if</span> (w_)</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;    fprintf(w_-&gt;fh.get(), <span class="stringliteral">&quot;  s.%s = Struct()\n&quot;</span>, name.c_str());</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;  gather_field(v.Qm_min(t.idx), f, wrk);</div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;  write_field(name, <span class="stringliteral">&quot;Qm_min&quot;</span>, f);</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;  gather_field(v.Qm_prev(t.idx), f, wrk);</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;  write_field(name, <span class="stringliteral">&quot;Qm_orig&quot;</span>, f);</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;  gather_field(v.Qm(t.idx), f, wrk);</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;  write_field(name, <span class="stringliteral">&quot;Qm_pre&quot;</span>, f);</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;  gather_field(v.Qm_max(t.idx), f, wrk);</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;  write_field(name, <span class="stringliteral">&quot;Qm_max&quot;</span>, f);</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;}</div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160; </div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;<span class="keywordtype">void</span> TestRandomized::write_post (<span class="keyword">const</span> Tracer&amp; t, Values&amp; v) {</div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;  <span class="keywordflow">if</span> ( ! t.write) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> name = get_tracer_name(t);</div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;  std::vector&lt;Real&gt; Qm, wrk;</div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;  gather_field(v.Qm(t.idx), Qm, wrk);</div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;  write_field(name, <span class="stringliteral">&quot;Qm_qlt&quot;</span>, Qm);</div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;}</div>
<div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160; </div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacehomme_1_1sl.html#a46e9e2574a59bf3476d8965cb14167bf">TestRandomized</a></div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;<a class="code" href="namespacehomme_1_1sl.html#a46e9e2574a59bf3476d8965cb14167bf">::check</a> (<span class="keyword">const</span> std::string&amp; cdr_name, <span class="keyword">const</span> mpi::Parallel&amp; p,</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;         <span class="keyword">const</span> std::vector&lt;Tracer&gt;&amp; ts, <span class="keyword">const</span> Values&amp; v) {</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">bool</span> details = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> eps = <a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>();</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> ulp3 = 3*eps;</div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> prefer_mass_con_to_bounds =</div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    options_.prefer_numerical_mass_conservation_to_numerical_bounds;</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> lv_tol = prefer_mass_con_to_bounds ? 100*eps : 0;</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> safety_tol = prefer_mass_con_to_bounds ? 100*eps : ulp3;</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;  std::vector&lt;Real&gt; lcl_mass(2*ts.size()), q_min_lcl(ts.size()), q_max_lcl(ts.size());</div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;  std::vector&lt;Int&gt; t_ok(ts.size(), 1), local_violated(ts.size(), 0);</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ti = 0; ti &lt; ts.size(); ++ti) {</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; t = ts[ti];</div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160; </div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(t.safe_should_hold);</div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> safe_only = ! t.local_should_hold;</div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> nonneg_only = t.problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">ProblemType::nonnegative</a>;</div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n = v.ncells();</div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* rhom = v.rhom(), * Qm_min = v.Qm_min(t.idx), * Qm = v.Qm(t.idx),</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;      * Qm_max = v.Qm_max(t.idx), * Qm_prev = v.Qm_prev(t.idx);</div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160; </div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;    q_min_lcl[ti] =  1e3;</div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;    q_max_lcl[ti] = -1e3;</div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> lv = (nonneg_only ?</div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;                       Qm[i] &lt; 0 :</div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;                       Qm[i] &lt; Qm_min[i] - lv_tol || Qm[i] &gt; Qm_max[i] + lv_tol);</div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;      <span class="keywordflow">if</span> (lv) local_violated[ti] = 1;</div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;      <span class="keywordflow">if</span> ( ! safe_only &amp;&amp; lv) {</div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;        <span class="comment">// If this fails at ~ machine eps, check r2l_nl_adjust_bounds code in</span></div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;        <span class="comment">// solve_node_problem.</span></div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;        <span class="keywordflow">if</span> (details)</div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;          <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;check q &quot;</span> &lt;&lt; t.str() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; Qm[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;             (Qm[i] &lt; Qm_min[i] ? Qm[i] - Qm_min[i] : Qm[i] - Qm_max[i]));</div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;        t_ok[ti] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;        ++nerr;</div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;      }</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;      <span class="keywordflow">if</span> (t.no_change_should_hold &amp;&amp; Qm[i] != Qm_prev[i]) {</div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;        <span class="keywordflow">if</span> (details)</div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;          <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;Q should be unchanged but is not: &quot;</span> &lt;&lt; Qm_prev[i] &lt;&lt; <span class="stringliteral">&quot; changed to &quot;</span> &lt;&lt;</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;             Qm[i] &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt; t.str());</div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        t_ok[ti] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;        ++nerr;</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;      }</div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;      lcl_mass[2*ti    ] += Qm_prev[i];</div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;      lcl_mass[2*ti + 1] += Qm[i];</div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;      q_min_lcl[ti] = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(q_min_lcl[ti], Qm_min[i]/rhom[i]);</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;      q_max_lcl[ti] = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(q_max_lcl[ti], Qm_max[i]/rhom[i]);</div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;    }</div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;  }</div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160; </div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;  std::vector&lt;Real&gt; q_min_gbl(ts.size(), 0), q_max_gbl(ts.size(), 0);</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;  <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">mpi::all_reduce</a>(p, q_min_lcl.data(), q_min_gbl.data(), q_min_lcl.size(), MPI_MIN);</div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;  <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">mpi::all_reduce</a>(p, q_max_lcl.data(), q_max_gbl.data(), q_max_lcl.size(), MPI_MAX);</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160; </div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ti = 0; ti &lt; ts.size(); ++ti) {</div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;    <span class="comment">// Check safety problem. If local_should_hold and it does, then the safety</span></div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;    <span class="comment">// problem is by construction also solved (since it&#39;s a relaxation of the</span></div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;    <span class="comment">// local problem).</span></div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; t = ts[ti];</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> safe_only = ! t.local_should_hold;</div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> nonneg_only = t.problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">ProblemType::nonnegative</a>;</div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;    <span class="keywordflow">if</span> (safe_only) {</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n = v.ncells();</div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* rhom = v.rhom(), * Qm_min = v.Qm_min(t.idx), * Qm = v.Qm(t.idx),</div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;        * Qm_max = v.Qm_max(t.idx);</div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> q_min = nonneg_only ? 0 : q_min_gbl[ti], q_max = q_max_gbl[ti];</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> delta = (q_max - q_min)*safety_tol;</div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> lv = (nonneg_only ?</div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;                         Qm[i] &lt; -ulp3 :</div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;                         (Qm[i] &lt; q_min*rhom[i] - delta ||</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;                          Qm[i] &gt; q_max*rhom[i] + delta));</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;        <span class="keywordflow">if</span> (lv) {</div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;          <span class="keywordflow">if</span> (details)</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;            <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;check q (safety) &quot;</span> &lt;&lt; t.str() &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; q_min*rhom[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;               &lt;&lt; Qm_min[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; Qm[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; Qm_max[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span></div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;               &lt;&lt; q_max*rhom[i] &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; (Qm[i] &lt; q_min*rhom[i] ?</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;                                             Qm[i] - q_min*rhom[i] :</div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;                                             Qm[i] - q_max*rhom[i]));</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;          t_ok[ti] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;          ++nerr;</div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;        }</div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;      }</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;    }</div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;  }</div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160; </div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;  std::vector&lt;Real&gt; glbl_mass(2*ts.size(), 0);</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;  <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">mpi::reduce</a>(p, lcl_mass.data(), glbl_mass.data(), lcl_mass.size(), MPI_SUM,</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;              p.root());</div>
<div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;  std::vector&lt;Int&gt; t_ok_gbl(ts.size(), 0);</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;  <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">mpi::reduce</a>(p, t_ok.data(), t_ok_gbl.data(), t_ok.size(), MPI_MIN, p.root());</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;  <span class="comment">// Right now we&#39;re not using these:</span></div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;  std::vector&lt;Int&gt; local_violated_gbl(ts.size(), 0);</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;  <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">mpi::reduce</a>(p, local_violated.data(), local_violated_gbl.data(),</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;              local_violated.size(), MPI_MAX, p.root());</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160; </div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;  <span class="keywordflow">if</span> (p.amroot()) {</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecontrol__mod.html#a19f70697971fe3e6502be3097865437a">tol</a> = 1e3*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>();</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ti = 0; ti &lt; ts.size(); ++ti) {</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;      <span class="comment">// Check mass conservation.</span></div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> desired_mass = glbl_mass[2*ti], actual_mass = glbl_mass[2*ti+1],</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;        <a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a> = <a class="code" href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">cedr::util::reldif</a>(desired_mass, actual_mass);</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">bool</span> mass_failed = <a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a> &gt; <a class="code" href="namespacecontrol__mod.html#a19f70697971fe3e6502be3097865437a">tol</a>;</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;      <span class="keywordflow">if</span> (mass_failed) {</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;        ++nerr;</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;        t_ok_gbl[ti] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;      }</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;      <span class="keywordflow">if</span> ( ! t_ok_gbl[ti]) {</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;FAIL &quot;</span> &lt;&lt; cdr_name &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; ts[ti].str();</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;        <span class="keywordflow">if</span> (mass_failed) std::cout &lt;&lt; <span class="stringliteral">&quot; mass re &quot;</span> &lt;&lt; <a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a>;</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;        <span class="comment">//pr(puf(desired_mass) pu(actual_mass));</span></div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;      }</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    }</div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;  }</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160; </div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;}</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;  </div>
<div class="line"><a name="l04573"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#a3ee5a0a03f871180cbac3bc818572022"> 4573</a></span>&#160;TestRandomized</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;::TestRandomized (<span class="keyword">const</span> std::string&amp; name, <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; p,</div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;                  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; ncells, <span class="keyword">const</span> <span class="keywordtype">bool</span> verbose,</div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;                  <span class="keyword">const</span> <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">CDR::Options</a> options)</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;  : cdr_name_(name), options_(options), p_(p), ncells_(ncells),</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;    write_inited_(false)</div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;{}</div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160; </div>
<div class="line"><a name="l04581"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1_test_randomized.html#acae3d5885de88a009da51bcfe2e818c5"> 4581</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#acae3d5885de88a009da51bcfe2e818c5">TestRandomized::init</a> () {</div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;  <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#a505fa093661dc6068f2979042a766d28">init_numbering</a>();</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;  init_tracers_vector();</div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;  <a class="code" href="classcedr_1_1test_1_1_test_randomized.html#ab9eaa4b79cfd68e55fd677a04ecae4e8">init_tracers</a>();</div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;}</div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160; </div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160; </div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;<span class="comment">//&gt;&gt; cedr_test_1d_transport.cpp</span></div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160; </div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;<span class="comment">//#include &quot;cedr_test.hpp&quot;</span></div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;<span class="comment">//#include &quot;cedr_qlt.hpp&quot;</span></div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;<span class="comment">//#include &quot;cedr_caas.hpp&quot;</span></div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160; </div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160; </div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> {</div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;<span class="keyword">namespace </span>test {</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;<span class="keyword">namespace </span>transport1d {</div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160; </div>
<div class="line"><a name="l04604"></a><span class="lineno"><a class="line" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html"> 4604</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespaceinterp__movie__mod.html#af417850ebbdd1ffe0e0080eb279fd2d2">interp</a> {</div>
<div class="line"><a name="l04605"></a><span class="lineno"><a class="line" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#a620a438fa741c9435e6cb6c3780ca1bd"> 4605</a></span>&#160;<span class="keyword">inline</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#a620a438fa741c9435e6cb6c3780ca1bd">to_periodic_core</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; xl, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; xr, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>&amp; <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>) {</div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> &gt;= xl &amp;&amp; <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> &lt;= xr) <span class="keywordflow">return</span> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>;</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> w = xr - xl, xmxl = <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> - xl;</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> - w*std::floor(xmxl / w);</div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;}</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160; </div>
<div class="line"><a name="l04611"></a><span class="lineno"><a class="line" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#aee0afb2988e04c0714704b9350c8fbfa"> 4611</a></span>&#160;<span class="keyword">inline</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#aee0afb2988e04c0714704b9350c8fbfa">get_slope</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[2], <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> y[2]) {</div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;  <span class="keywordflow">return</span> (y[1] - y[0]) / (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[1] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[0]);</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;}</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160; </div>
<div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l04616"></a><span class="lineno"><a class="line" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#af2b9037d2be847c271f93ca7019e9e4e"> 4616</a></span>&#160;<a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#af2b9037d2be847c271f93ca7019e9e4e">get_cubic</a> (<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacephysical__constants.html#a8f292bec2061eac2b56d3f01a57eeff2">dx</a>, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> v1, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> s1, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> v2, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> s2, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> c[4]) {</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> dx2 = <a class="code" href="namespacephysical__constants.html#a8f292bec2061eac2b56d3f01a57eeff2">dx</a>*<a class="code" href="namespacephysical__constants.html#a8f292bec2061eac2b56d3f01a57eeff2">dx</a>;</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> dx3 = dx2*<a class="code" href="namespacephysical__constants.html#a8f292bec2061eac2b56d3f01a57eeff2">dx</a>;</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> den = -dx3;</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> b1, b2;</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;  c[2] = s1;</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;  c[3] = v1;</div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;  b1 = v2 - <a class="code" href="namespacephysical__constants.html#a8f292bec2061eac2b56d3f01a57eeff2">dx</a>*c[2] - c[3];</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;  b2 = s2 - c[2];</div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;  c[0] = (2.0*b1 - <a class="code" href="namespacephysical__constants.html#a8f292bec2061eac2b56d3f01a57eeff2">dx</a>*b2) / den;</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;  c[1] = (-3.0*<a class="code" href="namespacephysical__constants.html#a8f292bec2061eac2b56d3f01a57eeff2">dx</a>*b1 + dx2*b2) / den;</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;}</div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160; </div>
<div class="line"><a name="l04629"></a><span class="lineno"><a class="line" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#a03d4626600d89587b948e34f86a92d76"> 4629</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#a03d4626600d89587b948e34f86a92d76">cubic_interp_periodic</a> (</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nx, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> y,</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> xi, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nxi, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* <span class="keyword">const</span> yi,</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>* <span class="keyword">const</span> dod)</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;{</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> nc = nx - 1;</div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;<span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;<span class="preprocessor"># pragma omp parallel for</span></div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> j = 0; j &lt; nxi; ++j) {</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> xi_per = <a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#a620a438fa741c9435e6cb6c3780ca1bd">to_periodic_core</a>(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[0], <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[nc], xi[j]);</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ip1 = std::upper_bound(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> + nx, xi_per) - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>;</div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;    <span class="comment">// Handle numerical issues at boundaries.</span></div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;    <span class="keywordflow">if</span> (ip1 == 0) ++ip1;</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ip1 == nx) --ip1;</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = ip1 - 1;</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;    <span class="comment">// Domain of dependence.</span></div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>* dodj = dod + 4*j;</div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; 4; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;      dodj[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>] = (i - 1 + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> + nc) % nc;</div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;    <span class="comment">// Slopes.</span></div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> at_start = i == 0, at_end = i == nc - 1;</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> smid = <a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#aee0afb2988e04c0714704b9350c8fbfa">get_slope</a>(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>+i, y+i);</div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> s1, s2;</div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;    <span class="keywordflow">if</span> (at_start) {</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> = (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[nc] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[nc-1]) / ((<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[1] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[0]) + (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[nc] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[nc-1]));</div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;      s1 = (1 - <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>)*<a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#aee0afb2988e04c0714704b9350c8fbfa">get_slope</a>(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>+nc-1, y+nc-1) + <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>*smid;</div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> = (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i-1]) / (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[ip1] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i-1]);</div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;      s1 = (1 - <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>)*<a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#aee0afb2988e04c0714704b9350c8fbfa">get_slope</a>(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>+i-1, y+i-1) + <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>*smid;</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;    }</div>
<div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;    <span class="keywordflow">if</span> (at_end) {</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> = (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[ip1] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]) / ((<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[ip1] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]) + (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[1] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[0]));</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;      s2 = (1 - <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>)*smid + <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>*<a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#aee0afb2988e04c0714704b9350c8fbfa">get_slope</a>(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, y);</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a> = (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[ip1] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]) / (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i+2] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]);</div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;      s2 = (1 - <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>)*smid + <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>*<a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#aee0afb2988e04c0714704b9350c8fbfa">get_slope</a>(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>+ip1, y+ip1);</div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;    }</div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;    <span class="comment">// Interp.</span></div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> c[4];</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;    <a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#af2b9037d2be847c271f93ca7019e9e4e">get_cubic</a>(<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[ip1] - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i], y[i], s1, y[ip1], s2, c);</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> xij = xi_per - <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;    yi[j] = (((c[0]*xij + c[1])*xij) + c[2])*xij + c[3];</div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;  }</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;}</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;} <span class="comment">// namespace interp</span></div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160; </div>
<div class="line"><a name="l04676"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html"> 4676</a></span>&#160;<span class="keyword">class </span><a class="code" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html">PyWriter</a> {</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;  <span class="keyword">typedef</span> std::unique_ptr&lt;FILE, cedr::util::FILECloser&gt; FilePtr;</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;  FilePtr fh_;</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;  <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html">PyWriter</a>(<span class="keyword">const</span> std::string&amp; filename);</div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;  <span class="keywordtype">void</span> write(<span class="keyword">const</span> std::string&amp; field_name, <span class="keyword">const</span> std::vector&lt;Real&gt;&amp; v) <span class="keyword">const</span>;</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;};</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160; </div>
<div class="line"><a name="l04684"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html#ab6de17c3bbbf8cf137408df91a06ef25"> 4684</a></span>&#160;PyWriter::PyWriter (<span class="keyword">const</span> std::string&amp; filename) {</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;  fh_ = FilePtr(fopen((filename + <span class="stringliteral">&quot;.py&quot;</span>).c_str(), <span class="stringliteral">&quot;w&quot;</span>));</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;  fprintf(fh_.get(), <span class="stringliteral">&quot;s = {};\n&quot;</span>);</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;}</div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160; </div>
<div class="line"><a name="l04689"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html#a76829c4c71648b552869b6b1c32bac2b"> 4689</a></span>&#160;<span class="keywordtype">void</span> PyWriter::write (<span class="keyword">const</span> std::string&amp; field_name, <span class="keyword">const</span> std::vector&lt;Real&gt;&amp; v)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;  fprintf(fh_.get(), <span class="stringliteral">&quot;s[&#39;%s&#39;] = [&quot;</span>, field_name.c_str());</div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; e: v)</div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;    fprintf(fh_.get(), <span class="stringliteral">&quot; %1.15e,&quot;</span>, e);</div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;  fprintf(fh_.get(), <span class="stringliteral">&quot;]\n&quot;</span>);</div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;}</div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160; </div>
<div class="line"><a name="l04696"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html"> 4696</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html">InitialCondition</a> {</div>
<div class="line"><a name="l04697"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a0afc5a23a3575d19828572474a2416a1ac20f36178f0cec638fecd03cbd31f535"> 4697</a></span>&#160;  <span class="keyword">enum</span> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a0afc5a23a3575d19828572474a2416a1">Enum</a> { sin, <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a0afc5a23a3575d19828572474a2416a1ac20f36178f0cec638fecd03cbd31f535">bell</a>, rect, uniform };</div>
<div class="line"><a name="l04698"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a96d256bc7588a2c6635edb4d12a87267"> 4698</a></span>&#160;  <span class="keyword">static</span> std::string <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a96d256bc7588a2c6635edb4d12a87267">convert</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a0afc5a23a3575d19828572474a2416a1">Enum</a>&amp; e) {</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;    <span class="keywordflow">switch</span> (e) {</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;    <span class="keywordflow">case</span> Enum::sin: <span class="keywordflow">return</span> <span class="stringliteral">&quot;sin&quot;</span>;</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;    <span class="keywordflow">case</span> Enum::bell: <span class="keywordflow">return</span> <span class="stringliteral">&quot;bell&quot;</span>;</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;    <span class="keywordflow">case</span> Enum::rect: <span class="keywordflow">return</span> <span class="stringliteral">&quot;rect&quot;</span>;</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;    <span class="keywordflow">case</span> Enum::uniform: <span class="keywordflow">return</span> <span class="stringliteral">&quot;uniform&quot;</span>;</div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;    }</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;InitialCondition::convert can&#39;t convert &quot;</span> &lt;&lt; e);</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;  }</div>
<div class="line"><a name="l04707"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a372463455b447aeb1beb9311a5475eda"> 4707</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a0afc5a23a3575d19828572474a2416a1">Enum</a> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a372463455b447aeb1beb9311a5475eda">convert</a> (<span class="keyword">const</span> std::string&amp; s) {</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;    <span class="keyword">using</span> <a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">util::eq</a>;</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(s, <span class="stringliteral">&quot;sin&quot;</span>)) <span class="keywordflow">return</span> Enum::sin;</div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(s, <span class="stringliteral">&quot;bell&quot;</span>)) <span class="keywordflow">return</span> Enum::bell;</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(s, <span class="stringliteral">&quot;rect&quot;</span>)) <span class="keywordflow">return</span> Enum::rect;</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(s, <span class="stringliteral">&quot;uniform&quot;</span>)) <span class="keywordflow">return</span> Enum::uniform;</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;InitialCondition::convert can&#39;t convert &quot;</span> &lt;&lt; s);</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;  }</div>
<div class="line"><a name="l04715"></a><span class="lineno"><a class="line" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a3131bcc84468541b84284e5b75e8b8f7"> 4715</a></span>&#160;  <span class="keyword">static</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a3131bcc84468541b84284e5b75e8b8f7">eval</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a0afc5a23a3575d19828572474a2416a1">Enum</a>&amp; ic, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>) {</div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;    <span class="keywordflow">switch</span> (ic) {</div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;    <span class="keywordflow">case</span> Enum::sin: <span class="keywordflow">return</span> 0.1 + 0.8*0.5*(1 + std::sin(6*M_PI*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>));</div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;    <span class="keywordflow">case</span> Enum::bell: <span class="keywordflow">return</span> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> &lt; 0.5 ? std::sin(2*M_PI*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>) : 0;</div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;    <span class="keywordflow">case</span> Enum::rect: <span class="keywordflow">return</span> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> &gt; 0.66 || <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> &lt; 0.33 ? 0 : 1;</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;    <span class="keywordflow">case</span> Enum::uniform: <span class="keywordflow">return</span> 0.42;</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;    }</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;InitialCondition::eval can&#39;t convert &quot;</span> &lt;&lt; ic);</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;  }</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;};</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160; </div>
<div class="line"><a name="l04726"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html"> 4726</a></span>&#160;<span class="keyword">class </span><a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html">Problem1D</a> {</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;  std::vector&lt;Real&gt; xb_, xcp_, rwrk_;</div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;  std::vector&lt;Int&gt; iwrk_;</div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160; </div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;  <span class="keywordtype">void</span> init_mesh (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ncells, <span class="keyword">const</span> <span class="keywordtype">bool</span> nonuniform_mesh) {</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;    xb_.resize(ncells+1);</div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;    xcp_.resize(ncells+1);</div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;    xb_[0] = 0;</div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;    <span class="keywordflow">if</span> (nonuniform_mesh) {</div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;      <span class="comment">// Large-scale, continuous variation in cell size, plus a huge jump at the</span></div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;      <span class="comment">// periodic boundary.</span></div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt;= ncells; ++i) {</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a> = <a class="code" href="namespacecedr_1_1util.html#aebb086baeee1459e0a42a4d659e044dc">cedr::util::square</a>(<a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>(i) / ncells);</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;        xb_[i] = 0.01 + sin(0.5*M_PI*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;      }</div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;      <span class="comment">// Random local cell sizes.</span></div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt;= ncells; ++i)</div>
<div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;        xb_[i] *= 0.3 + <a class="code" href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a>();</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;      <span class="comment">// Cumsum.</span></div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt;= ncells; ++i)</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;        xb_[i] += xb_[i-1];</div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;      <span class="comment">// Normalize.</span></div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt;= ncells; ++i)</div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;        xb_[i] /= xb_[ncells];</div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;      xb_.back() = 1;</div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 1; i &lt; ncells; ++i)</div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;        xb_[i] = <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>(i) / ncells;</div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;    }</div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; ncells; ++i)</div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;      xcp_[i] = 0.5*(xb_[i] + xb_[i+1]);</div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;    xcp_.back() = 1 + xcp_[0];</div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;  }</div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160; </div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> run_cdr (<span class="keyword">const</span> <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html">Problem1D</a>&amp; p, <a class="code" href="structcedr_1_1_c_d_r.html">CDR</a>&amp; cdr,</div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;                       <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* yp, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>* dods) {</div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n = p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a95c4ffeb3eb88dad18584acb48ac8cb8">ncells</a>();</div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>* dod = dods + 4*i;</div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;      <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a> = yp[dod[0]], <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a> = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>;</div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> j = 1; j &lt; 4; ++j) {</div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> v = yp[dod[j]];</div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;        <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a> = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(<a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>, v);</div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;        <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a> = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(<a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a>, v);</div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;      }</div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> area_i = p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">area</a>(i);</div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;      cdr.<a class="code" href="structcedr_1_1_c_d_r.html#ab3033b2dc6b8acf8868adc840e8687cb">set_Qm</a>(i, 0, y[i]*area_i, <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>*area_i, <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a>*area_i, yp[i]*area_i);</div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;    }</div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;    cdr.<a class="code" href="structcedr_1_1_c_d_r.html#aa988cb015d9ac7de1464d4e5f7240e2c">run</a>();</div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;      y[i] = cdr.<a class="code" href="structcedr_1_1_c_d_r.html#a00c495105fab3b2436e6c97d2da5135d">get_Qm</a>(i, 0) / p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">area</a>(i);</div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;    y[n] = y[0];</div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;  }</div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160; </div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">void</span> run_caas (<span class="keyword">const</span> <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html">Problem1D</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* yp, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>* dods) {</div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n = p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a95c4ffeb3eb88dad18584acb48ac8cb8">ncells</a>();</div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;    std::vector&lt;Real&gt; lo(n), up(n), w(n);</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> m = 0;</div>
<div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>* dod = dods + 4*i;</div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;      <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a> = yp[dod[0]], <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a> = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>;</div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> j = 1; j &lt; 4; ++j) {</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> v = yp[dod[j]];</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;        <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a> = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(<a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>, v);</div>
<div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;        <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a> = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(<a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a>, v);</div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;      }</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> area_i = p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">area</a>(i);</div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;      lo[i] = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>*area_i;</div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;      up[i] = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a>*area_i;</div>
<div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;      y[i] = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(<a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">min</a>, <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(<a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">max</a>, y[i]));</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;      m += (yp[i] - y[i])*area_i;</div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;    }</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> wsum = 0;</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;      w[i] = m &gt;= 0 ? up[i] - y[i]*p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">area</a>(i) : y[i]*p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">area</a>(i) - lo[i];</div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;      wsum += w[i];</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;    }</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;      y[i] += (m/(wsum*p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">area</a>(i)))*w[i];</div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;  }</div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160; </div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l04808"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#adc6ca00ee69b4ebc0229b15d9539656d"> 4808</a></span>&#160;  <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#adc6ca00ee69b4ebc0229b15d9539656d">Problem1D</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ncells, <span class="keyword">const</span> <span class="keywordtype">bool</span> nonuniform_mesh = <span class="keyword">false</span>) {</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;    init_mesh(ncells, nonuniform_mesh);</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;  }</div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160; </div>
<div class="line"><a name="l04812"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a95c4ffeb3eb88dad18584acb48ac8cb8"> 4812</a></span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a95c4ffeb3eb88dad18584acb48ac8cb8">ncells</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> xb_.size() - 1; }</div>
<div class="line"><a name="l04813"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a001164de65718b4dfb41235ac211a9cd"> 4813</a></span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a001164de65718b4dfb41235ac211a9cd">xb</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> xb_[i]; }</div>
<div class="line"><a name="l04814"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#aa2f24490faa360af980b3e3f1499efd8"> 4814</a></span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#aa2f24490faa360af980b3e3f1499efd8">xcp</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> xcp_[i]; }</div>
<div class="line"><a name="l04815"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4"> 4815</a></span>&#160;  <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">area</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; i)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> xb_[i+1] - xb_[i]; }</div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160; </div>
<div class="line"><a name="l04817"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ad9a1760a6cebd3b7df668e8304d772eb"> 4817</a></span>&#160;  <span class="keyword">const</span> std::vector&lt;Real&gt; <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ad9a1760a6cebd3b7df668e8304d772eb">get_xb</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> xb_; }</div>
<div class="line"><a name="l04818"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a6fbdc16ef380f9676d2167cb00857d8e"> 4818</a></span>&#160;  <span class="keyword">const</span> std::vector&lt;Real&gt; <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a6fbdc16ef380f9676d2167cb00857d8e">get_xcp</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> xcp_; }</div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160; </div>
<div class="line"><a name="l04820"></a><span class="lineno"><a class="line" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ae27c7a9777ced5358071b94ce9d98488"> 4820</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ae27c7a9777ced5358071b94ce9d98488">cycle</a> (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>&amp; nsteps, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* y0, <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* yf, <a class="code" href="structcedr_1_1_c_d_r.html">CDR</a>* cdr = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> n = xcp_.size();</div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;    rwrk_.resize(2*n);</div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;    iwrk_.resize(4*n);</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* xcpi = rwrk_.data();</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;    <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>* dod = iwrk_.data();</div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160; </div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a> xos = -1.0 / nsteps;</div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; n; ++i)</div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;      xcpi[i] = xcp_[i] + xos;</div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160; </div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;    <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>* ys[] = {xcpi + n, yf};</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;    std::copy(y0, y0 + n, ys[0]);</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ti = 0; ti &lt; nsteps; ++ti) {</div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;      <a class="code" href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#a03d4626600d89587b948e34f86a92d76">interp::cubic_interp_periodic</a>(xcp_.data(), n, ys[0],</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;                                    xcpi, n, ys[1], dod);</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;      <span class="keywordflow">if</span> (cdr)</div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;        run_cdr(*<span class="keyword">this</span>, *cdr, ys[0], ys[1], dod);</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;        run_caas(*<span class="keyword">this</span>, ys[0], ys[1], dod);</div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;      <a class="code" href="namespacecedr_1_1impl.html#a8e755217625cff5769f89160b2bdcd68">std::swap</a>(ys[0], ys[1]);</div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;    }</div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;    std::copy(ys[0], ys[0] + n, yf);</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;  }</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;};</div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160; </div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;<span class="comment">//todo Clean this up. Right now everything is hardcoded and kludgy.</span></div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;<span class="comment">// - optional write</span></div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;<span class="comment">// - some sort of brief quantitative output</span></div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;<span class="comment">// - better, more canonical IC</span></div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;<span class="comment">// - optional tree imbalance</span></div>
<div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;<span class="comment">// - optional mesh nonuniformity</span></div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;<span class="comment">// - parallel?</span></div>
<div class="line"><a name="l04853"></a><span class="lineno"><a class="line" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71"> 4853</a></span>&#160;<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">run</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">mpi::Parallel::Ptr</a>&amp; parallel, <span class="keyword">const</span> <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html">Input</a>&amp; in) {</div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(parallel-&gt;size() &gt; 1, <span class="stringliteral">&quot;run_1d_transport_test runs in serial only.&quot;</span>);</div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;  <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nerr = 0;</div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160; </div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;  <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html">Problem1D</a> p(in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>, <span class="keyword">false</span> <span class="comment">/* nonuniform_mesh */</span> );</div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160; </div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;  <span class="keyword">auto</span> tree = <a class="code" href="namespacecedr_1_1qlt_1_1tree.html#a30aba1281f9c0c2c90d3066d6d17d78c">qlt::tree::make_tree_over_1d_mesh</a>(parallel, in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>,</div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;                                                <span class="keyword">false</span> <span class="comment">/* imbalanced */</span>);</div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">qlt::QLT&lt;Kokkos::DefaultHostExecutionSpace&gt;</a> QLTT;</div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;  QLTT qltnn(parallel, in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>, tree), <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>(parallel, in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>, tree);</div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160; </div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">caas::CAAS&lt;Kokkos::DefaultHostExecutionSpace&gt;</a> CAAST;</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;  CAAST <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a>(parallel, in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>);</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160; </div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;  <a class="code" href="structcedr_1_1_c_d_r.html">CDR</a>* cdrs[] = {&amp;qltnn, &amp;<a class="code" href="namespacecedr_1_1qlt.html">qlt</a>, &amp;<a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a>};</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ncdrs = <span class="keyword">sizeof</span>(cdrs)/<span class="keyword">sizeof</span>(*cdrs);</div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160; </div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;  <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="structcedr_1_1_c_d_r.html">CDR</a>* cdr : cdrs) {</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;    <span class="keywordflow">if</span> (first) {</div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;      QLTT* <a class="code" href="namespacecedr_1_1qlt.html">qlt</a> = <span class="keyword">dynamic_cast&lt;</span>QLTT*<span class="keyword">&gt;</span>(cdr);</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<a class="code" href="namespacecedr_1_1qlt.html">qlt</a>);</div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;      <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>-&gt;declare_tracer(<a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">cedr::ProblemType::conserve</a> |</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;                          <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">cedr::ProblemType::nonnegative</a>, 0);</div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;      first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;      cdr-&gt;declare_tracer(<a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">cedr::ProblemType::conserve</a> |</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;                          <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">cedr::ProblemType::shapepreserve</a>, 0);</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;    cdr-&gt;end_tracer_declarations();</div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;    cdr-&gt;finish_setup();</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>; ++i)</div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;      cdr-&gt;set_rhom(i, 0, p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">area</a>(i));</div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;    cdr-&gt;print(std::cout);</div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;  }</div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160; </div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;  std::vector&lt;Real&gt; y0(in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>+1);</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0, nc = p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a95c4ffeb3eb88dad18584acb48ac8cb8">ncells</a>(); i &lt; nc; ++i)</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;    y0[i] = (p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#aa2f24490faa360af980b3e3f1499efd8">xcp</a>(i) &lt; 0.4 || p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#aa2f24490faa360af980b3e3f1499efd8">xcp</a>(i) &gt; 0.9 ?</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;             InitialCondition::eval(InitialCondition::sin, p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#aa2f24490faa360af980b3e3f1499efd8">xcp</a>(i)) :</div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;             InitialCondition::eval(InitialCondition::rect, p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#aa2f24490faa360af980b3e3f1499efd8">xcp</a>(i)));</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;  y0.back() = y0[0];</div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160; </div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;  <a class="code" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html">PyWriter</a> w(<span class="stringliteral">&quot;out_transport1d&quot;</span>);</div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;  w.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html#a76829c4c71648b552869b6b1c32bac2b">write</a>(<span class="stringliteral">&quot;xb&quot;</span>, p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ad9a1760a6cebd3b7df668e8304d772eb">get_xb</a>());</div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;  w.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html#a76829c4c71648b552869b6b1c32bac2b">write</a>(<span class="stringliteral">&quot;xcp&quot;</span>, p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a6fbdc16ef380f9676d2167cb00857d8e">get_xcp</a>());</div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;  w.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html#a76829c4c71648b552869b6b1c32bac2b">write</a>(<span class="stringliteral">&quot;y0&quot;</span>, y0);</div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160; </div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;  std::vector&lt;Real&gt; yf(in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>+1);</div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> nsteps = <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>(3.17*in.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>);</div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> ncycles = 1;</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;  </div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* names[] = {<span class="stringliteral">&quot;yqltnn&quot;</span>, <span class="stringliteral">&quot;yqlt&quot;</span>, <span class="stringliteral">&quot;ycaas&quot;</span>};</div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ic = 0; ic &lt; ncdrs; ++ic) {</div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;    std::copy(y0.begin(), y0.end(), yf.begin());</div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; ncycles; ++i)</div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;      p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ae27c7a9777ced5358071b94ce9d98488">cycle</a>(nsteps, yf.data(), yf.data(), cdrs[ic]);</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;    w.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html#a76829c4c71648b552869b6b1c32bac2b">write</a>(names[ic], yf);</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;  }</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160; </div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;  std::copy(y0.begin(), y0.end(), yf.begin());</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a> i = 0; i &lt; ncycles; ++i)</div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;    p.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ae27c7a9777ced5358071b94ce9d98488">cycle</a>(nsteps, yf.data(), yf.data());</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;  w.<a class="code" href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html#a76829c4c71648b552869b6b1c32bac2b">write</a>(<span class="stringliteral">&quot;ylcaas&quot;</span>, yf);</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160; </div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;}</div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160; </div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;} <span class="comment">// namespace transport1d</span></div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;} <span class="comment">// namespace test</span></div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160; </div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;<span class="comment">//&gt;&gt; cedr_test.cpp</span></div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;<span class="comment">// COMPOSE version 1.0: Copyright 2018 NTESS. This software is released under</span></div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;<span class="comment">// the BSD license; see LICENSE in the top-level directory.</span></div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160; </div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;<span class="comment">//#include &quot;cedr_qlt.hpp&quot;</span></div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;<span class="comment">//#include &quot;cedr_caas.hpp&quot;</span></div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;<span class="comment">//#include &quot;cedr_mpi.hpp&quot;</span></div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;<span class="comment">//#include &quot;cedr_util.hpp&quot;</span></div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;<span class="comment">//#include &quot;cedr_test.hpp&quot;</span></div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160; </div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;<span class="preprocessor">#include &lt;stdexcept&gt;</span></div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160; </div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr.html">cedr</a> { </div>
<div class="line"><a name="l04938"></a><span class="lineno"><a class="line" href="structcedr_1_1_input_parser.html"> 4938</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structcedr_1_1_input_parser.html">InputParser</a> {</div>
<div class="line"><a name="l04939"></a><span class="lineno"><a class="line" href="structcedr_1_1_input_parser.html#aa73524ff8c932b20105dcb15334d3179"> 4939</a></span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html">qlt::test::Input</a> <a class="code" href="structcedr_1_1_input_parser.html#aa73524ff8c932b20105dcb15334d3179">qin</a>;</div>
<div class="line"><a name="l04940"></a><span class="lineno"><a class="line" href="structcedr_1_1_input_parser.html#a748d975eebfa4a55c7fc21c6f6e11ec0"> 4940</a></span>&#160;  <a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html">test::transport1d::Input</a> <a class="code" href="structcedr_1_1_input_parser.html#a748d975eebfa4a55c7fc21c6f6e11ec0">tin</a>;</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160; </div>
<div class="line"><a name="l04942"></a><span class="lineno"><a class="line" href="classcedr_1_1_input_parser_1_1_arg_advancer.html"> 4942</a></span>&#160;  <span class="keyword">class </span><a class="code" href="classcedr_1_1_input_parser_1_1_arg_advancer.html">ArgAdvancer</a> {</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> argc_;</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;    <span class="keywordtype">char</span> <span class="keyword">const</span>* <span class="keyword">const</span>* argv_;</div>
<div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;    <span class="keywordtype">int</span> i_;</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;  <span class="keyword">public</span>:</div>
<div class="line"><a name="l04947"></a><span class="lineno"><a class="line" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a69ac1c8f2bc75a0ef08d5ea5106fe810"> 4947</a></span>&#160;    <a class="code" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a69ac1c8f2bc75a0ef08d5ea5106fe810">ArgAdvancer</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) : argc_(argc), argv_(argv), i_(1) {}</div>
<div class="line"><a name="l04948"></a><span class="lineno"><a class="line" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a2b45f79c3e9fe14e3b09bb1133715043"> 4948</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a2b45f79c3e9fe14e3b09bb1133715043">advance</a> () {</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;      <span class="keywordflow">if</span> (i_+1 &gt;= argc_) <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;Command line is missing an argument.&quot;</span>);</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;      <span class="keywordflow">return</span> argv_[++i_];</div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;    }</div>
<div class="line"><a name="l04952"></a><span class="lineno"><a class="line" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a74d9a6c03914607b1b7932320093b544"> 4952</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a74d9a6c03914607b1b7932320093b544">token</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> argv_[i_]; }</div>
<div class="line"><a name="l04953"></a><span class="lineno"><a class="line" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#aa59140f9e0706a2cc1646519fbc94201"> 4953</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#aa59140f9e0706a2cc1646519fbc94201">incr</a> () { ++i_; }</div>
<div class="line"><a name="l04954"></a><span class="lineno"><a class="line" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#ad98a308fab7f73a2ce4ade28b26b94ca"> 4954</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#ad98a308fab7f73a2ce4ade28b26b94ca">more</a> ()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> i_ &lt; argc_; }</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;  };</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;  </div>
<div class="line"><a name="l04957"></a><span class="lineno"><a class="line" href="structcedr_1_1_input_parser.html#adcd233bba43b0f23f97e6befa3fe4007"> 4957</a></span>&#160;  <a class="code" href="structcedr_1_1_input_parser.html#adcd233bba43b0f23f97e6befa3fe4007">InputParser</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv, <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">qlt::Parallel::Ptr</a>&amp; p) {</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;    <span class="keyword">using</span> <a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">util::eq</a>;</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a64b2c5e120cc9ba459c69a6f29bc6bd7">unittest</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ab62561957a57c9969924cf7cefaf25cf">perftest</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a6c43827bc4fa990eb3fb972249b92403">write</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">ncells</a> = 0;</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a4e1833af1045e63a2a2532fa7db02b6a">ntracers</a> = 1;</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a0a6ccc5d94ae8e3f487f331da739ba94">tracer_type</a> = 0;</div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#aa0f64406587f313e9309fa0c13530e16">nrepeat</a> = 1;</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a7317dba6f9385c1369b162913ed7ab92">pseudorandom</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;    qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a3891ebb2177bb10e34b50fee35a6a908">verbose</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;    tin.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a> = 0;</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="classcedr_1_1_input_parser_1_1_arg_advancer.html">ArgAdvancer</a> aa(argc, argv); aa.<a class="code" href="classcedr_1_1_input_parser_1_1_arg_advancer.html#ad98a308fab7f73a2ce4ade28b26b94ca">more</a>(); aa.incr()) {</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span>* token = aa.token();</div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-t&quot;</span>, <span class="stringliteral">&quot;--unittest&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a64b2c5e120cc9ba459c69a6f29bc6bd7">unittest</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-pt&quot;</span>, <span class="stringliteral">&quot;--perftest&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ab62561957a57c9969924cf7cefaf25cf">perftest</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-w&quot;</span>, <span class="stringliteral">&quot;--write&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a6c43827bc4fa990eb3fb972249b92403">write</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-nc&quot;</span>, <span class="stringliteral">&quot;--ncells&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">ncells</a> = std::atoi(aa.advance());</div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-nt&quot;</span>, <span class="stringliteral">&quot;--ntracers&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a4e1833af1045e63a2a2532fa7db02b6a">ntracers</a> = std::atoi(aa.advance());</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-tt&quot;</span>, <span class="stringliteral">&quot;--tracertype&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a0a6ccc5d94ae8e3f487f331da739ba94">tracer_type</a> = std::atoi(aa.advance());</div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-nr&quot;</span>, <span class="stringliteral">&quot;--nrepeat&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#aa0f64406587f313e9309fa0c13530e16">nrepeat</a> = std::atoi(aa.advance());</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;--proc-random&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a7317dba6f9385c1369b162913ed7ab92">pseudorandom</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-v&quot;</span>, <span class="stringliteral">&quot;--verbose&quot;</span>)) qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a3891ebb2177bb10e34b50fee35a6a908">verbose</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">eq</a>(token, <span class="stringliteral">&quot;-t1d&quot;</span>, <span class="stringliteral">&quot;--transport1dtest&quot;</span>)) tin.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a> = 1;</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;      <span class="keywordflow">else</span> <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;Invalid token &quot;</span> &lt;&lt; token);</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;    }</div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160; </div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;    <span class="keywordflow">if</span> (tin.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a>) {</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;      tin.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">ncells</a> = qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">ncells</a>;</div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;      tin.<a class="code" href="structcedr_1_1test_1_1transport1d_1_1_input.html#ab1ce2cdac0384c4e09992db35e1a25b7">verbose</a> = qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a3891ebb2177bb10e34b50fee35a6a908">verbose</a>;</div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;    }</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160; </div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a0a6ccc5d94ae8e3f487f331da739ba94">tracer_type</a> &lt; 0 || qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a0a6ccc5d94ae8e3f487f331da739ba94">tracer_type</a> &gt;= 4,</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;                  <span class="stringliteral">&quot;Tracer type is out of bounds [0, 3].&quot;</span>);</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a4e1833af1045e63a2a2532fa7db02b6a">ntracers</a> &lt; 1, <span class="stringliteral">&quot;Number of tracers is &lt; 1.&quot;</span>);</div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;  }</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160; </div>
<div class="line"><a name="l04994"></a><span class="lineno"><a class="line" href="structcedr_1_1_input_parser.html#a5468ccca3270edc8f8766e4a3bd4b61a"> 4994</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structcedr_1_1_input_parser.html#a5468ccca3270edc8f8766e4a3bd4b61a">print</a> (std::ostream&amp; os)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;ncells &quot;</span> &lt;&lt; qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">ncells</a></div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;       &lt;&lt; <span class="stringliteral">&quot; nrepeat &quot;</span> &lt;&lt; qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#aa0f64406587f313e9309fa0c13530e16">nrepeat</a>;</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;    <span class="keywordflow">if</span> (qin.<a class="code" href="structcedr_1_1qlt_1_1test_1_1_input.html#a7317dba6f9385c1369b162913ed7ab92">pseudorandom</a>) os &lt;&lt; <span class="stringliteral">&quot; random&quot;</span>;</div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;  }</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;};</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;} <span class="comment">// namespace cedr</span></div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160; </div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;<span class="comment">// -------------------- Homme-specific impl details -------------------- //</span></div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160; </div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;<span class="comment">// Includes if using compose library.</span></div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;<span class="preprocessor">#include &quot;compose/cedr.hpp&quot;</span></div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;<span class="comment">// Use these when rewriting each CDR&#39;s run() function to interact nicely with</span></div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;<span class="comment">// Homme&#39;s nested OpenMP and top-level horizontal threading scheme.</span></div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;<span class="preprocessor">#include &quot;compose/cedr_qlt.hpp&quot;</span></div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;<span class="preprocessor">#include &quot;compose/cedr_caas.hpp&quot;</span></div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160; </div>
<div class="line"><a name="l05014"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a1db4f124f17b089d8d6ba732ed29c19d"> 5014</a></span>&#160;<span class="preprocessor">#define THREAD_QLT_RUN</span></div>
<div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;<span class="preprocessor">#ifndef QLT_MAIN</span></div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;<span class="preprocessor"># ifdef HAVE_CONFIG_H</span></div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;<span class="preprocessor">#  include &quot;config.h.c&quot;</span></div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;<span class="preprocessor"># endif</span></div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160; </div>
<div class="line"><a name="l05021"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a50ae31c6c80236b8edcba1c59bd9caa1"> 5021</a></span>&#160;<span class="keyword">typedef</span> Kokkos::DefaultHostExecutionSpace <a class="code" href="compose__cedr_8cpp.html#a50ae31c6c80236b8edcba1c59bd9caa1">ComposeDefaultExecutionSpace</a>;</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160; </div>
<div class="line"><a name="l05023"></a><span class="lineno"><a class="line" href="namespacehomme.html"> 5023</a></span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacehomme.html">homme</a> {</div>
<div class="line"><a name="l05024"></a><span class="lineno"><a class="line" href="namespacehomme_1_1compose.html"> 5024</a></span>&#160;<span class="keyword">namespace </span>compose {</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160; </div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> ES&gt;</div>
<div class="line"><a name="l05027"></a><span class="lineno"><a class="line" href="classhomme_1_1compose_1_1_q_l_t.html"> 5027</a></span>&#160;<span class="keyword">class </span><a class="code" href="classhomme_1_1compose_1_1_q_l_t.html">QLT</a> : <span class="keyword">public</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">cedr::qlt::QLT&lt;ES&gt;</a> {</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">Int</a>;</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">cedr::Real</a> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">Real</a>;</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">cedr::qlt::QLT&lt;ES&gt;</a> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html">Super</a>;</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;  <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classcedr_1_1qlt_1_1_q_l_t.html#a073b0d26f059d049d8b66c5d1799e3e3">Super::RealList</a> RealList;</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160; </div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;  <span class="comment">//todo All of this VerticalLevelsData-related code should be impl&#39;ed</span></div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;  <span class="comment">// using a new optional root-node-function QLT registration function.</span></div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;  <span class="keyword">struct </span>VerticalLevelsData {</div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;    <span class="keyword">typedef</span> std::shared_ptr&lt;VerticalLevelsData&gt; <a class="code" href="structcedr_1_1_c_d_r.html#a3c8346ee469398a071419e53fdbe7b74">Ptr</a>;</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160; </div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;    RealList lo, hi, mass, ones, wrk;</div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160; </div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;    VerticalLevelsData (<span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a> n)</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;      : lo(<span class="stringliteral">&quot;lo&quot;</span>, n), hi(<span class="stringliteral">&quot;hi&quot;</span>, n), mass(<span class="stringliteral">&quot;mass&quot;</span>, n), ones(<span class="stringliteral">&quot;ones&quot;</span>, n), wrk(<span class="stringliteral">&quot;wrk&quot;</span>, n)</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;    {</div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; n; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) ones(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) = 1;</div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;    }</div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;  };</div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160; </div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;  <span class="keyword">typename</span> VerticalLevelsData::Ptr vld_;</div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160; </div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;  <span class="keywordtype">void</span> reconcile_vertical (<span class="keyword">const</span> Int problem_type, <span class="keyword">const</span> Int bd_os,</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;                           <span class="keyword">const</span> Int bis, <span class="keyword">const</span> Int bie) {</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;    <span class="keyword">using</span> <a class="code" href="structcedr_1_1_problem_type.html">cedr::ProblemType</a>;</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160; </div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>((problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">ProblemType::shapepreserve</a>) &amp;&amp;</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;                (problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a>));</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160; </div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;    <span class="keyword">auto</span>&amp; md = this-&gt;md_;</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;    <span class="keyword">auto</span>&amp; bd = this-&gt;bd_;</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; vld = *vld_;</div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;    <span class="keyword">const</span> Int <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> = vld.lo.extent_int(0);</div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;    <span class="keyword">const</span> Int nprob = (bie - bis)/<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>;</div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160; </div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;<span class="preprocessor">#   pragma omp master</span></div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;    <span class="keywordflow">for</span> (Int <a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a> = 0; <a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a> &lt; nprob; ++<a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>) {</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;      <span class="keyword">const</span> Int bd_os_pi = bd_os + md.a_d.trcr2bl2r(md.a_d.bidx2trcr(bis + <a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>));</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;<span class="preprocessor">#ifdef RV_DIAG</span></div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;      Real oob = 0;</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;      Real tot_mass = 0;</div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;      <span class="keywordflow">for</span> (Int <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;        <span class="keyword">const</span> Int bd_os_k = bd_os_pi + nprob*4*<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>;</div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;        vld.lo  (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) = bd.l2r_data(bd_os_k    );</div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;        vld.hi  (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) = bd.l2r_data(bd_os_k + 2);</div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;        vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) = bd.l2r_data(bd_os_k + 3); <span class="comment">// previous mass, not current one</span></div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;        tot_mass += vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;<span class="preprocessor">#ifdef RV_DIAG</span></div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;        <span class="keywordflow">if</span> (vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) &lt; vld.lo(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)) oob += vld.lo(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) - vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;        <span class="keywordflow">if</span> (vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) &gt; vld.hi(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)) oob += vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) - vld.hi(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;      }</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;      solve(<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, vld, tot_mass);</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;      Real tot_mass_slv = 0, oob_slv = 0;</div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;      <span class="keywordflow">for</span> (Int <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;        <span class="keyword">const</span> Int bd_os_k = bd_os_pi + nprob*4*<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>;</div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;        bd.l2r_data(bd_os_k + 3) = vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>); <span class="comment">// previous mass, not current one</span></div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;<span class="preprocessor">#ifdef RV_DIAG</span></div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;        tot_mass_slv += vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;        <span class="keywordflow">if</span> (vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) &lt; vld.lo(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)) oob_slv += vld.lo(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) - vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;        <span class="keywordflow">if</span> (vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) &gt; vld.hi(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)) oob_slv += vld.mass(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) - vld.hi(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>);</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;      }</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;<span class="preprocessor">#ifdef RV_DIAG</span></div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;      printf(<span class="stringliteral">&quot;%2d %9.2e %9.2e %9.2e %9.2e\n&quot;</span>, <a class="code" href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">pi</a>,</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;             oob/tot_mass, oob_slv/tot_mass,</div>
<div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;             tot_mass, std::abs(tot_mass_slv - tot_mass)/tot_mass);</div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;    }</div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;<span class="preprocessor">#   pragma omp barrier</span></div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;  }</div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160; </div>
<div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;  <span class="keyword">static</span> Int solve (<span class="keyword">const</span> Int n, <span class="keyword">const</span> Real* <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <span class="keyword">const</span> Real <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>,</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;                    <span class="keyword">const</span> Real* xlo, <span class="keyword">const</span> Real* xhi,</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;                    Real* <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, Real* wrk) {</div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> &gt;= 0);</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i] &gt; 0);</div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(xlo[i] &gt;= 0);</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(xhi[i] &gt;= xlo[i]);</div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;    }</div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;    Int <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = 0;</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;    Real tot_lo = 0, tot_hi = 0;</div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) tot_lo += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*xlo[i];</div>
<div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) tot_hi += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*xhi[i];</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> &lt; tot_lo) {</div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;      <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = -2;</div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;      <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) wrk[i] = 0;</div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;      <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = xlo[i];</div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;      <span class="comment">// Find a new xlo &gt;= 0 minimally far from the current one. This</span></div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;      <span class="comment">// is also the solution x.</span></div>
<div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;      <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">cedr::local::caas</a>(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, wrk, xlo, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> &gt; tot_hi) {</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;      <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = -1;</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;      <span class="keyword">const</span> Real f = <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>/tot_hi;</div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;      <span class="comment">// a[i] divides out.</span></div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;      <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = f*xhi[i];</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;      <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">cedr::local::caas</a>(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;    }</div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a>;</div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;  }</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160; </div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;  <span class="keyword">static</span> Int solve (<span class="keyword">const</span> Int <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <span class="keyword">const</span> VerticalLevelsData&amp; vld,</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;                    <span class="keyword">const</span> Real&amp; tot_mass) {</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;    solve(<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, vld.ones.data(), tot_mass, vld.lo.data(), vld.hi.data(),</div>
<div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;          vld.mass.data(), vld.wrk.data());    </div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;  }</div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160; </div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;  <span class="keyword">static</span> Int solve_unittest () {</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> eps = <a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>();</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> Int n = 7;</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160; </div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;    Real <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[n], xlo[n], xhi[n], <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[n], wrk[n];</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> Real x0  [n] = { 1.2, 0.5,3  , 2  , 1.5, 1.8,0.2};</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> Real dxlo[n] = {-0.1,-0.2,0.5,-1.5,-0.1,-1.1,0.1};</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> Real dxhi[n] = { 0.1,-0.1,1  ,-0.5, 0.1,-0.2,0.5};</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i] = i+1;</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) xlo[i] = x0[i] + dxlo[i];</div>
<div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) xhi[i] = x0[i] + dxhi[i];</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;    Real <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, b1;</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;    Int <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a>, nerr = 0;</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160; </div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> check_mass = [&amp;] () {</div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;      b1 = 0;</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;      <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) b1 += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i];</div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;      <span class="keywordflow">if</span> (std::abs(b1 - <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>) &gt;= 10*eps*<a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>) ++nerr;</div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;    };</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160; </div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = x0[i];</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;    <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = 0;</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*xlo[i];</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;    <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> *= 0.9;</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;    <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = solve(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, wrk);</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> != -2) ++nerr;</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;    check_mass();</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &gt; xhi[i]*(1 + 10*eps)) ++nerr;</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160; </div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = x0[i];</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;    <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = 0;</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> += <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*xhi[i];</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;    <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> *= 1.1;</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;    <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = solve(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, wrk);</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> != -1) ++nerr;</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;    check_mass();</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &lt; xlo[i]*(1 - 10*eps)) ++nerr;</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160; </div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = x0[i];</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;    <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> = 0;</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a> += 0.5*<a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>[i]*(xlo[i] + xhi[i]);</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;    <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = solve(n, <a class="code" href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">a</a>, <a class="code" href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">b</a>, xlo, xhi, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, wrk);</div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> != 0) ++nerr;</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    check_mass();</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &lt; xlo[i]*(1 - 10*eps)) ++nerr;</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;    <span class="keywordflow">for</span> (Int i = 0; i &lt; n; ++i) <span class="keywordflow">if</span> (<a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] &gt; xhi[i]*(1 + 10*eps)) ++nerr;</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160; </div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;    <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;  }</div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160; </div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l05194"></a><span class="lineno"><a class="line" href="classhomme_1_1compose_1_1_q_l_t.html#a4d575508c75491193be3b5b2872ca803"> 5194</a></span>&#160;  <a class="code" href="classhomme_1_1compose_1_1_q_l_t.html#a4d575508c75491193be3b5b2872ca803">QLT</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a>&amp; ncells,</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;       <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">cedr::qlt::tree::Node::Ptr</a>&amp; tree, <span class="keyword">const</span> <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">cedr::CDR::Options</a>&amp; options,</div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;       <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a>&amp; vertical_levels)</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;    : <a class="code" href="namespacecedr.html">cedr</a>::<a class="code" href="namespacecedr_1_1qlt.html">qlt</a>::<a class="code" href="classhomme_1_1compose_1_1_q_l_t.html">QLT</a>&lt;ES&gt;(p, ncells, tree, options)</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;  {</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;    <span class="keywordflow">if</span> (vertical_levels)</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;      vld_ = std::make_shared&lt;VerticalLevelsData&gt;(vertical_levels);</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;  }</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160; </div>
<div class="line"><a name="l05203"></a><span class="lineno"><a class="line" href="classhomme_1_1compose_1_1_q_l_t.html#a57a3f6d94df5041b5a3153476232a8b2"> 5203</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="classhomme_1_1compose_1_1_q_l_t.html#a57a3f6d94df5041b5a3153476232a8b2">run</a> ()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> mpitag = 42;</div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;    <span class="keyword">using</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a>;</div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;    <span class="keyword">using</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">cedr::Real</a>;</div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;    <span class="keyword">using</span> <a class="code" href="structcedr_1_1_problem_type.html">cedr::ProblemType</a>;</div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;    <span class="keyword">using</span> <a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">cedr::qlt::impl::NodeSets</a>;</div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;    <span class="keyword">namespace </span>mpi = <a class="code" href="namespacecedr_1_1mpi.html">cedr::mpi</a>;</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;    <span class="keyword">auto</span>&amp; md_ = this-&gt;md_;</div>
<div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;    <span class="keyword">auto</span>&amp; bd_ = this-&gt;bd_;</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;    <span class="keyword">auto</span>&amp; ns_ = this-&gt;ns_;</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;    <span class="keyword">auto</span>&amp; p_ = this-&gt;p_;</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;<span class="preprocessor">#if ! defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;<span class="preprocessor">#   pragma omp master</span></div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;    {</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;      <span class="comment">// Number of data per slot.</span></div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;      <span class="keyword">const</span> Int l2rndps = md_.a_d.prob2bl2r[md_.nprobtypes];</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;      <span class="keyword">const</span> Int r2lndps = md_.a_d.prob2br2l[md_.nprobtypes];</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160; </div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;      <span class="comment">// Leaves to root.</span></div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> il = 0; il &lt; ns_-&gt;levels.size(); ++il) {</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;        <span class="keyword">auto</span>&amp; lvl = ns_-&gt;levels[il];</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160; </div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;        <span class="comment">// Set up receives.</span></div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;        <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>.size()) {</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;<span class="preprocessor">#         pragma omp master</span></div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;          {</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>.size(); ++i) {</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;              <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>[i];</div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;              <a class="code" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">mpi::irecv</a>(*p_, &amp;bd_.l2r_data(mmd.offset*l2rndps), mmd.size*l2rndps, mmd.rank,</div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;                         mpitag, &amp;lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">kids_req</a>[i]);</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;            }</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;            <a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">mpi::waitall</a>(lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">kids_req</a>.size(), lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">kids_req</a>.data());</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;          }</div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;<span class="preprocessor">#         pragma omp barrier</span></div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;        }</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160; </div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;        <span class="comment">// Combine kids&#39; data.</span></div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;        <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>.size()) {</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;<span class="preprocessor">#         pragma omp for</span></div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ni = 0; ni &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>.size(); ++ni) {</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> lvlidx = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>[ni];</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> n = ns_-&gt;node_h(lvlidx);</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;            <span class="keywordflow">if</span> ( ! n-&gt;nkids) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;            <a class="code" href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a>(n-&gt;nkids == 2);</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;            <span class="comment">// Total density.</span></div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;            bd_.l2r_data(n-&gt;offset*l2rndps) =</div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;              (bd_.l2r_data(ns_-&gt;node_h(n-&gt;kids[0])-&gt;offset*l2rndps) +</div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;               bd_.l2r_data(ns_-&gt;node_h(n-&gt;kids[1])-&gt;offset*l2rndps));</div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;            <span class="comment">// Tracers.</span></div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;            <span class="keywordflow">for</span> (Int pti = 0; pti &lt; md_.nprobtypes; ++pti) {</div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;              <span class="keyword">const</span> Int problem_type = md_.get_problem_type(pti);</div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">bool</span> nonnegative = problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">ProblemType::nonnegative</a>;</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">bool</span> shapepreserve = problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">ProblemType::shapepreserve</a>;</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;              <span class="keyword">const</span> <span class="keywordtype">bool</span> conserve = problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a>;</div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;              <span class="keyword">const</span> Int bis = md_.a_d.prob2trcrptr[pti], bie = md_.a_d.prob2trcrptr[pti+1];</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined COLUMN_OPENMP</span></div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;<span class="preprocessor">#             pragma omp parallel for</span></div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;              <span class="keywordflow">for</span> (Int bi = bis; bi &lt; bie; ++bi) {</div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;                <span class="keyword">const</span> Int bdi = md_.a_d.trcr2bl2r(md_.a_d.bidx2trcr(bi));</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;                Real* <span class="keyword">const</span> me = &amp;bd_.l2r_data(n-&gt;offset*l2rndps + bdi);</div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> kid0 = ns_-&gt;node_h(n-&gt;kids[0]);</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;                <span class="keyword">const</span> <span class="keyword">auto</span> kid1 = ns_-&gt;node_h(n-&gt;kids[1]);</div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;                <span class="keyword">const</span> Real* <span class="keyword">const</span> k0 = &amp;bd_.l2r_data(kid0-&gt;offset*l2rndps + bdi);</div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;                <span class="keyword">const</span> Real* <span class="keyword">const</span> k1 = &amp;bd_.l2r_data(kid1-&gt;offset*l2rndps + bdi);</div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;                <span class="keywordflow">if</span> (nonnegative) {</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;                  me[0] = k0[0] + k1[0];</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;                  <span class="keywordflow">if</span> (conserve) me[1] = k0[1] + k1[1];</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;                  me[0] = shapepreserve ? k0[0] + k1[0] : <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(k0[0], k1[0]);</div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;                  me[1] = k0[1] + k1[1];</div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;                  me[2] = shapepreserve ? k0[2] + k1[2] : <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(k0[2], k1[2]);</div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;                  <span class="keywordflow">if</span> (conserve) me[3] = k0[3] + k1[3] ;</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;                }</div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;              }</div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;            }</div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;          }</div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;        }</div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160; </div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;        <span class="comment">// Send to parents.</span></div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;        <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>.size())</div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;<span class="preprocessor">#       pragma omp master</span></div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;        {</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>.size(); ++i) {</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>[i];</div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;            <a class="code" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">mpi::isend</a>(*p_, &amp;bd_.l2r_data(mmd.offset*l2rndps), mmd.size*l2rndps,</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;                       mmd.rank, mpitag);</div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;          }</div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;        }</div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160; </div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;<span class="preprocessor">#       pragma omp barrier</span></div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;      }</div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160; </div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;      <span class="comment">// Root.</span></div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;      <span class="keywordflow">if</span> ( ! (ns_-&gt;levels.empty() || ns_-&gt;levels.back().nodes.size() != 1 ||</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;              ns_-&gt;node_h(ns_-&gt;levels.back().nodes[0])-&gt;parent &gt;= 0)) {</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> n = ns_-&gt;node_h(ns_-&gt;levels.back().nodes[0]);</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;        <span class="keywordflow">for</span> (Int pti = 0; pti &lt; md_.nprobtypes; ++pti) {</div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;          <span class="keyword">const</span> Int bis = md_.a_d.prob2trcrptr[pti], bie = md_.a_d.prob2trcrptr[pti+1];</div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;          <span class="keywordflow">if</span> (bie == bis) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;          <span class="keyword">const</span> Int problem_type = md_.get_problem_type(pti);</div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;          <span class="keywordflow">if</span> (vld_) reconcile_vertical(problem_type, n-&gt;offset*l2rndps, bis, bie);</div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP &amp;&amp; defined COLUMN_OPENMP</span></div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;<span class="preprocessor">#         pragma omp parallel</span></div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; (defined HORIZ_OPENMP || defined COLUMN_OPENMP)</span></div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;<span class="preprocessor">#         pragma omp for</span></div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;          <span class="keywordflow">for</span> (Int bi = bis; bi &lt; bie; ++bi) {</div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;            <span class="keyword">const</span> Int l2rbdi = md_.a_d.trcr2bl2r(md_.a_d.bidx2trcr(bi));</div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;            <span class="keyword">const</span> Int r2lbdi = md_.a_d.trcr2br2l(md_.a_d.bidx2trcr(bi));</div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;            <span class="comment">// If QLT is enforcing global mass conservation, set the root&#39;s r2l Qm</span></div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;            <span class="comment">// value to the l2r Qm_prev&#39;s sum; otherwise, copy the l2r Qm value to</span></div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;            <span class="comment">// the r2l one.</span></div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;            <span class="keyword">const</span> Int os = (problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">ProblemType::conserve</a> ?</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;                            md_.get_problem_type_l2r_bulk_size(problem_type) - 1 :</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;                            (problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">ProblemType::nonnegative</a> ? 0 : 1));</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;            bd_.r2l_data(n-&gt;offset*r2lndps + r2lbdi) =</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;              bd_.l2r_data(n-&gt;offset*l2rndps + l2rbdi + os);</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;            <span class="keywordflow">if</span> ((problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fac7b193334c098ff0d8259103fa8ce007">ProblemType::consistent</a>) &amp;&amp;</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;                ! (problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">ProblemType::shapepreserve</a>)) {</div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;              <span class="comment">// Consistent but not shape preserving, so we&#39;re solving a dynamic range</span></div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;              <span class="comment">// preservation problem. We now know the global q_{min,max}. Start</span></div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;              <span class="comment">// propagating it leafward.</span></div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;              bd_.r2l_data(n-&gt;offset*r2lndps + r2lbdi + 1) =</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;                bd_.l2r_data(n-&gt;offset*l2rndps + l2rbdi + 0);</div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;              bd_.r2l_data(n-&gt;offset*r2lndps + r2lbdi + 2) =</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;                bd_.l2r_data(n-&gt;offset*l2rndps + l2rbdi + 2);</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;            }</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;          }</div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;        }</div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;      }</div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160; </div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;      <span class="comment">// Root to leaves.</span></div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> il = ns_-&gt;levels.size(); il &gt; 0; --il) {</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;        <span class="keyword">auto</span>&amp; lvl = ns_-&gt;levels[il-1];</div>
<div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160; </div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;        <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>.size()) {</div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;<span class="preprocessor">#         pragma omp master</span></div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;          {</div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>.size(); ++i) {</div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;              <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">me</a>[i];</div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;              <a class="code" href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">mpi::irecv</a>(*p_, &amp;bd_.r2l_data(mmd.offset*r2lndps), mmd.size*r2lndps, mmd.rank,</div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;                         mpitag, &amp;lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a1958b88c6ac291db0d61b9097a4a0594">me_recv_req</a>[i]);</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;            }</div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;            <a class="code" href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">mpi::waitall</a>(lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a1958b88c6ac291db0d61b9097a4a0594">me_recv_req</a>.size(), lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a1958b88c6ac291db0d61b9097a4a0594">me_recv_req</a>.data());</div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;          }</div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;<span class="preprocessor">#         pragma omp barrier</span></div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;        }</div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160; </div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;        <span class="comment">// Solve QP for kids&#39; values.</span></div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;<span class="preprocessor">#       pragma omp for</span></div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ni = 0; ni &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>.size(); ++ni) {</div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> lvlidx = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">nodes</a>[ni];</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> n = ns_-&gt;node_h(lvlidx);</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;          <span class="keywordflow">if</span> ( ! n-&gt;nkids) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;          <span class="keywordflow">for</span> (Int pti = 0; pti &lt; md_.nprobtypes; ++pti) {</div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;            <span class="keyword">const</span> Int problem_type = md_.get_problem_type(pti);</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;            <span class="keyword">const</span> Int bis = md_.a_d.prob2trcrptr[pti], bie = md_.a_d.prob2trcrptr[pti+1];</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined COLUMN_OPENMP</span></div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;<span class="preprocessor">#           pragma omp parallel for</span></div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;            <span class="keywordflow">for</span> (Int bi = bis; bi &lt; bie; ++bi) {</div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;              <span class="keyword">const</span> Int l2rbdi = md_.a_d.trcr2bl2r(md_.a_d.bidx2trcr(bi));</div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;              <span class="keyword">const</span> Int r2lbdi = md_.a_d.trcr2br2l(md_.a_d.bidx2trcr(bi));</div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;              <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;nkids == 2);</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;              <span class="keywordflow">if</span> ((problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fac7b193334c098ff0d8259103fa8ce007">ProblemType::consistent</a>) &amp;&amp;</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;                  ! (problem_type &amp; <a class="code" href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">ProblemType::shapepreserve</a>)) {</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;                <span class="comment">// Pass q_{min,max} info along. l2r data are updated for use in</span></div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;                <span class="comment">// solve_node_problem. r2l data are updated for use in isend.</span></div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;                <span class="keyword">const</span> Real q_min = bd_.r2l_data(n-&gt;offset*r2lndps + r2lbdi + 1);</div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;                <span class="keyword">const</span> Real q_max = bd_.r2l_data(n-&gt;offset*r2lndps + r2lbdi + 2);</div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;                bd_.l2r_data(n-&gt;offset*l2rndps + l2rbdi + 0) = q_min;</div>
<div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;                bd_.l2r_data(n-&gt;offset*l2rndps + l2rbdi + 2) = q_max;</div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;                <span class="keywordflow">for</span> (Int <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; 2; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;                  <span class="keyword">const</span> <span class="keyword">auto</span> os = ns_-&gt;node_h(n-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>])-&gt;offset;</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;                  bd_.l2r_data(os*l2rndps + l2rbdi + 0) = q_min;</div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;                  bd_.l2r_data(os*l2rndps + l2rbdi + 2) = q_max;</div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;                  bd_.r2l_data(os*r2lndps + r2lbdi + 1) = q_min;</div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;                  bd_.r2l_data(os*r2lndps + r2lbdi + 2) = q_max;</div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;                }</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;              }</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;              <span class="keyword">const</span> <span class="keyword">auto</span> k0 = ns_-&gt;node_h(n-&gt;kids[0]);</div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;              <span class="keyword">const</span> <span class="keyword">auto</span> k1 = ns_-&gt;node_h(n-&gt;kids[1]);</div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;              <a class="code" href="namespacecedr_1_1qlt_1_1impl.html#a260e2670b5693de806396dae4059a947">cedr::qlt::impl::solve_node_problem</a>(</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;                problem_type,</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;                 bd_.l2r_data( n-&gt;offset*l2rndps),</div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;                &amp;bd_.l2r_data( n-&gt;offset*l2rndps + l2rbdi),</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;                 bd_.r2l_data( n-&gt;offset*r2lndps + r2lbdi),</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;                 bd_.l2r_data(k0-&gt;offset*l2rndps),</div>
<div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;                &amp;bd_.l2r_data(k0-&gt;offset*l2rndps + l2rbdi),</div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;                 bd_.r2l_data(k0-&gt;offset*r2lndps + r2lbdi),</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;                 bd_.l2r_data(k1-&gt;offset*l2rndps),</div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;                &amp;bd_.l2r_data(k1-&gt;offset*l2rndps + l2rbdi),</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;                 bd_.r2l_data(k1-&gt;offset*r2lndps + r2lbdi),</div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;                this-&gt;options_.prefer_numerical_mass_conservation_to_numerical_bounds);</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;            }</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;          }</div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;        }</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160; </div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;        <span class="comment">// Send.</span></div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;        <span class="keywordflow">if</span> (lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>.size())</div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;<span class="preprocessor">#if defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;<span class="preprocessor">#       pragma omp master</span></div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;        {</div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>.size(); ++i) {</div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mmd = lvl.<a class="code" href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">kids</a>[i];</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;            <a class="code" href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">mpi::isend</a>(*p_, &amp;bd_.r2l_data(mmd.offset*r2lndps), mmd.size*r2lndps,</div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;                       mmd.rank, mpitag);</div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;          }</div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;        }</div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;      }</div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;<span class="preprocessor">#if ! defined THREAD_QLT_RUN &amp;&amp; defined HORIZ_OPENMP</span></div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;    }</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;  }</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160; </div>
<div class="line"><a name="l05438"></a><span class="lineno"><a class="line" href="classhomme_1_1compose_1_1_q_l_t.html#ac43a1d5cb462af1ab00e0c636074f33e"> 5438</a></span>&#160;  <span class="keyword">static</span> Int <a class="code" href="classhomme_1_1compose_1_1_q_l_t.html#ac43a1d5cb462af1ab00e0c636074f33e">unittest</a> () {</div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;    <span class="keywordflow">return</span> solve_unittest();</div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;  }</div>
<div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;};</div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160; </div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;<span class="comment">// We explicitly use Kokkos::Serial here so we can run the Kokkos kernels in the</span></div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;<span class="comment">// super class w/o triggering an expecution-space initialization error in</span></div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;<span class="comment">// Kokkos. This complication results from the interaction of Homme&#39;s</span></div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;<span class="comment">// HORIZ_OPENMP threading with Kokkos kernels.</span></div>
<div class="line"><a name="l05447"></a><span class="lineno"><a class="line" href="structhomme_1_1compose_1_1_c_a_a_s.html"> 5447</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structhomme_1_1compose_1_1_c_a_a_s.html">CAAS</a> : <span class="keyword">public</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">cedr::caas::CAAS&lt;Kokkos::Serial&gt;</a> {</div>
<div class="line"><a name="l05448"></a><span class="lineno"><a class="line" href="structhomme_1_1compose_1_1_c_a_a_s.html#ae8f4c2856aecf1da86efc78184e9ba12"> 5448</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">cedr::caas::CAAS&lt;Kokkos::Serial&gt;</a> <a class="code" href="structhomme_1_1compose_1_1_c_a_a_s.html#ae8f4c2856aecf1da86efc78184e9ba12">Super</a>;</div>
<div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160; </div>
<div class="line"><a name="l05450"></a><span class="lineno"><a class="line" href="structhomme_1_1compose_1_1_c_a_a_s.html#aa35344117a2c3047d4bc232737882688"> 5450</a></span>&#160;  <a class="code" href="structhomme_1_1compose_1_1_c_a_a_s.html#aa35344117a2c3047d4bc232737882688">CAAS</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a> nlclcells,</div>
<div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;        <span class="keyword">const</span> <span class="keyword">typename</span> <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html#ace4111c506c2eee9eabe531907e5d650">Super::UserAllReducer::Ptr</a>&amp; uar)</div>
<div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;    : <a class="code" href="classcedr_1_1caas_1_1_c_a_a_s.html">Super</a>(p, nlclcells, uar)</div>
<div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;  {}</div>
<div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160; </div>
<div class="line"><a name="l05455"></a><span class="lineno"><a class="line" href="structhomme_1_1compose_1_1_c_a_a_s.html#aded87ebde8108fd6d98116c47770406b"> 5455</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structhomme_1_1compose_1_1_c_a_a_s.html#aded87ebde8108fd6d98116c47770406b">run</a> ()<span class="keyword"> override </span>{</div>
<div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;    <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">Super::run</a>();</div>
<div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;  }</div>
<div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;};</div>
<div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160; </div>
<div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;} <span class="comment">// namespace compose</span></div>
<div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;} <span class="comment">// namespace homme</span></div>
<div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160; </div>
<div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;<span class="preprocessor">#ifdef QLT_MAIN</span></div>
<div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;<span class="keywordtype">int</span> <a class="code" href="main_8_f90.html#a8ec2266d83cd6c0b762cbcbc92c0af3d">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {</div>
<div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;  <span class="keywordtype">int</span> nerr = 0, retval = 0;</div>
<div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;  MPI_Init(&amp;argc, &amp;argv);</div>
<div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;  <span class="keyword">auto</span> p = <a class="code" href="namespacecedr_1_1mpi.html#a6e572b78e7d5d0ff5a43cab685375bb3">cedr::mpi::make_parallel</a>(MPI_COMM_WORLD);</div>
<div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;  srand(p-&gt;rank());</div>
<div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;  <a class="code" href="namespacearkode__mod.html#a876a1cb648d7a4173b7b5532624b2743">Kokkos::initialize</a>(argc, argv);</div>
<div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;  <span class="keywordflow">try</span></div>
<div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;  {</div>
<div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;    <a class="code" href="structcedr_1_1_input_parser.html">cedr::InputParser</a> inp(argc, argv, p);</div>
<div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;    <span class="keywordflow">if</span> (p-&gt;amroot()) inp.print(std::cout);</div>
<div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;    <span class="keywordflow">if</span> (inp.qin.unittest) {</div>
<div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;      nerr += <a class="code" href="namespacecedr_1_1local.html#a0cae8843ba7d55d41e672b37311725c8">cedr::local::unittest</a>();</div>
<div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;      nerr += <a class="code" href="namespacecedr_1_1caas_1_1test.html#a76970efe7100a1c7ab6ef420e0a45d5c">cedr::caas::test::unittest</a>(p);</div>
<div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;    }</div>
<div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;    <span class="keywordflow">if</span> (inp.qin.unittest || inp.qin.perftest)</div>
<div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;      nerr += <a class="code" href="namespacecedr_1_1qlt_1_1test.html#abcc1c3037c40bfabd109c2046c1c8e11">cedr::qlt::test::run_unit_and_randomized_tests</a>(p, inp.qin);</div>
<div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;    <span class="keywordflow">if</span> (inp.tin.ncells &gt; 0)</div>
<div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;      nerr += <a class="code" href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">cedr::test::transport1d::run</a>(p, inp.tin);</div>
<div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;    {</div>
<div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;      <span class="keywordtype">int</span> gnerr;</div>
<div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;      <a class="code" href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">cedr::mpi::all_reduce</a>(*p, &amp;nerr, &amp;gnerr, 1, MPI_SUM);</div>
<div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;      retval = gnerr != 0 ? -1 : 0;</div>
<div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;      <span class="keywordflow">if</span> (p-&gt;amroot())</div>
<div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;        std::cout &lt;&lt; (gnerr != 0 ? <span class="stringliteral">&quot;FAIL&quot;</span> : <span class="stringliteral">&quot;PASS&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;    }</div>
<div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;  }</div>
<div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;  <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;    <span class="keywordflow">if</span> (p-&gt;amroot())</div>
<div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;      std::cerr &lt;&lt; e.what();</div>
<div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;    retval = -1;</div>
<div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;  }</div>
<div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;  Kokkos::finalize();</div>
<div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;  <span class="keywordflow">if</span> (nerr) <a class="code" href="compose__cedr_8cpp.html#aee1c2a81a0aaa758fb41ff058dd320bb">prc</a>(nerr);</div>
<div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;  MPI_Finalize();</div>
<div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;  <span class="keywordflow">return</span> retval;</div>
<div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;}</div>
<div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160; </div>
<div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacehomme.html">homme</a> {</div>
<div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacecedr_1_1qlt.html">qlt</a> = <a class="code" href="namespacecedr_1_1qlt.html">cedr::qlt</a>;</div>
<div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;<span class="keyword">using</span> <a class="code" href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a>;</div>
<div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;<span class="keyword">using</span> <a class="code" href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">cedr::Real</a>;</div>
<div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160; </div>
<div class="line"><a name="l05511"></a><span class="lineno"><a class="line" href="namespacehomme.html#acaf39abd7df32b38d4eea5c118cdf307"> 5511</a></span>&#160;<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacehomme.html#acaf39abd7df32b38d4eea5c118cdf307">rank2sfc_search</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* rank2sfc, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>&amp; nrank, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>&amp; sfc) {</div>
<div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;  <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> lo = 0, hi = nrank+1;</div>
<div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;  <span class="keywordflow">while</span> (hi &gt; lo + 1) {</div>
<div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> mid = (lo + hi)/2;</div>
<div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;    <span class="keywordflow">if</span> (sfc &gt;= rank2sfc[mid])</div>
<div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;      lo = mid;</div>
<div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;      hi = mid;</div>
<div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;  }</div>
<div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;  <span class="keywordflow">return</span> lo;</div>
<div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;}</div>
<div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160; </div>
<div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;<span class="comment">// Change leaf node-&gt;cellidx from index into space-filling curve to global cell</span></div>
<div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;<span class="comment">// index. owned_ids is in SFC index order for this rank.</span></div>
<div class="line"><a name="l05525"></a><span class="lineno"><a class="line" href="namespacehomme.html#ac845ba9fb30edd78f28183b1d09c73b9"> 5525</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#ae52e85d9df82bdcaa2a239573db554d8">renumber</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nrank, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> my_rank, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* owned_ids,</div>
<div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;               <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* rank2sfc, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; node) {</div>
<div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;  <span class="keywordflow">if</span> (node-&gt;nkids) {</div>
<div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; node-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;      <a class="code" href="namespacehomme.html#ae52e85d9df82bdcaa2a239573db554d8">renumber</a>(nrank, <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>, my_rank, owned_ids, rank2sfc, node-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>]);</div>
<div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sfc = node-&gt;cellidx;</div>
<div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;    node-&gt;cellidx = node-&gt;rank == my_rank ? owned_ids[sfc - rank2sfc[my_rank]] : -1;</div>
<div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>((node-&gt;rank != my_rank &amp;&amp; node-&gt;cellidx == -1) ||</div>
<div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;                (node-&gt;rank == my_rank &amp;&amp; node-&gt;cellidx &gt;= 0 &amp;&amp; node-&gt;cellidx &lt; <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>));</div>
<div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;  }</div>
<div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;}</div>
<div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160; </div>
<div class="line"><a name="l05538"></a><span class="lineno"><a class="line" href="namespacehomme.html#ae52e85d9df82bdcaa2a239573db554d8"> 5538</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#ae52e85d9df82bdcaa2a239573db554d8">renumber</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* sc2gci, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* sc2rank,</div>
<div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;               <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; node) {</div>
<div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;  <span class="keywordflow">if</span> (node-&gt;nkids) {</div>
<div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; node-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;      <a class="code" href="namespacehomme.html#ae52e85d9df82bdcaa2a239573db554d8">renumber</a>(sc2gci, sc2rank, node-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>]);</div>
<div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ci = node-&gt;cellidx;</div>
<div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;    node-&gt;cellidx = sc2gci[ci];</div>
<div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;    node-&gt;rank = sc2rank[ci];</div>
<div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;  }</div>
<div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;}</div>
<div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160; </div>
<div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;<span class="comment">// Build a subtree over [0, nsublev).</span></div>
<div class="line"><a name="l05551"></a><span class="lineno"><a class="line" href="namespacehomme.html#ada6b051e814140c49b92b94341ea3522"> 5551</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">add_sub_levels</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; node, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nsublev,</div>
<div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;                     <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> gci, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> my_rank, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> rank,</div>
<div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;                     <span class="keyword">const</span> <span class="keywordtype">bool</span> calc_level, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> slb, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sle) {</div>
<div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;  <span class="keywordflow">if</span> (slb+1 == sle) {</div>
<div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;    node-&gt;cellidx = rank == my_rank ? nsublev*gci + slb : -1;</div>
<div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;    <span class="keywordflow">if</span> (calc_level) node-&gt;level = 0;</div>
<div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;    node-&gt;nkids = 2;</div>
<div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; 2; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;      <span class="keyword">auto</span> kid = std::make_shared&lt;qlt::tree::Node&gt;();</div>
<div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;      kid-&gt;parent = node.get();</div>
<div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;      kid-&gt;rank = rank;</div>
<div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;      node-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>] = kid;</div>
<div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;    }</div>
<div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> mid = slb + (sle - slb)/2;</div>
<div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;    <a class="code" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">add_sub_levels</a>(node-&gt;kids[0], nsublev, gci, my_rank, rank, calc_level, slb, mid);</div>
<div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;    <a class="code" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">add_sub_levels</a>(node-&gt;kids[1], nsublev, gci, my_rank, rank, calc_level, mid, sle);</div>
<div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;    <span class="keywordflow">if</span> (calc_level)</div>
<div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;      node-&gt;level = 1 + <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(node-&gt;kids[0]-&gt;level, node-&gt;kids[1]-&gt;level);</div>
<div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;  }</div>
<div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;}</div>
<div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160; </div>
<div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;<span class="comment">// Recurse to each leaf and call add_sub_levels above.</span></div>
<div class="line"><a name="l05574"></a><span class="lineno"><a class="line" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10"> 5574</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">add_sub_levels</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> my_rank, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; node,</div>
<div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;                     <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nsublev, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> level_offset) {</div>
<div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;  <span class="keywordflow">if</span> (node-&gt;nkids) {</div>
<div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; node-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;      <a class="code" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">add_sub_levels</a>(my_rank, node-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>], nsublev, level_offset);</div>
<div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;    node-&gt;level += level_offset;</div>
<div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> gci = node-&gt;cellidx;</div>
<div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> rank = node-&gt;rank;</div>
<div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;    <a class="code" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">add_sub_levels</a>(node, nsublev, gci, my_rank, rank, level_offset, 0, nsublev);</div>
<div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;    <span class="comment">// Level already calculated if requested.</span></div>
<div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(level_offset == 0 || node-&gt;level == level_offset);</div>
<div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;  }</div>
<div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;}</div>
<div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160; </div>
<div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;<span class="comment">// This impl carefully follows the requirements that</span></div>
<div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;<span class="comment">// cedr::qlt::impl::init_tree, level_schedule_and_collect</span></div>
<div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;<span class="comment">// establish. init_tree has to be modified to have the condition in</span></div>
<div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;<span class="comment">// the line</span></div>
<div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;<span class="comment">//   if (node-&gt;rank &lt; 0) node-&gt;rank = node-&gt;kids[0]-&gt;rank</span></div>
<div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;<span class="comment">// since here we&#39;re assigning the ranks ourselves. Similarly, it must</span></div>
<div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;<span class="comment">// check for node-&gt;level &gt;= 0; if the tree is partial, it is unable to</span></div>
<div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;<span class="comment">// compute node level.</span></div>
<div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a></div>
<div class="line"><a name="l05598"></a><span class="lineno"><a class="line" href="namespacehomme.html#ac08ff29d8a241d6f29570fd8107d8df1"> 5598</a></span>&#160;<a class="code" href="namespacehomme.html#ad2c39737424bd290e32dd7884f6f0f9b">make_my_tree_part</a> (<span class="keyword">const</span> <a class="code" href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">qlt::oned::Mesh</a>&amp; m, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> cs, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ce,</div>
<div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;                   <span class="keyword">const</span> qlt::tree::Node* parent,</div>
<div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>&amp; nrank, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* rank2sfc) {</div>
<div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> my_rank = m.parallel()-&gt;rank();</div>
<div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> cn = ce - cs, cn0 = cn/2;</div>
<div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a> n = std::make_shared&lt;qlt::tree::Node&gt;();</div>
<div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;  n-&gt;parent = parent;</div>
<div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;  n-&gt;rank = <a class="code" href="namespacehomme.html#acaf39abd7df32b38d4eea5c118cdf307">rank2sfc_search</a>(rank2sfc, nrank, cs);</div>
<div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;  n-&gt;cellidx = n-&gt;rank == my_rank ? cs : -1;</div>
<div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;rank &gt;= 0 &amp;&amp; n-&gt;rank &lt; nrank);</div>
<div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;  <span class="keywordflow">if</span> (cn == 1) {</div>
<div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;    n-&gt;nkids = 0;</div>
<div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;    n-&gt;level = 0;</div>
<div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;    <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;  }</div>
<div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> k1 = <a class="code" href="namespacehomme.html#ad2c39737424bd290e32dd7884f6f0f9b">make_my_tree_part</a>(m, cs, cs + cn0, n.get(), nrank, rank2sfc);</div>
<div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> k2 = <a class="code" href="namespacehomme.html#ad2c39737424bd290e32dd7884f6f0f9b">make_my_tree_part</a>(m, cs + cn0, ce, n.get(), nrank, rank2sfc);</div>
<div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;  n-&gt;level = 1 + <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(k1-&gt;level, k2-&gt;level);</div>
<div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;  <span class="keywordflow">if</span> (n-&gt;rank == my_rank) {</div>
<div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;    <span class="comment">// Need to know both kids for comm.</span></div>
<div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;    n-&gt;nkids = 2;</div>
<div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;    n-&gt;kids[0] = k1;</div>
<div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;    n-&gt;kids[1] = k2;</div>
<div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;    <span class="comment">// Prune parts of the tree irrelevant to my rank.</span></div>
<div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;    n-&gt;nkids = 0;</div>
<div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;    <span class="keywordflow">if</span> (k1-&gt;nkids &gt; 0 || k1-&gt;rank == my_rank) n-&gt;kids[n-&gt;nkids++] = k1;</div>
<div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;    <span class="keywordflow">if</span> (k2-&gt;nkids &gt; 0 || k2-&gt;rank == my_rank) n-&gt;kids[n-&gt;nkids++] = k2;</div>
<div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;    <span class="keywordflow">if</span> (n-&gt;nkids == 0) {</div>
<div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;      <span class="comment">// Signal a non-leaf node with 0 kids to init_tree.</span></div>
<div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;      n-&gt;nkids = -1;</div>
<div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;    }</div>
<div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;  }</div>
<div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;level &gt; 0 || n-&gt;nkids == 0);</div>
<div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;  <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;}</div>
<div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160; </div>
<div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a></div>
<div class="line"><a name="l05636"></a><span class="lineno"><a class="line" href="namespacehomme.html#ad2c39737424bd290e32dd7884f6f0f9b"> 5636</a></span>&#160;<a class="code" href="namespacehomme.html#ad2c39737424bd290e32dd7884f6f0f9b">make_my_tree_part</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>&amp; ncells,</div>
<div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>&amp; nrank, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* rank2sfc) {</div>
<div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;  <a class="code" href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">qlt::oned::Mesh</a> m(ncells, p);</div>
<div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespacehomme.html#ad2c39737424bd290e32dd7884f6f0f9b">make_my_tree_part</a>(m, 0, m.ncell(), <span class="keyword">nullptr</span>, nrank, rank2sfc);</div>
<div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;}</div>
<div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160; </div>
<div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> nextpow2 (<span class="keywordtype">size_t</span> n) {</div>
<div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;  <span class="keywordtype">size_t</span> p = 1;</div>
<div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;  <span class="keywordflow">while</span> (p &lt; n) p &lt;&lt;= 1;</div>
<div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;  <span class="keywordflow">return</span> p;</div>
<div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;}</div>
<div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160; </div>
<div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;<span class="keyword">static</span> <span class="keywordtype">size_t</span> get_tree_height (<span class="keywordtype">size_t</span> nleaf) {</div>
<div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;  <span class="keywordtype">size_t</span> height = 0;</div>
<div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;  nleaf = nextpow2(nleaf);</div>
<div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;  <span class="keywordflow">while</span> (nleaf) {</div>
<div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;    ++height;</div>
<div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;    nleaf &gt;&gt;= 1;</div>
<div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;  }</div>
<div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;  <span class="keywordflow">return</span> height;</div>
<div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;}</div>
<div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160; </div>
<div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a></div>
<div class="line"><a name="l05659"></a><span class="lineno"><a class="line" href="namespacehomme.html#a8a760fb0324709684a0de7b60bb5a06d"> 5659</a></span>&#160;<a class="code" href="namespacehomme.html#a8a760fb0324709684a0de7b60bb5a06d">make_tree_sgi</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>,</div>
<div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;               <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* owned_ids, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* rank2sfc, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nsublev) {</div>
<div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;  <span class="comment">// Partition 0:nelem-1, the space-filling curve space.</span></div>
<div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;  <span class="keyword">auto</span> tree = <a class="code" href="namespacehomme.html#ad2c39737424bd290e32dd7884f6f0f9b">make_my_tree_part</a>(p, <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>, p-&gt;size(), rank2sfc);</div>
<div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;  <span class="comment">// Renumber so that node-&gt;cellidx records the global element number, and</span></div>
<div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;  <span class="comment">// associate the correct rank with the element.</span></div>
<div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> my_rank = p-&gt;rank();</div>
<div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;  <a class="code" href="namespacehomme.html#ae52e85d9df82bdcaa2a239573db554d8">renumber</a>(p-&gt;size(), <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>, my_rank, owned_ids, rank2sfc, tree);</div>
<div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;  <span class="keywordflow">if</span> (nsublev &gt; 1) {</div>
<div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> level_offset = get_tree_height(nsublev) - 1;</div>
<div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;    <a class="code" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">add_sub_levels</a>(my_rank, tree, nsublev, level_offset);</div>
<div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;  }</div>
<div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;  <span class="keywordflow">return</span> tree;</div>
<div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;}</div>
<div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160; </div>
<div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a></div>
<div class="line"><a name="l05675"></a><span class="lineno"><a class="line" href="namespacehomme.html#a7d62839cc5b098460120928a53f85dbe"> 5675</a></span>&#160;<a class="code" href="namespacehomme.html#a7d62839cc5b098460120928a53f85dbe">make_tree_non_sgi</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>,</div>
<div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* sc2gci, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* sc2rank, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nsublev) {</div>
<div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;  <span class="keyword">auto</span> tree = <a class="code" href="namespacecedr_1_1qlt_1_1tree.html#a30aba1281f9c0c2c90d3066d6d17d78c">qlt::tree::make_tree_over_1d_mesh</a>(p, <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>);</div>
<div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;  <a class="code" href="namespacehomme.html#ae52e85d9df82bdcaa2a239573db554d8">renumber</a>(sc2gci, sc2rank, tree);</div>
<div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> my_rank = p-&gt;rank();</div>
<div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;  <span class="keywordflow">if</span> (nsublev &gt; 1) <a class="code" href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">add_sub_levels</a>(my_rank, tree, nsublev, 0);</div>
<div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;  <span class="keywordflow">return</span> tree;</div>
<div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;}</div>
<div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160; </div>
<div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a></div>
<div class="line"><a name="l05685"></a><span class="lineno"><a class="line" href="namespacehomme.html#a9740766876b36bd5a1511fec3c517cc2"> 5685</a></span>&#160;<a class="code" href="namespacehomme.html#a9740766876b36bd5a1511fec3c517cc2">clone</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; in, <span class="keyword">const</span> qlt::tree::Node* parent = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> out = std::make_shared&lt;qlt::tree::Node&gt;(*in);</div>
<div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(out-&gt;rank == in-&gt;rank &amp;&amp; out-&gt;level == in-&gt;level &amp;&amp;</div>
<div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;              out-&gt;nkids == in-&gt;nkids &amp;&amp; out-&gt;cellidx == in-&gt;cellidx);</div>
<div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160;  out-&gt;parent = parent;</div>
<div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; in-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;    out-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>] = <a class="code" href="namespacehomme.html#a9740766876b36bd5a1511fec3c517cc2">clone</a>(in-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>], out.get());</div>
<div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;  <span class="keywordflow">return</span> out;</div>
<div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;}</div>
<div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160; </div>
<div class="line"><a name="l05695"></a><span class="lineno"><a class="line" href="namespacehomme.html#ae674c8dd01c9c230ed797858d1203c8c"> 5695</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#ae674c8dd01c9c230ed797858d1203c8c">renumber_leaves</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; node, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> horiz_nleaf,</div>
<div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;                      <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> supidx) {</div>
<div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;  <span class="keywordflow">if</span> (node-&gt;nkids) {</div>
<div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; node-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;      <a class="code" href="namespacehomme.html#ae674c8dd01c9c230ed797858d1203c8c">renumber_leaves</a>(node-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>], horiz_nleaf, supidx);</div>
<div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;    <span class="keywordflow">if</span> (node-&gt;cellidx != -1) {</div>
<div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(node-&gt;cellidx &gt;= 0 &amp;&amp; node-&gt;cellidx &lt; horiz_nleaf);</div>
<div class="line"><a name="l05703"></a><span class="lineno"> 5703</span>&#160;      node-&gt;cellidx += horiz_nleaf*supidx;</div>
<div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;    }</div>
<div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;  }</div>
<div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;}</div>
<div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160; </div>
<div class="line"><a name="l05708"></a><span class="lineno"><a class="line" href="namespacehomme.html#a016506b6a677d76291770756f08dd3d2"> 5708</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#a016506b6a677d76291770756f08dd3d2">attach_and_renumber_horizontal_trees</a> (<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; supnode,</div>
<div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; htree,</div>
<div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> horiz_nleaf) {</div>
<div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;  <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> level = -1, rank;</div>
<div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; supnode-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;    <span class="keyword">auto</span>&amp; kid = supnode-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>];</div>
<div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;    <span class="keywordflow">if</span> (kid-&gt;nkids) {</div>
<div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;      <a class="code" href="namespacehomme.html#a016506b6a677d76291770756f08dd3d2">attach_and_renumber_horizontal_trees</a>(kid, htree, horiz_nleaf);</div>
<div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> supidx = kid-&gt;cellidx;</div>
<div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;      supnode-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>] = <a class="code" href="namespacehomme.html#a9740766876b36bd5a1511fec3c517cc2">clone</a>(htree);</div>
<div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;      kid = supnode-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>];</div>
<div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;      kid-&gt;parent = supnode.get();</div>
<div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;      kid-&gt;cellidx = -1;</div>
<div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;      <a class="code" href="namespacehomme.html#ae674c8dd01c9c230ed797858d1203c8c">renumber_leaves</a>(kid, horiz_nleaf, supidx);</div>
<div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;    }</div>
<div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;    rank = kid-&gt;rank;</div>
<div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;    level = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(level, kid-&gt;level);</div>
<div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;  }</div>
<div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;  <span class="keywordflow">if</span> (level != -1) ++level;</div>
<div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;  supnode-&gt;level = level;</div>
<div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;  supnode-&gt;rank = rank;</div>
<div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;}</div>
<div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160; </div>
<div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a></div>
<div class="line"><a name="l05733"></a><span class="lineno"><a class="line" href="namespacehomme.html#ac48e88a477264e5e3aa3860d43f29729"> 5733</a></span>&#160;<a class="code" href="namespacehomme.html#ac48e88a477264e5e3aa3860d43f29729">make_tree_over_index_range</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> cs, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ce,</div>
<div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;                            <span class="keyword">const</span> qlt::tree::Node* parent = <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> cn = ce - cs, cn0 = cn/2;</div>
<div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> n = std::make_shared&lt;qlt::tree::Node&gt;();</div>
<div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;  n-&gt;parent = parent;</div>
<div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;  <span class="keywordflow">if</span> (cn == 1) {</div>
<div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;    n-&gt;nkids = 0;</div>
<div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;    n-&gt;cellidx = cs;</div>
<div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;    n-&gt;nkids = 2;</div>
<div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;    n-&gt;kids[0] = <a class="code" href="namespacehomme.html#ac48e88a477264e5e3aa3860d43f29729">make_tree_over_index_range</a>(cs, cs + cn0, n.get());</div>
<div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;    n-&gt;kids[1] = <a class="code" href="namespacehomme.html#ac48e88a477264e5e3aa3860d43f29729">make_tree_over_index_range</a>(cs + cn0, ce, n.get());</div>
<div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;  }</div>
<div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;  <span class="keywordflow">return</span> n;</div>
<div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;}</div>
<div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160; </div>
<div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a></div>
<div class="line"><a name="l05750"></a><span class="lineno"><a class="line" href="namespacehomme.html#a3cb555dbcfd5d1b60efacf4064c3642a"> 5750</a></span>&#160;<a class="code" href="namespacehomme.html#a3cb555dbcfd5d1b60efacf4064c3642a">combine_superlevels</a>(<span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; horiz_tree, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> horiz_nleaf,</div>
<div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;                    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nsuplev) {</div>
<div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(horiz_tree-&gt;nkids &gt; 0);</div>
<div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;  <span class="comment">// In this tree, cellidx 0 is the top super level.</span></div>
<div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> suptree = <a class="code" href="namespacehomme.html#ac48e88a477264e5e3aa3860d43f29729">make_tree_over_index_range</a>(0, nsuplev);</div>
<div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;  <a class="code" href="namespacehomme.html#a016506b6a677d76291770756f08dd3d2">attach_and_renumber_horizontal_trees</a>(suptree, horiz_tree, horiz_nleaf);</div>
<div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;  <span class="keywordflow">return</span> suptree;</div>
<div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;}</div>
<div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160; </div>
<div class="line"><a name="l05759"></a><span class="lineno"><a class="line" href="namespacehomme.html#aba51c752bbb102f502bb15d88a84e170"> 5759</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#aba51c752bbb102f502bb15d88a84e170">check_tree</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a>&amp; n,</div>
<div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;                 <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nleaf) {</div>
<div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;<span class="preprocessor">#ifndef NDEBUG</span></div>
<div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;nkids &gt;= -1 &amp;&amp; n-&gt;nkids &lt;= 2);</div>
<div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;rank &gt;= 0);</div>
<div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;reserved == -1);</div>
<div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;  <span class="keywordflow">if</span> (n-&gt;nkids == 2)</div>
<div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;level == 1 + <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(n-&gt;kids[0]-&gt;level, n-&gt;kids[1]-&gt;level));</div>
<div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;  <span class="keywordflow">if</span> (n-&gt;nkids == 1) <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;level &gt;= 1 + n-&gt;kids[0]-&gt;level);</div>
<div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;  <span class="keywordflow">if</span> (n-&gt;nkids == 0) <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;level == 0);</div>
<div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;  <span class="keywordflow">if</span> (n-&gt;rank != p-&gt;rank()) <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;cellidx == -1);</div>
<div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;  <span class="keywordflow">else</span> <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n-&gt;cellidx &lt; nleaf);</div>
<div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; n-&gt;nkids; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(n.get() == n-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>]-&gt;parent);</div>
<div class="line"><a name="l05773"></a><span class="lineno"> 5773</span>&#160;    <a class="code" href="namespacehomme.html#aba51c752bbb102f502bb15d88a84e170">check_tree</a>(p, n-&gt;kids[<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>], nleaf);</div>
<div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;  }</div>
<div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;}</div>
<div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160; </div>
<div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;<a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a></div>
<div class="line"><a name="l05779"></a><span class="lineno"><a class="line" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1"> 5779</a></span>&#160;<a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a> (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a>&amp; p, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>,</div>
<div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;           <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* gid_data, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* rank_data, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nsublev,</div>
<div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;           <span class="keyword">const</span> <span class="keywordtype">bool</span> use_sgi, <span class="keyword">const</span> <span class="keywordtype">bool</span> cdr_over_super_levels,</div>
<div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;           <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nsuplev) {</div>
<div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;  <span class="keyword">auto</span> tree = use_sgi ?</div>
<div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;    <a class="code" href="namespacehomme.html#a8a760fb0324709684a0de7b60bb5a06d">make_tree_sgi</a>    (p, <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>, gid_data, rank_data, nsublev) :</div>
<div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;    <a class="code" href="namespacehomme.html#a7d62839cc5b098460120928a53f85dbe">make_tree_non_sgi</a>(p, <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>, gid_data, rank_data, nsublev);</div>
<div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;  <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nleaf = <a class="code" href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">nelem</a>*nsublev;</div>
<div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;  <span class="keywordflow">if</span> (cdr_over_super_levels) {</div>
<div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;    tree = <a class="code" href="namespacehomme.html#a3cb555dbcfd5d1b60efacf4064c3642a">combine_superlevels</a>(tree, nleaf, nsuplev);</div>
<div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;    nleaf *= nsuplev;</div>
<div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;  }</div>
<div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;  <span class="keywordflow">if</span> (use_sgi) <a class="code" href="namespacehomme.html#aba51c752bbb102f502bb15d88a84e170">check_tree</a>(p, tree, nleaf);</div>
<div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;  <span class="keywordflow">return</span> tree;</div>
<div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;}</div>
<div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160; </div>
<div class="line"><a name="l05795"></a><span class="lineno"><a class="line" href="namespacehomme.html#a0e8829f9f66731a13df2f2169190b8a1"> 5795</a></span>&#160;<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacehomme.html#a0e8829f9f66731a13df2f2169190b8a1">test_tree_maker</a> () {</div>
<div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;  <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nerr = 0;</div>
<div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;  <span class="keywordflow">if</span> (nextpow2(3) != 4) ++nerr;</div>
<div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;  <span class="keywordflow">if</span> (nextpow2(4) != 4) ++nerr;</div>
<div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;  <span class="keywordflow">if</span> (nextpow2(5) != 8) ++nerr;</div>
<div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;  <span class="keywordflow">if</span> (get_tree_height(3) != 3) ++nerr;</div>
<div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;  <span class="keywordflow">if</span> (get_tree_height(4) != 3) ++nerr;</div>
<div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;  <span class="keywordflow">if</span> (get_tree_height(5) != 4) ++nerr;</div>
<div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;  <span class="keywordflow">if</span> (get_tree_height(8) != 4) ++nerr;</div>
<div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;  <span class="keywordflow">return</span> nerr;</div>
<div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;}</div>
<div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160; </div>
<div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span></div>
<div class="line"><a name="l05808"></a><span class="lineno"><a class="line" href="namespacehomme.html#a3fc7b3e45303dc1b13cec02a12bf2aae"> 5808</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#a3fc7b3e45303dc1b13cec02a12bf2aae">compose_repro_sum</a>(<span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* send, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* <a class="code" href="namespacehomme_1_1cslmpi.html#a2b713e2734729354e7c6f52f90ec64d6">recv</a>,</div>
<div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;                       <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nlocal, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nfld, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> fcomm);</div>
<div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160; </div>
<div class="line"><a name="l05811"></a><span class="lineno"><a class="line" href="structhomme_1_1_repro_sum_reducer.html"> 5811</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structhomme_1_1_repro_sum_reducer.html">ReproSumReducer</a> :</div>
<div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;    <span class="keyword">public</span> compose::CAAS::UserAllReducer {</div>
<div class="line"><a name="l05813"></a><span class="lineno"><a class="line" href="structhomme_1_1_repro_sum_reducer.html#aff1fe8ae9e3487f1305bacf9b807aee2"> 5813</a></span>&#160;  <a class="code" href="structhomme_1_1_repro_sum_reducer.html#aff1fe8ae9e3487f1305bacf9b807aee2">ReproSumReducer</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> fcomm, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n_accum_in_place)</div>
<div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;    : fcomm_(fcomm), n_accum_in_place_(n_accum_in_place)</div>
<div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;  {}</div>
<div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160; </div>
<div class="line"><a name="l05817"></a><span class="lineno"><a class="line" href="structhomme_1_1_repro_sum_reducer.html#aae37a15f884a78645215877e29ac91b4"> 5817</a></span>&#160;  <span class="keywordtype">int</span> <a class="code" href="structhomme_1_1_repro_sum_reducer.html#aae37a15f884a78645215877e29ac91b4">n_accum_in_place</a> ()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> n_accum_in_place_; }</div>
<div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160; </div>
<div class="line"><a name="l05819"></a><span class="lineno"><a class="line" href="structhomme_1_1_repro_sum_reducer.html#a66d99c37157f93faacca805ac524410e"> 5819</a></span>&#160;  <span class="keywordtype">int</span> operator() (<span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html">cedr::mpi::Parallel</a>&amp; p, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* sendbuf, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* rcvbuf,</div>
<div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;                  <span class="keywordtype">int</span> nlocal, <span class="keywordtype">int</span> count, MPI_Op op)<span class="keyword"> const override </span>{</div>
<div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;    <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(op == MPI_SUM);</div>
<div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;<span class="preprocessor">#   pragma omp barrier</span></div>
<div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;<span class="preprocessor">#   pragma omp master</span></div>
<div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;    <a class="code" href="namespacehomme.html#a3fc7b3e45303dc1b13cec02a12bf2aae">compose_repro_sum</a>(sendbuf, rcvbuf, nlocal, count, fcomm_);</div>
<div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;<span class="preprocessor">#   pragma omp barrier</span></div>
<div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;  }</div>
<div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160; </div>
<div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> fcomm_, n_accum_in_place_;</div>
<div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;};</div>
<div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160; </div>
<div class="line"><a name="l05837"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html"> 5837</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structhomme_1_1_c_d_r.html">CDR</a> {</div>
<div class="line"><a name="l05838"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a09a617cd556ff89e82bc8b8b944d5a37"> 5838</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;CDR&gt; <a class="code" href="structhomme_1_1_c_d_r.html#a09a617cd556ff89e82bc8b8b944d5a37">Ptr</a>;</div>
<div class="line"><a name="l05839"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a312dcd3a0eac5a93efcc83b2f94b307d"> 5839</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="classhomme_1_1compose_1_1_q_l_t.html">compose::QLT&lt;ComposeDefaultExecutionSpace&gt;</a> <a class="code" href="structhomme_1_1_c_d_r.html#a312dcd3a0eac5a93efcc83b2f94b307d">QLTT</a>;</div>
<div class="line"><a name="l05840"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a54ef29fe424bcff8c51d19a913d05b14"> 5840</a></span>&#160;  <span class="keyword">typedef</span> <a class="code" href="structhomme_1_1compose_1_1_c_a_a_s.html">compose::CAAS</a> <a class="code" href="structhomme_1_1_c_d_r.html#a54ef29fe424bcff8c51d19a913d05b14">CAAST</a>;</div>
<div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160; </div>
<div class="line"><a name="l05842"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r_1_1_alg.html"> 5842</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html">Alg</a> {</div>
<div class="line"><a name="l05843"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93dabc280075b6f765f9f6eebdb8da190c48"> 5843</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93d">Enum</a> { <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>, qlt_super_level, qlt_super_level_local_caas, <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93dabc280075b6f765f9f6eebdb8da190c48">caas</a>, caas_super_level };</div>
<div class="line"><a name="l05844"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r_1_1_alg.html#ab466646e99d1630a69bc3315d58089ac"> 5844</a></span>&#160;    <span class="keyword">static</span> <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93d">Enum</a> <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#ab466646e99d1630a69bc3315d58089ac">convert</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> cdr_alg) {</div>
<div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;      <span class="keywordflow">switch</span> (cdr_alg) {</div>
<div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;      <span class="keywordflow">case</span> 2:  <span class="keywordflow">return</span> <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>;</div>
<div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;      <span class="keywordflow">case</span> 20: <span class="keywordflow">return</span> qlt_super_level;</div>
<div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;      <span class="keywordflow">case</span> 21: <span class="keywordflow">return</span> qlt_super_level_local_caas;</div>
<div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;      <span class="keywordflow">case</span> 3:  <span class="keywordflow">return</span> <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a>;</div>
<div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;      <span class="keywordflow">case</span> 30: <span class="keywordflow">return</span> caas_super_level;</div>
<div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;      <span class="keywordflow">case</span> 42: <span class="keywordflow">return</span> caas_super_level; <span class="comment">// actually none</span></div>
<div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;      <span class="keywordflow">default</span>: <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<span class="keyword">true</span>,  <span class="stringliteral">&quot;cdr_alg &quot;</span> &lt;&lt; cdr_alg &lt;&lt; <span class="stringliteral">&quot; is invalid.&quot;</span>);</div>
<div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;      }</div>
<div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;    }</div>
<div class="line"><a name="l05855"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r_1_1_alg.html#a4056f274fa96da8b23a8e39c91170f53"> 5855</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#a4056f274fa96da8b23a8e39c91170f53">is_qlt</a> (<a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93d">Enum</a> e) {</div>
<div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;      <span class="keywordflow">return</span> (e == <a class="code" href="namespacecedr_1_1qlt.html">qlt</a> || e == qlt_super_level ||</div>
<div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;              e == qlt_super_level_local_caas);</div>
<div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;    }</div>
<div class="line"><a name="l05859"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r_1_1_alg.html#a6b5539c8fd514df0f1c14fe22aae64cb"> 5859</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#a6b5539c8fd514df0f1c14fe22aae64cb">is_caas</a> (<a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93d">Enum</a> e) {</div>
<div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;      <span class="keywordflow">return</span> e == <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a> || e == caas_super_level;</div>
<div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;    }</div>
<div class="line"><a name="l05862"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r_1_1_alg.html#a9304074515e56b9df2169a5935fe1f1a"> 5862</a></span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#a9304074515e56b9df2169a5935fe1f1a">is_suplev</a> (<a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93d">Enum</a> e) {</div>
<div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;      <span class="keywordflow">return</span> (e == qlt_super_level || e == caas_super_level ||</div>
<div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;              e == qlt_super_level_local_caas);</div>
<div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;    }</div>
<div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;  };</div>
<div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160; </div>
<div class="line"><a name="l05868"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a8bfd672073e3dcc185b0388dd985ba6daa5d59347ad0d964dbdd9181813314a02"> 5868</a></span>&#160;  <span class="keyword">enum</span> { nsublev_per_suplev = 8 };</div>
<div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;  </div>
<div class="line"><a name="l05870"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a2cb44e5b7d50b2508163b9182b684152"> 5870</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93d">Alg::Enum</a> <a class="code" href="structhomme_1_1_c_d_r.html#a2cb44e5b7d50b2508163b9182b684152">alg</a>;</div>
<div class="line"><a name="l05871"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#ae6a59217fb6d619637564d88a9a8e994"> 5871</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="structhomme_1_1_c_d_r.html#ae6a59217fb6d619637564d88a9a8e994">ncell</a>, nlclcell, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, nsublev, nsuplev;</div>
<div class="line"><a name="l05872"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279"> 5872</a></span>&#160;  <span class="keyword">const</span> <span class="keywordtype">bool</span> threed, cdr_over_super_levels, <a class="code" href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279">caas_in_suplev</a>, hard_zero;</div>
<div class="line"><a name="l05873"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a65d5e4f8f637ab0627de4e8e30e1a5ec"> 5873</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a> <a class="code" href="structhomme_1_1_c_d_r.html#a65d5e4f8f637ab0627de4e8e30e1a5ec">p</a>;</div>
<div class="line"><a name="l05874"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a4de5322e2f5b8b568b8f9fb8d08aa5d8"> 5874</a></span>&#160;  <a class="code" href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">qlt::tree::Node::Ptr</a> <a class="code" href="structhomme_1_1_c_d_r.html#a4de5322e2f5b8b568b8f9fb8d08aa5d8">tree</a>; <span class="comment">// Don&#39;t need this except for unit testing.</span></div>
<div class="line"><a name="l05875"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c"> 5875</a></span>&#160;  <a class="code" href="structcedr_1_1_c_d_r.html#a3c8346ee469398a071419e53fdbe7b74">cedr::CDR::Ptr</a> <a class="code" href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c">cdr</a>;</div>
<div class="line"><a name="l05876"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9"> 5876</a></span>&#160;  std::vector&lt;Int&gt; <a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>; <span class="comment">// Map Homme ie to Homme global cell index.</span></div>
<div class="line"><a name="l05877"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261"> 5877</a></span>&#160;  std::vector&lt;Int&gt; <a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>; <span class="comment">// Map Homme ie to CDR local cell index (lclcellidx).</span></div>
<div class="line"><a name="l05878"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a580100f8dd928cedf1040ffa726ee3cb"> 5878</a></span>&#160;  std::vector&lt;char&gt; <a class="code" href="structhomme_1_1_c_d_r.html#a580100f8dd928cedf1040ffa726ee3cb">nonneg</a>;</div>
<div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160; </div>
<div class="line"><a name="l05880"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a016aaed67a618a7adcc01b7e49218e6d"> 5880</a></span>&#160;  <a class="code" href="structhomme_1_1_c_d_r.html#a016aaed67a618a7adcc01b7e49218e6d">CDR</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> cdr_alg_, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ngblcell_, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nlclcell_, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nlev_, <span class="keywordtype">bool</span> use_sgi,</div>
<div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;       <span class="keywordtype">bool</span> independent_time_steps, <span class="keyword">const</span> <span class="keywordtype">bool</span> hard_zero_, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* gid_data,</div>
<div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;       <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a>* rank_data, <span class="keyword">const</span> <a class="code" href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a>&amp; p_, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> fcomm)</div>
<div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;    : alg(<a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html">Alg</a>::<a class="code" href="namespacedcmip2012__test5.html#ad89ae7f123bdc5a628ee8e834c3e18a5">convert</a>(cdr_alg_)),</div>
<div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;      ncell(ngblcell_), nlclcell(nlclcell_), <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>(nlev_),</div>
<div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;      nsublev(<a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html">Alg</a>::is_suplev(alg) ? nsublev_per_suplev : 1),</div>
<div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;      nsuplev((<a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> + nsublev - 1) / nsublev),</div>
<div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;      threed(independent_time_steps),</div>
<div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;      cdr_over_super_levels(threed &amp;&amp; <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html">Alg</a>::is_caas(alg)),</div>
<div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;      caas_in_suplev(alg == <a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html">Alg</a>::qlt_super_level_local_caas &amp;&amp; nsublev &gt; 1),</div>
<div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;      hard_zero(hard_zero_),</div>
<div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;      p(p_), inited_tracers_(false)</div>
<div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;  {</div>
<div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n_id_in_suplev = caas_in_suplev ? 1 : nsublev;</div>
<div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;    <span class="keywordflow">if</span> (Alg::is_qlt(alg)) {</div>
<div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;      tree = <a class="code" href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">make_tree</a>(p, ncell, gid_data, rank_data, n_id_in_suplev, use_sgi,</div>
<div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;                       cdr_over_super_levels, nsuplev);</div>
<div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;      <a class="code" href="structcedr_1_1_c_d_r_1_1_options.html">cedr::CDR::Options</a> options;</div>
<div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;      options.<a class="code" href="structcedr_1_1_c_d_r_1_1_options.html#a9a6fa254247b874087170c3b86db13a3">prefer_numerical_mass_conservation_to_numerical_bounds</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;      <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nleaf = ncell*n_id_in_suplev;</div>
<div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;      <span class="keywordflow">if</span> (cdr_over_super_levels) nleaf *= nsuplev;</div>
<div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;      cdr = std::make_shared&lt;QLTT&gt;(p, nleaf, tree, options,</div>
<div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;                                   threed ? nsuplev : 0);</div>
<div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;      tree = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Alg::is_caas(alg)) {</div>
<div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n_accum_in_place = n_id_in_suplev*(cdr_over_super_levels ?</div>
<div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;                                                   nsuplev : 1);</div>
<div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a> = std::make_shared&lt;CAAST&gt;(</div>
<div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;        p, nlclcell*n_accum_in_place,</div>
<div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;        std::make_shared&lt;ReproSumReducer&gt;(fcomm, n_accum_in_place));</div>
<div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;      cdr = <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">caas</a>;</div>
<div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;      <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;Invalid semi_lagrange_cdr_alg &quot;</span> &lt;&lt; alg);</div>
<div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;    }</div>
<div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;    ie2gci.resize(nlclcell);</div>
<div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;  }</div>
<div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160; </div>
<div class="line"><a name="l05917"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a4132475f81e4b5caa43a6a423eb744f5"> 5917</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structhomme_1_1_c_d_r.html#a4132475f81e4b5caa43a6a423eb744f5">init_tracers</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> need_conservation) {</div>
<div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;    nonneg.resize(<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, hard_zero);</div>
<div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;    <span class="keyword">typedef</span> <a class="code" href="structcedr_1_1_problem_type.html">cedr::ProblemType</a> PT;</div>
<div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nt = cdr_over_super_levels ? <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a> : nsuplev*<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>;</div>
<div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ti = 0; ti &lt; nt; ++ti)</div>
<div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;      cdr-&gt;declare_tracer(PT::shapepreserve |</div>
<div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;                          (need_conservation ? PT::conserve : 0), 0);</div>
<div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;    cdr-&gt;end_tracer_declarations();</div>
<div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;  }</div>
<div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160; </div>
<div class="line"><a name="l05927"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a51fc0b9acba5d16cb4682ace1afb76c1"> 5927</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structhomme_1_1_c_d_r.html#a51fc0b9acba5d16cb4682ace1afb76c1">get_buffers_sizes</a> (<span class="keywordtype">size_t</span>&amp; s1, <span class="keywordtype">size_t</span> &amp;s2) {</div>
<div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;    cdr-&gt;get_buffers_sizes(s1, s2);</div>
<div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;  }</div>
<div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160; </div>
<div class="line"><a name="l05931"></a><span class="lineno"><a class="line" href="structhomme_1_1_c_d_r.html#a155fed2c976bb416d98b1872031c1cec"> 5931</a></span>&#160;  <span class="keywordtype">void</span> <a class="code" href="structhomme_1_1_c_d_r.html#a155fed2c976bb416d98b1872031c1cec">set_buffers</a> (<a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* b1, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* b2) {</div>
<div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;    cdr-&gt;set_buffers(b1, b2);</div>
<div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;    cdr-&gt;finish_setup();</div>
<div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;  }</div>
<div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160; </div>
<div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;  <span class="keywordtype">bool</span> inited_tracers_;</div>
<div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;};</div>
<div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160; </div>
<div class="line"><a name="l05940"></a><span class="lineno"><a class="line" href="namespacehomme.html#a4a444386784905f436c6fbbae4a397cf"> 5940</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#a4a444386784905f436c6fbbae4a397cf">set_ie2gci</a> (<a class="code" href="structhomme_1_1_c_d_r.html">CDR</a>&amp; q, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> gci) { q.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>[ie] = gci; }</div>
<div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160; </div>
<div class="line"><a name="l05942"></a><span class="lineno"><a class="line" href="namespacehomme.html#a596e78b4df2c806552616fd69b879cfa"> 5942</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#a596e78b4df2c806552616fd69b879cfa">init_ie2lci</a> (<a class="code" href="structhomme_1_1_c_d_r.html">CDR</a>&amp; q) {</div>
<div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n_id_in_suplev = q.<a class="code" href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279">caas_in_suplev</a> ? 1 : q.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>;</div>
<div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nleaf =</div>
<div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;    n_id_in_suplev*</div>
<div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;    q.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>.size()*</div>
<div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;    (q.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a> ? q.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a> : 1);</div>
<div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;  q.<a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>.resize(nleaf);</div>
<div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;  <span class="keywordflow">if</span> (CDR::Alg::is_qlt(q.<a class="code" href="structhomme_1_1_c_d_r.html#a2cb44e5b7d50b2508163b9182b684152">alg</a>)) {</div>
<div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;    <span class="keyword">auto</span> <a class="code" href="namespacecedr_1_1qlt.html">qlt</a> = std::static_pointer_cast&lt;CDR::QLTT&gt;(q.<a class="code" href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c">cdr</a>);</div>
<div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;    <span class="keywordflow">if</span> (q.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a>) {</div>
<div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> nlevwrem = q.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>*n_id_in_suplev;</div>
<div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ie = 0; ie &lt; q.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>.size(); ++ie)</div>
<div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> spli = 0; spli &lt; q.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>; ++spli)</div>
<div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sbli = 0; sbli &lt; n_id_in_suplev; ++sbli)</div>
<div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;            <span class="comment">//       local indexing is fastest over the whole column</span></div>
<div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;            q.<a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>[nlevwrem*ie + n_id_in_suplev*spli + sbli] =</div>
<div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;              <span class="comment">//           but global indexing is organized according to the tree</span></div>
<div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;              <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>-&gt;gci2lci(n_id_in_suplev*(q.<a class="code" href="structhomme_1_1_c_d_r.html#ae6a59217fb6d619637564d88a9a8e994">ncell</a>*spli + q.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>[ie]) + sbli);</div>
<div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ie = 0; ie &lt; q.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>.size(); ++ie)</div>
<div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sbli = 0; sbli &lt; n_id_in_suplev; ++sbli)</div>
<div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;          q.<a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>[n_id_in_suplev*ie + sbli] =</div>
<div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;            <a class="code" href="namespacecedr_1_1qlt.html">qlt</a>-&gt;gci2lci(n_id_in_suplev*q.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>[ie] + sbli);</div>
<div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;    }</div>
<div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;    <span class="keywordflow">if</span> (q.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a>) {</div>
<div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;      <span class="keyword">const</span> <span class="keyword">auto</span> nlevwrem = q.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>*n_id_in_suplev;</div>
<div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ie = 0; ie &lt; q.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>.size(); ++ie)</div>
<div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> spli = 0; spli &lt; q.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>; ++spli)</div>
<div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sbli = 0; sbli &lt; n_id_in_suplev; ++sbli) {</div>
<div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <span class="keywordtype">id</span> = nlevwrem*ie + n_id_in_suplev*spli + sbli;</div>
<div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;            q.<a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>[id] = id;</div>
<div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;          }</div>
<div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> ie = 0; ie &lt; q.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>.size(); ++ie)</div>
<div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sbli = 0; sbli &lt; n_id_in_suplev; ++sbli) {</div>
<div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <span class="keywordtype">id</span> = n_id_in_suplev*ie + sbli;</div>
<div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;          q.<a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>[id] = id;</div>
<div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;        }</div>
<div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;    }</div>
<div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;  }</div>
<div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;}</div>
<div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160; </div>
<div class="line"><a name="l05985"></a><span class="lineno"><a class="line" href="namespacehomme.html#ad617c49d38a616dba83ab782ade127b1"> 5985</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme.html#ad617c49d38a616dba83ab782ade127b1">init_tracers</a> (<a class="code" href="structhomme_1_1_c_d_r.html">CDR</a>&amp; q, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>,</div>
<div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;                   <span class="keyword">const</span> <span class="keywordtype">bool</span> need_conservation) {</div>
<div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;  q.<a class="code" href="structhomme_1_1_c_d_r.html#a4132475f81e4b5caa43a6a423eb744f5">init_tracers</a>(<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, need_conservation);</div>
<div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;}</div>
<div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160; </div>
<div class="line"><a name="l05990"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html"> 5990</a></span>&#160;<span class="keyword">namespace </span>sl { <span class="comment">// For sl_advection.F90</span></div>
<div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;<span class="comment">// Fortran array wrappers.</span></div>
<div class="line"><a name="l05992"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#a252e034117295143127d71004a1758a7"> 5992</a></span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">using</span> <a class="code" href="namespacehomme_1_1sl.html#a252e034117295143127d71004a1758a7">FA1</a> =</div>
<div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;  Kokkos::View&lt;T*,     Kokkos::LayoutLeft, Kokkos::HostSpace&gt;;</div>
<div class="line"><a name="l05994"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#af8c52da368642f513f3f40370cac3238"> 5994</a></span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">using</span> <a class="code" href="namespacehomme_1_1sl.html#af8c52da368642f513f3f40370cac3238">FA2</a> =</div>
<div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;  Kokkos::View&lt;T**,    Kokkos::LayoutLeft, Kokkos::HostSpace&gt;;</div>
<div class="line"><a name="l05996"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e"> 5996</a></span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">using</span> <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3</a> =</div>
<div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;  Kokkos::View&lt;T***,   Kokkos::LayoutLeft, Kokkos::HostSpace&gt;;</div>
<div class="line"><a name="l05998"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2"> 5998</a></span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">using</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4</a> =</div>
<div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;  Kokkos::View&lt;T****,  Kokkos::LayoutLeft, Kokkos::HostSpace&gt;;</div>
<div class="line"><a name="l06000"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#a82bdeafe95920df3fa468f2091412855"> 6000</a></span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; <span class="keyword">using</span> <a class="code" href="namespacehomme_1_1sl.html#a82bdeafe95920df3fa468f2091412855">FA5</a> =</div>
<div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;  Kokkos::View&lt;T*****, Kokkos::LayoutLeft, Kokkos::HostSpace&gt;;</div>
<div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160; </div>
<div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;<span class="comment">// Following are naming conventions in element_state and sl_advection:</span></div>
<div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;<span class="comment">//     elem(ie)%state%Q(:,:,k,q) is tracer mixing ratio.</span></div>
<div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;<span class="comment">//     elem(ie)%state%dp3d(:,:,k,tl%np1) is essentially total density.</span></div>
<div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;<span class="comment">//     elem(ie)%state%Qdp(:,:,k,q,n0_qdp) is Q*dp3d.</span></div>
<div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;<span class="comment">//     rho(:,:,k,ie) is spheremp*dp3d, essentially total mass at a GLL point.</span></div>
<div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;<span class="comment">//     Hence Q*rho = Q*spheremp*dp3d is tracer mass at a GLL point.</span></div>
<div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160;<span class="comment">// We need to get pointers to some of these; elem can&#39;t be given the bind(C)</span></div>
<div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;<span class="comment">// attribute, so we can&#39;t take the elem array directly. We get these quantities</span></div>
<div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;<span class="comment">// at a mix of previous and current time steps.</span></div>
<div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;<span class="comment">//   In the code that follows, _p is previous and _c is current time step. Q is</span></div>
<div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160;<span class="comment">// renamed to q, and Q is tracer mass at a GLL point.</span></div>
<div class="line"><a name="l06014"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html"> 6014</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structhomme_1_1sl_1_1_data.html">Data</a> {</div>
<div class="line"><a name="l06015"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html#a478e430b254a150d34cf695ec67a0c24"> 6015</a></span>&#160;  <span class="keyword">typedef</span> std::shared_ptr&lt;Data&gt; <a class="code" href="structhomme_1_1sl_1_1_data.html#a478e430b254a150d34cf695ec67a0c24">Ptr</a>;</div>
<div class="line"><a name="l06016"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html#a8fd6ca9f4f9a4846438a4fbe4733c831"> 6016</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="structhomme_1_1sl_1_1_data.html#a8fd6ca9f4f9a4846438a4fbe4733c831">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, <a class="code" href="namespacedimensions__mod.html#a5020e9504c2decc9d182fe296ffc3b42">qsize_d</a>, <a class="code" href="namespaceelement__state.html#ad600dbbab5d81bfc236df4786d322a10">timelevels</a>;</div>
<div class="line"><a name="l06017"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88"> 6017</a></span>&#160;  <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88">n0_qdp</a>, n1_qdp, tl_np1;</div>
<div class="line"><a name="l06018"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html#ab8feb2fa8ea775863acf9687a8d3d5fa"> 6018</a></span>&#160;  std::vector&lt;const Real*&gt; spheremp, <a class="code" href="structhomme_1_1sl_1_1_data.html#ab8feb2fa8ea775863acf9687a8d3d5fa">dp3d_c</a>;</div>
<div class="line"><a name="l06019"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html#a62711b4d4e7930645bdb0ba1cfe26609"> 6019</a></span>&#160;  std::vector&lt;Real*&gt; <a class="code" href="structhomme_1_1sl_1_1_data.html#a62711b4d4e7930645bdb0ba1cfe26609">q_c</a>, qdp_pc;</div>
<div class="line"><a name="l06020"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html#a90986b4edf9bac72ca4a0af464313def"> 6020</a></span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* <a class="code" href="structhomme_1_1sl_1_1_data.html#a90986b4edf9bac72ca4a0af464313def">dp0</a>;</div>
<div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160; </div>
<div class="line"><a name="l06022"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data_1_1_check.html"> 6022</a></span>&#160;  <span class="keyword">struct </span><a class="code" href="structhomme_1_1sl_1_1_data_1_1_check.html">Check</a> {</div>
<div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;    Kokkos::View&lt;Real**, Kokkos::Serial&gt;</div>
<div class="line"><a name="l06024"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data_1_1_check.html#af23c5177ca2f9c31e6c121a5b28b31a3"> 6024</a></span>&#160;      mass_p, <a class="code" href="structhomme_1_1sl_1_1_data_1_1_check.html#af23c5177ca2f9c31e6c121a5b28b31a3">mass_c</a>, mass_lo, mass_hi,</div>
<div class="line"><a name="l06025"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data_1_1_check.html#a9a9b3047bb76a1342b727eac60fdf240"> 6025</a></span>&#160;      q_lo, <a class="code" href="structhomme_1_1sl_1_1_data_1_1_check.html#a9a9b3047bb76a1342b727eac60fdf240">q_hi</a>, q_min_l, q_max_l, qd_lo, qd_hi;</div>
<div class="line"><a name="l06026"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data_1_1_check.html#a609733b84b38c38d706eb0dc103cefaf"> 6026</a></span>&#160;    <a class="code" href="structhomme_1_1sl_1_1_data_1_1_check.html#a609733b84b38c38d706eb0dc103cefaf">Check</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>)</div>
<div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;      : mass_p(<span class="stringliteral">&quot;mass_p&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), mass_c(<span class="stringliteral">&quot;mass_c&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;        mass_lo(<span class="stringliteral">&quot;mass_lo&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), mass_hi(<span class="stringliteral">&quot;mass_hi&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;        q_lo(<span class="stringliteral">&quot;q_lo&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), q_hi(<span class="stringliteral">&quot;q_hi&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;        q_min_l(<span class="stringliteral">&quot;q_min_l&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), q_max_l(<span class="stringliteral">&quot;q_max_l&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;        qd_lo(<span class="stringliteral">&quot;qd_lo&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), qd_hi(<span class="stringliteral">&quot;qd_hi&quot;</span>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>)</div>
<div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;    {}</div>
<div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;  };</div>
<div class="line"><a name="l06034"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html#acaa835ddf027bf5c839af61dae8b6747"> 6034</a></span>&#160;  std::shared_ptr&lt;Check&gt; <a class="code" href="structhomme_1_1sl_1_1_data.html#acaa835ddf027bf5c839af61dae8b6747">check</a>;</div>
<div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160; </div>
<div class="line"><a name="l06036"></a><span class="lineno"><a class="line" href="structhomme_1_1sl_1_1_data.html#a73e2935f5f6adf54fb92d82eacfe568e"> 6036</a></span>&#160;  <a class="code" href="structhomme_1_1sl_1_1_data.html#a73e2935f5f6adf54fb92d82eacfe568e">Data</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> lcl_ncell, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> np_, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nlev_, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> qsize_, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> qsize_d_, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> timelevels_)</div>
<div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;    : <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>(np_), <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>(nlev_), <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>(qsize_), <a class="code" href="namespacedimensions__mod.html#a5020e9504c2decc9d182fe296ffc3b42">qsize_d</a>(qsize_d_), <a class="code" href="namespaceelement__state.html#ad600dbbab5d81bfc236df4786d322a10">timelevels</a>(timelevels_),</div>
<div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;      spheremp(lcl_ncell, nullptr), dp3d_c(lcl_ncell, nullptr), q_c(lcl_ncell, nullptr),</div>
<div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;      qdp_pc(lcl_ncell, nullptr)</div>
<div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;  {}</div>
<div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;};</div>
<div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160; </div>
<div class="line"><a name="l06043"></a><span class="lineno"> 6043</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#a46e9e2574a59bf3476d8965cb14167bf">check</a> (<span class="keyword">const</span> <a class="code" href="structhomme_1_1_c_d_r.html">CDR</a>&amp; q, <span class="keyword">const</span> Data&amp; d) {</div>
<div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(q.<a class="code" href="structhomme_1_1_c_d_r.html#a506ae277c2a25c448f5c13e2095c1c14">nlclcell</a> == <span class="keyword">static_cast&lt;</span><a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a><span class="keyword">&gt;</span>(d.spheremp.size()));</div>
<div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;}</div>
<div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160; </div>
<div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l06048"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#af77f346d99433f2dcf621707aa32c086"> 6048</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#a52e0bc6d10b00586340d9941e7dabd5f">insert</a> (std::vector&lt;T*&gt;&amp; r, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i, T* v) {</div>
<div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(i &gt;= 0 &amp;&amp; i &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(r.size()));</div>
<div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;  r[i] = v;</div>
<div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;}</div>
<div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160; </div>
<div class="line"><a name="l06053"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#a52e0bc6d10b00586340d9941e7dabd5f"> 6053</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#a52e0bc6d10b00586340d9941e7dabd5f">insert</a> (<span class="keyword">const</span> <a class="code" href="structhomme_1_1sl_1_1_data.html#a478e430b254a150d34cf695ec67a0c24">Data::Ptr</a>&amp; d, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ptridx, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* array,</div>
<div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;             <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i0 = 0, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i1 = 0) {</div>
<div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(d);</div>
<div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;  <span class="keywordflow">switch</span> (ptridx) {</div>
<div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;  <span class="keywordflow">case</span> 0: insert&lt;const double&gt;(d-&gt;spheremp, ie, array); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;  <span class="keywordflow">case</span> 1: insert&lt;      double&gt;(d-&gt;qdp_pc,   ie, array); d-&gt;n0_qdp = i0; d-&gt;n1_qdp = i1; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;  <span class="keywordflow">case</span> 2: insert&lt;const double&gt;(d-&gt;dp3d_c,   ie, array); d-&gt;tl_np1 = i0; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;  <span class="keywordflow">case</span> 3: insert&lt;      double&gt;(d-&gt;q_c,      ie, array); <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;  <span class="keywordflow">case</span> 4: d-&gt;dp0 = array; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;  <span class="keywordflow">default</span>: <a class="code" href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a>(<span class="keyword">true</span>, <span class="stringliteral">&quot;Invalid pointer index &quot;</span> &lt;&lt; ptridx);</div>
<div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;  }</div>
<div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;}</div>
<div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160; </div>
<div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> run_cdr (<a class="code" href="structhomme_1_1_c_d_r.html">CDR</a>&amp; q) {</div>
<div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;<span class="preprocessor"># pragma omp barrier</span></div>
<div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;  q.<a class="code" href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c">cdr</a>-&gt;run();</div>
<div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;<span class="preprocessor"># pragma omp barrier</span></div>
<div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;}</div>
<div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160; </div>
<div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">int</span> np_&gt;</div>
<div class="line"><a name="l06077"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#a5978f1968c5d35e6d3421bfc97370896"> 6077</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#a0e15e9b43e8b615ddb5c88d87b40593a">accum_values</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> q, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> tl_np1,</div>
<div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n0_qdp, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> nonneg,</div>
<div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a252e034117295143127d71004a1758a7">FA1&lt;const Real&gt;</a>&amp; spheremp, <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;const Real&gt;</a>&amp; dp3d_c,</div>
<div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;Real&gt;</a>&amp; q_min, <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a>&amp; q_max,</div>
<div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a>&amp; qdp_p, <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;const Real&gt;</a>&amp; q_c,</div>
<div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;                   <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; <a class="code" href="namespaceparams__mod.html#aaf6b44dc42783444668b9854140d7559">volume</a>, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; rhom, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; Qm, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; Qm_prev,</div>
<div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;                   <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; Qm_min, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; Qm_max) {</div>
<div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> == np_);</div>
<div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> np2 = np_*np_;</div>
<div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> = 0; <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> &lt; np2; ++<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>) {</div>
<div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;    <a class="code" href="namespaceparams__mod.html#aaf6b44dc42783444668b9854140d7559">volume</a> += spheremp(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>); <span class="comment">// * dp0[k];</span></div>
<div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> rhomij = dp3d_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,tl_np1) * spheremp(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>);</div>
<div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;    rhom += rhomij;</div>
<div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;    Qm += q_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) * rhomij;</div>
<div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;    <span class="keywordflow">if</span> (nonneg) q_min(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie) = std::max&lt;Real&gt;(q_min(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie), 0);</div>
<div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;    Qm_min += q_min(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie) * rhomij;</div>
<div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;    Qm_max += q_max(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie) * rhomij;</div>
<div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;    Qm_prev += qdp_p(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,n0_qdp) * spheremp(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>);</div>
<div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;  }</div>
<div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;}</div>
<div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160; </div>
<div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">int</span> np_&gt;</div>
<div class="line"><a name="l06099"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#afafe33ddab3173614642830eb1c5ac57"> 6099</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#afafe33ddab3173614642830eb1c5ac57">run_global</a> (<a class="code" href="structhomme_1_1_c_d_r.html">CDR</a>&amp; cdr, <span class="keyword">const</span> <a class="code" href="structhomme_1_1sl_1_1_data.html">Data</a>&amp; d, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* q_min_r, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* q_max_r,</div>
<div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;                 <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nets, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nete) {</div>
<div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> np2 = np_*np_;</div>
<div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a876735b0b355ed0c4b2ef9cc95780352">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8fd6ca9f4f9a4846438a4fbe4733c831">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#af6d3d34b49e375a578fe909f5207158e">qsize</a>,</div>
<div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;    nlevwrem = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>*cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>;</div>
<div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> == np_);</div>
<div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;  </div>
<div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;  <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;      Real&gt;</a> q_min(q_min_r, np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, nete+1);</div>
<div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;  <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a> q_max(q_max_r, np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, nete+1);</div>
<div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160; </div>
<div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie = nets; ie &lt;= nete; ++ie) {</div>
<div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#a252e034117295143127d71004a1758a7">FA1&lt;const Real&gt;</a> spheremp(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a135e738ab8e648527e1e65df756837ce">spheremp</a>[ie], np2);</div>
<div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a> qdp_p(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a3397c381bfa9258d9f2d3a5732b424d9">qdp_pc</a>[ie], np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a37427a8b8f6743d5cf71e2fa221e43e0">qsize_d</a>, 2);</div>
<div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;const Real&gt;</a> dp3d_c(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#ab8feb2fa8ea775863acf9687a8d3d5fa">dp3d_c</a>[ie], np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a7991285f31b9e01876257ab73f72e3e7">timelevels</a>);</div>
<div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;const Real&gt;</a> q_c(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a62711b4d4e7930645bdb0ba1cfe26609">q_c</a>[ie], np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a37427a8b8f6743d5cf71e2fa221e43e0">qsize_d</a>);</div>
<div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;<span class="preprocessor">#ifdef COLUMN_OPENMP</span></div>
<div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;<span class="preprocessor">#   pragma omp parallel for</span></div>
<div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> q = 0; q &lt; <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>; ++q) {</div>
<div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> spli = 0; spli &lt; cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>; ++spli) {</div>
<div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> k0 = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>*spli;</div>
<div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> nonneg = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a580100f8dd928cedf1040ffa726ee3cb">nonneg</a>[q];</div>
<div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ti = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a> ? q : spli*<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a> + q;</div>
<div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;        <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> Qm = 0, Qm_min = 0, Qm_max = 0, Qm_prev = 0, rhom = 0, <a class="code" href="namespaceparams__mod.html#aaf6b44dc42783444668b9854140d7559">volume</a> = 0;</div>
<div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;        <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie_idx;</div>
<div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;        <span class="keywordflow">if</span> (cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279">caas_in_suplev</a>)</div>
<div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;          ie_idx = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a> ?</div>
<div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;            cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>*ie + spli :</div>
<div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;            ie;</div>
<div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sbli = 0; sbli &lt; cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>; ++sbli) {</div>
<div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = k0 + sbli;</div>
<div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;          <span class="keywordflow">if</span> ( ! cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279">caas_in_suplev</a>)</div>
<div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;            ie_idx = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a> ?</div>
<div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;              nlevwrem*ie + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> :</div>
<div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;              cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>*ie + sbli;</div>
<div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> lci = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>[ie_idx];</div>
<div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;          <span class="keywordflow">if</span> ( ! cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279">caas_in_suplev</a>) {</div>
<div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;            Qm = 0; Qm_min = 0; Qm_max = 0; Qm_prev = 0;</div>
<div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;            rhom = 0;</div>
<div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;            <a class="code" href="namespaceparams__mod.html#aaf6b44dc42783444668b9854140d7559">volume</a> = 0;</div>
<div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;          }</div>
<div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>)</div>
<div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;            accum_values&lt;np_&gt;(ie, <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, q, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88">n0_qdp</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, nonneg,</div>
<div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;                  spheremp, dp3d_c, q_min, q_max, qdp_p, q_c,</div>
<div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;                  <a class="code" href="namespaceparams__mod.html#aaf6b44dc42783444668b9854140d7559">volume</a>, rhom, Qm, Qm_prev, Qm_min, Qm_max);</div>
<div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;          <span class="keyword">const</span> <span class="keywordtype">bool</span> write = ! cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279">caas_in_suplev</a> || sbli == cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>-1;</div>
<div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;          <span class="keywordflow">if</span> (write) {</div>
<div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;            <span class="comment">// For now, handle just one rhom. For feasible global problems,</span></div>
<div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;            <span class="comment">// it&#39;s used only as a weight vector in QLT, so it&#39;s fine. In fact,</span></div>
<div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;            <span class="comment">// use just the cell geometry, rather than total density, since in QLT</span></div>
<div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;            <span class="comment">// this field is used as a weight vector.</span></div>
<div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;            <span class="comment">//todo Generalize to one rhom field per level. Until then, we&#39;re not</span></div>
<div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;            <span class="comment">// getting QLT&#39;s safety benefit.</span></div>
<div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;            <span class="keywordflow">if</span> (ti == 0) cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c">cdr</a>-&gt;set_rhom(lci, 0, <a class="code" href="namespaceparams__mod.html#aaf6b44dc42783444668b9854140d7559">volume</a>);</div>
<div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;            cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c">cdr</a>-&gt;set_Qm(lci, ti, Qm, Qm_min, Qm_max, Qm_prev);</div>
<div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;            <span class="keywordflow">if</span> (Qm_prev &lt; -0.5) {</div>
<div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;              <span class="keyword">static</span> <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;              <span class="keywordflow">if</span> (first) {</div>
<div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;                first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;                std::stringstream ss;</div>
<div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;                ss &lt;&lt; <span class="stringliteral">&quot;Qm_prev &lt; -0.5: Qm_prev = &quot;</span> &lt;&lt; Qm_prev</div>
<div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; on rank &quot;</span> &lt;&lt; cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a65d5e4f8f637ab0627de4e8e30e1a5ec">p</a>-&gt;rank()</div>
<div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot; at (ie,gid,spli,k0,q,ti,sbli,lci,k,n0_qdp,tl_np1) = (&quot;</span></div>
<div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;                   &lt;&lt; ie &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">ie2gci</a>[ie] &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; spli &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; k0 &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;                   &lt;&lt; q &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; ti &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; sbli &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; lci &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;                   &lt;&lt; d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88">n0_qdp</a> &lt;&lt; <span class="stringliteral">&quot;,&quot;</span> &lt;&lt; d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a> &lt;&lt; <span class="stringliteral">&quot;)\n&quot;</span>;</div>
<div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;                ss &lt;&lt; <span class="stringliteral">&quot;Qdp(:,:,k,q,n0_qdp) = [&quot;</span>;</div>
<div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;                <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> = 0; <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> &lt; np2; ++<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>)</div>
<div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;                  ss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; qdp_p(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88">n0_qdp</a>);</div>
<div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;                ss &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;</div>
<div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;                ss &lt;&lt; <span class="stringliteral">&quot;dp3d(:,:,k,tl_np1) = [&quot;</span>;</div>
<div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;                <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> = 0; <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> &lt; np2; ++<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>)</div>
<div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;                  ss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; dp3d_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>);</div>
<div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;                ss &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;</div>
<div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;                <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(ss.str());</div>
<div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;              }</div>
<div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;            }</div>
<div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;          }</div>
<div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;        }</div>
<div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;      }</div>
<div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;    }</div>
<div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;  }</div>
<div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160; </div>
<div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;  run_cdr(cdr);</div>
<div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;}</div>
<div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160; </div>
<div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">int</span> np_&gt;</div>
<div class="line"><a name="l06186"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#abb0c4b7af2eefb92d0dfa497edb3846d"> 6186</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#abb0c4b7af2eefb92d0dfa497edb3846d">solve_local</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> q,</div>
<div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;                  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> tl_np1, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n1_qdp, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, </div>
<div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;                  <span class="keyword">const</span> <span class="keywordtype">bool</span> scalar_bounds, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a>,</div>
<div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;                  <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a252e034117295143127d71004a1758a7">FA1&lt;const Real&gt;</a>&amp; spheremp, <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;const Real&gt;</a>&amp; dp3d_c,</div>
<div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;                  <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a>&amp; q_min, <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a>&amp; q_max,</div>
<div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;                  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> Qm, <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;Real&gt;</a>&amp; qdp_c, <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;Real&gt;</a>&amp; q_c) {</div>
<div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> == np_);</div>
<div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> np2 = np_*np_;</div>
<div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160; </div>
<div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;  <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> wa[np2], qlo[np2], qhi[np2], y[np2], <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[np2];</div>
<div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;  <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> rhom = 0;</div>
<div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> = 0; <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> &lt; np2; ++<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>) {</div>
<div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> rhomij = dp3d_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,tl_np1) * spheremp(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>);</div>
<div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;    rhom += rhomij;</div>
<div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;    wa[<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>] = rhomij;</div>
<div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;    y[<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>] = q_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q);</div>
<div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;    <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>] = y[<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>];</div>
<div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;  }</div>
<div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160; </div>
<div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;  <span class="comment">//todo Replace with ReconstructSafely.</span></div>
<div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;  <span class="keywordflow">if</span> (scalar_bounds) {</div>
<div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;    qlo[0] = q_min(0,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie);</div>
<div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;    qhi[0] = q_max(0,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie);</div>
<div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 1; i &lt; np2; ++i) qlo[i] = qlo[0];</div>
<div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 1; i &lt; np2; ++i) qhi[i] = qhi[0];</div>
<div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;    <span class="comment">// We can use either 2-norm minimization or ClipAndAssuredSum for</span></div>
<div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;    <span class="comment">// the local filter. CAAS is the faster. It corresponds to limiter</span></div>
<div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;    <span class="comment">// = 0. 2-norm minimization is the same in spirit as limiter = 8,</span></div>
<div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;    <span class="comment">// but it assuredly achieves the first-order optimality conditions</span></div>
<div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;    <span class="comment">// whereas limiter 8 does not.</span></div>
<div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a> == 8)</div>
<div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;      <a class="code" href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938">cedr::local::solve_1eq_bc_qp</a>(np2, wa, wa, Qm, qlo, qhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06219"></a><span class="lineno"> 6219</span>&#160;      <span class="comment">// We need to use *some* limiter; if 8 isn&#39;t chosen, default to</span></div>
<div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;      <span class="comment">// CAAS.</span></div>
<div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;      <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">cedr::local::caas</a>(np2, wa, Qm, qlo, qhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;    }</div>
<div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> = 0; <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> &lt; np2; ++<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>) {</div>
<div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;      qlo[<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>] = q_min(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie);</div>
<div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;      qhi[<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>] = q_max(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie);</div>
<div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;    }</div>
<div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> trial = 0; trial &lt; 3; ++trial) {</div>
<div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;      <span class="keywordtype">int</span> info;</div>
<div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a> == 8) {</div>
<div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;        info = <a class="code" href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938">cedr::local::solve_1eq_bc_qp</a>(</div>
<div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;          np2, wa, wa, Qm, qlo, qhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>);</div>
<div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;        <span class="keywordflow">if</span> (info == 1) info = 0;</div>
<div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;        info = 0;</div>
<div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;        <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">cedr::local::caas</a>(np2, wa, Qm, qlo, qhi, y, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>, <span class="keyword">false</span> <span class="comment">/* clip */</span>);</div>
<div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;        <span class="comment">// Clip for numerics against the cell extrema.</span></div>
<div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;        <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> qlo_s = qlo[0], qhi_s = qhi[0];</div>
<div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 1; i &lt; np2; ++i) {</div>
<div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;          qlo_s = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(qlo_s, qlo[i]);</div>
<div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;          qhi_s = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(qhi_s, qhi[i]);</div>
<div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;        }</div>
<div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; np2; ++i)</div>
<div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;          <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i] = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a>(qlo_s, <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a>(qhi_s, <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[i]));</div>
<div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;      }</div>
<div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;      <span class="keywordflow">if</span> (info == 0 || trial == 1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;      <span class="keywordflow">switch</span> (trial) {</div>
<div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;      <span class="keywordflow">case</span> 0: {</div>
<div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;        <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> qlo_s = qlo[0], qhi_s = qhi[0];</div>
<div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 1; i &lt; np2; ++i) {</div>
<div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;          qlo_s = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(qlo_s, qlo[i]);</div>
<div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;          qhi_s = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(qhi_s, qhi[i]);</div>
<div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;        }</div>
<div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; np2; ++i) qlo[i] = qlo_s;</div>
<div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; np2; ++i) qhi[i] = qhi_s;</div>
<div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;      } <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;      <span class="keywordflow">case</span> 1: {</div>
<div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> q = Qm / rhom;</div>
<div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; np2; ++i) qlo[i] = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(qlo[i], q);</div>
<div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; np2; ++i) qhi[i] = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(qhi[i], q);                </div>
<div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;      } <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;      }</div>
<div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;    }</div>
<div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;  }</div>
<div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;        </div>
<div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> = 0; <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> &lt; np2; ++<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>) {</div>
<div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;    q_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) = <a class="code" href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">x</a>[<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>];</div>
<div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;    qdp_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,n1_qdp) = q_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) * dp3d_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,tl_np1);</div>
<div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;  }</div>
<div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;}</div>
<div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160; </div>
<div class="line"><a name="l06272"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#a16cd0b0b5d042613ec1fe5a9947dddf2"> 6272</a></span>&#160;<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacehomme_1_1sl.html#a16cd0b0b5d042613ec1fe5a9947dddf2">vertical_caas_backup</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* rhom,</div>
<div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;                          <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> q_min, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> q_max,</div>
<div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;                          <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> Qmlo_tot, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> Qmhi_tot, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> Qm_tot,</div>
<div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;                          <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* Qmlo, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* Qmhi, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* Qm) {</div>
<div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;  <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = 0;</div>
<div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;  <span class="keywordflow">if</span> (Qm_tot &lt; Qmlo_tot || Qm_tot &gt; Qmhi_tot) {</div>
<div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;    <span class="keywordflow">if</span> (Qm_tot &lt; Qmlo_tot) {</div>
<div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;      <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = -2;</div>
<div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) Qmhi[i] = Qmlo[i];</div>
<div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) Qmlo[i] = q_min*rhom[i];</div>
<div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;      Qmlo_tot = 0;</div>
<div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) Qmlo_tot += Qmlo[i];</div>
<div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;      <span class="keywordflow">if</span> (Qm_tot &lt; Qmlo_tot) <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = -4;</div>
<div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;      <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = -1;</div>
<div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) Qmlo[i] = Qmhi[i];</div>
<div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) Qmhi[i] = q_max*rhom[i];</div>
<div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;      Qmhi_tot = 0;</div>
<div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) Qmhi_tot += Qmhi[i];</div>
<div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;      <span class="keywordflow">if</span> (Qm_tot &gt; Qmhi_tot) <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> = -3;</div>
<div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;    }</div>
<div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a> &lt; -2) {</div>
<div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;      <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> rhom_tot = 0;</div>
<div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) rhom_tot += rhom[i];</div>
<div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> q = Qm_tot/rhom_tot;</div>
<div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) Qm[i] = q*rhom[i];</div>
<div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a>;</div>
<div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;    }</div>
<div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;  }</div>
<div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) rhom[i] = 1;</div>
<div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;  <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">cedr::local::caas</a>(n, rhom, Qm_tot, Qmlo, Qmhi, Qm, Qm, <span class="keyword">false</span>);</div>
<div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">status</a>;</div>
<div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;}</div>
<div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160; </div>
<div class="line"><a name="l06306"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#a0e15e9b43e8b615ddb5c88d87b40593a"> 6306</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#a0e15e9b43e8b615ddb5c88d87b40593a">accum_values</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> q, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> tl_np1,</div>
<div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n0_qdp, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> np2,</div>
<div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a252e034117295143127d71004a1758a7">FA1&lt;const Real&gt;</a>&amp; spheremp, <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;const Real&gt;</a>&amp; dp3d_c,</div>
<div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;Real&gt;</a>&amp; q_min, <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a>&amp; q_max,</div>
<div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;                   <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a>&amp; qdp_p, <span class="keyword">const</span> <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;const Real&gt;</a>&amp; q_c,</div>
<div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;                   <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; rhom, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; Qm, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; Qm_min, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>&amp; Qm_max) {</div>
<div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> = 0; <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> &lt; np2; ++<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>) {</div>
<div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> rhomij = dp3d_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,tl_np1) * spheremp(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>);</div>
<div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;    rhom += rhomij;</div>
<div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;    Qm += q_c(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) * rhomij;</div>
<div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160;    Qm_min += q_min(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie) * rhomij;</div>
<div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;    Qm_max += q_max(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie) * rhomij;</div>
<div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;  }</div>
<div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;}</div>
<div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160; </div>
<div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;<span class="keyword">template</span> &lt;<span class="keywordtype">int</span> np_&gt;</div>
<div class="line"><a name="l06322"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#ab9d646428a12b139d7ed0af95052a2d7"> 6322</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#ab9d646428a12b139d7ed0af95052a2d7">run_local</a> (<a class="code" href="structhomme_1_1_c_d_r.html">CDR</a>&amp; cdr, <span class="keyword">const</span> <a class="code" href="structhomme_1_1sl_1_1_data.html">Data</a>&amp; d, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* q_min_r, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* q_max_r,</div>
<div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nets, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nete, <span class="keyword">const</span> <span class="keywordtype">bool</span> scalar_bounds,</div>
<div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a>) {</div>
<div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;  <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> np2 = np_*np_;</div>
<div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a876735b0b355ed0c4b2ef9cc95780352">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8fd6ca9f4f9a4846438a4fbe4733c831">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#af6d3d34b49e375a578fe909f5207158e">qsize</a>,</div>
<div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160;    nlevwrem = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>*cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>;</div>
<div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(<a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> == np_);</div>
<div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160; </div>
<div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;  <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;      Real&gt;</a> q_min(q_min_r, np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, nete+1);</div>
<div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;  <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a> q_max(q_max_r, np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, nete+1);</div>
<div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160; </div>
<div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie = nets; ie &lt;= nete; ++ie) {</div>
<div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#a252e034117295143127d71004a1758a7">FA1&lt;const Real&gt;</a> spheremp(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a135e738ab8e648527e1e65df756837ce">spheremp</a>[ie], np2);</div>
<div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;      Real&gt;</a> qdp_c(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a3397c381bfa9258d9f2d3a5732b424d9">qdp_pc</a>[ie], np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a37427a8b8f6743d5cf71e2fa221e43e0">qsize_d</a>, 2);</div>
<div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;const Real&gt;</a> dp3d_c(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#ab8feb2fa8ea775863acf9687a8d3d5fa">dp3d_c</a>[ie], np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a7991285f31b9e01876257ab73f72e3e7">timelevels</a>);</div>
<div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">FA3&lt;      Real&gt;</a> q_c(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a62711b4d4e7930645bdb0ba1cfe26609">q_c</a>[ie], np2, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a37427a8b8f6743d5cf71e2fa221e43e0">qsize_d</a>);</div>
<div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;<span class="preprocessor">#ifdef COLUMN_OPENMP</span></div>
<div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;<span class="preprocessor">#   pragma omp parallel for</span></div>
<div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> q = 0; q &lt; <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>; ++q) {</div>
<div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> spli = 0; spli &lt; cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>; ++spli) {</div>
<div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> k0 = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>*spli;</div>
<div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ti = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a> ? q : spli*<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a> + q;</div>
<div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;        <span class="keywordflow">if</span> (cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279">caas_in_suplev</a>) {</div>
<div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> ie_idx = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a> ?</div>
<div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;            cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>*ie + spli :</div>
<div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;            ie;</div>
<div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;          <span class="keyword">const</span> <span class="keyword">auto</span> lci = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>[ie_idx];</div>
<div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> Qm_tot = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c">cdr</a>-&gt;get_Qm(lci, ti);</div>
<div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;          <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> Qm_min_tot = 0, Qm_max_tot = 0;</div>
<div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;          <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> rhom[CDR::nsublev_per_suplev], Qm[CDR::nsublev_per_suplev],</div>
<div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;            Qm_min[CDR::nsublev_per_suplev], Qm_max[CDR::nsublev_per_suplev];</div>
<div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;          <span class="comment">// Redistribute mass in the vertical direction of the super level.</span></div>
<div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;          <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>;</div>
<div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sbli = 0; sbli &lt; cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>; ++sbli) {</div>
<div class="line"><a name="l06357"></a><span class="lineno"> 6357</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = k0 + sbli;</div>
<div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &gt;= <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>) {</div>
<div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;              n = sbli;</div>
<div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;              <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;            }</div>
<div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;            rhom[sbli] = 0; Qm[sbli] = 0; Qm_min[sbli] = 0; Qm_max[sbli] = 0;</div>
<div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;            <a class="code" href="namespacehomme_1_1sl.html#a0e15e9b43e8b615ddb5c88d87b40593a">accum_values</a>(ie, <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, q, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88">n0_qdp</a>, np2,</div>
<div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;                         spheremp, dp3d_c, q_min, q_max, qdp_c, q_c,</div>
<div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;                         rhom[sbli], Qm[sbli], Qm_min[sbli], Qm_max[sbli]);</div>
<div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;            Qm_min_tot += Qm_min[sbli];</div>
<div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;            Qm_max_tot += Qm_max[sbli];</div>
<div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;          }</div>
<div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;          <span class="keywordflow">if</span> (Qm_tot &gt;= Qm_min_tot &amp;&amp; Qm_tot &lt;= Qm_max_tot) {</div>
<div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) rhom[i] = 1;</div>
<div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;            <a class="code" href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">cedr::local::caas</a>(n, rhom, Qm_tot, Qm_min, Qm_max, Qm, Qm, <span class="keyword">false</span>);</div>
<div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;            <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> q_min_s, q_max_s;</div>
<div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;            <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sbli = 0; sbli &lt; n; ++sbli) {</div>
<div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;              <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = k0 + sbli;</div>
<div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;              <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> = 0; <a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a> &lt; np2; ++<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>) {</div>
<div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;                <span class="keywordflow">if</span> (first) {</div>
<div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;                  q_min_s = q_min(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie);</div>
<div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;                  q_max_s = q_max(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie);</div>
<div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;                  first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;                  q_min_s = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(q_min_s, q_min(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie));</div>
<div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;                  q_max_s = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(q_max_s, q_max(<a class="code" href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">g</a>,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie));</div>
<div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;                }</div>
<div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;              }</div>
<div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;            }</div>
<div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;            <a class="code" href="namespacehomme_1_1sl.html#a16cd0b0b5d042613ec1fe5a9947dddf2">vertical_caas_backup</a>(n, rhom, q_min_s, q_max_s,</div>
<div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;                                 Qm_min_tot, Qm_max_tot, Qm_tot,</div>
<div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;                                 Qm_min, Qm_max, Qm);</div>
<div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;          }</div>
<div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;          <span class="comment">// Redistribute mass in the horizontal direction of each level.</span></div>
<div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; n; ++i) {</div>
<div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = k0 + i;</div>
<div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;            solve_local&lt;np_&gt;(ie, <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, q, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a16e071b6c5d1231986e1e9ac711f3d38">n1_qdp</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,</div>
<div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;                 scalar_bounds, <a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a>,</div>
<div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;                 spheremp, dp3d_c, q_min, q_max, Qm[i], qdp_c, q_c);</div>
<div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;          }</div>
<div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> sbli = 0; sbli &lt; cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>; ++sbli) {</div>
<div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = k0 + sbli;</div>
<div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &gt;= <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> ie_idx = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">cdr_over_super_levels</a> ?</div>
<div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;              nlevwrem*ie + <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> :</div>
<div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;              cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>*ie + sbli;</div>
<div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> lci = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">ie2lci</a>[ie_idx];</div>
<div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> Qm = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c">cdr</a>-&gt;get_Qm(lci, ti);</div>
<div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;            solve_local&lt;np_&gt;(ie, <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>, q, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a16e071b6c5d1231986e1e9ac711f3d38">n1_qdp</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>,</div>
<div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;                 scalar_bounds, <a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a>,</div>
<div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;                 spheremp, dp3d_c, q_min, q_max, Qm, qdp_c, q_c);</div>
<div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;          }</div>
<div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;        }</div>
<div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;      }</div>
<div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;    }</div>
<div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;  }</div>
<div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;}</div>
<div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160; </div>
<div class="line"><a name="l06418"></a><span class="lineno"><a class="line" href="namespacehomme_1_1sl.html#a46e9e2574a59bf3476d8965cb14167bf"> 6418</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacehomme_1_1sl.html#a46e9e2574a59bf3476d8965cb14167bf">check</a> (<a class="code" href="structhomme_1_1_c_d_r.html">CDR</a>&amp; cdr, <a class="code" href="structhomme_1_1sl_1_1_data.html">Data</a>&amp; d, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* q_min_r, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a>* q_max_r,</div>
<div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;            <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nets, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> nete) {</div>
<div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;  <span class="keyword">using</span> <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">cedr::mpi::reduce</a>;</div>
<div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160; </div>
<div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a876735b0b355ed0c4b2ef9cc95780352">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8fd6ca9f4f9a4846438a4fbe4733c831">nlev</a>, nsuplev = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">nsuplev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a> = d.<a class="code" href="structhomme_1_1sl_1_1_data.html#af6d3d34b49e375a578fe909f5207158e">qsize</a>,</div>
<div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;    nprob = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#ab96d0824701e73a05788e65b65a4bbf8">threed</a> ? 1 : nsuplev;</div>
<div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160; </div>
<div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;  Kokkos::View&lt;Real**, Kokkos::Serial&gt;</div>
<div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;    mass_p(<span class="stringliteral">&quot;mass_p&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), mass_c(<span class="stringliteral">&quot;mass_c&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;    mass_lo(<span class="stringliteral">&quot;mass_lo&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), mass_hi(<span class="stringliteral">&quot;mass_hi&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;    q_lo(<span class="stringliteral">&quot;q_lo&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), q_hi(<span class="stringliteral">&quot;q_hi&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;    q_min_l(<span class="stringliteral">&quot;q_min_l&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), q_max_l(<span class="stringliteral">&quot;q_max_l&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;    qd_lo(<span class="stringliteral">&quot;qd_lo&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), qd_hi(<span class="stringliteral">&quot;qd_hi&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>);</div>
<div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;  <a class="code" href="namespacehomme_1_1sl.html#a82bdeafe95920df3fa468f2091412855">FA5&lt;const Real&gt;</a></div>
<div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;    q_min(q_min_r, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, nete+1),</div>
<div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;    q_max(q_max_r, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, nete+1);</div>
<div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;  Kokkos::deep_copy(q_lo,  1e200);</div>
<div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;  Kokkos::deep_copy(q_hi, -1e200);</div>
<div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;  Kokkos::deep_copy(q_min_l,  1e200);</div>
<div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;  Kokkos::deep_copy(q_max_l, -1e200);</div>
<div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;  Kokkos::deep_copy(qd_lo, 0);</div>
<div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;  Kokkos::deep_copy(qd_hi, 0);</div>
<div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160; </div>
<div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;  <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> iprob = 0;</div>
<div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160; </div>
<div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;  <span class="keywordtype">bool</span> fp_issue = <span class="keyword">false</span>; <span class="comment">// Limit output once the first issue is seen.</span></div>
<div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> ie = nets; ie &lt;= nete; ++ie) {</div>
<div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#af8c52da368642f513f3f40370cac3238">FA2&lt;const Real&gt;</a> spheremp(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a135e738ab8e648527e1e65df756837ce">spheremp</a>[ie], <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>);</div>
<div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#a82bdeafe95920df3fa468f2091412855">FA5&lt;const Real&gt;</a> qdp_pc(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a3397c381bfa9258d9f2d3a5732b424d9">qdp_pc</a>[ie], <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a37427a8b8f6743d5cf71e2fa221e43e0">qsize_d</a>, 2);</div>
<div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a> dp3d_c(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#ab8feb2fa8ea775863acf9687a8d3d5fa">dp3d_c</a>[ie], <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a7991285f31b9e01876257ab73f72e3e7">timelevels</a>);</div>
<div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;    <a class="code" href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">FA4&lt;const Real&gt;</a> q_c(d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a62711b4d4e7930645bdb0ba1cfe26609">q_c</a>[ie], <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a37427a8b8f6743d5cf71e2fa221e43e0">qsize_d</a>);</div>
<div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> spli = 0; spli &lt; nsuplev; ++spli) {</div>
<div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;      <span class="keywordflow">if</span> (nprob &gt; 1) iprob = spli;</div>
<div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = spli*cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; (spli+1)*cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">nsublev</a>; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) {</div>
<div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &gt;= <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;        <span class="keywordflow">if</span> ( ! fp_issue) {</div>
<div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> j = 0; j &lt; <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>; ++j)</div>
<div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>; ++i) {</div>
<div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;              <span class="comment">// FP issues.</span></div>
<div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;              <span class="keywordflow">if</span> (<a class="code" href="namespacesurfaces__mod.html#acd025aa90ee60dfdb616983bad0aa680">std::isnan</a>(dp3d_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>)))</div>
<div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;              { <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;dp3d NaN:&quot;</span> <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(i) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(j)); fp_issue = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;              <span class="keywordflow">if</span> (std::isinf(dp3d_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>)))</div>
<div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;              { <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;dp3d Inf:&quot;</span> <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(i) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(j)); fp_issue = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;            }</div>
<div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;        }</div>
<div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> q = 0; q &lt; <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>; ++q) {</div>
<div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;          <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> qlo_s = q_min(0,0,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie), qhi_s = q_max(0,0,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie);</div>
<div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> j = 0; j &lt; <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>; ++j)</div>
<div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>; ++i) {</div>
<div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;              qlo_s = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(qlo_s, q_min(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie));</div>
<div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;              qhi_s = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(qhi_s, q_max(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie));</div>
<div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;            }</div>
<div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;          <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> j = 0; j &lt; <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>; ++j)</div>
<div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;            <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i = 0; i &lt; <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>; ++i) {</div>
<div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;              <span class="comment">// FP issues.</span></div>
<div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;              <span class="keywordflow">if</span> ( ! fp_issue) {</div>
<div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;                <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> i_qdp : {0, 1}) {</div>
<div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;                  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> n_qdp = i_qdp == 0 ? d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88">n0_qdp</a> : d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a16e071b6c5d1231986e1e9ac711f3d38">n1_qdp</a>;</div>
<div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;                  <span class="keywordflow">if</span> (<a class="code" href="namespacesurfaces__mod.html#acd025aa90ee60dfdb616983bad0aa680">std::isnan</a>(qdp_pc(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,n_qdp)))</div>
<div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;                  { <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;qdp NaN:&quot;</span> <a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(i_qdp) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(i) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(j)); fp_issue = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;                  <span class="keywordflow">if</span> (std::isinf(qdp_pc(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,n_qdp)))</div>
<div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;                  { <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;qdp Inf:&quot;</span> <a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(i_qdp) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(i) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(j)); fp_issue = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;                }</div>
<div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="namespacesurfaces__mod.html#acd025aa90ee60dfdb616983bad0aa680">std::isnan</a>(q_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)))</div>
<div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;                { <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;q NaN:&quot;</span> <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(i) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(j)); fp_issue = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;                <span class="keywordflow">if</span> (std::isinf(q_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)))</div>
<div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;                { <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<span class="stringliteral">&quot;q Inf:&quot;</span> <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(i) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(j)); fp_issue = <span class="keyword">true</span>; }</div>
<div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;              }</div>
<div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;              <span class="comment">// Mass conservation.</span></div>
<div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;              mass_p(iprob,q) += qdp_pc(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88">n0_qdp</a>) * spheremp(i,j);</div>
<div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;              mass_c(iprob,q) += qdp_pc(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a16e071b6c5d1231986e1e9ac711f3d38">n1_qdp</a>) * spheremp(i,j);</div>
<div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;              <span class="comment">// Local bound constraints w.r.t. cell-local extrema.</span></div>
<div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;              <span class="keywordflow">if</span> (q_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &lt; qlo_s)</div>
<div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;                qd_lo(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(qd_lo(iprob,q), qlo_s - q_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q));</div>
<div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;              <span class="keywordflow">if</span> (q_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &gt; qhi_s)</div>
<div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;                qd_hi(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(qd_hi(iprob,q), q_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) - qhi_s);</div>
<div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;              <span class="comment">// Safety problem bound constraints.</span></div>
<div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;              mass_lo(iprob,q) += (q_min(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie) * dp3d_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>) *</div>
<div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;                                  spheremp(i,j));</div>
<div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;              mass_hi(iprob,q) += (q_max(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie) * dp3d_c(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,d.<a class="code" href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">tl_np1</a>) *</div>
<div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160;                                  spheremp(i,j));</div>
<div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;              q_lo(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(q_lo(iprob,q), q_min(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie));</div>
<div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;              q_hi(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(q_hi(iprob,q), q_max(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie));</div>
<div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;              q_min_l(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(q_min_l(iprob,q), q_min(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie));</div>
<div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;              q_max_l(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(q_max_l(iprob,q), q_max(i,j,<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q,ie));</div>
<div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;            }</div>
<div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;        }</div>
<div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;      }</div>
<div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;    }</div>
<div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;  }</div>
<div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160; </div>
<div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;<span class="preprocessor"># pragma omp barrier</span></div>
<div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;<span class="preprocessor"># pragma omp master</span></div>
<div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;  {</div>
<div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;    <span class="keywordflow">if</span> ( ! d.<a class="code" href="structhomme_1_1sl_1_1_data.html#acaa835ddf027bf5c839af61dae8b6747">check</a>)</div>
<div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;      d.<a class="code" href="structhomme_1_1sl_1_1_data.html#acaa835ddf027bf5c839af61dae8b6747">check</a> = std::make_shared&lt;Data::Check&gt;(nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>);</div>
<div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;    <span class="keyword">auto</span>&amp; c = *d.<a class="code" href="structhomme_1_1sl_1_1_data.html#acaa835ddf027bf5c839af61dae8b6747">check</a>;</div>
<div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;    Kokkos::deep_copy(c.mass_p, 0);</div>
<div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;    Kokkos::deep_copy(c.mass_c, 0);</div>
<div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;    Kokkos::deep_copy(c.mass_lo, 0);</div>
<div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;    Kokkos::deep_copy(c.mass_hi, 0);</div>
<div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;    Kokkos::deep_copy(c.q_lo,  1e200);</div>
<div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;    Kokkos::deep_copy(c.q_hi, -1e200);</div>
<div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;    Kokkos::deep_copy(c.q_min_l,  1e200);</div>
<div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;    Kokkos::deep_copy(c.q_max_l, -1e200);</div>
<div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;    Kokkos::deep_copy(c.qd_lo, 0);</div>
<div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;    Kokkos::deep_copy(c.qd_hi, 0);</div>
<div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;  }</div>
<div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160; </div>
<div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;<span class="preprocessor"># pragma omp barrier</span></div>
<div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160;<span class="preprocessor"># pragma omp critical</span></div>
<div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;  {</div>
<div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;    <span class="keyword">auto</span>&amp; c = *d.<a class="code" href="structhomme_1_1sl_1_1_data.html#acaa835ddf027bf5c839af61dae8b6747">check</a>;</div>
<div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> spli = 0; spli &lt; nprob; ++spli) {</div>
<div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;      <span class="keywordflow">if</span> (nprob &gt; 1) iprob = spli;</div>
<div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> q = 0; q &lt; <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>; ++q) {</div>
<div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;        c.mass_p(iprob,q) += mass_p(iprob,q);</div>
<div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;        c.mass_c(iprob,q) += mass_c(iprob,q);</div>
<div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;        c.qd_lo(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(c.qd_lo(iprob,q), qd_lo(iprob,q));</div>
<div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;        c.qd_hi(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(c.qd_hi(iprob,q), qd_hi(iprob,q));</div>
<div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;        c.mass_lo(iprob,q) += mass_lo(iprob,q);</div>
<div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;        c.mass_hi(iprob,q) += mass_hi(iprob,q);</div>
<div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;        c.q_lo(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(c.q_lo(iprob,q), q_lo(iprob,q));</div>
<div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;        c.q_hi(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(c.q_hi(iprob,q), q_hi(iprob,q));</div>
<div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;        c.q_min_l(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">std::min</a>(c.q_min_l(iprob,q), q_min_l(iprob,q));</div>
<div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;        c.q_max_l(iprob,q) = <a class="code" href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">std::max</a>(c.q_max_l(iprob,q), q_max_l(iprob,q));</div>
<div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;      }</div>
<div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;    }</div>
<div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;  }</div>
<div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160; </div>
<div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;<span class="preprocessor">#ifdef HORIZ_OPENMP</span></div>
<div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;<span class="preprocessor"># pragma omp barrier</span></div>
<div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;<span class="preprocessor"># pragma omp master</span></div>
<div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;  {</div>
<div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;    Kokkos::View&lt;Real**, Kokkos::Serial&gt;</div>
<div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;      mass_p_g(<span class="stringliteral">&quot;mass_p_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), mass_c_g(<span class="stringliteral">&quot;mass_c_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;      mass_lo_g(<span class="stringliteral">&quot;mass_lo_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), mass_hi_g(<span class="stringliteral">&quot;mass_hi_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;      q_lo_g(<span class="stringliteral">&quot;q_lo_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), q_hi_g(<span class="stringliteral">&quot;q_hi_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;      q_min_g(<span class="stringliteral">&quot;q_min_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), q_max_g(<span class="stringliteral">&quot;q_max_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>),</div>
<div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;      qd_lo_g(<span class="stringliteral">&quot;qd_lo_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>), qd_hi_g(<span class="stringliteral">&quot;qd_hi_g&quot;</span>, nprob, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>);</div>
<div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160; </div>
<div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; p = *cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a65d5e4f8f637ab0627de4e8e30e1a5ec">p</a>;</div>
<div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; c = *d.<a class="code" href="structhomme_1_1sl_1_1_data.html#acaa835ddf027bf5c839af61dae8b6747">check</a>;</div>
<div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> root = cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a65d5e4f8f637ab0627de4e8e30e1a5ec">p</a>-&gt;root();</div>
<div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> N = nprob*<a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>;</div>
<div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160; </div>
<div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.mass_p.data(), mass_p_g.data(), N, MPI_SUM, root);</div>
<div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.mass_c.data(), mass_c_g.data(), N, MPI_SUM, root);</div>
<div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.qd_lo.data(), qd_lo_g.data(), N, MPI_MAX, root);</div>
<div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.qd_hi.data(), qd_hi_g.data(), N, MPI_MAX, root);</div>
<div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160;    <span class="comment">// Safety problem.</span></div>
<div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.mass_lo.data(), mass_lo_g.data(), N, MPI_SUM, root);</div>
<div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.mass_hi.data(), mass_hi_g.data(), N, MPI_SUM, root);</div>
<div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.q_lo.data(), q_lo_g.data(), N, MPI_MIN, root);</div>
<div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.q_hi.data(), q_hi_g.data(), N, MPI_MAX, root);</div>
<div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.q_min_l.data(), q_min_g.data(), N, MPI_MIN, root);</div>
<div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160;    <a class="code" href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">reduce</a>(p, c.q_max_l.data(), q_max_g.data(), N, MPI_MAX, root);</div>
<div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160; </div>
<div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;    <span class="keywordflow">if</span> (cdr.<a class="code" href="structhomme_1_1_c_d_r.html#a65d5e4f8f637ab0627de4e8e30e1a5ec">p</a>-&gt;amroot()) {</div>
<div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;      <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> <a class="code" href="namespacecontrol__mod.html#a19f70697971fe3e6502be3097865437a">tol</a> = 1e4*<a class="code" href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">std::numeric_limits&lt;Real&gt;::epsilon</a>();</div>
<div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> = 0; <a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a> &lt; nprob; ++<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>)</div>
<div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">Int</a> q = 0; q &lt; <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>; ++q) {</div>
<div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;          <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">Real</a> <a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a> = <a class="code" href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">cedr::util::reldif</a>(mass_p_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q), mass_c_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q));</div>
<div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;          <span class="keywordflow">if</span> (<a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a> &gt; <a class="code" href="namespacecontrol__mod.html#a19f70697971fe3e6502be3097865437a">tol</a>)</div>
<div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;            <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(mass_p_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(mass_c_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(<a class="code" href="namespacejw.html#a6fec32e251eadfd05121de103250de27">rd</a>));</div>
<div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;          <span class="keywordflow">if</span> (mass_lo_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &lt;= mass_c_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &amp;&amp; mass_c_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &lt;= mass_hi_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)) {</div>
<div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;            <span class="comment">// Local problems should be feasible.</span></div>
<div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;            <span class="keywordflow">if</span> (qd_lo_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &gt; 0)</div>
<div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;              <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(qd_lo_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)));</div>
<div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;            <span class="keywordflow">if</span> (qd_hi_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &gt; 0)</div>
<div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;              <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(qd_hi_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)));</div>
<div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160;          } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160;            <span class="comment">// Safety problem must hold.</span></div>
<div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;            <span class="keywordflow">if</span> (q_lo_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &lt; q_min_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q))</div>
<div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160;              <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q_lo_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) - q_min_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q_min_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)));</div>
<div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;            <span class="keywordflow">if</span> (q_hi_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) &gt; q_max_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q))</div>
<div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;              <a class="code" href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a>(<a class="code" href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a>(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q_max_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q) - q_hi_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)) <a class="code" href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a>(q_max_g(<a class="code" href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">k</a>,q)));</div>
<div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160;          }</div>
<div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;        }</div>
<div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160;    }</div>
<div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;  }</div>
<div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;}</div>
<div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160; </div>
<div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;} <span class="comment">// namespace sl</span></div>
<div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;} <span class="comment">// namespace homme</span></div>
<div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160; </div>
<div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;<span class="comment">// Interface for Homme, through compose_mod.F90.</span></div>
<div class="line"><a name="l06610"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#aaebef883fc629d3b956d841647d8c8fe"> 6610</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#aaebef883fc629d3b956d841647d8c8fe">kokkos_init</a> () {</div>
<div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;  Kokkos::InitArguments args;</div>
<div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;  args.disable_warnings = <span class="keyword">true</span>;</div>
<div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;  <a class="code" href="namespacearkode__mod.html#a876a1cb648d7a4173b7b5532624b2743">Kokkos::initialize</a>(args);</div>
<div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;}</div>
<div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160; </div>
<div class="line"><a name="l06616"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a03c36fbef1a0e5fbe8c92b3fe4bc99e9"> 6616</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#a03c36fbef1a0e5fbe8c92b3fe4bc99e9">kokkos_finalize</a> () {</div>
<div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;  Kokkos::finalize();</div>
<div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;}</div>
<div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160; </div>
<div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;<span class="keyword">static</span> <a class="code" href="structhomme_1_1_c_d_r.html#a09a617cd556ff89e82bc8b8b944d5a37">homme::CDR::Ptr</a> g_cdr;</div>
<div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160; </div>
<div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span></div>
<div class="line"><a name="l06623"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a4e5350374155dab7d49fe09a30c17a27"> 6623</a></span>&#160;<a class="code" href="compose__cedr_8cpp.html#a4e5350374155dab7d49fe09a30c17a27">cedr_init_impl</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> fcomm, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> cdr_alg, <span class="keyword">const</span> <span class="keywordtype">bool</span> use_sgi,</div>
<div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>* gid_data, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>* rank_data,</div>
<div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> gbl_ncell, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> lcl_ncell,</div>
<div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> independent_time_steps, <span class="keyword">const</span> <span class="keywordtype">bool</span> hard_zero,</div>
<div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160;                <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>) {</div>
<div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;  <span class="keyword">const</span> <span class="keyword">auto</span> p = <a class="code" href="namespacecedr_1_1mpi.html#a6e572b78e7d5d0ff5a43cab685375bb3">cedr::mpi::make_parallel</a>(MPI_Comm_f2c(fcomm));</div>
<div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;  g_cdr = std::make_shared&lt;homme::CDR&gt;(</div>
<div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;    cdr_alg, gbl_ncell, lcl_ncell, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, use_sgi, independent_time_steps, hard_zero,</div>
<div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;    gid_data, rank_data, p, fcomm);</div>
<div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;}</div>
<div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160; </div>
<div class="line"><a name="l06634"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#aab863b45779787c440a28c6bc8189b10"> 6634</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#aab863b45779787c440a28c6bc8189b10">cedr_query_bufsz</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>* sendsz, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>* recvsz) {</div>
<div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_cdr);</div>
<div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;  <span class="keywordtype">size_t</span> s1, s2;</div>
<div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;  g_cdr-&gt;get_buffers_sizes(s1, s2);</div>
<div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;  *sendsz = <span class="keyword">static_cast&lt;</span><a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a><span class="keyword">&gt;</span>(s1);</div>
<div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;  *recvsz = <span class="keyword">static_cast&lt;</span><a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a><span class="keyword">&gt;</span>(s2);</div>
<div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160;}</div>
<div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160; </div>
<div class="line"><a name="l06642"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a65701dc1e7871e366c32fa3d0d59597f"> 6642</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#a65701dc1e7871e366c32fa3d0d59597f">cedr_set_bufs</a> (<a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* sendbuf, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* recvbuf,</div>
<div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;                               <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>) {</div>
<div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160;  g_cdr-&gt;set_buffers(sendbuf, recvbuf);</div>
<div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;}</div>
<div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160; </div>
<div class="line"><a name="l06647"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#aff6d23ee28a27615bad6e7be0a3e67e8"> 6647</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#aff6d23ee28a27615bad6e7be0a3e67e8">cedr_unittest</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> fcomm, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a>* nerrp) {</div>
<div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160;<span class="preprocessor">#if 0</span></div>
<div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_cdr);</div>
<div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_cdr-&gt;tree);</div>
<div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160;  <span class="keyword">auto</span> p = <a class="code" href="namespacecedr_1_1mpi.html#a6e572b78e7d5d0ff5a43cab685375bb3">cedr::mpi::make_parallel</a>(MPI_Comm_f2c(fcomm));</div>
<div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="structhomme_1_1_c_d_r_1_1_alg.html#a4056f274fa96da8b23a8e39c91170f53">homme::CDR::Alg::is_qlt</a>(g_cdr-&gt;alg))</div>
<div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160;    *nerrp = <a class="code" href="namespacecedr_1_1qlt_1_1test.html#a097812f6cbbfba363a2a7501d7d6e1ca">cedr::qlt::test::test_qlt</a>(p, g_cdr-&gt;tree, g_cdr-&gt;nsublev*g_cdr-&gt;ncell,</div>
<div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;                                       1, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;    *nerrp = <a class="code" href="namespacecedr_1_1caas_1_1test.html#a76970efe7100a1c7ab6ef420e0a45d5c">cedr::caas::test::unittest</a>(p);</div>
<div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;  *nerrp += <a class="code" href="namespacehomme.html#a0e8829f9f66731a13df2f2169190b8a1">homme::test_tree_maker</a>();</div>
<div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;  *nerrp += <a class="code" href="classhomme_1_1compose_1_1_q_l_t.html#ac43a1d5cb462af1ab00e0c636074f33e">homme::CDR::QLTT::unittest</a>();</div>
<div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160;}</div>
<div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160; </div>
<div class="line"><a name="l06662"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a2f6321c9bb1d41a4174cdda554e29e1b"> 6662</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#a2f6321c9bb1d41a4174cdda554e29e1b">cedr_set_ie2gci</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> ie, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> gci) {</div>
<div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_cdr);</div>
<div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;  <span class="comment">// Now is a good time to drop the tree, whose persistence was used for unit</span></div>
<div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;  <span class="comment">// testing if at all.</span></div>
<div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;  g_cdr-&gt;tree = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;  <a class="code" href="namespacehomme.html#a4a444386784905f436c6fbbae4a397cf">homme::set_ie2gci</a>(*g_cdr, ie - 1, gci - 1);</div>
<div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;}</div>
<div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160; </div>
<div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;<span class="keyword">static</span> <a class="code" href="structhomme_1_1sl_1_1_data.html#a478e430b254a150d34cf695ec67a0c24">homme::sl::Data::Ptr</a> g_sl;</div>
<div class="line"><a name="l06671"></a><span class="lineno"> 6671</span>&#160; </div>
<div class="line"><a name="l06672"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#abc8a42a818fcdafcf2eb3644a461521a"> 6672</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> <a class="code" href="compose__cedr_8cpp.html#abc8a42a818fcdafcf2eb3644a461521a">cedr_sl_init</a> (</div>
<div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>,</div>
<div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> qsized, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> <a class="code" href="namespaceelement__state.html#ad600dbbab5d81bfc236df4786d322a10">timelevels</a>,</div>
<div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;  <span class="keyword">const</span> <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> need_conservation)</div>
<div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;{</div>
<div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_cdr);</div>
<div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;  g_sl = std::make_shared&lt;homme::sl::Data&gt;(g_cdr-&gt;nlclcell, <a class="code" href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">np</a>, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>,</div>
<div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;                                           qsized, <a class="code" href="namespaceelement__state.html#ad600dbbab5d81bfc236df4786d322a10">timelevels</a>);</div>
<div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;  <a class="code" href="namespacehomme.html#a596e78b4df2c806552616fd69b879cfa">homme::init_ie2lci</a>(*g_cdr);</div>
<div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;  <a class="code" href="namespacehomme.html#ad617c49d38a616dba83ab782ade127b1">homme::init_tracers</a>(*g_cdr, <a class="code" href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">nlev</a>, <a class="code" href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">qsize</a>, need_conservation);</div>
<div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;  homme::sl::check(*g_cdr, *g_sl);</div>
<div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;  <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;}</div>
<div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160; </div>
<div class="line"><a name="l06686"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#ae8e9dd870a128686a261eb848c9a18a2"> 6686</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#ae8e9dd870a128686a261eb848c9a18a2">cedr_sl_set_pointers_begin</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> nets, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> nete) {}</div>
<div class="line"><a name="l06687"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#ae31f3ee7ed0b1796b20d315da6067bd7"> 6687</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#ae31f3ee7ed0b1796b20d315da6067bd7">cedr_sl_set_spheremp</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> ie, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* v)</div>
<div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;{ <a class="code" href="namespacehomme_1_1sl.html#af77f346d99433f2dcf621707aa32c086">homme::sl::insert</a>(g_sl, ie - 1, 0, v); }</div>
<div class="line"><a name="l06689"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#ae3ec6a834c0bd7647fde8f59d31cb012"> 6689</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#ae3ec6a834c0bd7647fde8f59d31cb012">cedr_sl_set_qdp</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> ie, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* v, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> n0_qdp,</div>
<div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;                                 <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> n1_qdp)</div>
<div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;{ <a class="code" href="namespacehomme_1_1sl.html#af77f346d99433f2dcf621707aa32c086">homme::sl::insert</a>(g_sl, ie - 1, 1, v, n0_qdp - 1, n1_qdp - 1); }</div>
<div class="line"><a name="l06692"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#aac63b05d328ad81de6a8b4a6b6390f59"> 6692</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#aac63b05d328ad81de6a8b4a6b6390f59">cedr_sl_set_dp3d</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> ie, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* v, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> tl_np1)</div>
<div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;{ <a class="code" href="namespacehomme_1_1sl.html#af77f346d99433f2dcf621707aa32c086">homme::sl::insert</a>(g_sl, ie - 1, 2, v, tl_np1 - 1); }</div>
<div class="line"><a name="l06694"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#af90836fbfe6950bf37bc5cfe57ad9ebc"> 6694</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#af90836fbfe6950bf37bc5cfe57ad9ebc">cedr_sl_set_dp</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> ie, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* v)</div>
<div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;{ <a class="code" href="namespacehomme_1_1sl.html#af77f346d99433f2dcf621707aa32c086">homme::sl::insert</a>(g_sl, ie - 1, 2, v, 0); }</div>
<div class="line"><a name="l06696"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#af5a0276bb2dbefb74e60bc2f48777353"> 6696</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#af5a0276bb2dbefb74e60bc2f48777353">cedr_sl_set_q</a> (<a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> ie, <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* v)</div>
<div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;{ <a class="code" href="namespacehomme_1_1sl.html#af77f346d99433f2dcf621707aa32c086">homme::sl::insert</a>(g_sl, ie - 1, 3, v); }</div>
<div class="line"><a name="l06698"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#adb50e9b1de2f71de7cc4bd92ecd6a495"> 6698</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#adb50e9b1de2f71de7cc4bd92ecd6a495">cedr_sl_set_dp0</a> (<a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* v)</div>
<div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;{ <a class="code" href="namespacehomme_1_1sl.html#af77f346d99433f2dcf621707aa32c086">homme::sl::insert</a>(g_sl, 0, 4, v); }</div>
<div class="line"><a name="l06700"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a01a8e64063567601af02f3ee19e4a4c3"> 6700</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#a01a8e64063567601af02f3ee19e4a4c3">cedr_sl_set_pointers_end</a> () {}</div>
<div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160; </div>
<div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;<span class="comment">// Run QLT.</span></div>
<div class="line"><a name="l06703"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a6733f39eb2f96fb3a1149d1a087aedaa"> 6703</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#a6733f39eb2f96fb3a1149d1a087aedaa">cedr_sl_run</a> (<a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* minq, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* maxq,</div>
<div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;                             <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> nets, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> nete) {</div>
<div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(minq != maxq);</div>
<div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_cdr);</div>
<div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_sl);</div>
<div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;  homme::sl::run_global&lt;4&gt;(*g_cdr, *g_sl, minq, maxq, nets-1, nete-1);</div>
<div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;}</div>
<div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160; </div>
<div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;<span class="comment">// Run the cell-local limiter problem.</span></div>
<div class="line"><a name="l06712"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#ae747afb448da5f0376697e43d74778c5"> 6712</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#ae747afb448da5f0376697e43d74778c5">cedr_sl_run_local</a> (<a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* minq, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* maxq,</div>
<div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;                                   <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> nets, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> nete, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> use_ir,</div>
<div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;                                   <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> <a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a>) {</div>
<div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(minq != maxq);</div>
<div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_cdr);</div>
<div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_sl);</div>
<div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;  homme::sl::run_local&lt;4&gt;(*g_cdr, *g_sl, minq, maxq, nets-1, nete-1, use_ir,</div>
<div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;                          <a class="code" href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">limiter_option</a>);</div>
<div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;}</div>
<div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160; </div>
<div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;<span class="comment">// Check properties for this transport step.</span></div>
<div class="line"><a name="l06723"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#a955408f4b6bdfb672629fed0acaa3edf"> 6723</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#a955408f4b6bdfb672629fed0acaa3edf">cedr_sl_check</a> (<span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* minq, <span class="keyword">const</span> <a class="code" href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a>* maxq,</div>
<div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;                               <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> nets, <a class="code" href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a> nete) {</div>
<div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_cdr);</div>
<div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;  <a class="code" href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a>(g_sl);</div>
<div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;  homme::sl::check(*g_cdr, *g_sl, minq, maxq, nets-1, nete-1);</div>
<div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;}</div>
<div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160; </div>
<div class="line"><a name="l06730"></a><span class="lineno"><a class="line" href="compose__cedr_8cpp.html#afb0c587d50bffba1a90d72ba7597f152"> 6730</a></span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="compose__cedr_8cpp.html#afb0c587d50bffba1a90d72ba7597f152">cedr_finalize</a> () {</div>
<div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;  g_sl = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;  g_cdr = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;}</div>
<div class="ttc" id="aclasscedr_1_1_input_parser_1_1_arg_advancer_html"><div class="ttname"><a href="classcedr_1_1_input_parser_1_1_arg_advancer.html">cedr::InputParser::ArgAdvancer</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04942">compose_cedr.cpp:4942</a></div></div>
<div class="ttc" id="aclasscedr_1_1_input_parser_1_1_arg_advancer_html_a2b45f79c3e9fe14e3b09bb1133715043"><div class="ttname"><a href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a2b45f79c3e9fe14e3b09bb1133715043">cedr::InputParser::ArgAdvancer::advance</a></div><div class="ttdeci">const char * advance()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04948">compose_cedr.cpp:4948</a></div></div>
<div class="ttc" id="aclasscedr_1_1_input_parser_1_1_arg_advancer_html_a69ac1c8f2bc75a0ef08d5ea5106fe810"><div class="ttname"><a href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a69ac1c8f2bc75a0ef08d5ea5106fe810">cedr::InputParser::ArgAdvancer::ArgAdvancer</a></div><div class="ttdeci">ArgAdvancer(int argc, char **argv)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04947">compose_cedr.cpp:4947</a></div></div>
<div class="ttc" id="aclasscedr_1_1_input_parser_1_1_arg_advancer_html_a74d9a6c03914607b1b7932320093b544"><div class="ttname"><a href="classcedr_1_1_input_parser_1_1_arg_advancer.html#a74d9a6c03914607b1b7932320093b544">cedr::InputParser::ArgAdvancer::token</a></div><div class="ttdeci">const char * token() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04952">compose_cedr.cpp:4952</a></div></div>
<div class="ttc" id="aclasscedr_1_1_input_parser_1_1_arg_advancer_html_aa59140f9e0706a2cc1646519fbc94201"><div class="ttname"><a href="classcedr_1_1_input_parser_1_1_arg_advancer.html#aa59140f9e0706a2cc1646519fbc94201">cedr::InputParser::ArgAdvancer::incr</a></div><div class="ttdeci">void incr()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04953">compose_cedr.cpp:4953</a></div></div>
<div class="ttc" id="aclasscedr_1_1_input_parser_1_1_arg_advancer_html_ad98a308fab7f73a2ce4ade28b26b94ca"><div class="ttname"><a href="classcedr_1_1_input_parser_1_1_arg_advancer.html#ad98a308fab7f73a2ce4ade28b26b94ca">cedr::InputParser::ArgAdvancer::more</a></div><div class="ttdeci">bool more() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04954">compose_cedr.cpp:4954</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html">cedr::caas::CAAS</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00907">compose_cedr.cpp:907</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a123e7bc147038d85752b51dbc0e0d52a"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a123e7bc147038d85752b51dbc0e0d52a">cedr::caas::CAAS::finished_setup_</a></div><div class="ttdeci">bool finished_setup_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00981">compose_cedr.cpp:981</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a2187699bf313cd248971790e17e7143c"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a2187699bf313cd248971790e17e7143c">cedr::caas::CAAS::set_rhom</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void set_rhom(const Int &amp;lclcellidx, const Int &amp;rhomidx, const Real &amp;rhom) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01017">compose_cedr.cpp:1017</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a25fb8c96e17a5cf52fa8f5d1a121d0ad"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a25fb8c96e17a5cf52fa8f5d1a121d0ad">cedr::caas::CAAS::finish_locally</a></div><div class="ttdeci">void finish_locally()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03980">compose_cedr.cpp:3980</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a286accaaf020796734e0e8984ada62b1"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a286accaaf020796734e0e8984ada62b1">cedr::caas::CAAS::end_tracer_declarations</a></div><div class="ttdeci">void end_tracer_declarations() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03806">compose_cedr.cpp:3806</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a328c8238b4279baff795f97d3acdf173"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a328c8238b4279baff795f97d3acdf173">cedr::caas::CAAS::reduce_globally</a></div><div class="ttdeci">void reduce_globally()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03972">compose_cedr.cpp:3972</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a3c487a7cbfd1c15e707036bf6010f55f"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a3c487a7cbfd1c15e707036bf6010f55f">cedr::caas::CAAS::need_conserve_</a></div><div class="ttdeci">bool need_conserve_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00977">compose_cedr.cpp:977</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a3fd3c6018001a747e0b40c80b2a2e01c"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a3fd3c6018001a747e0b40c80b2a2e01c">cedr::caas::CAAS::set_buffers</a></div><div class="ttdeci">void set_buffers(Real *buf1, Real *buf2) override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03838">compose_cedr.cpp:3838</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a434388bd16d754c7091654788b23878b"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a434388bd16d754c7091654788b23878b">cedr::caas::CAAS::finish_setup</a></div><div class="ttdeci">void finish_setup() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03847">compose_cedr.cpp:3847</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a43c3ccd110b8401cf4c82219d197fe5e"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a43c3ccd110b8401cf4c82219d197fe5e">cedr::caas::CAAS::IntList</a></div><div class="ttdeci">Kokkos::View&lt; Int *, Kokkos::LayoutLeft, Device &gt; IntList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00963">compose_cedr.cpp:963</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a48d6656e20903fd21bffcc11c1f908b3"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a48d6656e20903fd21bffcc11c1f908b3">cedr::caas::CAAS::set_Qm</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void set_Qm(const Int &amp;lclcellidx, const Int &amp;tracer_idx, const Real &amp;Qm, const Real &amp;Qm_min, const Real &amp;Qm_max, const Real Qm_prev=std::numeric_limits&lt; Real &gt;::infinity()) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01026">compose_cedr.cpp:1026</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a4b3b86d7004bd8db749714c58372733d"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a4b3b86d7004bd8db749714c58372733d">cedr::caas::CAAS::get_buffers_sizes</a></div><div class="ttdeci">void get_buffers_sizes(size_t &amp;buf1, size_t &amp;buf2) override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03831">compose_cedr.cpp:3831</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a51db49b62432ed6b0ea1875114157421"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a51db49b62432ed6b0ea1875114157421">cedr::caas::CAAS::get_Qm</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Real get_Qm(const Int &amp;lclcellidx, const Int &amp;tracer_idx) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01040">compose_cedr.cpp:1040</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a816b83a8487dbc88d8fa843e722dd732"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a816b83a8487dbc88d8fa843e722dd732">cedr::caas::CAAS::declare_tracer</a></div><div class="ttdeci">void declare_tracer(int problem_type, const Int &amp;rhomidx) override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03795">compose_cedr.cpp:3795</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a85e4fa2a2a4ab325e53845943ed61f48"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a85e4fa2a2a4ab325e53845943ed61f48">cedr::caas::CAAS::user_reducer_</a></div><div class="ttdeci">UserAllReducer::Ptr user_reducer_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00973">compose_cedr.cpp:973</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a86de64c7ffe1084260e45518997e99c0"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a86de64c7ffe1084260e45518997e99c0">cedr::caas::CAAS::Device</a></div><div class="ttdeci">cedr::impl::DeviceType&lt; ExeSpace &gt;::type Device</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00909">compose_cedr.cpp:909</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a8a50dc5d74b570ea11de351a3b9b5bb6"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a8a50dc5d74b570ea11de351a3b9b5bb6">cedr::caas::CAAS::d_</a></div><div class="ttdeci">RealList d_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00980">compose_cedr.cpp:980</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a8aa95b7eb655b14bea7a61182ff69c09"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a8aa95b7eb655b14bea7a61182ff69c09">cedr::caas::CAAS::send_</a></div><div class="ttdeci">RealList send_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00980">compose_cedr.cpp:980</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a8c398d85becddf2d94ac02991e4556a4"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a8c398d85becddf2d94ac02991e4556a4">cedr::caas::CAAS::probs_</a></div><div class="ttdeci">IntList probs_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00978">compose_cedr.cpp:978</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a8cc7e3549e2e8ce2c2f6ad3671deeeb5"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a8cc7e3549e2e8ce2c2f6ad3671deeeb5">cedr::caas::CAAS::get_problem_type</a></div><div class="ttdeci">int get_problem_type(const Int &amp;tracer_idx) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03863">compose_cedr.cpp:3863</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a8d46460cee51108c435def65ab5da015"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a8d46460cee51108c435def65ab5da015">cedr::caas::CAAS::p_</a></div><div class="ttdeci">mpi::Parallel::Ptr p_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00972">compose_cedr.cpp:972</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a8fcae413e992c1ca191f21e6b0debcf8"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a8fcae413e992c1ca191f21e6b0debcf8">cedr::caas::CAAS::nrhomidxs_</a></div><div class="ttdeci">Int nrhomidxs_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00975">compose_cedr.cpp:975</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a9a2993d2c0cc0ffc38344bacd1a2361f"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a9a2993d2c0cc0ffc38344bacd1a2361f">cedr::caas::CAAS::get_num_tracers</a></div><div class="ttdeci">Int get_num_tracers() const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03869">compose_cedr.cpp:3869</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a9b173cba1219ec2b87de4c11dc6f8dc3"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a9b173cba1219ec2b87de4c11dc6f8dc3">cedr::caas::CAAS::recv_</a></div><div class="ttdeci">RealList recv_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00980">compose_cedr.cpp:980</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_a9dcb6c61166e724ef9539b296d924591"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#a9dcb6c61166e724ef9539b296d924591">cedr::caas::CAAS::probs_h_</a></div><div class="ttdeci">IntList::HostMirror probs_h_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00979">compose_cedr.cpp:979</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_ab4a8fa2d175e48f52f7ab80bf3bdcce1"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#ab4a8fa2d175e48f52f7ab80bf3bdcce1">cedr::caas::CAAS::Me</a></div><div class="ttdeci">CAAS&lt; ExeSpace &gt; Me</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00910">compose_cedr.cpp:910</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_ab74c81a9f681b58929af5f84a49c352f"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#ab74c81a9f681b58929af5f84a49c352f">cedr::caas::CAAS::t2r_</a></div><div class="ttdeci">IntList t2r_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00978">compose_cedr.cpp:978</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_ac499842d68aca0ba4d9a675664ea8fbe"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#ac499842d68aca0ba4d9a675664ea8fbe">cedr::caas::CAAS::run</a></div><div class="ttdeci">void run() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04020">compose_cedr.cpp:4020</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_ace4111c506c2eee9eabe531907e5d650"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#ace4111c506c2eee9eabe531907e5d650">cedr::caas::CAAS::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; Me &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00911">compose_cedr.cpp:911</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_ada5f9d04b8bbf91c87ca571c828b883e"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#ada5f9d04b8bbf91c87ca571c828b883e">cedr::caas::CAAS::RealList</a></div><div class="ttdeci">Kokkos::View&lt; Real *, Kokkos::LayoutLeft, Device &gt; RealList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00912">compose_cedr.cpp:912</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_adce4bcf380215208609e80f43984981c"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#adce4bcf380215208609e80f43984981c">cedr::caas::CAAS::tracer_decls_</a></div><div class="ttdeci">std::shared_ptr&lt; std::vector&lt; Decl &gt; &gt; tracer_decls_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00976">compose_cedr.cpp:976</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_aebd9e499ed880c2e79a00ff21e324fa7"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#aebd9e499ed880c2e79a00ff21e324fa7">cedr::caas::CAAS::UnmanagedRealList</a></div><div class="ttdeci">cedr::impl::Unmanaged&lt; RealList &gt; UnmanagedRealList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00962">compose_cedr.cpp:962</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_af2bfbf0700298c8dda3152791f11b395"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#af2bfbf0700298c8dda3152791f11b395">cedr::caas::CAAS::nlclcells_</a></div><div class="ttdeci">Int nlclcells_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00975">compose_cedr.cpp:975</a></div></div>
<div class="ttc" id="aclasscedr_1_1caas_1_1_c_a_a_s_html_aff00f5067fdecb35aa64116f20c7aa98"><div class="ttname"><a href="classcedr_1_1caas_1_1_c_a_a_s.html#aff00f5067fdecb35aa64116f20c7aa98">cedr::caas::CAAS::CAAS</a></div><div class="ttdeci">CAAS(const mpi::Parallel::Ptr &amp;p, const Int nlclcells, const typename UserAllReducer::Ptr &amp;r=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03785">compose_cedr.cpp:3785</a></div></div>
<div class="ttc" id="aclasscedr_1_1mpi_1_1_parallel_html"><div class="ttname"><a href="classcedr_1_1mpi_1_1_parallel.html">cedr::mpi::Parallel</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00212">compose_cedr.cpp:212</a></div></div>
<div class="ttc" id="aclasscedr_1_1mpi_1_1_parallel_html_a19b8ad85d1408f6114421e328f617577"><div class="ttname"><a href="classcedr_1_1mpi_1_1_parallel.html#a19b8ad85d1408f6114421e328f617577">cedr::mpi::Parallel::Parallel</a></div><div class="ttdeci">Parallel(MPI_Comm comm)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00216">compose_cedr.cpp:216</a></div></div>
<div class="ttc" id="aclasscedr_1_1mpi_1_1_parallel_html_a4679f09fa87c42310ac9b90b712c2809"><div class="ttname"><a href="classcedr_1_1mpi_1_1_parallel.html#a4679f09fa87c42310ac9b90b712c2809">cedr::mpi::Parallel::size</a></div><div class="ttdeci">Int size() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02332">compose_cedr.cpp:2332</a></div></div>
<div class="ttc" id="aclasscedr_1_1mpi_1_1_parallel_html_a5f796868b6a39b81295292def0196fe3"><div class="ttname"><a href="classcedr_1_1mpi_1_1_parallel.html#a5f796868b6a39b81295292def0196fe3">cedr::mpi::Parallel::root</a></div><div class="ttdeci">Int root() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00220">compose_cedr.cpp:220</a></div></div>
<div class="ttc" id="aclasscedr_1_1mpi_1_1_parallel_html_aa260ebf870235c0e3834ec6bb94a351f"><div class="ttname"><a href="classcedr_1_1mpi_1_1_parallel.html#aa260ebf870235c0e3834ec6bb94a351f">cedr::mpi::Parallel::comm</a></div><div class="ttdeci">MPI_Comm comm() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00217">compose_cedr.cpp:217</a></div></div>
<div class="ttc" id="aclasscedr_1_1mpi_1_1_parallel_html_aa7cbfef2c75620d170371b125679f281"><div class="ttname"><a href="classcedr_1_1mpi_1_1_parallel.html#aa7cbfef2c75620d170371b125679f281">cedr::mpi::Parallel::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; Parallel &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00215">compose_cedr.cpp:215</a></div></div>
<div class="ttc" id="aclasscedr_1_1mpi_1_1_parallel_html_ad5a5d63fd5ed9d639834857757606b19"><div class="ttname"><a href="classcedr_1_1mpi_1_1_parallel.html#ad5a5d63fd5ed9d639834857757606b19">cedr::mpi::Parallel::rank</a></div><div class="ttdeci">Int rank() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02338">compose_cedr.cpp:2338</a></div></div>
<div class="ttc" id="aclasscedr_1_1mpi_1_1_parallel_html_ad956465e5758049c7587929595d52299"><div class="ttname"><a href="classcedr_1_1mpi_1_1_parallel.html#ad956465e5758049c7587929595d52299">cedr::mpi::Parallel::amroot</a></div><div class="ttdeci">bool amroot() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00221">compose_cedr.cpp:221</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html">cedr::qlt::QLT</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00673">compose_cedr.cpp:673</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a055eac02ef22081e738e735fa68578d1"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a055eac02ef22081e738e735fa68578d1">cedr::qlt::QLT::IntList</a></div><div class="ttdeci">Kokkos::View&lt; Int *, Device &gt; IntList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00732">compose_cedr.cpp:732</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a073b0d26f059d049d8b66c5d1799e3e3"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a073b0d26f059d049d8b66c5d1799e3e3">cedr::qlt::QLT::RealList</a></div><div class="ttdeci">Kokkos::View&lt; Real *, Device &gt; RealList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00678">compose_cedr.cpp:678</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a0c1a4d9fd58ff961f01578a04a15e02e"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a0c1a4d9fd58ff961f01578a04a15e02e">cedr::qlt::QLT::l2r_combine_kid_data</a></div><div class="ttdeci">void l2r_combine_kid_data(const Int &amp;lvlidx, const Int &amp;l2rndps) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03117">compose_cedr.cpp:3117</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a0fe6b6b89981974d682b4096ac210b1e"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a0fe6b6b89981974d682b4096ac210b1e">cedr::qlt::QLT::Me</a></div><div class="ttdeci">QLT&lt; ExeSpace &gt; Me</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00676">compose_cedr.cpp:676</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a1a8a3cf478360277dc875eef4b4250d7"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a1a8a3cf478360277dc875eef4b4250d7">cedr::qlt::QLT::init_ordinals</a></div><div class="ttdeci">void init_ordinals()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02998">compose_cedr.cpp:2998</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a1ee460e97c8285bebfbbd17af959564b"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a1ee460e97c8285bebfbbd17af959564b">cedr::qlt::QLT::get_owned_glblcells</a></div><div class="ttdeci">void get_owned_glblcells(std::vector&lt; Long &gt; &amp;gcis) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03029">compose_cedr.cpp:3029</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a21773cb730605b9749e0291c66b4d1d6"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a21773cb730605b9749e0291c66b4d1d6">cedr::qlt::QLT::init</a></div><div class="ttdeci">static void init(const std::string &amp;name, IntList &amp;d, typename IntList::HostMirror &amp;h, size_t n)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02856">compose_cedr.cpp:2856</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a3267afdf17e6a873b9267087ab1b2d3e"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a3267afdf17e6a873b9267087ab1b2d3e">cedr::qlt::QLT::declare_tracer</a></div><div class="ttdeci">void declare_tracer(int problem_type, const Int &amp;rhomidx) override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03054">compose_cedr.cpp:3054</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a3447eb3c22f536ef0816e8625df7f69b"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a3447eb3c22f536ef0816e8625df7f69b">cedr::qlt::QLT::init</a></div><div class="ttdeci">void init(const MetaDataBuilder &amp;mdb)</div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a3ef39b340f964d6965517076750726e3"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a3ef39b340f964d6965517076750726e3">cedr::qlt::QLT::ConstIntList</a></div><div class="ttdeci">cedr::impl::Const&lt; IntList &gt; ConstIntList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00733">compose_cedr.cpp:733</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a4098edea0e28e95f830dcbcf914f48e0"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a4098edea0e28e95f830dcbcf914f48e0">cedr::qlt::QLT::get_problem_type_r2l_bulk_size</a></div><div class="ttdeci">static int get_problem_type_r2l_bulk_size(const int &amp;mask)</div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a449fb834c32f927c0d70c86c8199116f"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a449fb834c32f927c0d70c86c8199116f">cedr::qlt::QLT::get_problem_type</a></div><div class="ttdeci">static KOKKOS_INLINE_FUNCTION int get_problem_type(const int &amp;idx)</div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a495b3a172143d2de992f477bc529e2b1"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a495b3a172143d2de992f477bc529e2b1">cedr::qlt::QLT::r2l_send_to_kids</a></div><div class="ttdeci">void r2l_send_to_kids(const impl::NodeSets::Level &amp;lvl, const Int &amp;r2lndps) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03384">compose_cedr.cpp:3384</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a4bce582840cb58a4ce70fbd740cbfacf"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a4bce582840cb58a4ce70fbd740cbfacf">cedr::qlt::QLT::init</a></div><div class="ttdeci">void init(const Parallel::Ptr &amp;p, const Int &amp;ncells, const tree::Node::Ptr &amp;tree)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02984">compose_cedr.cpp:2984</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a4ed32b7c9d2c3f2889b89dcc01c452fe"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a4ed32b7c9d2c3f2889b89dcc01c452fe">cedr::qlt::QLT::r2l_recv</a></div><div class="ttdeci">void r2l_recv(const impl::NodeSets::Level &amp;lvl, const Int &amp;r2lndps) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03256">compose_cedr.cpp:3256</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a5273c47c902c24b4f2a0741f27956120"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a5273c47c902c24b4f2a0741f27956120">cedr::qlt::QLT::root_compute</a></div><div class="ttdeci">void root_compute(const Int &amp;l2rndps, const Int &amp;r2lndps) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03219">compose_cedr.cpp:3219</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a586e7f48cf1fd309d37f6c67da0dc76c"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a586e7f48cf1fd309d37f6c67da0dc76c">cedr::qlt::QLT::ns_</a></div><div class="ttdeci">std::shared_ptr&lt; const impl::NodeSets &gt; ns_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00838">compose_cedr.cpp:838</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a596f975d028550632ee5fb3e70b5eed5"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a596f975d028550632ee5fb3e70b5eed5">cedr::qlt::QLT::run</a></div><div class="ttdeci">void run() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03393">compose_cedr.cpp:3393</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a63777cbd5e67f5ed92a2612513dece18"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a63777cbd5e67f5ed92a2612513dece18">cedr::qlt::QLT::mdb_</a></div><div class="ttdeci">MetaDataBuilder::Ptr mdb_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00847">compose_cedr.cpp:847</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a6a8d2cda6321bd2f6a59e4dd85f9bfc6"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a6a8d2cda6321bd2f6a59e4dd85f9bfc6">cedr::qlt::QLT::set_Qm</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void set_Qm(const Int &amp;lclcellidx, const Int &amp;tracer_idx, const Real &amp;Qm, const Real &amp;Qm_min, const Real &amp;Qm_max, const Real Qm_prev=std::numeric_limits&lt; Real &gt;::infinity()) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01549">compose_cedr.cpp:1549</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a6fcf4740b2f4b23a2ad03ec133ead2ee"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a6fcf4740b2f4b23a2ad03ec133ead2ee">cedr::qlt::QLT::r2l_solve_qp</a></div><div class="ttdeci">void r2l_solve_qp(const Int &amp;lvlidx, const Int &amp;l2rndps, const Int &amp;r2lndps) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03303">compose_cedr.cpp:3303</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a8318d3741486e1e54865d2c3d8133653"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a8318d3741486e1e54865d2c3d8133653">cedr::qlt::QLT::print</a></div><div class="ttdeci">void print(std::ostream &amp;os) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03016">compose_cedr.cpp:3016</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a84478e9b51aaa88ce6f926a4a41c07a5"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a84478e9b51aaa88ce6f926a4a41c07a5">cedr::qlt::QLT::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; Me &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00677">compose_cedr.cpp:677</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a86d63f43bc89c9244408775e6b29ade1"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a86d63f43bc89c9244408775e6b29ade1">cedr::qlt::QLT::nsdd_</a></div><div class="ttdeci">std::shared_ptr&lt; impl::NodeSetsDeviceData&lt; ExeSpace &gt; &gt; nsdd_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00840">compose_cedr.cpp:840</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a8855469fbf2739b8b3b9c94ede02eb67"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a8855469fbf2739b8b3b9c94ede02eb67">cedr::qlt::QLT::set_buffers</a></div><div class="ttdeci">void set_buffers(Real *buf1, Real *buf2) override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03078">compose_cedr.cpp:3078</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a9018bfb30d655cb813ffd035498d4b52"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a9018bfb30d655cb813ffd035498d4b52">cedr::qlt::QLT::QLT</a></div><div class="ttdeci">QLT(const Parallel::Ptr &amp;p, const Int &amp;ncells, const tree::Node::Ptr &amp;tree, CDR::Options options=Options())</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03007">compose_cedr.cpp:3007</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a95d862da426b1f9348837e9c73bfa7b3"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a95d862da426b1f9348837e9c73bfa7b3">cedr::qlt::QLT::ConstUnmanagedIntList</a></div><div class="ttdeci">cedr::impl::ConstUnmanaged&lt; IntList &gt; ConstUnmanagedIntList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00734">compose_cedr.cpp:734</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a969c2dfcff33c9a462d65896808f9623"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a969c2dfcff33c9a462d65896808f9623">cedr::qlt::QLT::md_</a></div><div class="ttdeci">MetaData md_</div><div class="ttdoc">View data for host and device computation.</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00850">compose_cedr.cpp:850</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a99f352c9b0cf724a5b45b70b0d288c1c"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a99f352c9b0cf724a5b45b70b0d288c1c">cedr::qlt::QLT::get_Qm</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Real get_Qm(const Int &amp;lclcellidx, const Int &amp;tracer_idx) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01587">compose_cedr.cpp:1587</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_a9cbe7b87776dcf8ab9c5c56e5685d974"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#a9cbe7b87776dcf8ab9c5c56e5685d974">cedr::qlt::QLT::end_tracer_declarations</a></div><div class="ttdeci">void end_tracer_declarations() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03065">compose_cedr.cpp:3065</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_aa347f16c8c195dc3a9eea28b841e7dc0"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#aa347f16c8c195dc3a9eea28b841e7dc0">cedr::qlt::QLT::nshd_</a></div><div class="ttdeci">std::shared_ptr&lt; impl::NodeSetsHostData &gt; nshd_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00841">compose_cedr.cpp:841</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_aa4ae6dfd97ee6c328511f0f7e45976fb"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#aa4ae6dfd97ee6c328511f0f7e45976fb">cedr::qlt::QLT::get_problem_type_idx</a></div><div class="ttdeci">static int get_problem_type_idx(const int &amp;mask)</div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_aa9b83575295958b3ecc89e6ef81d8df4"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#aa9b83575295958b3ecc89e6ef81d8df4">cedr::qlt::QLT::gci2lci</a></div><div class="ttdeci">Int gci2lci(const Int &amp;gci) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03041">compose_cedr.cpp:3041</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ab3021096085b1400b07e0d39fe6f9ae7"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ab3021096085b1400b07e0d39fe6f9ae7">cedr::qlt::QLT::get_buffers_sizes</a></div><div class="ttdeci">void get_buffers_sizes(size_t &amp;buf1, size_t &amp;buf2) override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03071">compose_cedr.cpp:3071</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ab6765f1390332eddf8f644fe60128433"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ab6765f1390332eddf8f644fe60128433">cedr::qlt::QLT::gci2lci_</a></div><div class="ttdeci">std::shared_ptr&lt; Gci2LciMap &gt; gci2lci_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00844">compose_cedr.cpp:844</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_abff0963db1a1bd0c00a46ee0ce48a3f6"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#abff0963db1a1bd0c00a46ee0ce48a3f6">cedr::qlt::QLT::Gci2LciMap</a></div><div class="ttdeci">std::map&lt; Int, Int &gt; Gci2LciMap</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00843">compose_cedr.cpp:843</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ac09df17ae7c38e04f41dcb5700092c0c"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ac09df17ae7c38e04f41dcb5700092c0c">cedr::qlt::QLT::get_num_tracers</a></div><div class="ttdeci">Int get_num_tracers() const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03100">compose_cedr.cpp:3100</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ad4f52d10cdefba976a000b5f0a186a95"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ad4f52d10cdefba976a000b5f0a186a95">cedr::qlt::QLT::a_h</a></div><div class="ttdeci">Arrays&lt; typename ConstUnmanagedIntList::HostMirror &gt; a_h</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00802">compose_cedr.cpp:802</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ad74c27f1a2680f0c76d9b2991b6f18fe"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ad74c27f1a2680f0c76d9b2991b6f18fe">cedr::qlt::QLT::a_d</a></div><div class="ttdeci">Arrays&lt; ConstUnmanagedIntList &gt; a_d</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00803">compose_cedr.cpp:803</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ad85d32b7277b27a39d6bda5e605daac7"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ad85d32b7277b27a39d6bda5e605daac7">cedr::qlt::QLT::finish_setup</a></div><div class="ttdeci">void finish_setup() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03085">compose_cedr.cpp:3085</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ad9c51a9177892aa04c600773abe6ac11"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ad9c51a9177892aa04c600773abe6ac11">cedr::qlt::QLT::get_problem_type</a></div><div class="ttdeci">int get_problem_type(const Int &amp;tracer_idx) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03093">compose_cedr.cpp:3093</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_adbfb99b85e927e80b9f1a6fb69f76047"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#adbfb99b85e927e80b9f1a6fb69f76047">cedr::qlt::QLT::l2r_send_to_parents</a></div><div class="ttdeci">void l2r_send_to_parents(const impl::NodeSets::Level &amp;lvl, const Int &amp;l2rndps) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03210">compose_cedr.cpp:3210</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ae584a8a8c6ded31710928b0bfffeb242"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ae584a8a8c6ded31710928b0bfffeb242">cedr::qlt::QLT::p_</a></div><div class="ttdeci">Parallel::Ptr p_</div><div class="ttdoc">Pointer data for initialization and host computation.</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00836">compose_cedr.cpp:836</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ae5bcfd4e69486bda74225278f513b3c3"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ae5bcfd4e69486bda74225278f513b3c3">cedr::qlt::QLT::set_rhom</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void set_rhom(const Int &amp;lclcellidx, const Int &amp;rhomidx, const Real &amp;rhom) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01542">compose_cedr.cpp:1542</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_ae887c2546eb47eafdeb8e58fe6a1e288"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#ae887c2546eb47eafdeb8e58fe6a1e288">cedr::qlt::QLT::nlclcells</a></div><div class="ttdeci">Int nlclcells() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03022">compose_cedr.cpp:3022</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_af1a0b1b2a8800fe7a49045308bd61ee2"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#af1a0b1b2a8800fe7a49045308bd61ee2">cedr::qlt::QLT::Device</a></div><div class="ttdeci">cedr::impl::DeviceType&lt; ExeSpace &gt;::type Device</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00675">compose_cedr.cpp:675</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_af79ccbf41643efd58dcc29de8260199a"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#af79ccbf41643efd58dcc29de8260199a">cedr::qlt::QLT::bd_</a></div><div class="ttdeci">BulkData bd_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00851">compose_cedr.cpp:851</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_q_l_t_html_afffa19071eec946749272d9ad1dbd0dd"><div class="ttname"><a href="classcedr_1_1qlt_1_1_q_l_t.html#afffa19071eec946749272d9ad1dbd0dd">cedr::qlt::QLT::get_problem_type_l2r_bulk_size</a></div><div class="ttdeci">static KOKKOS_INLINE_FUNCTION int get_problem_type_l2r_bulk_size(const int &amp;mask)</div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html">cedr::qlt::Timer</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02426">compose_cedr.cpp:2426</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edae"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edae">cedr::qlt::Timer::Op</a></div><div class="ttdeci">Op</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02428">compose_cedr.cpp:2428</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaea043af0b185f9b1d1af6cc8c103783b75"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea043af0b185f9b1d1af6cc8c103783b75">cedr::qlt::Timer::qltrunl2r</a></div><div class="ttdeci">@ qltrunl2r</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02428">compose_cedr.cpp:2428</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaea0af5ae2b492422e8ea6a44e6c21cf343"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea0af5ae2b492422e8ea6a44e6c21cf343">cedr::qlt::Timer::waitall</a></div><div class="ttdeci">@ waitall</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02428">compose_cedr.cpp:2428</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaea41a1f4c4684ecd85db778bbd2a3fce18"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea41a1f4c4684ecd85db778bbd2a3fce18">cedr::qlt::Timer::qltrun</a></div><div class="ttdeci">@ qltrun</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02428">compose_cedr.cpp:2428</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaea45f2e86e39d230aafc930343c1d23811"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea45f2e86e39d230aafc930343c1d23811">cedr::qlt::Timer::qltrunr2l</a></div><div class="ttdeci">@ qltrunr2l</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02428">compose_cedr.cpp:2428</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaea8932f4c5fd83511800461ddeaf96a997"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea8932f4c5fd83511800461ddeaf96a997">cedr::qlt::Timer::total</a></div><div class="ttdeci">@ total</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02429">compose_cedr.cpp:2429</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea93f4b2da8d23f7e6ea251c4973d41b30">cedr::qlt::Timer::NTIMERS</a></div><div class="ttdeci">@ NTIMERS</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02429">compose_cedr.cpp:2429</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaea9501181ea4c574b8b4440411ceaa8a96"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaea9501181ea4c574b8b4440411ceaa8a96">cedr::qlt::Timer::analyze</a></div><div class="ttdeci">@ analyze</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02428">compose_cedr.cpp:2428</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaeacb820002d5d6448bfb255d832fefed63"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaeacb820002d5d6448bfb255d832fefed63">cedr::qlt::Timer::snp</a></div><div class="ttdeci">@ snp</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02428">compose_cedr.cpp:2428</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a180078dc887a651747d4af62fe10edaeae63447b32c00b834471886966f833c36"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a180078dc887a651747d4af62fe10edaeae63447b32c00b834471886966f833c36">cedr::qlt::Timer::tree</a></div><div class="ttdeci">@ tree</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02428">compose_cedr.cpp:2428</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a18e6dd3b80c54ca258b202d81daa1abf"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a18e6dd3b80c54ca258b202d81daa1abf">cedr::qlt::Timer::init</a></div><div class="ttdeci">static void init()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02430">compose_cedr.cpp:2430</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a29a2432f3e24ae376275e855319b47b6"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a29a2432f3e24ae376275e855319b47b6">cedr::qlt::Timer::stop</a></div><div class="ttdeci">static void stop(const Op op)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02450">compose_cedr.cpp:2450</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_a67433f0f91c7000b32ad545239f2cd4f"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#a67433f0f91c7000b32ad545239f2cd4f">cedr::qlt::Timer::start</a></div><div class="ttdeci">static void start(const Op op)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02444">compose_cedr.cpp:2444</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_abee29aaee4b6a40fe9fb95e17a78e7a6"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#abee29aaee4b6a40fe9fb95e17a78e7a6">cedr::qlt::Timer::print</a></div><div class="ttdeci">static void print()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02463">compose_cedr.cpp:2463</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1_timer_html_ae11111b5eac47aa7c5dba40f87247f92"><div class="ttname"><a href="classcedr_1_1qlt_1_1_timer.html#ae11111b5eac47aa7c5dba40f87247f92">cedr::qlt::Timer::reset</a></div><div class="ttdeci">static void reset(const Op op)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02438">compose_cedr.cpp:2438</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1test_1_1_test_q_l_t_html"><div class="ttname"><a href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html">cedr::qlt::test::TestQLT</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03419">compose_cedr.cpp:3419</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1test_1_1_test_q_l_t_html_a466ced59652d893b8faf62e4d36bb2c9"><div class="ttname"><a href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html#a466ced59652d893b8faf62e4d36bb2c9">cedr::qlt::test::TestQLT::QLTT</a></div><div class="ttdeci">QLT&lt; Kokkos::DefaultExecutionSpace &gt; QLTT</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03421">compose_cedr.cpp:3421</a></div></div>
<div class="ttc" id="aclasscedr_1_1qlt_1_1test_1_1_test_q_l_t_html_a895fda361434740baa765be426a04877"><div class="ttname"><a href="classcedr_1_1qlt_1_1test_1_1_test_q_l_t.html#a895fda361434740baa765be426a04877">cedr::qlt::test::TestQLT::TestQLT</a></div><div class="ttdeci">TestQLT(const Parallel::Ptr &amp;p, const tree::Node::Ptr &amp;tree, const Int &amp;ncells, const bool external_memory, const bool verbose, CDR::Options options)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03423">compose_cedr.cpp:3423</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html">cedr::test::TestRandomized</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01750">compose_cedr.cpp:1750</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a20ed81ef52a6a3496cf041c1325f59e7"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a20ed81ef52a6a3496cf041c1325f59e7">cedr::test::TestRandomized::get_cdr</a></div><div class="ttdeci">virtual CDR &amp; get_cdr()=0</div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a2b823e264295db343e072086f2ac80f7"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a2b823e264295db343e072086f2ac80f7">cedr::test::TestRandomized::run</a></div><div class="ttdeci">Int run(const Int nrepeat=1, const bool write=false)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01906">compose_cedr.cpp:1906</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a337141a0fb828d667912e67be42c5999"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a337141a0fb828d667912e67be42c5999">cedr::test::TestRandomized::sync_device</a></div><div class="ttdeci">void sync_device()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01819">compose_cedr.cpp:1819</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a3ee5a0a03f871180cbac3bc818572022"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a3ee5a0a03f871180cbac3bc818572022">cedr::test::TestRandomized::TestRandomized</a></div><div class="ttdeci">TestRandomized(const std::string &amp;cdr_name, const mpi::Parallel::Ptr &amp;p, const Int &amp;ncells, const bool verbose=false, const CDR::Options options=CDR::Options())</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04573">compose_cedr.cpp:4574</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a505fa093661dc6068f2979042a766d28"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a505fa093661dc6068f2979042a766d28">cedr::test::TestRandomized::init_numbering</a></div><div class="ttdeci">virtual void init_numbering()=0</div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a5e62ed5647b0071f4d4384356879598c"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a5e62ed5647b0071f4d4384356879598c">cedr::test::TestRandomized::tracers_</a></div><div class="ttdeci">std::vector&lt; Tracer &gt; tracers_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01840">compose_cedr.cpp:1840</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a61cffe426f3ac3d14cdf7e5b8b9716bb"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a61cffe426f3ac3d14cdf7e5b8b9716bb">cedr::test::TestRandomized::ncells_</a></div><div class="ttdeci">const Int ncells_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01837">compose_cedr.cpp:1837</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a6b11b2248d6ec1bad4ef42a0ef44ce2b"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a6b11b2248d6ec1bad4ef42a0ef44ce2b">cedr::test::TestRandomized::run_impl</a></div><div class="ttdeci">virtual void run_impl(const Int trial)=0</div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a6c8f45ba1a961b27cbd49aa32b068bc4"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a6c8f45ba1a961b27cbd49aa32b068bc4">cedr::test::TestRandomized::sync_host</a></div><div class="ttdeci">void sync_host()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01821">compose_cedr.cpp:1821</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_a717b1a6ba6a4dd401efe982912bac82d"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#a717b1a6ba6a4dd401efe982912bac82d">cedr::test::TestRandomized::p_</a></div><div class="ttdeci">const mpi::Parallel::Ptr p_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01836">compose_cedr.cpp:1836</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_aa0fe4c695707cf12cb688c56dbf74290"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#aa0fe4c695707cf12cb688c56dbf74290">cedr::test::TestRandomized::gcis_</a></div><div class="ttdeci">std::vector&lt; Long &gt; gcis_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01839">compose_cedr.cpp:1839</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_ab9eaa4b79cfd68e55fd677a04ecae4e8"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#ab9eaa4b79cfd68e55fd677a04ecae4e8">cedr::test::TestRandomized::init_tracers</a></div><div class="ttdeci">virtual void init_tracers()=0</div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_acae3d5885de88a009da51bcfe2e818c5"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#acae3d5885de88a009da51bcfe2e818c5">cedr::test::TestRandomized::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04581">compose_cedr.cpp:4581</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1_test_randomized_html_acdc2dc3c674df805f7838bd8f016b7b2"><div class="ttname"><a href="classcedr_1_1test_1_1_test_randomized.html#acdc2dc3c674df805f7838bd8f016b7b2">cedr::test::TestRandomized::size</a></div><div class="ttdeci">PRIVATE_CUDA v size())</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01816">compose_cedr.cpp:1816</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html">cedr::test::transport1d::Problem1D</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04726">compose_cedr.cpp:4726</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html_a001164de65718b4dfb41235ac211a9cd"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a001164de65718b4dfb41235ac211a9cd">cedr::test::transport1d::Problem1D::xb</a></div><div class="ttdeci">Real xb(const Int &amp;i) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04813">compose_cedr.cpp:4813</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html_a309da6f46bd2e16b14949fe3b77c3bd4"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a309da6f46bd2e16b14949fe3b77c3bd4">cedr::test::transport1d::Problem1D::area</a></div><div class="ttdeci">Real area(const Int &amp;i) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04815">compose_cedr.cpp:4815</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html_a6fbdc16ef380f9676d2167cb00857d8e"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a6fbdc16ef380f9676d2167cb00857d8e">cedr::test::transport1d::Problem1D::get_xcp</a></div><div class="ttdeci">const std::vector&lt; Real &gt; get_xcp() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04818">compose_cedr.cpp:4818</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html_a95c4ffeb3eb88dad18584acb48ac8cb8"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#a95c4ffeb3eb88dad18584acb48ac8cb8">cedr::test::transport1d::Problem1D::ncells</a></div><div class="ttdeci">Int ncells() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04812">compose_cedr.cpp:4812</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html_aa2f24490faa360af980b3e3f1499efd8"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#aa2f24490faa360af980b3e3f1499efd8">cedr::test::transport1d::Problem1D::xcp</a></div><div class="ttdeci">Real xcp(const Int &amp;i) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04814">compose_cedr.cpp:4814</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html_ad9a1760a6cebd3b7df668e8304d772eb"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ad9a1760a6cebd3b7df668e8304d772eb">cedr::test::transport1d::Problem1D::get_xb</a></div><div class="ttdeci">const std::vector&lt; Real &gt; get_xb() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04817">compose_cedr.cpp:4817</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html_adc6ca00ee69b4ebc0229b15d9539656d"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#adc6ca00ee69b4ebc0229b15d9539656d">cedr::test::transport1d::Problem1D::Problem1D</a></div><div class="ttdeci">Problem1D(const Int ncells, const bool nonuniform_mesh=false)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04808">compose_cedr.cpp:4808</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_problem1_d_html_ae27c7a9777ced5358071b94ce9d98488"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_problem1_d.html#ae27c7a9777ced5358071b94ce9d98488">cedr::test::transport1d::Problem1D::cycle</a></div><div class="ttdeci">void cycle(const Int &amp;nsteps, const Real *y0, Real *yf, CDR *cdr=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04820">compose_cedr.cpp:4820</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_py_writer_html"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html">cedr::test::transport1d::PyWriter</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04676">compose_cedr.cpp:4676</a></div></div>
<div class="ttc" id="aclasscedr_1_1test_1_1transport1d_1_1_py_writer_html_a76829c4c71648b552869b6b1c32bac2b"><div class="ttname"><a href="classcedr_1_1test_1_1transport1d_1_1_py_writer.html#a76829c4c71648b552869b6b1c32bac2b">cedr::test::transport1d::PyWriter::write</a></div><div class="ttdeci">void write(const std::string &amp;field_name, const std::vector&lt; Real &gt; &amp;v) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04689">compose_cedr.cpp:4689</a></div></div>
<div class="ttc" id="aclasshomme_1_1compose_1_1_q_l_t_html"><div class="ttname"><a href="classhomme_1_1compose_1_1_q_l_t.html">homme::compose::QLT</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05027">compose_cedr.cpp:5027</a></div></div>
<div class="ttc" id="aclasshomme_1_1compose_1_1_q_l_t_html_a4d575508c75491193be3b5b2872ca803"><div class="ttname"><a href="classhomme_1_1compose_1_1_q_l_t.html#a4d575508c75491193be3b5b2872ca803">homme::compose::QLT::QLT</a></div><div class="ttdeci">QLT(const cedr::mpi::Parallel::Ptr &amp;p, const cedr::Int &amp;ncells, const cedr::qlt::tree::Node::Ptr &amp;tree, const cedr::CDR::Options &amp;options, const cedr::Int &amp;vertical_levels)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05194">compose_cedr.cpp:5194</a></div></div>
<div class="ttc" id="aclasshomme_1_1compose_1_1_q_l_t_html_a57a3f6d94df5041b5a3153476232a8b2"><div class="ttname"><a href="classhomme_1_1compose_1_1_q_l_t.html#a57a3f6d94df5041b5a3153476232a8b2">homme::compose::QLT::run</a></div><div class="ttdeci">void run() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05203">compose_cedr.cpp:5203</a></div></div>
<div class="ttc" id="aclasshomme_1_1compose_1_1_q_l_t_html_ac43a1d5cb462af1ab00e0c636074f33e"><div class="ttname"><a href="classhomme_1_1compose_1_1_q_l_t.html#ac43a1d5cb462af1ab00e0c636074f33e">homme::compose::QLT::unittest</a></div><div class="ttdeci">static Int unittest()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05438">compose_cedr.cpp:5438</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a006202302bcd05004f5b38e2e252090f"><div class="ttname"><a href="compose__cedr_8cpp.html#a006202302bcd05004f5b38e2e252090f">puf</a></div><div class="ttdeci">#define puf(m)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00329">compose_cedr.cpp:329</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a01a8e64063567601af02f3ee19e4a4c3"><div class="ttname"><a href="compose__cedr_8cpp.html#a01a8e64063567601af02f3ee19e4a4c3">cedr_sl_set_pointers_end</a></div><div class="ttdeci">void cedr_sl_set_pointers_end()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06700">compose_cedr.cpp:6700</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a03c36fbef1a0e5fbe8c92b3fe4bc99e9"><div class="ttname"><a href="compose__cedr_8cpp.html#a03c36fbef1a0e5fbe8c92b3fe4bc99e9">kokkos_finalize</a></div><div class="ttdeci">void kokkos_finalize()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06616">compose_cedr.cpp:6616</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a0f2e369bf2e22cb70102fefb49e674ec"><div class="ttname"><a href="compose__cedr_8cpp.html#a0f2e369bf2e22cb70102fefb49e674ec">PROTECTED_CUDA</a></div><div class="ttdeci">#define PROTECTED_CUDA</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00018">compose_cedr.cpp:18</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a29459ab5c7f822a0161149755f44796e"><div class="ttname"><a href="compose__cedr_8cpp.html#a29459ab5c7f822a0161149755f44796e">cedr_assert</a></div><div class="ttdeci">#define cedr_assert(condition)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00343">compose_cedr.cpp:343</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a2f6321c9bb1d41a4174cdda554e29e1b"><div class="ttname"><a href="compose__cedr_8cpp.html#a2f6321c9bb1d41a4174cdda554e29e1b">cedr_set_ie2gci</a></div><div class="ttdeci">void cedr_set_ie2gci(const homme::Int ie, const homme::Int gci)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06662">compose_cedr.cpp:6662</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a368104aa4a3bed637d78c0034a89cf5e"><div class="ttname"><a href="compose__cedr_8cpp.html#a368104aa4a3bed637d78c0034a89cf5e">ConstExceptGnu</a></div><div class="ttdeci">#define ConstExceptGnu</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00024">compose_cedr.cpp:24</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a4e5350374155dab7d49fe09a30c17a27"><div class="ttname"><a href="compose__cedr_8cpp.html#a4e5350374155dab7d49fe09a30c17a27">cedr_init_impl</a></div><div class="ttdeci">void cedr_init_impl(const homme::Int fcomm, const homme::Int cdr_alg, const bool use_sgi, const homme::Int *gid_data, const homme::Int *rank_data, const homme::Int gbl_ncell, const homme::Int lcl_ncell, const homme::Int nlev, const bool independent_time_steps, const bool hard_zero, const homme::Int, const homme::Int)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06623">compose_cedr.cpp:6623</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a50ae31c6c80236b8edcba1c59bd9caa1"><div class="ttname"><a href="compose__cedr_8cpp.html#a50ae31c6c80236b8edcba1c59bd9caa1">ComposeDefaultExecutionSpace</a></div><div class="ttdeci">Kokkos::DefaultHostExecutionSpace ComposeDefaultExecutionSpace</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05021">compose_cedr.cpp:5021</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a62f071f9019b2263ed76a35f753af003"><div class="ttname"><a href="compose__cedr_8cpp.html#a62f071f9019b2263ed76a35f753af003">pr</a></div><div class="ttdeci">#define pr(m)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00312">compose_cedr.cpp:312</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a65701dc1e7871e366c32fa3d0d59597f"><div class="ttname"><a href="compose__cedr_8cpp.html#a65701dc1e7871e366c32fa3d0d59597f">cedr_set_bufs</a></div><div class="ttdeci">void cedr_set_bufs(homme::Real *sendbuf, homme::Real *recvbuf, homme::Int, homme::Int)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06642">compose_cedr.cpp:6642</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a6733f39eb2f96fb3a1149d1a087aedaa"><div class="ttname"><a href="compose__cedr_8cpp.html#a6733f39eb2f96fb3a1149d1a087aedaa">cedr_sl_run</a></div><div class="ttdeci">void cedr_sl_run(homme::Real *minq, const homme::Real *maxq, homme::Int nets, homme::Int nete)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06703">compose_cedr.cpp:6703</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a69e47429f12cecc8d0019d3611431ef1"><div class="ttname"><a href="compose__cedr_8cpp.html#a69e47429f12cecc8d0019d3611431ef1">cedr_kernel_throw_if</a></div><div class="ttdeci">#define cedr_kernel_throw_if(condition, message)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00367">compose_cedr.cpp:367</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a7c3c704df71e1a19ad95990aa8120aa0"><div class="ttname"><a href="compose__cedr_8cpp.html#a7c3c704df71e1a19ad95990aa8120aa0">mprarr</a></div><div class="ttdeci">#define mprarr(m)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00340">compose_cedr.cpp:340</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a89988e06d2811f8655acc919f35aa97e"><div class="ttname"><a href="compose__cedr_8cpp.html#a89988e06d2811f8655acc919f35aa97e">tpr</a></div><div class="ttdeci">#define tpr(op)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02459">compose_cedr.cpp:2459</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a8dffbbd90b95389e38d9175eec2688db"><div class="ttname"><a href="compose__cedr_8cpp.html#a8dffbbd90b95389e38d9175eec2688db">cedr_kernel_assert</a></div><div class="ttdeci">#define cedr_kernel_assert(condition)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00351">compose_cedr.cpp:351</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_a955408f4b6bdfb672629fed0acaa3edf"><div class="ttname"><a href="compose__cedr_8cpp.html#a955408f4b6bdfb672629fed0acaa3edf">cedr_sl_check</a></div><div class="ttdeci">void cedr_sl_check(const homme::Real *minq, const homme::Real *maxq, homme::Int nets, homme::Int nete)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06723">compose_cedr.cpp:6723</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_aa880d3b0360ecb807e94f0b35abc9a29"><div class="ttname"><a href="compose__cedr_8cpp.html#aa880d3b0360ecb807e94f0b35abc9a29">PRIVATE_CUDA</a></div><div class="ttdeci">#define PRIVATE_CUDA</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00017">compose_cedr.cpp:17</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_aab863b45779787c440a28c6bc8189b10"><div class="ttname"><a href="compose__cedr_8cpp.html#aab863b45779787c440a28c6bc8189b10">cedr_query_bufsz</a></div><div class="ttdeci">void cedr_query_bufsz(homme::Int *sendsz, homme::Int *recvsz)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06634">compose_cedr.cpp:6634</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_aac63b05d328ad81de6a8b4a6b6390f59"><div class="ttname"><a href="compose__cedr_8cpp.html#aac63b05d328ad81de6a8b4a6b6390f59">cedr_sl_set_dp3d</a></div><div class="ttdeci">void cedr_sl_set_dp3d(homme::Int ie, homme::Real *v, homme::Int tl_np1)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06692">compose_cedr.cpp:6692</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_aaebef883fc629d3b956d841647d8c8fe"><div class="ttname"><a href="compose__cedr_8cpp.html#aaebef883fc629d3b956d841647d8c8fe">kokkos_init</a></div><div class="ttdeci">void kokkos_init()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06610">compose_cedr.cpp:6610</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ab62d865ca5513267292f212fbb9cb9e6"><div class="ttname"><a href="compose__cedr_8cpp.html#ab62d865ca5513267292f212fbb9cb9e6">KIF</a></div><div class="ttdeci">#define KIF</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00013">compose_cedr.cpp:13</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_abc8a42a818fcdafcf2eb3644a461521a"><div class="ttname"><a href="compose__cedr_8cpp.html#abc8a42a818fcdafcf2eb3644a461521a">cedr_sl_init</a></div><div class="ttdeci">homme::Int cedr_sl_init(const homme::Int np, const homme::Int nlev, const homme::Int qsize, const homme::Int qsized, const homme::Int timelevels, const homme::Int need_conservation)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06672">compose_cedr.cpp:6672</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_acb74fbfd99a1989babb83fdaa6bfe4c5"><div class="ttname"><a href="compose__cedr_8cpp.html#acb74fbfd99a1989babb83fdaa6bfe4c5">pu</a></div><div class="ttdeci">#define pu(m)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00330">compose_cedr.cpp:330</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_adb50e9b1de2f71de7cc4bd92ecd6a495"><div class="ttname"><a href="compose__cedr_8cpp.html#adb50e9b1de2f71de7cc4bd92ecd6a495">cedr_sl_set_dp0</a></div><div class="ttdeci">void cedr_sl_set_dp0(homme::Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06698">compose_cedr.cpp:6698</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae086df1862e813f26d79b63021b7cd92"><div class="ttname"><a href="compose__cedr_8cpp.html#ae086df1862e813f26d79b63021b7cd92">cedr_throw_if</a></div><div class="ttdeci">#define cedr_throw_if(condition, message)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00359">compose_cedr.cpp:359</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae31f3ee7ed0b1796b20d315da6067bd7"><div class="ttname"><a href="compose__cedr_8cpp.html#ae31f3ee7ed0b1796b20d315da6067bd7">cedr_sl_set_spheremp</a></div><div class="ttdeci">void cedr_sl_set_spheremp(homme::Int ie, homme::Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06687">compose_cedr.cpp:6687</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae3ec6a834c0bd7647fde8f59d31cb012"><div class="ttname"><a href="compose__cedr_8cpp.html#ae3ec6a834c0bd7647fde8f59d31cb012">cedr_sl_set_qdp</a></div><div class="ttdeci">void cedr_sl_set_qdp(homme::Int ie, homme::Real *v, homme::Int n0_qdp, homme::Int n1_qdp)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06689">compose_cedr.cpp:6689</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae747afb448da5f0376697e43d74778c5"><div class="ttname"><a href="compose__cedr_8cpp.html#ae747afb448da5f0376697e43d74778c5">cedr_sl_run_local</a></div><div class="ttdeci">void cedr_sl_run_local(homme::Real *minq, const homme::Real *maxq, homme::Int nets, homme::Int nete, homme::Int use_ir, homme::Int limiter_option)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06712">compose_cedr.cpp:6712</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_ae8e9dd870a128686a261eb848c9a18a2"><div class="ttname"><a href="compose__cedr_8cpp.html#ae8e9dd870a128686a261eb848c9a18a2">cedr_sl_set_pointers_begin</a></div><div class="ttdeci">void cedr_sl_set_pointers_begin(homme::Int nets, homme::Int nete)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06686">compose_cedr.cpp:6686</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_aee1c2a81a0aaa758fb41ff058dd320bb"><div class="ttname"><a href="compose__cedr_8cpp.html#aee1c2a81a0aaa758fb41ff058dd320bb">prc</a></div><div class="ttdeci">#define prc(m)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00327">compose_cedr.cpp:327</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_af5a0276bb2dbefb74e60bc2f48777353"><div class="ttname"><a href="compose__cedr_8cpp.html#af5a0276bb2dbefb74e60bc2f48777353">cedr_sl_set_q</a></div><div class="ttdeci">void cedr_sl_set_q(homme::Int ie, homme::Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06696">compose_cedr.cpp:6696</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_af90836fbfe6950bf37bc5cfe57ad9ebc"><div class="ttname"><a href="compose__cedr_8cpp.html#af90836fbfe6950bf37bc5cfe57ad9ebc">cedr_sl_set_dp</a></div><div class="ttdeci">void cedr_sl_set_dp(homme::Int ie, homme::Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06694">compose_cedr.cpp:6694</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_afb0c587d50bffba1a90d72ba7597f152"><div class="ttname"><a href="compose__cedr_8cpp.html#afb0c587d50bffba1a90d72ba7597f152">cedr_finalize</a></div><div class="ttdeci">void cedr_finalize()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06730">compose_cedr.cpp:6730</a></div></div>
<div class="ttc" id="acompose__cedr_8cpp_html_aff6d23ee28a27615bad6e7be0a3e67e8"><div class="ttname"><a href="compose__cedr_8cpp.html#aff6d23ee28a27615bad6e7be0a3e67e8">cedr_unittest</a></div><div class="ttdeci">void cedr_unittest(const homme::Int fcomm, homme::Int *nerrp)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06647">compose_cedr.cpp:6647</a></div></div>
<div class="ttc" id="amain_8_f90_html_a8ec2266d83cd6c0b762cbcbc92c0af3d"><div class="ttname"><a href="main_8_f90.html#a8ec2266d83cd6c0b762cbcbc92c0af3d">main</a></div><div class="ttdeci">program main</div><div class="ttdef"><b>Definition:</b> <a href="main_8_f90_source.html#l00006">main.F90:6</a></div></div>
<div class="ttc" id="anamespace_homme_1_1_physical_constants_html_a3433b33c94724c45ecbe0c60e26b18fa"><div class="ttname"><a href="namespace_homme_1_1_physical_constants.html#a3433b33c94724c45ecbe0c60e26b18fa">Homme::PhysicalConstants::g</a></div><div class="ttdeci">constexpr Real g</div><div class="ttdef"><b>Definition:</b> <a href="_physical_constants_8hpp_source.html#l00023">PhysicalConstants.hpp:23</a></div></div>
<div class="ttc" id="anamespace_homme_html_ae7a6813a53e3f9affa8f76c91acaeac3"><div class="ttname"><a href="namespace_homme.html#ae7a6813a53e3f9affa8f76c91acaeac3">Homme::get_default_team_policy</a></div><div class="ttdeci">Kokkos::TeamPolicy&lt; ExecSpace, Tags... &gt; get_default_team_policy(const int num_parallel_iterations, const ThreadPreferences tp=ThreadPreferences())</div><div class="ttdef"><b>Definition:</b> <a href="_exec_space_defs_8hpp_source.html#l00158">ExecSpaceDefs.hpp:158</a></div></div>
<div class="ttc" id="anamespace_kokkos_html"><div class="ttname"><a href="namespace_kokkos.html">Kokkos</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03755">compose_cedr.cpp:3755</a></div></div>
<div class="ttc" id="anamespacearkode__mod_html_a876a1cb648d7a4173b7b5532624b2743"><div class="ttname"><a href="namespacearkode__mod.html#a876a1cb648d7a4173b7b5532624b2743">arkode_mod::initialize</a></div><div class="ttdeci">subroutine initialize(elem, nets, nete, par, n0, qn0, tstart, arkode_parameters, table_set)</div><div class="ttdef"><b>Definition:</b> <a href="arkode__mod_8_f90_source.html#l00374">arkode_mod.F90:376</a></div></div>
<div class="ttc" id="anamespacebaroclinic__wave_html_a8619f63e6dd6db1077c1a18788afa359"><div class="ttname"><a href="namespacebaroclinic__wave.html#a8619f63e6dd6db1077c1a18788afa359">baroclinic_wave::k</a></div><div class="ttdeci">real(8), parameter k</div><div class="ttdef"><b>Definition:</b> <a href="dcmip2016-baroclinic_8_f90_source.html#l00083">dcmip2016-baroclinic.F90:83</a></div></div>
<div class="ttc" id="anamespacebaroclinic__wave_html_acf8e56bd7dfdfd2c39e16dfa491a5293"><div class="ttname"><a href="namespacebaroclinic__wave.html#acf8e56bd7dfdfd2c39e16dfa491a5293">baroclinic_wave::b</a></div><div class="ttdeci">real(8), parameter b</div><div class="ttdef"><b>Definition:</b> <a href="dcmip2016-baroclinic_8_f90_source.html#l00083">dcmip2016-baroclinic.F90:83</a></div></div>
<div class="ttc" id="anamespacecedr_1_1caas_1_1test_html_a76970efe7100a1c7ab6ef420e0a45d5c"><div class="ttname"><a href="namespacecedr_1_1caas_1_1test.html#a76970efe7100a1c7ab6ef420e0a45d5c">cedr::caas::test::unittest</a></div><div class="ttdeci">Int unittest(const mpi::Parallel::Ptr &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04128">compose_cedr.cpp:4128</a></div></div>
<div class="ttc" id="anamespacecedr_1_1caas_html_a6260f5a193dc31cd8f4c83c4313e9827"><div class="ttname"><a href="namespacecedr_1_1caas.html#a6260f5a193dc31cd8f4c83c4313e9827">cedr::caas::homme_parallel_for</a></div><div class="ttdeci">void homme_parallel_for(const Int &amp;beg, const Int &amp;end, const Func &amp;f)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03889">compose_cedr.cpp:3889</a></div></div>
<div class="ttc" id="anamespacecedr_1_1impl_html_a354eb5be15e9642658afd448891a2050"><div class="ttname"><a href="namespacecedr_1_1impl.html#a354eb5be15e9642658afd448891a2050">cedr::impl::Unmanaged</a></div><div class="ttdeci">Kokkos::View&lt; typename View::traits::scalar_array_type, typename View::traits::array_layout, typename View::traits::device_type, Kokkos::MemoryTraits&lt; MemoryTraitsMask&lt; View &gt;::value|Kokkos::Unmanaged &gt; &gt; Unmanaged</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00057">compose_cedr.cpp:67</a></div></div>
<div class="ttc" id="anamespacecedr_1_1impl_html_a48209f302659f05c4442357a53a63815"><div class="ttname"><a href="namespacecedr_1_1impl.html#a48209f302659f05c4442357a53a63815">cedr::impl::max</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION const T &amp; max(const T &amp;a, const T &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00142">compose_cedr.cpp:142</a></div></div>
<div class="ttc" id="anamespacecedr_1_1impl_html_a5069e7dbc6821fadf6c89b08ac324bd0"><div class="ttname"><a href="namespacecedr_1_1impl.html#a5069e7dbc6821fadf6c89b08ac324bd0">cedr::impl::Const</a></div><div class="ttdeci">typename View::const_type Const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00070">compose_cedr.cpp:70</a></div></div>
<div class="ttc" id="anamespacecedr_1_1impl_html_a8e755217625cff5769f89160b2bdcd68"><div class="ttname"><a href="namespacecedr_1_1impl.html#a8e755217625cff5769f89160b2bdcd68">cedr::impl::swap</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void swap(T &amp;a, T &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00144">compose_cedr.cpp:144</a></div></div>
<div class="ttc" id="anamespacecedr_1_1impl_html_a9333a756f97752d17b2cfe51a508ddb3"><div class="ttname"><a href="namespacecedr_1_1impl.html#a9333a756f97752d17b2cfe51a508ddb3">cedr::impl::ConstUnmanaged</a></div><div class="ttdeci">Const&lt; Unmanaged&lt; View &gt; &gt; ConstUnmanaged</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00073">compose_cedr.cpp:73</a></div></div>
<div class="ttc" id="anamespacecedr_1_1impl_html_ade10df214ab86a43d760c425716ab26f"><div class="ttname"><a href="namespacecedr_1_1impl.html#ade10df214ab86a43d760c425716ab26f">cedr::impl::DefaultDeviceType</a></div><div class="ttdeci">Kokkos::Device&lt; Kokkos::DefaultExecutionSpace::execution_space, Kokkos::DefaultExecutionSpace::memory_space &gt; DefaultDeviceType</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00090">compose_cedr.cpp:90</a></div></div>
<div class="ttc" id="anamespacecedr_1_1impl_html_afaf106747d577e9c3dc9eb35a735b8b1"><div class="ttname"><a href="namespacecedr_1_1impl.html#afaf106747d577e9c3dc9eb35a735b8b1">cedr::impl::min</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION const T &amp; min(const T &amp;a, const T &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00140">compose_cedr.cpp:140</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_1_1impl_html_a42d22fd1c7d68c43aba1a2d25758b351"><div class="ttname"><a href="namespacecedr_1_1local_1_1impl.html#a42d22fd1c7d68c43aba1a2d25758b351">cedr::local::impl::check_lu</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Int check_lu(const Int n, const Real *a, const Real &amp;b, const Real *xlo, const Real *xhi, const Real &amp;r_tol, Real *x)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01214">compose_cedr.cpp:1214</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_1_1impl_html_a5c9833133735f9d3293b5d0f6526bd2c"><div class="ttname"><a href="namespacecedr_1_1local_1_1impl.html#a5c9833133735f9d3293b5d0f6526bd2c">cedr::local::impl::calc_r</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void calc_r(const Int n, const Real *w, const Real *a, const Real b, const Real *xlo, const Real *xhi, const Real *y, const Real &amp;lambda, Real *x, Real &amp;r, Real &amp;r_lambda)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01234">compose_cedr.cpp:1234</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_1_1impl_html_a8b83e71c647cda8a5e7fe355dcc16bdd"><div class="ttname"><a href="namespacecedr_1_1local_1_1impl.html#a8b83e71c647cda8a5e7fe355dcc16bdd">cedr::local::impl::calc_r_tol</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Real calc_r_tol(const Real b, const Real *a, const Real *y, const Int n)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01204">compose_cedr.cpp:1204</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_1_1test_html_a6c211e87158b2e61682f2f2908f6692f"><div class="ttname"><a href="namespacecedr_1_1local_1_1test.html#a6c211e87158b2e61682f2f2908f6692f">cedr::local::test::test_1eq_bc_qp</a></div><div class="ttdeci">Int test_1eq_bc_qp()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02118">compose_cedr.cpp:2118</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_1_1test_html_a8187e641f42aba1db0579d7486cee077"><div class="ttname"><a href="namespacecedr_1_1local_1_1test.html#a8187e641f42aba1db0579d7486cee077">cedr::local::test::check_1eq_bc_qp_foc</a></div><div class="ttdeci">bool check_1eq_bc_qp_foc(const char *label, const Int n, const Real *w, const Real *a, const Real b, const Real *xlo, const Real *xhi, const Real *y, const Real *x, const bool verbose)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02031">compose_cedr.cpp:2031</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_1_1test_html_ae2953f323781ba2bb1dec9c208b6c3a5"><div class="ttname"><a href="namespacecedr_1_1local_1_1test.html#ae2953f323781ba2bb1dec9c208b6c3a5">cedr::local::test::test_1eq_nonneg</a></div><div class="ttdeci">Int test_1eq_nonneg()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02243">compose_cedr.cpp:2243</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_html_a0cae8843ba7d55d41e672b37311725c8"><div class="ttname"><a href="namespacecedr_1_1local.html#a0cae8843ba7d55d41e672b37311725c8">cedr::local::unittest</a></div><div class="ttdeci">Int unittest()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02308">compose_cedr.cpp:2308</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_html_a61447f212fd00919206121765d9d5e54"><div class="ttname"><a href="namespacecedr_1_1local.html#a61447f212fd00919206121765d9d5e54">cedr::local::solve_1eq_nonneg</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Int solve_1eq_nonneg(const Int n, const Real *a, const Real b, const Real *y, Real *x, const Real *w, const Method::Enum lcl_method)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01499">compose_cedr.cpp:1499</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_html_a7ea93d46b1e55b0de005be1cdb4af938"><div class="ttname"><a href="namespacecedr_1_1local.html#a7ea93d46b1e55b0de005be1cdb4af938">cedr::local::solve_1eq_bc_qp</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Int solve_1eq_bc_qp(const Int n, const Real *w, const Real *a, const Real b, const Real *xlo, const Real *xhi, const Real *y, Real *x, const Int max_its=100)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01358">compose_cedr.cpp:1358</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_html_a9703513793df83282daf15b0c62fc70c"><div class="ttname"><a href="namespacecedr_1_1local.html#a9703513793df83282daf15b0c62fc70c">cedr::local::caas</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void caas(const Int n, const Real *a, const Real b, const Real *xlo, const Real *xhi, const Real *y, Real *x, const bool clip=true)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01463">compose_cedr.cpp:1463</a></div></div>
<div class="ttc" id="anamespacecedr_1_1local_html_aeec5c3e64900ac50f51105cafb9b0668"><div class="ttname"><a href="namespacecedr_1_1local.html#aeec5c3e64900ac50f51105cafb9b0668">cedr::local::solve_1eq_bc_qp_2d</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Int solve_1eq_bc_qp_2d(const Real *w, const Real *a, const Real b, const Real *xlo, const Real *xhi, const Real *y, Real *x, const bool clip=true, const bool early_exit_on_tol=true)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01259">compose_cedr.cpp:1259</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html"><div class="ttname"><a href="namespacecedr_1_1mpi.html">cedr::mpi</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00210">compose_cedr.cpp:210</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a400d5cae4d1c0616beee60e458a54f36"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a400d5cae4d1c0616beee60e458a54f36">cedr::mpi::gatherv</a></div><div class="ttdeci">int gatherv(const Parallel &amp;p, const T *sendbuf, int sendcount, T *recvbuf, const int *recvcounts, const int *displs, int root)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01178">compose_cedr.cpp:1178</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a44511e63350daf3b4beabe2ffc0ea358"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a44511e63350daf3b4beabe2ffc0ea358">cedr::mpi::isend</a></div><div class="ttdeci">int isend(const Parallel &amp;p, const T *buf, int count, int dest, int tag, Request *ireq=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01144">compose_cedr.cpp:1144</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a5405e4778663ed0790594ca71430f4a1"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a5405e4778663ed0790594ca71430f4a1">cedr::mpi::get_type&lt; long &gt;</a></div><div class="ttdeci">MPI_Datatype get_type&lt; long &gt;()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02364">compose_cedr.cpp:2364</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a5b8d958bebd9c6b0885b8179adc985f2"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a5b8d958bebd9c6b0885b8179adc985f2">cedr::mpi::get_type&lt; double &gt;</a></div><div class="ttdeci">MPI_Datatype get_type&lt; double &gt;()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02363">compose_cedr.cpp:2363</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a695d22f093668469a6040c03b24d9bbf"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a695d22f093668469a6040c03b24d9bbf">cedr::mpi::all_reduce</a></div><div class="ttdeci">int all_reduce(const Parallel &amp;p, const T *sendbuf, T *rcvbuf, int count, MPI_Op op)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01138">compose_cedr.cpp:1138</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a6e572b78e7d5d0ff5a43cab685375bb3"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a6e572b78e7d5d0ff5a43cab685375bb3">cedr::mpi::make_parallel</a></div><div class="ttdeci">Parallel::Ptr make_parallel(MPI_Comm comm)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02328">compose_cedr.cpp:2328</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a81666edb64563b7477056b7612b9ef16"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a81666edb64563b7477056b7612b9ef16">cedr::mpi::gather</a></div><div class="ttdeci">int gather(const Parallel &amp;p, const T *sendbuf, int sendcount, T *recvbuf, int recvcount, int root)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01171">compose_cedr.cpp:1171</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a8aa2d3a508c129246605b5750632bf2c"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a8aa2d3a508c129246605b5750632bf2c">cedr::mpi::get_type</a></div><div class="ttdeci">MPI_Datatype get_type()</div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_a98c43b0c7eeef438fd75d5c9b272614f"><div class="ttname"><a href="namespacecedr_1_1mpi.html#a98c43b0c7eeef438fd75d5c9b272614f">cedr::mpi::irecv</a></div><div class="ttdeci">int irecv(const Parallel &amp;p, T *buf, int count, int src, int tag, Request *ireq=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01158">compose_cedr.cpp:1158</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_aab6cca7c11c548d38f7cf386def89d9a"><div class="ttname"><a href="namespacecedr_1_1mpi.html#aab6cca7c11c548d38f7cf386def89d9a">cedr::mpi::reduce</a></div><div class="ttdeci">int reduce(const Parallel &amp;p, const T *sendbuf, T *rcvbuf, int count, MPI_Op op, int root)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01131">compose_cedr.cpp:1131</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_abbfab661857550024ee1c2a18f107649"><div class="ttname"><a href="namespacecedr_1_1mpi.html#abbfab661857550024ee1c2a18f107649">cedr::mpi::get_type&lt; int &gt;</a></div><div class="ttdeci">MPI_Datatype get_type&lt; int &gt;()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02362">compose_cedr.cpp:2362</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_abef62a697b1c181d6bc6ef3023fa4213"><div class="ttname"><a href="namespacecedr_1_1mpi.html#abef62a697b1c181d6bc6ef3023fa4213">cedr::mpi::waitall</a></div><div class="ttdeci">int waitall(int count, Request *reqs, MPI_Status *stats=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02381">compose_cedr.cpp:2381</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_acdb744561335e178b128fd66512c7dca"><div class="ttname"><a href="namespacecedr_1_1mpi.html#acdb744561335e178b128fd66512c7dca">cedr::mpi::all_ok</a></div><div class="ttdeci">bool all_ok(const Parallel &amp;p, bool im_ok)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02398">compose_cedr.cpp:2398</a></div></div>
<div class="ttc" id="anamespacecedr_1_1mpi_html_ae0e941fa3748495376c11d4ff65b30e7"><div class="ttname"><a href="namespacecedr_1_1mpi.html#ae0e941fa3748495376c11d4ff65b30e7">cedr::mpi::waitany</a></div><div class="ttdeci">int waitany(int count, Request *reqs, int *index, MPI_Status *stats=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02366">compose_cedr.cpp:2366</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a260e2670b5693de806396dae4059a947"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a260e2670b5693de806396dae4059a947">cedr::qlt::impl::solve_node_problem</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void solve_node_problem(const Real &amp;rhom, const Real *pd, const Real &amp;Qm, const Real &amp;rhom0, const Real *k0d, Real &amp;Qm0, const Real &amp;rhom1, const Real *k1d, Real &amp;Qm1, const bool prefer_mass_con_to_bounds)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01646">compose_cedr.cpp:1646</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a2978e68a93684ed0847042c137b7a73e"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a2978e68a93684ed0847042c137b7a73e">cedr::qlt::impl::init_offsets</a></div><div class="ttdeci">void init_offsets(const Int my_rank, std::vector&lt; RankNode &gt; &amp;rns, std::vector&lt; NodeSets::Level::MPIMetaData &gt; &amp;mmds, Int &amp;offset)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02626">compose_cedr.cpp:2626</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a2af675dd004b8fdfc4b5534500d5716c"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a2af675dd004b8fdfc4b5534500d5716c">cedr::qlt::impl::init_comm</a></div><div class="ttdeci">void init_comm(const Int my_rank, NodeSets &amp;ns)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02663">compose_cedr.cpp:2663</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a341881488f4888139714451dacf13205"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a341881488f4888139714451dacf13205">cedr::qlt::impl::level_schedule_and_collect</a></div><div class="ttdeci">void level_schedule_and_collect(NodeSets &amp;ns, const Int &amp;my_rank, const tree::Node::Ptr &amp;node, Int &amp;level, bool &amp;need_parent_ns_node)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02533">compose_cedr.cpp:2533</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a34248cb5c089cabdf20318ff1eb794e2"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a34248cb5c089cabdf20318ff1eb794e2">cedr::qlt::impl::check_leaf_nodes</a></div><div class="ttdeci">Int check_leaf_nodes(const Parallel::Ptr &amp;p, const NodeSets &amp;ns, const Int ncells)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02741">compose_cedr.cpp:2741</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a4c3d085892f315ae1f1f134413fc2edb"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a4c3d085892f315ae1f1f134413fc2edb">cedr::qlt::impl::RankNode</a></div><div class="ttdeci">std::pair&lt; Int, NodeSets::Node * &gt; RankNode</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02624">compose_cedr.cpp:2624</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a5e38a1906b866bc8943b7052fb961574"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a5e38a1906b866bc8943b7052fb961574">cedr::qlt::impl::unittest</a></div><div class="ttdeci">Int unittest(const Parallel::Ptr &amp;p, const NodeSets::ConstPtr &amp;ns, const Int ncells)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02837">compose_cedr.cpp:2837</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a60a33d14250e0f94489b76589052590b"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a60a33d14250e0f94489b76589052590b">cedr::qlt::impl::NodeSetsHostData</a></div><div class="ttdeci">impl::NodeSetsDeviceData&lt; Kokkos::DefaultHostExecutionSpace &gt; NodeSetsHostData</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00647">compose_cedr.cpp:647</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_a84f6c0cb8e8bd600979400cb5cfe0b29"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#a84f6c0cb8e8bd600979400cb5cfe0b29">cedr::qlt::impl::test_comm_pattern</a></div><div class="ttdeci">Int test_comm_pattern(const Parallel::Ptr &amp;p, const NodeSets &amp;ns, const Int ncells)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02765">compose_cedr.cpp:2765</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_ac46929bd66312874d443dd21155f8019"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#ac46929bd66312874d443dd21155f8019">cedr::qlt::impl::analyze</a></div><div class="ttdeci">NodeSets::ConstPtr analyze(const Parallel::Ptr &amp;p, const Int &amp;ncells, const tree::Node::Ptr &amp;tree)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02701">compose_cedr.cpp:2701</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_ad78a836ebfaee833c929dbe37dec8105"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#ad78a836ebfaee833c929dbe37dec8105">cedr::qlt::impl::solve_node_problem</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void solve_node_problem(const Int problem_type, const Real &amp;rhom, const Real *pd, const Real &amp;Qm, const Real &amp;rhom0, const Real *k0d, Real &amp;Qm0, const Real &amp;rhom1, const Real *k1d, Real &amp;Qm1, const bool prefer_mass_con_to_bounds)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01701">compose_cedr.cpp:1701</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_ae964fe4c8b82233ab3d00631ce47c147"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#ae964fe4c8b82233ab3d00631ce47c147">cedr::qlt::impl::consolidate</a></div><div class="ttdeci">void consolidate(NodeSets &amp;ns)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02616">compose_cedr.cpp:2616</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_aec739810f3d854f37286d9f057eef65c"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#aec739810f3d854f37286d9f057eef65c">cedr::qlt::impl::init_tree</a></div><div class="ttdeci">Int init_tree(const Int &amp;my_rank, const tree::Node::Ptr &amp;node, Int &amp;id)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02515">compose_cedr.cpp:2515</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1impl_html_aefef0e8c4df812514c90416f481c5e8b"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1impl.html#aefef0e8c4df812514c90416f481c5e8b">cedr::qlt::impl::check_comm</a></div><div class="ttdeci">Int check_comm(const NodeSets &amp;ns)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02720">compose_cedr.cpp:2720</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1oned_1_1test_html_a1b4fae859c2c49b25fd8e8fe30c9acc4"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a1b4fae859c2c49b25fd8e8fe30c9acc4">cedr::qlt::oned::test::mark_cells</a></div><div class="ttdeci">void mark_cells(const tree::Node::Ptr &amp;node, std::vector&lt; Int &gt; &amp;cells)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03615">compose_cedr.cpp:3615</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1oned_1_1test_html_a79a8c8e0339adeec705d1a2e243708e1"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1oned_1_1test.html#a79a8c8e0339adeec705d1a2e243708e1">cedr::qlt::oned::test::unittest</a></div><div class="ttdeci">Int unittest(const Parallel::Ptr &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03624">compose_cedr.cpp:3624</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1test_html_a097812f6cbbfba363a2a7501d7d6e1ca"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1test.html#a097812f6cbbfba363a2a7501d7d6e1ca">cedr::qlt::test::test_qlt</a></div><div class="ttdeci">Int test_qlt(const Parallel::Ptr &amp;p, const tree::Node::Ptr &amp;tree, const Int &amp;ncells, const Int nrepeat, const bool write, const bool external_memory, const bool prefer_mass_con_to_bounds, const bool verbose)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03507">compose_cedr.cpp:3507</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1test_html_abcc1c3037c40bfabd109c2046c1c8e11"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1test.html#abcc1c3037c40bfabd109c2046c1c8e11">cedr::qlt::test::run_unit_and_randomized_tests</a></div><div class="ttdeci">Int run_unit_and_randomized_tests(const Parallel::Ptr &amp;p, const Input &amp;in)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03695">compose_cedr.cpp:3695</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1test_html_ac2d5f7d3e1a15b97276f0f6d1cfebe09"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1test.html#ac2d5f7d3e1a15b97276f0f6d1cfebe09">cedr::qlt::test::unittest_QLT</a></div><div class="ttdeci">Int unittest_QLT(const Parallel::Ptr &amp;p, const bool write_requested=false)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03666">compose_cedr.cpp:3666</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1test_html_ad8facd3eb0f21a69fee66bec77a4c5c4"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1test.html#ad8facd3eb0f21a69fee66bec77a4c5c4">cedr::qlt::test::unittest_NodeSets</a></div><div class="ttdeci">Int unittest_NodeSets(const Parallel::Ptr &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03648">compose_cedr.cpp:3648</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_1_1tree_html_a30aba1281f9c0c2c90d3066d6d17d78c"><div class="ttname"><a href="namespacecedr_1_1qlt_1_1tree.html#a30aba1281f9c0c2c90d3066d6d17d78c">cedr::qlt::tree::make_tree_over_1d_mesh</a></div><div class="ttdeci">Node::Ptr make_tree_over_1d_mesh(const Parallel::Ptr &amp;p, const Int &amp;ncells, const bool imbalanced=false)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03642">compose_cedr.cpp:3642</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_html"><div class="ttname"><a href="namespacecedr_1_1qlt.html">cedr::qlt</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00548">compose_cedr.cpp:548</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_html_a0d5051a5914c1d93500b80ffedb636a8"><div class="ttname"><a href="namespacecedr_1_1qlt.html#a0d5051a5914c1d93500b80ffedb636a8">cedr::qlt::r2l_nl_adjust_bounds</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void r2l_nl_adjust_bounds(Real Qm_bnd[2], const Real rhom[2], Real Qm_extra)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01595">compose_cedr.cpp:1595</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_html_a1f3514319e5f8eca070482f5295b599d"><div class="ttname"><a href="namespacecedr_1_1qlt.html#a1f3514319e5f8eca070482f5295b599d">cedr::qlt::init_device_data</a></div><div class="ttdeci">void init_device_data(const impl::NodeSets &amp;ns, impl::NodeSetsHostData &amp;h, impl::NodeSetsDeviceData&lt; ES &gt; &amp;d)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02956">compose_cedr.cpp:2956</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_html_a48184f32fcafb0fdfd9e2fc9a0e042b5"><div class="ttname"><a href="namespacecedr_1_1qlt.html#a48184f32fcafb0fdfd9e2fc9a0e042b5">cedr::qlt::r2l_solve_qp_set_q</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void r2l_solve_qp_set_q(const Data &amp;l2r_data, const Data &amp;r2l_data, const Int &amp;os, const Int &amp;l2rndps, const Int &amp;r2lndps, const Int &amp;l2rbdi, const Int &amp;r2lbdi, const Real &amp;q_min, const Real &amp;q_max)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03268">compose_cedr.cpp:3268</a></div></div>
<div class="ttc" id="anamespacecedr_1_1qlt_html_abf5106256ba521c713427b1d79c061be"><div class="ttname"><a href="namespacecedr_1_1qlt.html#abf5106256ba521c713427b1d79c061be">cedr::qlt::r2l_solve_qp_solve_node_problem</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION void r2l_solve_qp_solve_node_problem(const Data &amp;l2r_data, const Data &amp;r2l_data, const Int &amp;problem_type, const impl::NodeSets::Node &amp;n, const impl::NodeSets::Node &amp;k0, const impl::NodeSets::Node &amp;k1, const Int &amp;l2rndps, const Int &amp;r2lndps, const Int &amp;l2rbdi, const Int &amp;r2lbdi, const bool prefer_mass_con_to_bounds)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03280">compose_cedr.cpp:3280</a></div></div>
<div class="ttc" id="anamespacecedr_1_1test_1_1transport1d_1_1interp_html_a03d4626600d89587b948e34f86a92d76"><div class="ttname"><a href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#a03d4626600d89587b948e34f86a92d76">cedr::test::transport1d::interp::cubic_interp_periodic</a></div><div class="ttdeci">void cubic_interp_periodic(const Real *const x, const Int nx, const Real *const y, const Real *const xi, const Int nxi, Real *const yi, Int *const dod)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04629">compose_cedr.cpp:4629</a></div></div>
<div class="ttc" id="anamespacecedr_1_1test_1_1transport1d_1_1interp_html_a620a438fa741c9435e6cb6c3780ca1bd"><div class="ttname"><a href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#a620a438fa741c9435e6cb6c3780ca1bd">cedr::test::transport1d::interp::to_periodic_core</a></div><div class="ttdeci">Real to_periodic_core(const Real &amp;xl, const Real &amp;xr, const Real &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04605">compose_cedr.cpp:4605</a></div></div>
<div class="ttc" id="anamespacecedr_1_1test_1_1transport1d_1_1interp_html_aee0afb2988e04c0714704b9350c8fbfa"><div class="ttname"><a href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#aee0afb2988e04c0714704b9350c8fbfa">cedr::test::transport1d::interp::get_slope</a></div><div class="ttdeci">Real get_slope(const Real x[2], const Real y[2])</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04611">compose_cedr.cpp:4611</a></div></div>
<div class="ttc" id="anamespacecedr_1_1test_1_1transport1d_1_1interp_html_af2b9037d2be847c271f93ca7019e9e4e"><div class="ttname"><a href="namespacecedr_1_1test_1_1transport1d_1_1interp.html#af2b9037d2be847c271f93ca7019e9e4e">cedr::test::transport1d::interp::get_cubic</a></div><div class="ttdeci">void get_cubic(Real dx, Real v1, Real s1, Real v2, Real s2, Real c[4])</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04616">compose_cedr.cpp:4616</a></div></div>
<div class="ttc" id="anamespacecedr_1_1test_1_1transport1d_html_addbbd79160bdccab693d08f9ad5e6b71"><div class="ttname"><a href="namespacecedr_1_1test_1_1transport1d.html#addbbd79160bdccab693d08f9ad5e6b71">cedr::test::transport1d::run</a></div><div class="ttdeci">Int run(const mpi::Parallel::Ptr &amp;p, const Input &amp;in)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04853">compose_cedr.cpp:4853</a></div></div>
<div class="ttc" id="anamespacecedr_1_1util_html_a4b025f56b9c9ec77cf0220e4cf9b44cf"><div class="ttname"><a href="namespacecedr_1_1util.html#a4b025f56b9c9ec77cf0220e4cf9b44cf">cedr::util::reldif</a></div><div class="ttdeci">Real reldif(const Real a, const Real b)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00372">compose_cedr.cpp:372</a></div></div>
<div class="ttc" id="anamespacecedr_1_1util_html_a61f3ce9b70a51feb4dac7eeded04d8d0"><div class="ttname"><a href="namespacecedr_1_1util.html#a61f3ce9b70a51feb4dac7eeded04d8d0">cedr::util::urand</a></div><div class="ttdeci">Real urand()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02005">compose_cedr.cpp:2005</a></div></div>
<div class="ttc" id="anamespacecedr_1_1util_html_a8cc6be245e1ed9a0338ed9b26f1b51e7"><div class="ttname"><a href="namespacecedr_1_1util.html#a8cc6be245e1ed9a0338ed9b26f1b51e7">cedr::util::reldif</a></div><div class="ttdeci">Real reldif(const Real *a, const Real *b, const Int n)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02007">compose_cedr.cpp:2007</a></div></div>
<div class="ttc" id="anamespacecedr_1_1util_html_a999b0e1fcfd71bec4f37889b78b4a25e"><div class="ttname"><a href="namespacecedr_1_1util.html#a999b0e1fcfd71bec4f37889b78b4a25e">cedr::util::eq</a></div><div class="ttdeci">bool eq(const std::string &amp;a, const char *const b1, const char *const b2=0)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02000">compose_cedr.cpp:2000</a></div></div>
<div class="ttc" id="anamespacecedr_1_1util_html_aebb086baeee1459e0a42a4d659e044dc"><div class="ttname"><a href="namespacecedr_1_1util.html#aebb086baeee1459e0a42a4d659e044dc">cedr::util::square</a></div><div class="ttdeci">constexpr KOKKOS_INLINE_FUNCTION T square(const T &amp;x)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00305">compose_cedr.cpp:305</a></div></div>
<div class="ttc" id="anamespacecedr_1_1util_html_aefa04d452aeb48c1024688c909160d90"><div class="ttname"><a href="namespacecedr_1_1util.html#aefa04d452aeb48c1024688c909160d90">cedr::util::prarr</a></div><div class="ttdeci">void prarr(const std::string &amp;name, const T *const v, const size_t n)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00332">compose_cedr.cpp:332</a></div></div>
<div class="ttc" id="anamespacecedr_html"><div class="ttname"><a href="namespacecedr.html">cedr</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00027">compose_cedr.cpp:27</a></div></div>
<div class="ttc" id="anamespacecedr_html_a0445bf8d3356f2f8542d578857090a08"><div class="ttname"><a href="namespacecedr.html#a0445bf8d3356f2f8542d578857090a08">cedr::Int</a></div><div class="ttdeci">int Int</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00162">compose_cedr.cpp:162</a></div></div>
<div class="ttc" id="anamespacecedr_html_a86bcaf9f409211c2859255278eedf606"><div class="ttname"><a href="namespacecedr.html#a86bcaf9f409211c2859255278eedf606">cedr::Real</a></div><div class="ttdeci">double Real</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00165">compose_cedr.cpp:165</a></div></div>
<div class="ttc" id="anamespacecedr_html_a8b8f6c83cd7036cafc573f61c91244ef"><div class="ttname"><a href="namespacecedr.html#a8b8f6c83cd7036cafc573f61c91244ef">cedr::Size</a></div><div class="ttdeci">std::size_t Size</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00164">compose_cedr.cpp:164</a></div></div>
<div class="ttc" id="anamespacecedr_html_a9b1ef9093cb8aed0e6bb1317bc27053e"><div class="ttname"><a href="namespacecedr.html#a9b1ef9093cb8aed0e6bb1317bc27053e">cedr::Long</a></div><div class="ttdeci">long int Long</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00163">compose_cedr.cpp:163</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a19f70697971fe3e6502be3097865437a"><div class="ttname"><a href="namespacecontrol__mod.html#a19f70697971fe3e6502be3097865437a">control_mod::tol</a></div><div class="ttdeci">real(kind=real_kind), public tol</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00137">control_mod.F90:137</a></div></div>
<div class="ttc" id="anamespacecontrol__mod_html_a4ae9f52bee36b1f0153a2431b0faafdb"><div class="ttname"><a href="namespacecontrol__mod.html#a4ae9f52bee36b1f0153a2431b0faafdb">control_mod::limiter_option</a></div><div class="ttdeci">integer, public limiter_option</div><div class="ttdef"><b>Definition:</b> <a href="control__mod_8_f90_source.html#l00096">control_mod.F90:96</a></div></div>
<div class="ttc" id="anamespacedcmip2012__test5_html_a23dbdf598e3e14675594d87b6df56eb3"><div class="ttname"><a href="namespacedcmip2012__test5.html#a23dbdf598e3e14675594d87b6df56eb3">dcmip2012_test5::epsilon</a></div><div class="ttdeci">real(8), parameter epsilon</div><div class="ttdef"><b>Definition:</b> <a href="dcmip2012__test5_8_f90_source.html#l00055">dcmip2012_test5.F90:55</a></div></div>
<div class="ttc" id="anamespacedcmip2012__test5_html_ad89ae7f123bdc5a628ee8e834c3e18a5"><div class="ttname"><a href="namespacedcmip2012__test5.html#ad89ae7f123bdc5a628ee8e834c3e18a5">dcmip2012_test5::convert</a></div><div class="ttdeci">real(8), parameter convert</div><div class="ttdef"><b>Definition:</b> <a href="dcmip2012__test5_8_f90_source.html#l00050">dcmip2012_test5.F90:50</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a0070848a40ac48379601d9a8a183c83b"><div class="ttname"><a href="namespacedimensions__mod.html#a0070848a40ac48379601d9a8a183c83b">dimensions_mod::qsize</a></div><div class="ttdeci">integer, public qsize</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00026">dimensions_mod.F90:26</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a5020e9504c2decc9d182fe296ffc3b42"><div class="ttname"><a href="namespacedimensions__mod.html#a5020e9504c2decc9d182fe296ffc3b42">dimensions_mod::qsize_d</a></div><div class="ttdeci">integer, parameter, public qsize_d</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00018">dimensions_mod.F90:18</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a64817c8f3506c463c896d202d237025e"><div class="ttname"><a href="namespacedimensions__mod.html#a64817c8f3506c463c896d202d237025e">dimensions_mod::nelem</a></div><div class="ttdeci">integer, public nelem</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00041">dimensions_mod.F90:41</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a6baa218e1683465acc4f37fcea8e30d5"><div class="ttname"><a href="namespacedimensions__mod.html#a6baa218e1683465acc4f37fcea8e30d5">dimensions_mod::nlev</a></div><div class="ttdeci">integer, parameter, public nlev</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00029">dimensions_mod.F90:29</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_a8648e26ae0e474ccf69d32a8148520c9"><div class="ttname"><a href="namespacedimensions__mod.html#a8648e26ae0e474ccf69d32a8148520c9">dimensions_mod::np</a></div><div class="ttdeci">integer, parameter, public np</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00023">dimensions_mod.F90:23</a></div></div>
<div class="ttc" id="anamespacedimensions__mod_html_af137394c40531d5d6f0daa64351372e7"><div class="ttname"><a href="namespacedimensions__mod.html#af137394c40531d5d6f0daa64351372e7">dimensions_mod::ne</a></div><div class="ttdeci">integer, public ne</div><div class="ttdef"><b>Definition:</b> <a href="dimensions__mod_8_f90_source.html#l00039">dimensions_mod.F90:39</a></div></div>
<div class="ttc" id="anamespaceelement__state_html_ad600dbbab5d81bfc236df4786d322a10"><div class="ttname"><a href="namespaceelement__state.html#ad600dbbab5d81bfc236df4786d322a10">element_state::timelevels</a></div><div class="ttdeci">integer, parameter, public timelevels</div><div class="ttdef"><b>Definition:</b> <a href="preqx_2element__state_8_f90_source.html#l00012">element_state.F90:12</a></div></div>
<div class="ttc" id="anamespacehomme_1_1cslmpi_html_a2b713e2734729354e7c6f52f90ec64d6"><div class="ttname"><a href="namespacehomme_1_1cslmpi.html#a2b713e2734729354e7c6f52f90ec64d6">homme::cslmpi::recv</a></div><div class="ttdeci">void recv(CslMpi &amp;cm, const bool skip_if_empty=false)</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l03422">compose_slmm.cpp:3422</a></div></div>
<div class="ttc" id="anamespacehomme_1_1cslmpi_html_af40d7ea4fe4185cea6fc7c0e4f17133b"><div class="ttname"><a href="namespacehomme_1_1cslmpi.html#af40d7ea4fe4185cea6fc7c0e4f17133b">homme::cslmpi::init</a></div><div class="ttdeci">CslMpi::Ptr init(const slmm::Advecter::ConstPtr &amp;advecter, const mpi::Parallel::Ptr &amp;p, Int np, Int nlev, Int qsize, Int qsized, Int nelemd, const Int *nbr_id_rank, const Int *nirptr, Int halo)</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l03329">compose_slmm.cpp:3329</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_a0e15e9b43e8b615ddb5c88d87b40593a"><div class="ttname"><a href="namespacehomme_1_1sl.html#a0e15e9b43e8b615ddb5c88d87b40593a">homme::sl::accum_values</a></div><div class="ttdeci">void accum_values(const Int ie, const Int k, const Int q, const Int tl_np1, const Int n0_qdp, const Int np2, const FA1&lt; const Real &gt; &amp;spheremp, const FA3&lt; const Real &gt; &amp;dp3d_c, const FA4&lt; Real &gt; &amp;q_min, const FA4&lt; const Real &gt; &amp;q_max, const FA4&lt; const Real &gt; &amp;qdp_p, const FA3&lt; const Real &gt; &amp;q_c, Real &amp;rhom, Real &amp;Qm, Real &amp;Qm_min, Real &amp;Qm_max)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06306">compose_cedr.cpp:6306</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_a16cd0b0b5d042613ec1fe5a9947dddf2"><div class="ttname"><a href="namespacehomme_1_1sl.html#a16cd0b0b5d042613ec1fe5a9947dddf2">homme::sl::vertical_caas_backup</a></div><div class="ttdeci">Int vertical_caas_backup(const Int n, Real *rhom, const Real q_min, const Real q_max, Real Qmlo_tot, Real Qmhi_tot, const Real Qm_tot, Real *Qmlo, Real *Qmhi, Real *Qm)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06272">compose_cedr.cpp:6272</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_a252e034117295143127d71004a1758a7"><div class="ttname"><a href="namespacehomme_1_1sl.html#a252e034117295143127d71004a1758a7">homme::sl::FA1</a></div><div class="ttdeci">Kokkos::View&lt; T *, Kokkos::LayoutLeft, Kokkos::HostSpace &gt; FA1</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05992">compose_cedr.cpp:5993</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_a46e9e2574a59bf3476d8965cb14167bf"><div class="ttname"><a href="namespacehomme_1_1sl.html#a46e9e2574a59bf3476d8965cb14167bf">homme::sl::check</a></div><div class="ttdeci">void check(CDR &amp;cdr, Data &amp;d, const Real *q_min_r, const Real *q_max_r, const Int nets, const Int nete)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06418">compose_cedr.cpp:6418</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_a52e0bc6d10b00586340d9941e7dabd5f"><div class="ttname"><a href="namespacehomme_1_1sl.html#a52e0bc6d10b00586340d9941e7dabd5f">homme::sl::insert</a></div><div class="ttdeci">void insert(const Data::Ptr &amp;d, const Int ie, const Int ptridx, Real *array, const Int i0=0, const Int i1=0)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06053">compose_cedr.cpp:6053</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_a754eb05e12514d593668ba186124a7d2"><div class="ttname"><a href="namespacehomme_1_1sl.html#a754eb05e12514d593668ba186124a7d2">homme::sl::FA4</a></div><div class="ttdeci">Kokkos::View&lt; T ****, Kokkos::LayoutLeft, Kokkos::HostSpace &gt; FA4</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05998">compose_cedr.cpp:5999</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_a82bdeafe95920df3fa468f2091412855"><div class="ttname"><a href="namespacehomme_1_1sl.html#a82bdeafe95920df3fa468f2091412855">homme::sl::FA5</a></div><div class="ttdeci">Kokkos::View&lt; T *****, Kokkos::LayoutLeft, Kokkos::HostSpace &gt; FA5</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06000">compose_cedr.cpp:6001</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_aa4bae311d240392f5d57f5a8681a672e"><div class="ttname"><a href="namespacehomme_1_1sl.html#aa4bae311d240392f5d57f5a8681a672e">homme::sl::FA3</a></div><div class="ttdeci">Kokkos::View&lt; T ***, Kokkos::LayoutLeft, Kokkos::HostSpace &gt; FA3</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05996">compose_cedr.cpp:5997</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_ab9d646428a12b139d7ed0af95052a2d7"><div class="ttname"><a href="namespacehomme_1_1sl.html#ab9d646428a12b139d7ed0af95052a2d7">homme::sl::run_local</a></div><div class="ttdeci">void run_local(CDR &amp;cdr, const Data &amp;d, Real *q_min_r, const Real *q_max_r, const Int nets, const Int nete, const bool scalar_bounds, const Int limiter_option)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06322">compose_cedr.cpp:6322</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_abb0c4b7af2eefb92d0dfa497edb3846d"><div class="ttname"><a href="namespacehomme_1_1sl.html#abb0c4b7af2eefb92d0dfa497edb3846d">homme::sl::solve_local</a></div><div class="ttdeci">void solve_local(const Int ie, const Int k, const Int q, const Int tl_np1, const Int n1_qdp, const Int np, const bool scalar_bounds, const Int limiter_option, const FA1&lt; const Real &gt; &amp;spheremp, const FA3&lt; const Real &gt; &amp;dp3d_c, const FA4&lt; const Real &gt; &amp;q_min, const FA4&lt; const Real &gt; &amp;q_max, const Real Qm, FA4&lt; Real &gt; &amp;qdp_c, FA3&lt; Real &gt; &amp;q_c)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06186">compose_cedr.cpp:6186</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_af77f346d99433f2dcf621707aa32c086"><div class="ttname"><a href="namespacehomme_1_1sl.html#af77f346d99433f2dcf621707aa32c086">homme::sl::insert</a></div><div class="ttdeci">void insert(std::vector&lt; T * &gt; &amp;r, const Int i, T *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06048">compose_cedr.cpp:6048</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_af8c52da368642f513f3f40370cac3238"><div class="ttname"><a href="namespacehomme_1_1sl.html#af8c52da368642f513f3f40370cac3238">homme::sl::FA2</a></div><div class="ttdeci">Kokkos::View&lt; T **, Kokkos::LayoutLeft, Kokkos::HostSpace &gt; FA2</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05994">compose_cedr.cpp:5995</a></div></div>
<div class="ttc" id="anamespacehomme_1_1sl_html_afafe33ddab3173614642830eb1c5ac57"><div class="ttname"><a href="namespacehomme_1_1sl.html#afafe33ddab3173614642830eb1c5ac57">homme::sl::run_global</a></div><div class="ttdeci">void run_global(CDR &amp;cdr, const Data &amp;d, Real *q_min_r, const Real *q_max_r, const Int nets, const Int nete)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06099">compose_cedr.cpp:6099</a></div></div>
<div class="ttc" id="anamespacehomme_html"><div class="ttname"><a href="namespacehomme.html">homme</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05023">compose_cedr.cpp:5023</a></div></div>
<div class="ttc" id="anamespacehomme_html_a016506b6a677d76291770756f08dd3d2"><div class="ttname"><a href="namespacehomme.html#a016506b6a677d76291770756f08dd3d2">homme::attach_and_renumber_horizontal_trees</a></div><div class="ttdeci">void attach_and_renumber_horizontal_trees(const qlt::tree::Node::Ptr &amp;supnode, const qlt::tree::Node::Ptr &amp;htree, const Int horiz_nleaf)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05708">compose_cedr.cpp:5708</a></div></div>
<div class="ttc" id="anamespacehomme_html_a0e8829f9f66731a13df2f2169190b8a1"><div class="ttname"><a href="namespacehomme.html#a0e8829f9f66731a13df2f2169190b8a1">homme::test_tree_maker</a></div><div class="ttdeci">Int test_tree_maker()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05795">compose_cedr.cpp:5795</a></div></div>
<div class="ttc" id="anamespacehomme_html_a3cb555dbcfd5d1b60efacf4064c3642a"><div class="ttname"><a href="namespacehomme.html#a3cb555dbcfd5d1b60efacf4064c3642a">homme::combine_superlevels</a></div><div class="ttdeci">qlt::tree::Node::Ptr combine_superlevels(const qlt::tree::Node::Ptr &amp;horiz_tree, const Int horiz_nleaf, const Int nsuplev)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05750">compose_cedr.cpp:5750</a></div></div>
<div class="ttc" id="anamespacehomme_html_a3eee1ce80e3db8a696f06c5f6c30a6f1"><div class="ttname"><a href="namespacehomme.html#a3eee1ce80e3db8a696f06c5f6c30a6f1">homme::make_tree</a></div><div class="ttdeci">qlt::tree::Node::Ptr make_tree(const cedr::mpi::Parallel::Ptr &amp;p, const Int nelem, const Int *gid_data, const Int *rank_data, const Int nsublev, const bool use_sgi, const bool cdr_over_super_levels, const Int nsuplev)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05779">compose_cedr.cpp:5779</a></div></div>
<div class="ttc" id="anamespacehomme_html_a3fc7b3e45303dc1b13cec02a12bf2aae"><div class="ttname"><a href="namespacehomme.html#a3fc7b3e45303dc1b13cec02a12bf2aae">homme::compose_repro_sum</a></div><div class="ttdeci">void compose_repro_sum(const Real *send, Real *recv, Int nlocal, Int nfld, Int fcomm)</div></div>
<div class="ttc" id="anamespacehomme_html_a4a444386784905f436c6fbbae4a397cf"><div class="ttname"><a href="namespacehomme.html#a4a444386784905f436c6fbbae4a397cf">homme::set_ie2gci</a></div><div class="ttdeci">void set_ie2gci(CDR &amp;q, const Int ie, const Int gci)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05940">compose_cedr.cpp:5940</a></div></div>
<div class="ttc" id="anamespacehomme_html_a596e78b4df2c806552616fd69b879cfa"><div class="ttname"><a href="namespacehomme.html#a596e78b4df2c806552616fd69b879cfa">homme::init_ie2lci</a></div><div class="ttdeci">void init_ie2lci(CDR &amp;q)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05942">compose_cedr.cpp:5942</a></div></div>
<div class="ttc" id="anamespacehomme_html_a7d62839cc5b098460120928a53f85dbe"><div class="ttname"><a href="namespacehomme.html#a7d62839cc5b098460120928a53f85dbe">homme::make_tree_non_sgi</a></div><div class="ttdeci">qlt::tree::Node::Ptr make_tree_non_sgi(const cedr::mpi::Parallel::Ptr &amp;p, const Int nelem, const Int *sc2gci, const Int *sc2rank, const Int nsublev)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05675">compose_cedr.cpp:5675</a></div></div>
<div class="ttc" id="anamespacehomme_html_a8a760fb0324709684a0de7b60bb5a06d"><div class="ttname"><a href="namespacehomme.html#a8a760fb0324709684a0de7b60bb5a06d">homme::make_tree_sgi</a></div><div class="ttdeci">qlt::tree::Node::Ptr make_tree_sgi(const cedr::mpi::Parallel::Ptr &amp;p, const Int nelem, const Int *owned_ids, const Int *rank2sfc, const Int nsublev)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05659">compose_cedr.cpp:5659</a></div></div>
<div class="ttc" id="anamespacehomme_html_a9740766876b36bd5a1511fec3c517cc2"><div class="ttname"><a href="namespacehomme.html#a9740766876b36bd5a1511fec3c517cc2">homme::clone</a></div><div class="ttdeci">qlt::tree::Node::Ptr clone(const qlt::tree::Node::Ptr &amp;in, const qlt::tree::Node *parent=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05685">compose_cedr.cpp:5685</a></div></div>
<div class="ttc" id="anamespacehomme_html_aa2ca2aa98b50def12f1623c268d094ee"><div class="ttname"><a href="namespacehomme.html#aa2ca2aa98b50def12f1623c268d094ee">homme::Int</a></div><div class="ttdeci">slmm::Int Int</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l02193">compose_slmm.cpp:2193</a></div></div>
<div class="ttc" id="anamespacehomme_html_aba51c752bbb102f502bb15d88a84e170"><div class="ttname"><a href="namespacehomme.html#aba51c752bbb102f502bb15d88a84e170">homme::check_tree</a></div><div class="ttdeci">void check_tree(const cedr::mpi::Parallel::Ptr &amp;p, const qlt::tree::Node::Ptr &amp;n, const Int nleaf)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05759">compose_cedr.cpp:5759</a></div></div>
<div class="ttc" id="anamespacehomme_html_ac48e88a477264e5e3aa3860d43f29729"><div class="ttname"><a href="namespacehomme.html#ac48e88a477264e5e3aa3860d43f29729">homme::make_tree_over_index_range</a></div><div class="ttdeci">qlt::tree::Node::Ptr make_tree_over_index_range(const Int cs, const Int ce, const qlt::tree::Node *parent=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05733">compose_cedr.cpp:5733</a></div></div>
<div class="ttc" id="anamespacehomme_html_acaf39abd7df32b38d4eea5c118cdf307"><div class="ttname"><a href="namespacehomme.html#acaf39abd7df32b38d4eea5c118cdf307">homme::rank2sfc_search</a></div><div class="ttdeci">Int rank2sfc_search(const Int *rank2sfc, const Int &amp;nrank, const Int &amp;sfc)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05511">compose_cedr.cpp:5511</a></div></div>
<div class="ttc" id="anamespacehomme_html_acdf5762db8fe71175a518eb6482b2c10"><div class="ttname"><a href="namespacehomme.html#acdf5762db8fe71175a518eb6482b2c10">homme::add_sub_levels</a></div><div class="ttdeci">void add_sub_levels(const Int my_rank, const qlt::tree::Node::Ptr &amp;node, const Int nsublev, const Int level_offset)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05574">compose_cedr.cpp:5574</a></div></div>
<div class="ttc" id="anamespacehomme_html_ad2c39737424bd290e32dd7884f6f0f9b"><div class="ttname"><a href="namespacehomme.html#ad2c39737424bd290e32dd7884f6f0f9b">homme::make_my_tree_part</a></div><div class="ttdeci">qlt::tree::Node::Ptr make_my_tree_part(const cedr::mpi::Parallel::Ptr &amp;p, const Int &amp;ncells, const Int &amp;nrank, const Int *rank2sfc)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05636">compose_cedr.cpp:5636</a></div></div>
<div class="ttc" id="anamespacehomme_html_ad617c49d38a616dba83ab782ade127b1"><div class="ttname"><a href="namespacehomme.html#ad617c49d38a616dba83ab782ade127b1">homme::init_tracers</a></div><div class="ttdeci">void init_tracers(CDR &amp;q, const Int nlev, const Int qsize, const bool need_conservation)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05985">compose_cedr.cpp:5985</a></div></div>
<div class="ttc" id="anamespacehomme_html_ae52e85d9df82bdcaa2a239573db554d8"><div class="ttname"><a href="namespacehomme.html#ae52e85d9df82bdcaa2a239573db554d8">homme::renumber</a></div><div class="ttdeci">void renumber(const Int *sc2gci, const Int *sc2rank, const qlt::tree::Node::Ptr &amp;node)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05538">compose_cedr.cpp:5538</a></div></div>
<div class="ttc" id="anamespacehomme_html_ae674c8dd01c9c230ed797858d1203c8c"><div class="ttname"><a href="namespacehomme.html#ae674c8dd01c9c230ed797858d1203c8c">homme::renumber_leaves</a></div><div class="ttdeci">void renumber_leaves(const qlt::tree::Node::Ptr &amp;node, const Int horiz_nleaf, const Int supidx)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05695">compose_cedr.cpp:5695</a></div></div>
<div class="ttc" id="anamespacehomme_html_af613524ea9fa700597e28c2792c5b38d"><div class="ttname"><a href="namespacehomme.html#af613524ea9fa700597e28c2792c5b38d">homme::Real</a></div><div class="ttdeci">slmm::Real Real</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l02194">compose_slmm.cpp:2194</a></div></div>
<div class="ttc" id="anamespaceinterp__movie__mod_html_af417850ebbdd1ffe0e0080eb279fd2d2"><div class="ttname"><a href="namespaceinterp__movie__mod.html#af417850ebbdd1ffe0e0080eb279fd2d2">interp_movie_mod::interp</a></div><div class="ttdeci">type(interpolate_t) interp</div><div class="ttdef"><b>Definition:</b> <a href="interp__movie__mod_8_f90_source.html#l00217">interp_movie_mod.F90:217</a></div></div>
<div class="ttc" id="anamespacejw_html_a655cdd60136294f8259068e09d1307ff"><div class="ttname"><a href="namespacejw.html#a655cdd60136294f8259068e09d1307ff">jw::pi</a></div><div class="ttdeci">real(r8), parameter pi</div><div class="ttdef"><b>Definition:</b> <a href="asp__tests_8_f90_source.html#l00048">asp_tests.F90:48</a></div></div>
<div class="ttc" id="anamespacejw_html_a6fec32e251eadfd05121de103250de27"><div class="ttname"><a href="namespacejw.html#a6fec32e251eadfd05121de103250de27">jw::rd</a></div><div class="ttdeci">real(r8), parameter rd</div><div class="ttdef"><b>Definition:</b> <a href="asp__tests_8_f90_source.html#l00048">asp_tests.F90:48</a></div></div>
<div class="ttc" id="anamespacejw_html_acf663523b96ec023200fa8a0f58209f8"><div class="ttname"><a href="namespacejw.html#acf663523b96ec023200fa8a0f58209f8">jw::a</a></div><div class="ttdeci">real(r8), parameter a</div><div class="ttdef"><b>Definition:</b> <a href="asp__tests_8_f90_source.html#l00048">asp_tests.F90:48</a></div></div>
<div class="ttc" id="anamespaceparallel__mod_html_a867e5652843d63385b06802d398d1ad2"><div class="ttname"><a href="namespaceparallel__mod.html#a867e5652843d63385b06802d398d1ad2">parallel_mod::status</a></div><div class="ttdeci">integer, dimension(:,:), allocatable, public status</div><div class="ttdef"><b>Definition:</b> <a href="parallel__mod_8_f90_source.html#l00035">parallel_mod.F90:35</a></div></div>
<div class="ttc" id="anamespaceparams__mod_html_aaf6b44dc42783444668b9854140d7559"><div class="ttname"><a href="namespaceparams__mod.html#aaf6b44dc42783444668b9854140d7559">params_mod::volume</a></div><div class="ttdeci">integer, parameter, public volume</div><div class="ttdef"><b>Definition:</b> <a href="params__mod_8_f90_source.html#l00009">params_mod.F90:9</a></div></div>
<div class="ttc" id="anamespacephysical__constants_html_a8f292bec2061eac2b56d3f01a57eeff2"><div class="ttname"><a href="namespacephysical__constants.html#a8f292bec2061eac2b56d3f01a57eeff2">physical_constants::dx</a></div><div class="ttdeci">real(kind=real_kind), public dx</div><div class="ttdef"><b>Definition:</b> <a href="physical__constants_8_f90_source.html#l00079">physical_constants.F90:79</a></div></div>
<div class="ttc" id="anamespaceslmm_1_1nearest__point_html_aa389a84fa6e8831d1ba347ec19219c0d"><div class="ttname"><a href="namespaceslmm_1_1nearest__point.html#aa389a84fa6e8831d1ba347ec19219c0d">slmm::nearest_point::Mesh</a></div><div class="ttdeci">siqk::sh::Mesh&lt; siqk::ko::HostSpace &gt; Mesh</div><div class="ttdef"><b>Definition:</b> <a href="compose__slmm_8cpp_source.html#l01588">compose_slmm.cpp:1588</a></div></div>
<div class="ttc" id="anamespacesupercell_html_a8afb838193de1fd0aeb14e727966a8e6"><div class="ttname"><a href="namespacesupercell.html#a8afb838193de1fd0aeb14e727966a8e6">supercell::us</a></div><div class="ttdeci">real(8), parameter us</div><div class="ttdef"><b>Definition:</b> <a href="dcmip2016-supercell_8_f90_source.html#l00093">dcmip2016-supercell.F90:93</a></div></div>
<div class="ttc" id="anamespacesupercell_html_ae57ef03dc0cb9828dbacc89aac8870c0"><div class="ttname"><a href="namespacesupercell.html#ae57ef03dc0cb9828dbacc89aac8870c0">supercell::x</a></div><div class="ttdeci">real(8), parameter x</div><div class="ttdef"><b>Definition:</b> <a href="dcmip2016-supercell_8_f90_source.html#l00084">dcmip2016-supercell.F90:84</a></div></div>
<div class="ttc" id="anamespacesurfaces__mod_html_acd025aa90ee60dfdb616983bad0aa680"><div class="ttname"><a href="namespacesurfaces__mod.html#acd025aa90ee60dfdb616983bad0aa680">surfaces_mod::isnan</a></div><div class="ttdeci">logical function isnan(a)</div><div class="ttdef"><b>Definition:</b> <a href="surfaces__mod_8_f90_source.html#l02117">surfaces_mod.F90:2118</a></div></div>
<div class="ttc" id="astruct_kokkos_1_1_real2_html"><div class="ttname"><a href="struct_kokkos_1_1_real2.html">Kokkos::Real2</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03756">compose_cedr.cpp:3756</a></div></div>
<div class="ttc" id="astruct_kokkos_1_1_real2_html_a4ec3111c370c55528b772656e847a34b"><div class="ttname"><a href="struct_kokkos_1_1_real2.html#a4ec3111c370c55528b772656e847a34b">Kokkos::Real2::v</a></div><div class="ttdeci">cedr::Real v[2]</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03757">compose_cedr.cpp:3757</a></div></div>
<div class="ttc" id="astruct_kokkos_1_1_real2_html_acceec37cc5b3c3ca8ed70f60024a6371"><div class="ttname"><a href="struct_kokkos_1_1_real2.html#acceec37cc5b3c3ca8ed70f60024a6371">Kokkos::Real2::Real2</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Real2()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03758">compose_cedr.cpp:3758</a></div></div>
<div class="ttc" id="astruct_kokkos_1_1reduction__identity_3_01_real2_01_4_html"><div class="ttname"><a href="struct_kokkos_1_1reduction__identity_3_01_real2_01_4.html">Kokkos::reduction_identity&lt; Real2 &gt;</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03776">compose_cedr.cpp:3776</a></div></div>
<div class="ttc" id="astruct_kokkos_1_1reduction__identity_3_01_real2_01_4_html_a673bb4ce53e92a8be7c337204b6670d7"><div class="ttname"><a href="struct_kokkos_1_1reduction__identity_3_01_real2_01_4.html#a673bb4ce53e92a8be7c337204b6670d7">Kokkos::reduction_identity&lt; Real2 &gt;::sum</a></div><div class="ttdeci">static KOKKOS_INLINE_FUNCTION Real2 sum()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03777">compose_cedr.cpp:3777</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_1_1_options_html"><div class="ttname"><a href="structcedr_1_1_c_d_r_1_1_options.html">cedr::CDR::Options</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00434">compose_cedr.cpp:434</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_1_1_options_html_a9a6fa254247b874087170c3b86db13a3"><div class="ttname"><a href="structcedr_1_1_c_d_r_1_1_options.html#a9a6fa254247b874087170c3b86db13a3">cedr::CDR::Options::prefer_numerical_mass_conservation_to_numerical_bounds</a></div><div class="ttdeci">bool prefer_numerical_mass_conservation_to_numerical_bounds</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00441">compose_cedr.cpp:441</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_1_1_options_html_afd18af8ddc6582a59e84a16059ffa832"><div class="ttname"><a href="structcedr_1_1_c_d_r_1_1_options.html#afd18af8ddc6582a59e84a16059ffa832">cedr::CDR::Options::Options</a></div><div class="ttdeci">Options()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00443">compose_cedr.cpp:443</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html"><div class="ttname"><a href="structcedr_1_1_c_d_r.html">cedr::CDR</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00431">compose_cedr.cpp:431</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a00c495105fab3b2436e6c97d2da5135d"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a00c495105fab3b2436e6c97d2da5135d">cedr::CDR::get_Qm</a></div><div class="ttdeci">virtual KOKKOS_FUNCTION Real get_Qm(const Int &amp;lclcellidx, const Int &amp;tracer_idx) const =0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a024f5f3db801c5add24053c5f4df4c30"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a024f5f3db801c5add24053c5f4df4c30">cedr::CDR::finish_setup</a></div><div class="ttdeci">virtual void finish_setup()=0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a09ce830b9d53db7a7a26afe23a84bd3b"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a09ce830b9d53db7a7a26afe23a84bd3b">cedr::CDR::end_tracer_declarations</a></div><div class="ttdeci">virtual void end_tracer_declarations()=0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a0f079d40fdc243e68be879d40e286767"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a0f079d40fdc243e68be879d40e286767">cedr::CDR::options_</a></div><div class="ttdeci">Options options_</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00520">compose_cedr.cpp:520</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a3c8346ee469398a071419e53fdbe7b74"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a3c8346ee469398a071419e53fdbe7b74">cedr::CDR::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; CDR &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00432">compose_cedr.cpp:432</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a43b82d0e0517bb5b7250c66dea37ca59"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a43b82d0e0517bb5b7250c66dea37ca59">cedr::CDR::set_buffers</a></div><div class="ttdeci">virtual void set_buffers(Real *buf1, Real *buf2)=0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a466e671d6f74d6915246951e68ab3614"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a466e671d6f74d6915246951e68ab3614">cedr::CDR::get_options</a></div><div class="ttdeci">const Options &amp; get_options() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00452">compose_cedr.cpp:452</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a49513f55696d058b2a799318b32770de"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a49513f55696d058b2a799318b32770de">cedr::CDR::set_rhom</a></div><div class="ttdeci">virtual KOKKOS_FUNCTION void set_rhom(const Int &amp;lclcellidx, const Int &amp;rhomidx, const Real &amp;rhom) const =0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a54f40ac08ba0a53af5a7388a3881f025"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a54f40ac08ba0a53af5a7388a3881f025">cedr::CDR::get_buffers_sizes</a></div><div class="ttdeci">virtual void get_buffers_sizes(size_t &amp;buf1, size_t &amp;buf2)=0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_a8f36942e03a3bf1cb2a9ba823244faa8"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#a8f36942e03a3bf1cb2a9ba823244faa8">cedr::CDR::print</a></div><div class="ttdeci">virtual void print(std::ostream &amp;os) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00450">compose_cedr.cpp:450</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_aa2ea72b6689f1611245976c35014505d"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#aa2ea72b6689f1611245976c35014505d">cedr::CDR::get_problem_type</a></div><div class="ttdeci">virtual int get_problem_type(const Int &amp;tracer_idx) const =0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_aa4a6a4dd2583b886ea2345109526cbfd"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#aa4a6a4dd2583b886ea2345109526cbfd">cedr::CDR::CDR</a></div><div class="ttdeci">CDR(const Options options=Options())</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00448">compose_cedr.cpp:448</a></div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_aa988cb015d9ac7de1464d4e5f7240e2c"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#aa988cb015d9ac7de1464d4e5f7240e2c">cedr::CDR::run</a></div><div class="ttdeci">virtual void run()=0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_aaaab72126510943e4ea028c6028de64d"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#aaaab72126510943e4ea028c6028de64d">cedr::CDR::declare_tracer</a></div><div class="ttdeci">virtual void declare_tracer(int problem_type, const Int &amp;rhomidx)=0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_aab0c355174d756a73f7d70c07c962f09"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#aab0c355174d756a73f7d70c07c962f09">cedr::CDR::get_num_tracers</a></div><div class="ttdeci">virtual Int get_num_tracers() const =0</div></div>
<div class="ttc" id="astructcedr_1_1_c_d_r_html_ab3033b2dc6b8acf8868adc840e8687cb"><div class="ttname"><a href="structcedr_1_1_c_d_r.html#ab3033b2dc6b8acf8868adc840e8687cb">cedr::CDR::set_Qm</a></div><div class="ttdeci">virtual KOKKOS_FUNCTION void set_Qm(const Int &amp;lclcellidx, const Int &amp;tracer_idx, const Real &amp;Qm, const Real &amp;Qm_min, const Real &amp;Qm_max, const Real Qm_prev=std::numeric_limits&lt; Real &gt;::infinity()) const =0</div></div>
<div class="ttc" id="astructcedr_1_1_input_parser_html"><div class="ttname"><a href="structcedr_1_1_input_parser.html">cedr::InputParser</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04938">compose_cedr.cpp:4938</a></div></div>
<div class="ttc" id="astructcedr_1_1_input_parser_html_a5468ccca3270edc8f8766e4a3bd4b61a"><div class="ttname"><a href="structcedr_1_1_input_parser.html#a5468ccca3270edc8f8766e4a3bd4b61a">cedr::InputParser::print</a></div><div class="ttdeci">void print(std::ostream &amp;os) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04994">compose_cedr.cpp:4994</a></div></div>
<div class="ttc" id="astructcedr_1_1_input_parser_html_a748d975eebfa4a55c7fc21c6f6e11ec0"><div class="ttname"><a href="structcedr_1_1_input_parser.html#a748d975eebfa4a55c7fc21c6f6e11ec0">cedr::InputParser::tin</a></div><div class="ttdeci">test::transport1d::Input tin</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04940">compose_cedr.cpp:4940</a></div></div>
<div class="ttc" id="astructcedr_1_1_input_parser_html_aa73524ff8c932b20105dcb15334d3179"><div class="ttname"><a href="structcedr_1_1_input_parser.html#aa73524ff8c932b20105dcb15334d3179">cedr::InputParser::qin</a></div><div class="ttdeci">qlt::test::Input qin</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04939">compose_cedr.cpp:4939</a></div></div>
<div class="ttc" id="astructcedr_1_1_input_parser_html_adcd233bba43b0f23f97e6befa3fe4007"><div class="ttname"><a href="structcedr_1_1_input_parser.html#adcd233bba43b0f23f97e6befa3fe4007">cedr::InputParser::InputParser</a></div><div class="ttdeci">InputParser(int argc, char **argv, const qlt::Parallel::Ptr &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04957">compose_cedr.cpp:4957</a></div></div>
<div class="ttc" id="astructcedr_1_1_problem_type_html"><div class="ttname"><a href="structcedr_1_1_problem_type.html">cedr::ProblemType</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00180">compose_cedr.cpp:180</a></div></div>
<div class="ttc" id="astructcedr_1_1_problem_type_html_a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4"><div class="ttname"><a href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa37d369e4aa076868c1dc0c10f474f4d4">cedr::ProblemType::shapepreserve</a></div><div class="ttdeci">@ shapepreserve</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00182">compose_cedr.cpp:182</a></div></div>
<div class="ttc" id="astructcedr_1_1_problem_type_html_a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1"><div class="ttname"><a href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fa7df1ef3dd7598b64f8dd2d3fa61682a1">cedr::ProblemType::conserve</a></div><div class="ttdeci">@ conserve</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00182">compose_cedr.cpp:182</a></div></div>
<div class="ttc" id="astructcedr_1_1_problem_type_html_a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7"><div class="ttname"><a href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fabd8dbefb10916ca93fae9b9891919dc7">cedr::ProblemType::nonnegative</a></div><div class="ttdeci">@ nonnegative</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00189">compose_cedr.cpp:188</a></div></div>
<div class="ttc" id="astructcedr_1_1_problem_type_html_a78da8427cc0cd7963ffed310c3ee926fac7b193334c098ff0d8259103fa8ce007"><div class="ttname"><a href="structcedr_1_1_problem_type.html#a78da8427cc0cd7963ffed310c3ee926fac7b193334c098ff0d8259103fa8ce007">cedr::ProblemType::consistent</a></div><div class="ttdeci">@ consistent</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00182">compose_cedr.cpp:182</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1_c_a_a_s_1_1_decl_html"><div class="ttname"><a href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html">cedr::caas::CAAS::Decl</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00965">compose_cedr.cpp:965</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1_c_a_a_s_1_1_decl_html_a1b52b74fa233e5a0b7683af59e2c1c5b"><div class="ttname"><a href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#a1b52b74fa233e5a0b7683af59e2c1c5b">cedr::caas::CAAS::Decl::Decl</a></div><div class="ttdeci">Decl(const int probtype_, const Int rhomidx_)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00968">compose_cedr.cpp:968</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1_c_a_a_s_1_1_decl_html_ab0e4100cf9faed8d10fab951689b6db1"><div class="ttname"><a href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#ab0e4100cf9faed8d10fab951689b6db1">cedr::caas::CAAS::Decl::rhomidx</a></div><div class="ttdeci">Int rhomidx</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00967">compose_cedr.cpp:967</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1_c_a_a_s_1_1_decl_html_ac98cdb7856f6dd3ddaa0cb35281c26b5"><div class="ttname"><a href="structcedr_1_1caas_1_1_c_a_a_s_1_1_decl.html#ac98cdb7856f6dd3ddaa0cb35281c26b5">cedr::caas::CAAS::Decl::probtype</a></div><div class="ttdeci">int probtype</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00966">compose_cedr.cpp:966</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer_html"><div class="ttname"><a href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html">cedr::caas::CAAS::UserAllReducer</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00915">compose_cedr.cpp:915</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer_html_a04b71f510cb275314b3221fb04bad1b2"><div class="ttname"><a href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a04b71f510cb275314b3221fb04bad1b2">cedr::caas::CAAS::UserAllReducer::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; const UserAllReducer &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00916">compose_cedr.cpp:916</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer_html_a2bb9b9d2f7970318f27b5b939a3e0aca"><div class="ttname"><a href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#a2bb9b9d2f7970318f27b5b939a3e0aca">cedr::caas::CAAS::UserAllReducer::operator()</a></div><div class="ttdeci">virtual int operator()(const mpi::Parallel &amp;p, Real *sendbuf, Real *rcvbuf, int nlocal, int nfld, MPI_Op op) const =0</div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer_html_ae06c422ee554740d8758bf6bf7e2f304"><div class="ttname"><a href="structcedr_1_1caas_1_1_c_a_a_s_1_1_user_all_reducer.html#ae06c422ee554740d8758bf6bf7e2f304">cedr::caas::CAAS::UserAllReducer::n_accum_in_place</a></div><div class="ttdeci">virtual int n_accum_in_place() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00917">compose_cedr.cpp:917</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_1_1_test_all_reducer_html"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s_1_1_test_all_reducer.html">cedr::caas::test::TestCAAS::TestAllReducer</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04037">compose_cedr.cpp:4037</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_1_1_test_all_reducer_html_a670824dce56173cfc95e66d1519a394c"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s_1_1_test_all_reducer.html#a670824dce56173cfc95e66d1519a394c">cedr::caas::test::TestCAAS::TestAllReducer::operator()</a></div><div class="ttdeci">int operator()(const mpi::Parallel &amp;p, Real *sendbuf, Real *rcvbuf, int nlcl, int count, MPI_Op op) const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04038">compose_cedr.cpp:4038</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_html"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html">cedr::caas::test::TestCAAS</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04034">compose_cedr.cpp:4034</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_html_a3ed9adf8835cbd8d2bcf18433e5f9915"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a3ed9adf8835cbd8d2bcf18433e5f9915">cedr::caas::test::TestCAAS::init_numbering</a></div><div class="ttdeci">void init_numbering() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04075">compose_cedr.cpp:4075</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_html_a519ad30d791c28c7a77d39a7ad919c0f"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a519ad30d791c28c7a77d39a7ad919c0f">cedr::caas::test::TestCAAS::get_cdr</a></div><div class="ttdeci">CDR &amp; get_cdr() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04073">compose_cedr.cpp:4073</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_html_a66967dc293a3b9d16b6f1e6c24018004"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a66967dc293a3b9d16b6f1e6c24018004">cedr::caas::test::TestCAAS::run_impl</a></div><div class="ttdeci">void run_impl(const Int trial) override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04109">compose_cedr.cpp:4109</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_html_a6d684d1617810c485350b2bf3a5f14e1"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#a6d684d1617810c485350b2bf3a5f14e1">cedr::caas::test::TestCAAS::CAAST</a></div><div class="ttdeci">CAAS&lt; Kokkos::DefaultExecutionSpace &gt; CAAST</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04035">compose_cedr.cpp:4035</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_html_acaeea9e48be92b872f1163191e864aae"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#acaeea9e48be92b872f1163191e864aae">cedr::caas::test::TestCAAS::init_tracers</a></div><div class="ttdeci">void init_tracers() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04085">compose_cedr.cpp:4085</a></div></div>
<div class="ttc" id="astructcedr_1_1caas_1_1test_1_1_test_c_a_a_s_html_af73725e00319814f0d14518197b64337"><div class="ttname"><a href="structcedr_1_1caas_1_1test_1_1_test_c_a_a_s.html#af73725e00319814f0d14518197b64337">cedr::caas::test::TestCAAS::TestCAAS</a></div><div class="ttdeci">TestCAAS(const mpi::Parallel::Ptr &amp;p, const Int &amp;ncells, const bool use_own_reducer, const bool external_memory, const bool verbose)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04057">compose_cedr.cpp:4057</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_device_type_html"><div class="ttname"><a href="structcedr_1_1impl_1_1_device_type.html">cedr::impl::DeviceType</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00076">compose_cedr.cpp:76</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_device_type_html_a316a06dae4264eeeb58f1507aeb9fc53"><div class="ttname"><a href="structcedr_1_1impl_1_1_device_type.html#a316a06dae4264eeeb58f1507aeb9fc53">cedr::impl::DeviceType::type</a></div><div class="ttdeci">Kokkos::Device&lt; typename ExeSpace::execution_space, typename ExeSpace::memory_space &gt; type</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00078">compose_cedr.cpp:78</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_exe_space_utils_html"><div class="ttname"><a href="structcedr_1_1impl_1_1_exe_space_utils.html">cedr::impl::ExeSpaceUtils</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00107">compose_cedr.cpp:107</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_exe_space_utils_html_a05464d4fa037da54688672e65e92c05d"><div class="ttname"><a href="structcedr_1_1impl_1_1_exe_space_utils.html#a05464d4fa037da54688672e65e92c05d">cedr::impl::ExeSpaceUtils::Member</a></div><div class="ttdeci">typename TeamPolicy::member_type Member</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00109">compose_cedr.cpp:109</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_exe_space_utils_html_a18ba59c0e27af80222ebb2bdd4cb8244"><div class="ttname"><a href="structcedr_1_1impl_1_1_exe_space_utils.html#a18ba59c0e27af80222ebb2bdd4cb8244">cedr::impl::ExeSpaceUtils::TeamPolicy</a></div><div class="ttdeci">Kokkos::TeamPolicy&lt; ExeSpace &gt; TeamPolicy</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00108">compose_cedr.cpp:108</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_exe_space_utils_html_a453a15c7f15b8fc831baa73cb477dc99"><div class="ttname"><a href="structcedr_1_1impl_1_1_exe_space_utils.html#a453a15c7f15b8fc831baa73cb477dc99">cedr::impl::ExeSpaceUtils::get_default_team_policy</a></div><div class="ttdeci">static TeamPolicy get_default_team_policy(int outer, int inner)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00110">compose_cedr.cpp:110</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_memory_traits_mask_html"><div class="ttname"><a href="structcedr_1_1impl_1_1_memory_traits_mask.html">cedr::impl::MemoryTraitsMask</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00033">compose_cedr.cpp:33</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_memory_traits_mask_html_acf4ed67cb31145624eb4f22cae4cbbdeab98a9c144d5d60822b845dc7b5055c52"><div class="ttname"><a href="structcedr_1_1impl_1_1_memory_traits_mask.html#acf4ed67cb31145624eb4f22cae4cbbdeab98a9c144d5d60822b845dc7b5055c52">cedr::impl::MemoryTraitsMask::value</a></div><div class="ttdeci">@ value</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00050">compose_cedr.cpp:37</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_on_gpu_html"><div class="ttname"><a href="structcedr_1_1impl_1_1_on_gpu.html">cedr::impl::OnGpu</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00093">compose_cedr.cpp:93</a></div></div>
<div class="ttc" id="astructcedr_1_1impl_1_1_on_gpu_html_a275caf39ce69261780aa94a4a4f62a96adcb1815c6dc942ff90ddf2afa9bc7a2b"><div class="ttname"><a href="structcedr_1_1impl_1_1_on_gpu.html#a275caf39ce69261780aa94a4a4f62a96adcb1815c6dc942ff90ddf2afa9bc7a2b">cedr::impl::OnGpu::value</a></div><div class="ttdeci">@ value</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00100">compose_cedr.cpp:94</a></div></div>
<div class="ttc" id="astructcedr_1_1local_1_1_method_html"><div class="ttname"><a href="structcedr_1_1local_1_1_method.html">cedr::local::Method</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01099">compose_cedr.cpp:1099</a></div></div>
<div class="ttc" id="astructcedr_1_1local_1_1_method_html_a67c13b3d95665f3e30d21de22459d3b0"><div class="ttname"><a href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0">cedr::local::Method::Enum</a></div><div class="ttdeci">Enum</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01099">compose_cedr.cpp:1099</a></div></div>
<div class="ttc" id="astructcedr_1_1local_1_1_method_html_a67c13b3d95665f3e30d21de22459d3b0a12e240876312c9b5e79fadb028bd6176"><div class="ttname"><a href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0a12e240876312c9b5e79fadb028bd6176">cedr::local::Method::caas</a></div><div class="ttdeci">@ caas</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01099">compose_cedr.cpp:1099</a></div></div>
<div class="ttc" id="astructcedr_1_1local_1_1_method_html_a67c13b3d95665f3e30d21de22459d3b0aeb7ed44142d1af44ca1226f6c2c54d1f"><div class="ttname"><a href="structcedr_1_1local_1_1_method.html#a67c13b3d95665f3e30d21de22459d3b0aeb7ed44142d1af44ca1226f6c2c54d1f">cedr::local::Method::least_squares</a></div><div class="ttdeci">@ least_squares</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01099">compose_cedr.cpp:1099</a></div></div>
<div class="ttc" id="astructcedr_1_1mpi_1_1_op_html"><div class="ttname"><a href="structcedr_1_1mpi_1_1_op.html">cedr::mpi::Op</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00267">compose_cedr.cpp:267</a></div></div>
<div class="ttc" id="astructcedr_1_1mpi_1_1_op_html_aaf68fcf95b791b02bb232ee91a3c570a"><div class="ttname"><a href="structcedr_1_1mpi_1_1_op.html#aaf68fcf95b791b02bb232ee91a3c570a">cedr::mpi::Op::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; Op &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00268">compose_cedr.cpp:268</a></div></div>
<div class="ttc" id="astructcedr_1_1mpi_1_1_op_html_ab08fb1807a8e963b14fcaa7f3b6c92d4"><div class="ttname"><a href="structcedr_1_1mpi_1_1_op.html#ab08fb1807a8e963b14fcaa7f3b6c92d4">cedr::mpi::Op::~Op</a></div><div class="ttdeci">~Op()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00274">compose_cedr.cpp:274</a></div></div>
<div class="ttc" id="astructcedr_1_1mpi_1_1_op_html_abcd53e121f0327ef0e1f86d6f10581a4"><div class="ttname"><a href="structcedr_1_1mpi_1_1_op.html#abcd53e121f0327ef0e1f86d6f10581a4">cedr::mpi::Op::Op</a></div><div class="ttdeci">Op(MPI_User_function *function, bool commute)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00270">compose_cedr.cpp:270</a></div></div>
<div class="ttc" id="astructcedr_1_1mpi_1_1_op_html_ae5809d9c733e2e22650358548df631fc"><div class="ttname"><a href="structcedr_1_1mpi_1_1_op.html#ae5809d9c733e2e22650358548df631fc">cedr::mpi::Op::get</a></div><div class="ttdeci">const MPI_Op &amp; get() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00276">compose_cedr.cpp:276</a></div></div>
<div class="ttc" id="astructcedr_1_1mpi_1_1_request_html"><div class="ttname"><a href="structcedr_1_1mpi_1_1_request.html">cedr::mpi::Request</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00224">compose_cedr.cpp:224</a></div></div>
<div class="ttc" id="astructcedr_1_1mpi_1_1_request_html_a4b34b505d84b830b36538152c39151b2"><div class="ttname"><a href="structcedr_1_1mpi_1_1_request.html#a4b34b505d84b830b36538152c39151b2">cedr::mpi::Request::request</a></div><div class="ttdeci">MPI_Request request</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00225">compose_cedr.cpp:225</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_arrays_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html">cedr::qlt::QLT::Arrays</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00749">compose_cedr.cpp:749</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_arrays_html_a5e73df43cb23f600d25596cbf56be503"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a5e73df43cb23f600d25596cbf56be503">cedr::qlt::QLT::Arrays::trcr2bl2r</a></div><div class="ttdeci">IntListT trcr2bl2r</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00763">compose_cedr.cpp:763</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_arrays_html_a82c1ec992eb8eacbf40cd36fb3597a7c"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a82c1ec992eb8eacbf40cd36fb3597a7c">cedr::qlt::QLT::Arrays::prob2bl2r</a></div><div class="ttdeci">Int prob2bl2r[nprobtypes+1]</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00761">compose_cedr.cpp:761</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_arrays_html_a869c5b42f9ad3209fe0f913b73db23b8"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#a869c5b42f9ad3209fe0f913b73db23b8">cedr::qlt::QLT::Arrays::trcr2br2l</a></div><div class="ttdeci">IntListT trcr2br2l</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00766">compose_cedr.cpp:766</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_arrays_html_ac7e103c98969b33015ba8d9def91601f"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ac7e103c98969b33015ba8d9def91601f">cedr::qlt::QLT::Arrays::bidx2trcr</a></div><div class="ttdeci">IntListT bidx2trcr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00756">compose_cedr.cpp:756</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_arrays_html_ad2714cc0919e9e0a1f5cf8baa540642f"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad2714cc0919e9e0a1f5cf8baa540642f">cedr::qlt::QLT::Arrays::trcr2prob</a></div><div class="ttdeci">IntListT trcr2prob</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00751">compose_cedr.cpp:751</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_arrays_html_ad445fe9e8595795ac65ed704e91f6baf"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad445fe9e8595795ac65ed704e91f6baf">cedr::qlt::QLT::Arrays::trcr2bidx</a></div><div class="ttdeci">IntListT trcr2bidx</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00758">compose_cedr.cpp:758</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_arrays_html_ad51124248b30607a6159b0984b2c2b7a"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_arrays.html#ad51124248b30607a6159b0984b2c2b7a">cedr::qlt::QLT::Arrays::prob2br2l</a></div><div class="ttdeci">Int prob2br2l[nprobtypes+1]</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00765">compose_cedr.cpp:765</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_c_p_t.html">cedr::qlt::QLT::CPT</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00778">compose_cedr.cpp:778</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html">cedr::qlt::QLT::MetaDataBuilder</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00739">compose_cedr.cpp:739</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder_html_acac9da1d9d3ad145e75d5f8ff2bf20a3"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html#acac9da1d9d3ad145e75d5f8ff2bf20a3">cedr::qlt::QLT::MetaDataBuilder::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; MetaDataBuilder &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00740">compose_cedr.cpp:740</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder_html_af35f9a2f88cf3ee57123a3e201616ff9"><div class="ttname"><a href="structcedr_1_1qlt_1_1_q_l_t_1_1_meta_data_builder.html#af35f9a2f88cf3ee57123a3e201616ff9">cedr::qlt::QLT::MetaDataBuilder::trcr2prob</a></div><div class="ttdeci">std::vector&lt; int &gt; trcr2prob</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00741">compose_cedr.cpp:741</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html">cedr::qlt::impl::NodeSets::Level::MPIMetaData</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00592">compose_cedr.cpp:592</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data_html_a0ed18ff2290e9cc3e3a42ca672ffc437"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#a0ed18ff2290e9cc3e3a42ca672ffc437">cedr::qlt::impl::NodeSets::Level::MPIMetaData::size</a></div><div class="ttdeci">Int size</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00595">compose_cedr.cpp:595</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data_html_a18780fe0b7ac08571587d3e6f5cf509d"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#a18780fe0b7ac08571587d3e6f5cf509d">cedr::qlt::impl::NodeSets::Level::MPIMetaData::offset</a></div><div class="ttdeci">Int offset</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00594">compose_cedr.cpp:594</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data_html_ab95674919a44c629cea0bf7710f4c8a8"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_1_1_m_p_i_meta_data.html#ab95674919a44c629cea0bf7710f4c8a8">cedr::qlt::impl::NodeSets::Level::MPIMetaData::rank</a></div><div class="ttdeci">Int rank</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00593">compose_cedr.cpp:593</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html">cedr::qlt::impl::NodeSets::Level</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00591">compose_cedr.cpp:591</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_html_a1958b88c6ac291db0d61b9097a4a0594"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a1958b88c6ac291db0d61b9097a4a0594">cedr::qlt::impl::NodeSets::Level::me_recv_req</a></div><div class="ttdeci">std::vector&lt; mpi::Request &gt; me_recv_req</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00602">compose_cedr.cpp:602</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_html_a29fb7a29d1605599d519fe2e61a88cce"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a29fb7a29d1605599d519fe2e61a88cce">cedr::qlt::impl::NodeSets::Level::me</a></div><div class="ttdeci">std::vector&lt; MPIMetaData &gt; me</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00601">compose_cedr.cpp:601</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_html_a64ec9159b1349d3b14b0df7f9644481b"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#a64ec9159b1349d3b14b0df7f9644481b">cedr::qlt::impl::NodeSets::Level::me_send_req</a></div><div class="ttdeci">std::vector&lt; mpi::Request &gt; me_send_req</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00602">compose_cedr.cpp:602</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_html_ab91cb12a201b968c34e530dc43f5931a"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#ab91cb12a201b968c34e530dc43f5931a">cedr::qlt::impl::NodeSets::Level::kids</a></div><div class="ttdeci">std::vector&lt; MPIMetaData &gt; kids</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00601">compose_cedr.cpp:601</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_html_adc4813ac17592bc41d7be16f6840e1b2"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#adc4813ac17592bc41d7be16f6840e1b2">cedr::qlt::impl::NodeSets::Level::kids_req</a></div><div class="ttdeci">std::vector&lt; mpi::Request &gt; kids_req</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00602">compose_cedr.cpp:602</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level_html_af8631dffaf9333cd3149a0103e63af22"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_level.html#af8631dffaf9333cd3149a0103e63af22">cedr::qlt::impl::NodeSets::Level::nodes</a></div><div class="ttdeci">std::vector&lt; Int &gt; nodes</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00599">compose_cedr.cpp:599</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html">cedr::qlt::impl::NodeSets::Node</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00558">compose_cedr.cpp:558</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node_html_a26a4b8a2c362cf90dc088cdb0a419050"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a26a4b8a2c362cf90dc088cdb0a419050">cedr::qlt::impl::NodeSets::Node::Node</a></div><div class="ttdeci">KOKKOS_FUNCTION Node()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00575">compose_cedr.cpp:575</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node_html_a409782388cb7ca69b2043b291cd901f4"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a409782388cb7ca69b2043b291cd901f4">cedr::qlt::impl::NodeSets::Node::offset</a></div><div class="ttdeci">Int offset</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00573">compose_cedr.cpp:573</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node_html_a602096b077cbe7cc0791976a72445e91"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a602096b077cbe7cc0791976a72445e91">cedr::qlt::impl::NodeSets::Node::rank</a></div><div class="ttdeci">Int rank</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00561">compose_cedr.cpp:561</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node_html_a62ddeb52897d22624365a25e4cad5662"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a62ddeb52897d22624365a25e4cad5662">cedr::qlt::impl::NodeSets::Node::kids</a></div><div class="ttdeci">Int kids[2]</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00570">compose_cedr.cpp:570</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node_html_a8fd5cc5c891fb77f704bb5c28926ea82"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#a8fd5cc5c891fb77f704bb5c28926ea82">cedr::qlt::impl::NodeSets::Node::id</a></div><div class="ttdeci">Int id</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00563">compose_cedr.cpp:563</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node_html_aa22fc635907a421d3a7874ea6f09a43a"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#aa22fc635907a421d3a7874ea6f09a43a">cedr::qlt::impl::NodeSets::Node::parent</a></div><div class="ttdeci">Int parent</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00565">compose_cedr.cpp:565</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node_html_ac8aab199bf4be0107260057b6ffadd3d"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_1_1_node.html#ac8aab199bf4be0107260057b6ffadd3d">cedr::qlt::impl::NodeSets::Node::nkids</a></div><div class="ttdeci">Int nkids</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00569">compose_cedr.cpp:569</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_device_data_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html">cedr::qlt::impl::NodeSetsDeviceData</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00636">compose_cedr.cpp:636</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_device_data_html_a1bb3148bcd1385b35d9b41a1b78f7029"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a1bb3148bcd1385b35d9b41a1b78f7029">cedr::qlt::impl::NodeSetsDeviceData::lvl</a></div><div class="ttdeci">IntList lvl</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00644">compose_cedr.cpp:644</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_device_data_html_a46e96087b90bfb5ea66f6db6378d9de1"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#a46e96087b90bfb5ea66f6db6378d9de1">cedr::qlt::impl::NodeSetsDeviceData::lvlptr</a></div><div class="ttdeci">IntList lvlptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00644">compose_cedr.cpp:644</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_device_data_html_aceb88f138b177aef682ff55d12fddeef"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#aceb88f138b177aef682ff55d12fddeef">cedr::qlt::impl::NodeSetsDeviceData::node</a></div><div class="ttdeci">NodeList node</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00641">compose_cedr.cpp:641</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_device_data_html_ad5e6cc429699f72099a6ed6f8a8f78e5"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#ad5e6cc429699f72099a6ed6f8a8f78e5">cedr::qlt::impl::NodeSetsDeviceData::IntList</a></div><div class="ttdeci">Kokkos::View&lt; Int *, Device &gt; IntList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00638">compose_cedr.cpp:638</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_device_data_html_ae2e0552864e4da6d10318d087ea45dfe"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#ae2e0552864e4da6d10318d087ea45dfe">cedr::qlt::impl::NodeSetsDeviceData::Device</a></div><div class="ttdeci">cedr::impl::DeviceType&lt; ExeSpace &gt;::type Device</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00637">compose_cedr.cpp:637</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_device_data_html_afaaed340bcf7e1c7cb6e1d8ec5075a79"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets_device_data.html#afaaed340bcf7e1c7cb6e1d8ec5075a79">cedr::qlt::impl::NodeSetsDeviceData::NodeList</a></div><div class="ttdeci">Kokkos::View&lt; NodeSets::Node *, Device &gt; NodeList</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00639">compose_cedr.cpp:639</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html">cedr::qlt::impl::NodeSets</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00552">compose_cedr.cpp:552</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_a2168adf08a01a3cdc1e506d7bb843066"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a2168adf08a01a3cdc1e506d7bb843066">cedr::qlt::impl::NodeSets::node_h</a></div><div class="ttdeci">const Node * node_h(const Int &amp;idx) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00625">compose_cedr.cpp:625</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_a3d8e325a238a32a9d36855b72e4fd293"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a3d8e325a238a32a9d36855b72e4fd293">cedr::qlt::impl::NodeSets::nslots</a></div><div class="ttdeci">Int nslots</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00609">compose_cedr.cpp:609</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_a46d290212390f403a3e00d16d5674636"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a46d290212390f403a3e00d16d5674636">cedr::qlt::impl::NodeSets::print</a></div><div class="ttdeci">void print(std::ostream &amp;os) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l02486">compose_cedr.cpp:2486</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_a80c73a0bd8c3eedb2c7206008d398369"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a80c73a0bd8c3eedb2c7206008d398369">cedr::qlt::impl::NodeSets::ConstPtr</a></div><div class="ttdeci">std::shared_ptr&lt; const NodeSets &gt; ConstPtr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00553">compose_cedr.cpp:553</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_a9010b20d4a700340bc86c16e9b241a01"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#a9010b20d4a700340bc86c16e9b241a01">cedr::qlt::impl::NodeSets::levels</a></div><div class="ttdeci">std::vector&lt; Level &gt; levels</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00606">compose_cedr.cpp:606</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_ad2f4f2e6a12a2a14af52bdeea6b0dd39"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad2f4f2e6a12a2a14af52bdeea6b0dd39">cedr::qlt::impl::NodeSets::alloc</a></div><div class="ttdeci">Int alloc()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00613">compose_cedr.cpp:613</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_ad81f72856653524d04016a4bd1a106c0"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ad81f72856653524d04016a4bd1a106c0">cedr::qlt::impl::NodeSets::node_h</a></div><div class="ttdeci">Node * node_h(const Int &amp;idx)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00621">compose_cedr.cpp:621</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_ae6835ea8185bc6ea84ead71203869fbca308a0ac1e8070200a48c6b84239bb60a"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#ae6835ea8185bc6ea84ead71203869fbca308a0ac1e8070200a48c6b84239bb60a">cedr::qlt::impl::NodeSets::mpitag</a></div><div class="ttdeci">@ mpitag</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00555">compose_cedr.cpp:555</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1impl_1_1_node_sets_html_aee6389fbf05b013dff31e396d2548c5e"><div class="ttname"><a href="structcedr_1_1qlt_1_1impl_1_1_node_sets.html#aee6389fbf05b013dff31e396d2548c5e">cedr::qlt::impl::NodeSets::nnode</a></div><div class="ttdeci">Int nnode() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00619">compose_cedr.cpp:619</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html">cedr::qlt::oned::Mesh::ParallelDecomp</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03522">compose_cedr.cpp:3522</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp_html_ab171dec9c69416e4f0ca11c5fab5ec31"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31">cedr::qlt::oned::Mesh::ParallelDecomp::Enum</a></div><div class="ttdeci">Enum</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03523">compose_cedr.cpp:3523</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp_html_ab171dec9c69416e4f0ca11c5fab5ec31a1da2969eecb0ed9914a58de2e0bbfae1"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh_1_1_parallel_decomp.html#ab171dec9c69416e4f0ca11c5fab5ec31a1da2969eecb0ed9914a58de2e0bbfae1">cedr::qlt::oned::Mesh::ParallelDecomp::contiguous</a></div><div class="ttdeci">@ contiguous</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03526">compose_cedr.cpp:3526</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh.html">cedr::qlt::oned::Mesh</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03521">compose_cedr.cpp:3521</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_html_a79b3f76cb7fc5abf605f41fde61d118d"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#a79b3f76cb7fc5abf605f41fde61d118d">cedr::qlt::oned::Mesh::Mesh</a></div><div class="ttdeci">Mesh(const Int nc, const Parallel::Ptr &amp;p, const ParallelDecomp::Enum &amp;parallel_decomp=ParallelDecomp::contiguous)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03534">compose_cedr.cpp:3534</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_html_aa6c579129d55b44a99ba355a8925cd2f"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#aa6c579129d55b44a99ba355a8925cd2f">cedr::qlt::oned::Mesh::unittest</a></div><div class="ttdeci">static Int unittest(const Parallel::Ptr &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03563">compose_cedr.cpp:3563</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_html_ab5825c8b59906112f369266651390dc5"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ab5825c8b59906112f369266651390dc5">cedr::qlt::oned::Mesh::parallel</a></div><div class="ttdeci">const Parallel::Ptr &amp; parallel() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03550">compose_cedr.cpp:3550</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_html_abeae5a51abcd1bca1ea4228a782849af"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#abeae5a51abcd1bca1ea4228a782849af">cedr::qlt::oned::Mesh::rank</a></div><div class="ttdeci">Int rank(const Int &amp;ci) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03552">compose_cedr.cpp:3552</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_html_ad0dc88f38b653772ac6d66ad088c926c"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ad0dc88f38b653772ac6d66ad088c926c">cedr::qlt::oned::Mesh::ncell</a></div><div class="ttdeci">Int ncell() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03548">compose_cedr.cpp:3548</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1oned_1_1_mesh_html_ae93021b1ad618e19cd9c6a4b6904280d"><div class="ttname"><a href="structcedr_1_1qlt_1_1oned_1_1_mesh.html#ae93021b1ad618e19cd9c6a4b6904280d">cedr::qlt::oned::Mesh::init</a></div><div class="ttdeci">void init(const Int nc, const Parallel::Ptr &amp;p, const ParallelDecomp::Enum &amp;parallel_decomp)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l03539">compose_cedr.cpp:3539</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html">cedr::qlt::test::Input</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00864">compose_cedr.cpp:864</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_a0a6ccc5d94ae8e3f487f331da739ba94"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#a0a6ccc5d94ae8e3f487f331da739ba94">cedr::qlt::test::Input::tracer_type</a></div><div class="ttdeci">Int tracer_type</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00866">compose_cedr.cpp:866</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_a3891ebb2177bb10e34b50fee35a6a908"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#a3891ebb2177bb10e34b50fee35a6a908">cedr::qlt::test::Input::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00867">compose_cedr.cpp:867</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_a4e1833af1045e63a2a2532fa7db02b6a"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#a4e1833af1045e63a2a2532fa7db02b6a">cedr::qlt::test::Input::ntracers</a></div><div class="ttdeci">Int ntracers</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00866">compose_cedr.cpp:866</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_a64b2c5e120cc9ba459c69a6f29bc6bd7"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#a64b2c5e120cc9ba459c69a6f29bc6bd7">cedr::qlt::test::Input::unittest</a></div><div class="ttdeci">bool unittest</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00865">compose_cedr.cpp:865</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_a6c43827bc4fa990eb3fb972249b92403"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#a6c43827bc4fa990eb3fb972249b92403">cedr::qlt::test::Input::write</a></div><div class="ttdeci">bool write</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00865">compose_cedr.cpp:865</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_a7317dba6f9385c1369b162913ed7ab92"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#a7317dba6f9385c1369b162913ed7ab92">cedr::qlt::test::Input::pseudorandom</a></div><div class="ttdeci">bool pseudorandom</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00867">compose_cedr.cpp:867</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_aa0f64406587f313e9309fa0c13530e16"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#aa0f64406587f313e9309fa0c13530e16">cedr::qlt::test::Input::nrepeat</a></div><div class="ttdeci">Int nrepeat</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00866">compose_cedr.cpp:866</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_ab62561957a57c9969924cf7cefaf25cf"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#ab62561957a57c9969924cf7cefaf25cf">cedr::qlt::test::Input::perftest</a></div><div class="ttdeci">bool perftest</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00865">compose_cedr.cpp:865</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1test_1_1_input_html_ac04a6af7b597b2c3696f22ce35c69615"><div class="ttname"><a href="structcedr_1_1qlt_1_1test_1_1_input.html#ac04a6af7b597b2c3696f22ce35c69615">cedr::qlt::test::Input::ncells</a></div><div class="ttdeci">Int ncells</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00866">compose_cedr.cpp:866</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html">cedr::qlt::tree::Node</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00652">compose_cedr.cpp:652</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_a792a2ecbc99f2bef73976b1560124dd3"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#a792a2ecbc99f2bef73976b1560124dd3">cedr::qlt::tree::Node::nkids</a></div><div class="ttdeci">Int nkids</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00657">compose_cedr.cpp:657</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_a89687110e6b7977fd8315fd8fd876b33"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#a89687110e6b7977fd8315fd8fd876b33">cedr::qlt::tree::Node::reserved</a></div><div class="ttdeci">Int reserved</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00659">compose_cedr.cpp:659</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_a897b7034c85009fac0ad1cff38666d12"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#a897b7034c85009fac0ad1cff38666d12">cedr::qlt::tree::Node::cellidx</a></div><div class="ttdeci">Long cellidx</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00656">compose_cedr.cpp:656</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_a935d3a370b4643ae2c846970b9701d40"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#a935d3a370b4643ae2c846970b9701d40">cedr::qlt::tree::Node::level</a></div><div class="ttdeci">Int level</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00660">compose_cedr.cpp:660</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_aa7c74cf6f178da4d95fba73f7d8957ac"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#aa7c74cf6f178da4d95fba73f7d8957ac">cedr::qlt::tree::Node::parent</a></div><div class="ttdeci">const Node * parent</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00654">compose_cedr.cpp:654</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_aaa27c4241f11ccd06b85ef015bd139f1"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#aaa27c4241f11ccd06b85ef015bd139f1">cedr::qlt::tree::Node::Node</a></div><div class="ttdeci">Node()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00663">compose_cedr.cpp:663</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_aae95dadec9c763ed43b5ce73f0eafa9e"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#aae95dadec9c763ed43b5ce73f0eafa9e">cedr::qlt::tree::Node::kids</a></div><div class="ttdeci">Node::Ptr kids[2]</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00658">compose_cedr.cpp:658</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_acd95c2b454683824cf551230d92684c0"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#acd95c2b454683824cf551230d92684c0">cedr::qlt::tree::Node::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; Node &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00653">compose_cedr.cpp:653</a></div></div>
<div class="ttc" id="astructcedr_1_1qlt_1_1tree_1_1_node_html_ad3cded9e7dc5ae27003bec236ef60bed"><div class="ttname"><a href="structcedr_1_1qlt_1_1tree_1_1_node.html#ad3cded9e7dc5ae27003bec236ef60bed">cedr::qlt::tree::Node::rank</a></div><div class="ttdeci">Int rank</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00655">compose_cedr.cpp:655</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html">cedr::test::TestRandomized::Tracer</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01767">compose_cedr.cpp:1767</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_a03dc0f277c68639a62ebb08b6081ebb2"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a03dc0f277c68639a62ebb08b6081ebb2">cedr::test::TestRandomized::Tracer::idx</a></div><div class="ttdeci">Int idx</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01770">compose_cedr.cpp:1770</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_a08ba125e4e78b508248c402b2db4b38b"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a08ba125e4e78b508248c402b2db4b38b">cedr::test::TestRandomized::Tracer::Tracer</a></div><div class="ttdeci">Tracer()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01778">compose_cedr.cpp:1778</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_a49ee7e7623121a14eebd29ef3d4f1dc6"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a49ee7e7623121a14eebd29ef3d4f1dc6">cedr::test::TestRandomized::Tracer::no_change_should_hold</a></div><div class="ttdeci">bool no_change_should_hold</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01773">compose_cedr.cpp:1773</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_a5e211d7b5ce0d93e738b39c969ffa580"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a5e211d7b5ce0d93e738b39c969ffa580">cedr::test::TestRandomized::Tracer::str</a></div><div class="ttdeci">std::string str() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04167">compose_cedr.cpp:4167</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_a71069357c9ff73580f40302e06157e94"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#a71069357c9ff73580f40302e06157e94">cedr::test::TestRandomized::Tracer::problem_type</a></div><div class="ttdeci">Int problem_type</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01771">compose_cedr.cpp:1771</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_aa67e9f878ebc02e7d9f7af1bf7e2bd35"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#aa67e9f878ebc02e7d9f7af1bf7e2bd35">cedr::test::TestRandomized::Tracer::safe_should_hold</a></div><div class="ttdeci">bool safe_should_hold</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01773">compose_cedr.cpp:1773</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_ac5fabda7fac9149a4f017fea51df5c4c"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#ac5fabda7fac9149a4f017fea51df5c4c">cedr::test::TestRandomized::Tracer::local_should_hold</a></div><div class="ttdeci">bool local_should_hold</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01773">compose_cedr.cpp:1773</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_ac6e02fc6c9238e222edf39a7a0e82778"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#ac6e02fc6c9238e222edf39a7a0e82778">cedr::test::TestRandomized::Tracer::PT</a></div><div class="ttdeci">ProblemType PT</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01768">compose_cedr.cpp:1768</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_af703e6851dbf67b2a1314cbb12fe0063"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#af703e6851dbf67b2a1314cbb12fe0063">cedr::test::TestRandomized::Tracer::perturbation_type</a></div><div class="ttdeci">Int perturbation_type</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01772">compose_cedr.cpp:1772</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_tracer_html_af81a8689094afe7aac9ebcce83e4c179"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_tracer.html#af81a8689094afe7aac9ebcce83e4c179">cedr::test::TestRandomized::Tracer::write</a></div><div class="ttdeci">bool write</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01774">compose_cedr.cpp:1774</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_html"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values.html">cedr::test::TestRandomized::Values</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01801">compose_cedr.cpp:1801</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_html_a19afaa1a320cc3cae65366f585b42513"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#a19afaa1a320cc3cae65366f585b42513">cedr::test::TestRandomized::Values::Values</a></div><div class="ttdeci">Values(const Int ntracers, const Int ncells)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01802">compose_cedr.cpp:1802</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_html_a448e626a73eb6be271c50a6c0536f10d"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#a448e626a73eb6be271c50a6c0536f10d">cedr::test::TestRandomized::Values::data</a></div><div class="ttdeci">Real * data()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01805">compose_cedr.cpp:1805</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_html_ae62c80499961f7f61b62feabeb13d787"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values.html#ae62c80499961f7f61b62feabeb13d787">cedr::test::TestRandomized::Values::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01806">compose_cedr.cpp:1806</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_partition_html"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html">cedr::test::TestRandomized::ValuesPartition</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01784">compose_cedr.cpp:1784</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_partition_html_a037049779c8e59c56442d30d1c9fd41b"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a037049779c8e59c56442d30d1c9fd41b">cedr::test::TestRandomized::ValuesPartition::Qm</a></div><div class="ttdeci">KIF Real * Qm(const Int &amp;ti) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01788">compose_cedr.cpp:1788</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_partition_html_a16f153cebcaaa7ab76a54309e5b620d1"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a16f153cebcaaa7ab76a54309e5b620d1">cedr::test::TestRandomized::ValuesPartition::Qm_min</a></div><div class="ttdeci">KIF Real * Qm_min(const Int &amp;ti) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01787">compose_cedr.cpp:1787</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_partition_html_a2468f9ea014eb03710c46ed4a00cb744"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a2468f9ea014eb03710c46ed4a00cb744">cedr::test::TestRandomized::ValuesPartition::ncells</a></div><div class="ttdeci">Int ncells() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01785">compose_cedr.cpp:1785</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_partition_html_a5a8a5b0f3d8f8f052ec909b82d7cc80c"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a5a8a5b0f3d8f8f052ec909b82d7cc80c">cedr::test::TestRandomized::ValuesPartition::rhom</a></div><div class="ttdeci">KIF Real * rhom() const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01786">compose_cedr.cpp:1786</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_partition_html_a693d6f396fc94541b61e60851b69d0d1"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a693d6f396fc94541b61e60851b69d0d1">cedr::test::TestRandomized::ValuesPartition::init</a></div><div class="ttdeci">void init(const Int ncells, Real *v)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01792">compose_cedr.cpp:1792</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_partition_html_a694cbce474a91ab6650d81824890ba22"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#a694cbce474a91ab6650d81824890ba22">cedr::test::TestRandomized::ValuesPartition::Qm_prev</a></div><div class="ttdeci">KIF Real * Qm_prev(const Int &amp;ti) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01790">compose_cedr.cpp:1790</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_values_partition_html_adb70e989019217376bb3d1546ad97280"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_values_partition.html#adb70e989019217376bb3d1546ad97280">cedr::test::TestRandomized::ValuesPartition::Qm_max</a></div><div class="ttdeci">KIF Real * Qm_max(const Int &amp;ti) const</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01789">compose_cedr.cpp:1789</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_writer_html"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html">cedr::test::TestRandomized::Writer</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01828">compose_cedr.cpp:1828</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_writer_html_a1fd27f80de4c4b4b4e3fc325dfb75d5e"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a1fd27f80de4c4b4b4e3fc325dfb75d5e">cedr::test::TestRandomized::Writer::displs</a></div><div class="ttdeci">std::vector&lt; int &gt; displs</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01832">compose_cedr.cpp:1832</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_writer_html_a2325c74c693d3ad4e8b5995e32bb4991"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a2325c74c693d3ad4e8b5995e32bb4991">cedr::test::TestRandomized::Writer::ngcis</a></div><div class="ttdeci">std::vector&lt; Int &gt; ngcis</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01830">compose_cedr.cpp:1830</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_writer_html_a3f6a632979c2b9c1218df22215eff8f8"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a3f6a632979c2b9c1218df22215eff8f8">cedr::test::TestRandomized::Writer::fh</a></div><div class="ttdeci">std::unique_ptr&lt; FILE, cedr::util::FILECloser &gt; fh</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01829">compose_cedr.cpp:1829</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_writer_html_a9455b49982ce8ff82ead07b02fbf72f9"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#a9455b49982ce8ff82ead07b02fbf72f9">cedr::test::TestRandomized::Writer::gcis</a></div><div class="ttdeci">std::vector&lt; Long &gt; gcis</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01831">compose_cedr.cpp:1831</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1_test_randomized_1_1_writer_html_afea30e4be158d5f880325c10443c273b"><div class="ttname"><a href="structcedr_1_1test_1_1_test_randomized_1_1_writer.html#afea30e4be158d5f880325c10443c273b">cedr::test::TestRandomized::Writer::~Writer</a></div><div class="ttdeci">~Writer()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04179">compose_cedr.cpp:4179</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_initial_condition_html"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html">cedr::test::transport1d::InitialCondition</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04696">compose_cedr.cpp:4696</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_initial_condition_html_a0afc5a23a3575d19828572474a2416a1"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a0afc5a23a3575d19828572474a2416a1">cedr::test::transport1d::InitialCondition::Enum</a></div><div class="ttdeci">Enum</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04697">compose_cedr.cpp:4697</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_initial_condition_html_a0afc5a23a3575d19828572474a2416a1ac20f36178f0cec638fecd03cbd31f535"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a0afc5a23a3575d19828572474a2416a1ac20f36178f0cec638fecd03cbd31f535">cedr::test::transport1d::InitialCondition::bell</a></div><div class="ttdeci">@ bell</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04697">compose_cedr.cpp:4697</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_initial_condition_html_a3131bcc84468541b84284e5b75e8b8f7"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a3131bcc84468541b84284e5b75e8b8f7">cedr::test::transport1d::InitialCondition::eval</a></div><div class="ttdeci">static Real eval(const Enum &amp;ic, const Real x)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04715">compose_cedr.cpp:4715</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_initial_condition_html_a372463455b447aeb1beb9311a5475eda"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a372463455b447aeb1beb9311a5475eda">cedr::test::transport1d::InitialCondition::convert</a></div><div class="ttdeci">static Enum convert(const std::string &amp;s)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04707">compose_cedr.cpp:4707</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_initial_condition_html_a96d256bc7588a2c6635edb4d12a87267"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_initial_condition.html#a96d256bc7588a2c6635edb4d12a87267">cedr::test::transport1d::InitialCondition::convert</a></div><div class="ttdeci">static std::string convert(const Enum &amp;e)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l04698">compose_cedr.cpp:4698</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_input_html"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_input.html">cedr::test::transport1d::Input</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01978">compose_cedr.cpp:1978</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_input_html_a8c967b9b5d7c178b4a43536fa8210d3b"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_input.html#a8c967b9b5d7c178b4a43536fa8210d3b">cedr::test::transport1d::Input::ncells</a></div><div class="ttdeci">Int ncells</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01979">compose_cedr.cpp:1979</a></div></div>
<div class="ttc" id="astructcedr_1_1test_1_1transport1d_1_1_input_html_ab1ce2cdac0384c4e09992db35e1a25b7"><div class="ttname"><a href="structcedr_1_1test_1_1transport1d_1_1_input.html#ab1ce2cdac0384c4e09992db35e1a25b7">cedr::test::transport1d::Input::verbose</a></div><div class="ttdeci">bool verbose</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l01980">compose_cedr.cpp:1980</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_f_i_l_e_closer_html"><div class="ttname"><a href="structcedr_1_1util_1_1_f_i_l_e_closer.html">cedr::util::FILECloser</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00377">compose_cedr.cpp:377</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_f_i_l_e_closer_html_a628a5c38409e8571169ca24df78c9ed3"><div class="ttname"><a href="structcedr_1_1util_1_1_f_i_l_e_closer.html#a628a5c38409e8571169ca24df78c9ed3">cedr::util::FILECloser::operator()</a></div><div class="ttdeci">void operator()(FILE *fh)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00377">compose_cedr.cpp:377</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_raw_array_raft_html"><div class="ttname"><a href="structcedr_1_1util_1_1_raw_array_raft.html">cedr::util::RawArrayRaft</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00380">compose_cedr.cpp:380</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_raw_array_raft_html_a0c93fb7bedaefa430740c716fc9b5679"><div class="ttname"><a href="structcedr_1_1util_1_1_raw_array_raft.html#a0c93fb7bedaefa430740c716fc9b5679">cedr::util::RawArrayRaft::Device</a></div><div class="ttdeci">cedr::impl::DeviceType&lt; ExeSpace &gt;::type Device</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00381">compose_cedr.cpp:381</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_raw_array_raft_html_a6477a26e112f9bdcd241f943836991f2"><div class="ttname"><a href="structcedr_1_1util_1_1_raw_array_raft.html#a6477a26e112f9bdcd241f943836991f2">cedr::util::RawArrayRaft::device_ptr</a></div><div class="ttdeci">T * device_ptr()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00401">compose_cedr.cpp:401</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_raw_array_raft_html_a68a6e0b2cca3384d2f91b067b11e46fd"><div class="ttname"><a href="structcedr_1_1util_1_1_raw_array_raft.html#a68a6e0b2cca3384d2f91b067b11e46fd">cedr::util::RawArrayRaft::RawArrayRaft</a></div><div class="ttdeci">RawArrayRaft(T *a, const Int n)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00384">compose_cedr.cpp:384</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_raw_array_raft_html_a6984d9f19d5f816ecce7ebf08dc92b9d"><div class="ttname"><a href="structcedr_1_1util_1_1_raw_array_raft.html#a6984d9f19d5f816ecce7ebf08dc92b9d">cedr::util::RawArrayRaft::sync_host</a></div><div class="ttdeci">T * sync_host()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00396">compose_cedr.cpp:396</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_raw_array_raft_html_a80ddb92836fd045166cca9068999d90e"><div class="ttname"><a href="structcedr_1_1util_1_1_raw_array_raft.html#a80ddb92836fd045166cca9068999d90e">cedr::util::RawArrayRaft::sync_device</a></div><div class="ttdeci">const List &amp; sync_device()</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00391">compose_cedr.cpp:391</a></div></div>
<div class="ttc" id="astructcedr_1_1util_1_1_raw_array_raft_html_a82c44a66fe4bb3fa084a173c02b9df6a"><div class="ttname"><a href="structcedr_1_1util_1_1_raw_array_raft.html#a82c44a66fe4bb3fa084a173c02b9df6a">cedr::util::RawArrayRaft::List</a></div><div class="ttdeci">Kokkos::View&lt; T *, Device &gt; List</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l00382">compose_cedr.cpp:382</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_1_1_alg_html"><div class="ttname"><a href="structhomme_1_1_c_d_r_1_1_alg.html">homme::CDR::Alg</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05842">compose_cedr.cpp:5842</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_1_1_alg_html_a4056f274fa96da8b23a8e39c91170f53"><div class="ttname"><a href="structhomme_1_1_c_d_r_1_1_alg.html#a4056f274fa96da8b23a8e39c91170f53">homme::CDR::Alg::is_qlt</a></div><div class="ttdeci">static bool is_qlt(Enum e)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05855">compose_cedr.cpp:5855</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_1_1_alg_html_a6b5539c8fd514df0f1c14fe22aae64cb"><div class="ttname"><a href="structhomme_1_1_c_d_r_1_1_alg.html#a6b5539c8fd514df0f1c14fe22aae64cb">homme::CDR::Alg::is_caas</a></div><div class="ttdeci">static bool is_caas(Enum e)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05859">compose_cedr.cpp:5859</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_1_1_alg_html_a9304074515e56b9df2169a5935fe1f1a"><div class="ttname"><a href="structhomme_1_1_c_d_r_1_1_alg.html#a9304074515e56b9df2169a5935fe1f1a">homme::CDR::Alg::is_suplev</a></div><div class="ttdeci">static bool is_suplev(Enum e)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05862">compose_cedr.cpp:5862</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_1_1_alg_html_aa9f42eb489d369dba42d57c543a8e93d"><div class="ttname"><a href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93d">homme::CDR::Alg::Enum</a></div><div class="ttdeci">Enum</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05843">compose_cedr.cpp:5843</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_1_1_alg_html_aa9f42eb489d369dba42d57c543a8e93dabc280075b6f765f9f6eebdb8da190c48"><div class="ttname"><a href="structhomme_1_1_c_d_r_1_1_alg.html#aa9f42eb489d369dba42d57c543a8e93dabc280075b6f765f9f6eebdb8da190c48">homme::CDR::Alg::caas</a></div><div class="ttdeci">@ caas</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05843">compose_cedr.cpp:5843</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_1_1_alg_html_ab466646e99d1630a69bc3315d58089ac"><div class="ttname"><a href="structhomme_1_1_c_d_r_1_1_alg.html#ab466646e99d1630a69bc3315d58089ac">homme::CDR::Alg::convert</a></div><div class="ttdeci">static Enum convert(Int cdr_alg)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05844">compose_cedr.cpp:5844</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html"><div class="ttname"><a href="structhomme_1_1_c_d_r.html">homme::CDR</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05837">compose_cedr.cpp:5837</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a016aaed67a618a7adcc01b7e49218e6d"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a016aaed67a618a7adcc01b7e49218e6d">homme::CDR::CDR</a></div><div class="ttdeci">CDR(Int cdr_alg_, Int ngblcell_, Int nlclcell_, Int nlev_, bool use_sgi, bool independent_time_steps, const bool hard_zero_, const Int *gid_data, const Int *rank_data, const cedr::mpi::Parallel::Ptr &amp;p_, Int fcomm)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05880">compose_cedr.cpp:5880</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a09a617cd556ff89e82bc8b8b944d5a37"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a09a617cd556ff89e82bc8b8b944d5a37">homme::CDR::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; CDR &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05838">compose_cedr.cpp:5838</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a155fed2c976bb416d98b1872031c1cec"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a155fed2c976bb416d98b1872031c1cec">homme::CDR::set_buffers</a></div><div class="ttdeci">void set_buffers(Real *b1, Real *b2)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05931">compose_cedr.cpp:5931</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a18d74187f34c6912e38b5c0f18585279"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a18d74187f34c6912e38b5c0f18585279">homme::CDR::caas_in_suplev</a></div><div class="ttdeci">const bool caas_in_suplev</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05872">compose_cedr.cpp:5872</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a2cb44e5b7d50b2508163b9182b684152"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a2cb44e5b7d50b2508163b9182b684152">homme::CDR::alg</a></div><div class="ttdeci">const Alg::Enum alg</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05870">compose_cedr.cpp:5870</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a312dcd3a0eac5a93efcc83b2f94b307d"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a312dcd3a0eac5a93efcc83b2f94b307d">homme::CDR::QLTT</a></div><div class="ttdeci">compose::QLT&lt; ComposeDefaultExecutionSpace &gt; QLTT</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05839">compose_cedr.cpp:5839</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a4132475f81e4b5caa43a6a423eb744f5"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a4132475f81e4b5caa43a6a423eb744f5">homme::CDR::init_tracers</a></div><div class="ttdeci">void init_tracers(const Int qsize, const bool need_conservation)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05917">compose_cedr.cpp:5917</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a439bf32ade8386e86b8c7e470f97cda9"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a439bf32ade8386e86b8c7e470f97cda9">homme::CDR::cdr_over_super_levels</a></div><div class="ttdeci">const bool cdr_over_super_levels</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05872">compose_cedr.cpp:5872</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a46d5e2e662bdf4c6df29ac160830ab5c"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a46d5e2e662bdf4c6df29ac160830ab5c">homme::CDR::cdr</a></div><div class="ttdeci">cedr::CDR::Ptr cdr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05875">compose_cedr.cpp:5875</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a47537d3519ad8d7735a226b92d25c08e"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a47537d3519ad8d7735a226b92d25c08e">homme::CDR::nsublev</a></div><div class="ttdeci">const Int nsublev</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05871">compose_cedr.cpp:5871</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a4de5322e2f5b8b568b8f9fb8d08aa5d8"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a4de5322e2f5b8b568b8f9fb8d08aa5d8">homme::CDR::tree</a></div><div class="ttdeci">qlt::tree::Node::Ptr tree</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05874">compose_cedr.cpp:5874</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a506ae277c2a25c448f5c13e2095c1c14"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a506ae277c2a25c448f5c13e2095c1c14">homme::CDR::nlclcell</a></div><div class="ttdeci">const Int nlclcell</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05871">compose_cedr.cpp:5871</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a51fc0b9acba5d16cb4682ace1afb76c1"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a51fc0b9acba5d16cb4682ace1afb76c1">homme::CDR::get_buffers_sizes</a></div><div class="ttdeci">void get_buffers_sizes(size_t &amp;s1, size_t &amp;s2)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05927">compose_cedr.cpp:5927</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a54ef29fe424bcff8c51d19a913d05b14"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a54ef29fe424bcff8c51d19a913d05b14">homme::CDR::CAAST</a></div><div class="ttdeci">compose::CAAS CAAST</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05840">compose_cedr.cpp:5840</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a580100f8dd928cedf1040ffa726ee3cb"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a580100f8dd928cedf1040ffa726ee3cb">homme::CDR::nonneg</a></div><div class="ttdeci">std::vector&lt; char &gt; nonneg</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05878">compose_cedr.cpp:5878</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a65d5e4f8f637ab0627de4e8e30e1a5ec"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a65d5e4f8f637ab0627de4e8e30e1a5ec">homme::CDR::p</a></div><div class="ttdeci">const cedr::mpi::Parallel::Ptr p</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05873">compose_cedr.cpp:5873</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a6d5be3cd5f625d36748823e8643bdfa9"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a6d5be3cd5f625d36748823e8643bdfa9">homme::CDR::ie2gci</a></div><div class="ttdeci">std::vector&lt; Int &gt; ie2gci</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05876">compose_cedr.cpp:5876</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_a7a970028d8677b332dc2a3ff89716acc"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#a7a970028d8677b332dc2a3ff89716acc">homme::CDR::nsuplev</a></div><div class="ttdeci">const Int nsuplev</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05871">compose_cedr.cpp:5871</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_ab96d0824701e73a05788e65b65a4bbf8"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#ab96d0824701e73a05788e65b65a4bbf8">homme::CDR::threed</a></div><div class="ttdeci">const bool threed</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05872">compose_cedr.cpp:5872</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_abccd85f1a2983f34bcd18a6ad6190261"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#abccd85f1a2983f34bcd18a6ad6190261">homme::CDR::ie2lci</a></div><div class="ttdeci">std::vector&lt; Int &gt; ie2lci</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05877">compose_cedr.cpp:5877</a></div></div>
<div class="ttc" id="astructhomme_1_1_c_d_r_html_ae6a59217fb6d619637564d88a9a8e994"><div class="ttname"><a href="structhomme_1_1_c_d_r.html#ae6a59217fb6d619637564d88a9a8e994">homme::CDR::ncell</a></div><div class="ttdeci">const Int ncell</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05871">compose_cedr.cpp:5871</a></div></div>
<div class="ttc" id="astructhomme_1_1_repro_sum_reducer_html"><div class="ttname"><a href="structhomme_1_1_repro_sum_reducer.html">homme::ReproSumReducer</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05811">compose_cedr.cpp:5812</a></div></div>
<div class="ttc" id="astructhomme_1_1_repro_sum_reducer_html_aae37a15f884a78645215877e29ac91b4"><div class="ttname"><a href="structhomme_1_1_repro_sum_reducer.html#aae37a15f884a78645215877e29ac91b4">homme::ReproSumReducer::n_accum_in_place</a></div><div class="ttdeci">int n_accum_in_place() const override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05817">compose_cedr.cpp:5817</a></div></div>
<div class="ttc" id="astructhomme_1_1_repro_sum_reducer_html_aff1fe8ae9e3487f1305bacf9b807aee2"><div class="ttname"><a href="structhomme_1_1_repro_sum_reducer.html#aff1fe8ae9e3487f1305bacf9b807aee2">homme::ReproSumReducer::ReproSumReducer</a></div><div class="ttdeci">ReproSumReducer(Int fcomm, Int n_accum_in_place)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05813">compose_cedr.cpp:5813</a></div></div>
<div class="ttc" id="astructhomme_1_1compose_1_1_c_a_a_s_html"><div class="ttname"><a href="structhomme_1_1compose_1_1_c_a_a_s.html">homme::compose::CAAS</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05447">compose_cedr.cpp:5447</a></div></div>
<div class="ttc" id="astructhomme_1_1compose_1_1_c_a_a_s_html_aa35344117a2c3047d4bc232737882688"><div class="ttname"><a href="structhomme_1_1compose_1_1_c_a_a_s.html#aa35344117a2c3047d4bc232737882688">homme::compose::CAAS::CAAS</a></div><div class="ttdeci">CAAS(const cedr::mpi::Parallel::Ptr &amp;p, const cedr::Int nlclcells, const typename Super::UserAllReducer::Ptr &amp;uar)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05450">compose_cedr.cpp:5450</a></div></div>
<div class="ttc" id="astructhomme_1_1compose_1_1_c_a_a_s_html_aded87ebde8108fd6d98116c47770406b"><div class="ttname"><a href="structhomme_1_1compose_1_1_c_a_a_s.html#aded87ebde8108fd6d98116c47770406b">homme::compose::CAAS::run</a></div><div class="ttdeci">void run() override</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05455">compose_cedr.cpp:5455</a></div></div>
<div class="ttc" id="astructhomme_1_1compose_1_1_c_a_a_s_html_ae8f4c2856aecf1da86efc78184e9ba12"><div class="ttname"><a href="structhomme_1_1compose_1_1_c_a_a_s.html#ae8f4c2856aecf1da86efc78184e9ba12">homme::compose::CAAS::Super</a></div><div class="ttdeci">cedr::caas::CAAS&lt; Kokkos::Serial &gt; Super</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l05448">compose_cedr.cpp:5448</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_1_1_check_html"><div class="ttname"><a href="structhomme_1_1sl_1_1_data_1_1_check.html">homme::sl::Data::Check</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06022">compose_cedr.cpp:6022</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_1_1_check_html_a609733b84b38c38d706eb0dc103cefaf"><div class="ttname"><a href="structhomme_1_1sl_1_1_data_1_1_check.html#a609733b84b38c38d706eb0dc103cefaf">homme::sl::Data::Check::Check</a></div><div class="ttdeci">Check(const Int nlev, const Int qsize)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06026">compose_cedr.cpp:6026</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_1_1_check_html_a9a9b3047bb76a1342b727eac60fdf240"><div class="ttname"><a href="structhomme_1_1sl_1_1_data_1_1_check.html#a9a9b3047bb76a1342b727eac60fdf240">homme::sl::Data::Check::q_hi</a></div><div class="ttdeci">Kokkos::View&lt; Real **, Kokkos::Serial &gt; q_hi</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06025">compose_cedr.cpp:6025</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_1_1_check_html_af23c5177ca2f9c31e6c121a5b28b31a3"><div class="ttname"><a href="structhomme_1_1sl_1_1_data_1_1_check.html#af23c5177ca2f9c31e6c121a5b28b31a3">homme::sl::Data::Check::mass_c</a></div><div class="ttdeci">Kokkos::View&lt; Real **, Kokkos::Serial &gt; mass_c</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06024">compose_cedr.cpp:6024</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html">homme::sl::Data</a></div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06014">compose_cedr.cpp:6014</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a135e738ab8e648527e1e65df756837ce"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a135e738ab8e648527e1e65df756837ce">homme::sl::Data::spheremp</a></div><div class="ttdeci">std::vector&lt; const Real * &gt; spheremp</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06018">compose_cedr.cpp:6018</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a16e071b6c5d1231986e1e9ac711f3d38"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a16e071b6c5d1231986e1e9ac711f3d38">homme::sl::Data::n1_qdp</a></div><div class="ttdeci">Int n1_qdp</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06017">compose_cedr.cpp:6017</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a3397c381bfa9258d9f2d3a5732b424d9"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a3397c381bfa9258d9f2d3a5732b424d9">homme::sl::Data::qdp_pc</a></div><div class="ttdeci">std::vector&lt; Real * &gt; qdp_pc</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06019">compose_cedr.cpp:6019</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a37427a8b8f6743d5cf71e2fa221e43e0"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a37427a8b8f6743d5cf71e2fa221e43e0">homme::sl::Data::qsize_d</a></div><div class="ttdeci">const Int qsize_d</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06016">compose_cedr.cpp:6016</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a478e430b254a150d34cf695ec67a0c24"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a478e430b254a150d34cf695ec67a0c24">homme::sl::Data::Ptr</a></div><div class="ttdeci">std::shared_ptr&lt; Data &gt; Ptr</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06015">compose_cedr.cpp:6015</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a62711b4d4e7930645bdb0ba1cfe26609"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a62711b4d4e7930645bdb0ba1cfe26609">homme::sl::Data::q_c</a></div><div class="ttdeci">std::vector&lt; Real * &gt; q_c</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06019">compose_cedr.cpp:6019</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a73e2935f5f6adf54fb92d82eacfe568e"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a73e2935f5f6adf54fb92d82eacfe568e">homme::sl::Data::Data</a></div><div class="ttdeci">Data(Int lcl_ncell, Int np_, Int nlev_, Int qsize_, Int qsize_d_, Int timelevels_)</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06036">compose_cedr.cpp:6036</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a7991285f31b9e01876257ab73f72e3e7"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a7991285f31b9e01876257ab73f72e3e7">homme::sl::Data::timelevels</a></div><div class="ttdeci">const Int timelevels</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06016">compose_cedr.cpp:6016</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a876735b0b355ed0c4b2ef9cc95780352"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a876735b0b355ed0c4b2ef9cc95780352">homme::sl::Data::np</a></div><div class="ttdeci">const Int np</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06016">compose_cedr.cpp:6016</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a8e206bd01ee59ca1ac34cb747e102f88"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a8e206bd01ee59ca1ac34cb747e102f88">homme::sl::Data::n0_qdp</a></div><div class="ttdeci">Int n0_qdp</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06017">compose_cedr.cpp:6017</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a8fd6ca9f4f9a4846438a4fbe4733c831"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a8fd6ca9f4f9a4846438a4fbe4733c831">homme::sl::Data::nlev</a></div><div class="ttdeci">const Int nlev</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06016">compose_cedr.cpp:6016</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a90986b4edf9bac72ca4a0af464313def"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a90986b4edf9bac72ca4a0af464313def">homme::sl::Data::dp0</a></div><div class="ttdeci">const Real * dp0</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06020">compose_cedr.cpp:6020</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_a9f4e305c4da85a04d5f98059ab200f29"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#a9f4e305c4da85a04d5f98059ab200f29">homme::sl::Data::tl_np1</a></div><div class="ttdeci">Int tl_np1</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06017">compose_cedr.cpp:6017</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_ab8feb2fa8ea775863acf9687a8d3d5fa"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#ab8feb2fa8ea775863acf9687a8d3d5fa">homme::sl::Data::dp3d_c</a></div><div class="ttdeci">std::vector&lt; const Real * &gt; dp3d_c</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06018">compose_cedr.cpp:6018</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_acaa835ddf027bf5c839af61dae8b6747"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#acaa835ddf027bf5c839af61dae8b6747">homme::sl::Data::check</a></div><div class="ttdeci">std::shared_ptr&lt; Check &gt; check</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06034">compose_cedr.cpp:6034</a></div></div>
<div class="ttc" id="astructhomme_1_1sl_1_1_data_html_af6d3d34b49e375a578fe909f5207158e"><div class="ttname"><a href="structhomme_1_1sl_1_1_data.html#af6d3d34b49e375a578fe909f5207158e">homme::sl::Data::qsize</a></div><div class="ttdeci">const Int qsize</div><div class="ttdef"><b>Definition:</b> <a href="compose__cedr_8cpp_source.html#l06016">compose_cedr.cpp:6016</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_0b9b079b26fcc9f7494e277d37e7b67d.html">share</a></li><li class="navelem"><a class="el" href="dir_ba74d2a1222e90ef480fd96e94c40893.html">compose</a></li><li class="navelem"><a class="el" href="compose__cedr_8cpp.html">compose_cedr.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
